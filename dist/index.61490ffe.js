var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},i={},s=t.parcelRequiref6c0;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var n={id:t,exports:{}};return e[t]=n,s.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){i[t]=e},t.parcelRequiref6c0=s),s.register("ew4tU",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0}),t.exports.hard=t.exports.medium=t.exports.easy=t.exports.getCell=t.exports.getBounds=void 0;t.exports.getBounds=t=>({top:0,left:0,right:t[0].length-1,bottom:t.length-1});t.exports.getCell=(t,e)=>{const i=t[e.y];let s=-1;return void 0!==i&&(s=i[e.x]),s},t.exports.easy=[[.1,.2,.2,.2,.1],[.2,.3,.5,.3,.2],[.2,.5,1,.5,.2],[.2,.3,.5,.3,.2],[.1,.2,.2,.2,.1]],t.exports.medium=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,.2,0,0,0,0,0,0],[0,0,0,0,0,.3,.5,.3,0,0,0,0,0],[0,0,0,0,.2,.5,1,.5,.2,0,0,0,0],[0,0,0,0,0,.3,.5,.3,0,0,0,0,0],[0,0,0,0,0,0,.2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],t.exports.hard=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,.3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,.3,.4,.3,0,0,0,0,0,0,0,0,0,0],[0,0,0,.3,.4,.5,.4,.3,0,0,0,0,0,.3,0,0,0],[0,0,.2,.3,.5,.6,.5,.3,.2,0,0,0,.3,.7,.3,0,0],[0,.2,.3,.3,.5,.6,.5,.3,.3,.2,0,.3,.7,1,.7,.3,0],[0,0,.2,.3,.5,.6,.5,.3,.2,0,0,0,.3,.7,.3,0,0],[0,0,0,.3,.4,.5,.4,.3,0,0,0,0,0,.3,0,0,0],[0,0,0,0,.3,.4,.3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,.3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]})),s.register("f867C",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0}),t.exports.toString=t.exports.add=t.exports.LEFT=t.exports.DOWN=t.exports.RIGHT=t.exports.UP=void 0,t.exports.UP={x:0,y:-1},t.exports.RIGHT={x:1,y:0},t.exports.DOWN={x:0,y:1},t.exports.LEFT={x:-1,y:0};t.exports.add=(t,e)=>({x:t.x+e.x,y:t.y+e.y});t.exports.toString=t=>`(${t.x}, ${t.y})`}));Object.defineProperty({},"__esModule",{value:!0});var n={},r=n&&n.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),o=n&&n.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),h=n&&n.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return o(e,t),e};Object.defineProperty(n,"__esModule",{value:!0}),n.start=void 0;var l={},a=l&&l.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),c=l&&l.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),d=l&&l.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&a(e,t,i);return c(e,t),e};Object.defineProperty(l,"__esModule",{value:!0}),l.makeRunner=l.useSensor=l.drill=l.moveLeft=l.moveDown=l.moveRight=l.moveUp=void 0;const u=d(s("ew4tU")),f=d(s("f867C")),p=t=>e=>{if(e.acted)throw new Error("Already acted this turn.");return e.acted=!0,t(e)},g=(t,e)=>{const i=f.add(t.position,e),s=u.getBounds(t.stage);if(i.x<s.left||i.x>s.right||i.y<s.top||i.y>s.bottom)throw new Error(`Invalid position: ${f.toString(i)}`);t.position=i};l.moveUp=p((t=>g(t,f.UP))),l.moveRight=p((t=>g(t,f.RIGHT))),l.moveDown=p((t=>g(t,f.DOWN))),l.moveLeft=p((t=>g(t,f.LEFT))),l.drill=p((t=>{t.oil+=u.getCell(t.stage,t.position)}));l.useSensor=t=>({center:u.getCell(t.stage,t.position),top:u.getCell(t.stage,f.add(t.position,f.UP)),right:u.getCell(t.stage,f.add(t.position,f.RIGHT)),bottom:u.getCell(t.stage,f.add(t.position,f.DOWN)),left:u.getCell(t.stage,f.add(t.position,f.LEFT))});l.makeRunner=t=>({moveUp:()=>(0,l.moveUp)(t),moveRight:()=>(0,l.moveRight)(t),moveDown:()=>(0,l.moveDown)(t),moveLeft:()=>(0,l.moveLeft)(t),drill:()=>(0,l.drill)(t),useSensor:()=>(0,l.useSensor)(t),getPosition:()=>Object.assign({},t.position)});var m=s("ew4tU");const w=h(s("f867C"));let v="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let t=1;t<v.length;t++)v[t]+=v[t-1];function y(t){for(let e=1;e<v.length;e+=2)if(v[e]>t)return v[e-1]<=t;return!1}function b(t){return t>=127462&&t<=127487}function O(t,e,i=!0,s=!0){return(i?S:x)(t,e,s)}function S(t,e,i){if(e==t.length)return e;e&&k(t.charCodeAt(e))&&A(t.charCodeAt(e-1))&&e--;let s=M(t,e);for(e+=T(s);e<t.length;){let n=M(t,e);if(8205==s||8205==n||i&&y(n))e+=T(n),s=n;else{if(!b(n))break;{let i=0,s=e-2;for(;s>=0&&b(M(t,s));)i++,s-=2;if(i%2==0)break;e+=2}}}return e}function x(t,e,i){for(;e>0;){let s=S(t,e-2,i);if(s<e)return s;e--}return 0}function k(t){return t>=56320&&t<57344}function A(t){return t>=55296&&t<56320}function M(t,e){let i=t.charCodeAt(e);if(!A(i)||e+1==t.length)return i;let s=t.charCodeAt(e+1);return k(s)?s-56320+(i-55296<<10)+65536:i}function C(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function T(t){return t<65536?1:2}function D(t,e,i=t.length){let s=0;for(let n=0;n<i;)9==t.charCodeAt(n)?(s+=e-s%e,n++):(s++,n=O(t,n));return s}function R(t,e,i,s){for(let s=0,n=0;;){if(n>=e)return s;if(s==t.length)break;n+=9==t.charCodeAt(s)?i-n%i:1,s=O(t,s)}return!0===s?-1:t.length}class E{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),P.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),P.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new W(this),n=new W(t);for(let t=e,r=e;;){if(s.next(t),n.next(t),t=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(r+=s.value.length,s.done||r>=i)return!0}}iter(t=1){return new W(this,t)}iterRange(t,e=this.length){return new N(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new H(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new B(t):P.from(B.split(t,[])):E.empty}}class B extends E{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((e?i:o)>=t)return new Q(s,o,i,r);s=o+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new B(V(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&s){let t=i.pop(),e=L(n.text,t.text.slice(),0,n.length);if(e.length<=32)i.push(new B(e,t.length+n.length));else{let t=e.length>>1;i.push(new B(e.slice(0,t)),new B(e.slice(t)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof B))return super.replace(t,e,i);let s=L(this.text,L(i.text,V(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new B(s,n):P.from(B.split(s,[]),n)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<=e&&r<this.text.length;r++){let o=this.text[r],h=n+o.length;n>t&&r&&(s+=i),t<h&&e>n&&(s+=o.slice(Math.max(0,t-n),e-n)),n=h+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,32==i.length&&(e.push(new B(i,s)),i=[],s=-1);return s>-1&&e.push(new B(i,s)),e}}class P extends E{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,h=i+r.lines-1;if((e?h:o)>=t)return r.lineInner(t,e,i,s);s=o+1,i=h+1}}decompose(t,e,i,s){for(let n=0,r=0;r<=e&&n<this.children.length;n++){let o=this.children[n],h=r+o.length;if(t<=h&&e>=r){let n=s&((r<=t?1:0)|(h>=e?2:0));r>=t&&h<=e&&!n?i.push(o):o.decompose(t-r,e-r,i,n)}r=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(t>=n&&e<=o){let h=r.replace(t-n,e-n,i),l=this.lines-r.lines+h.lines;if(h.lines<l>>4&&h.lines>l>>6){let n=this.children.slice();return n[s]=h,new P(n,this.length-(e-t)+i.length)}return super.replace(n,o,h)}n=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=e;n++){let o=this.children[n],h=r+o.length;r>t&&n&&(s+=i),t<h&&e>r&&(s+=o.sliceString(t-r,e-r,i)),r=h+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof P))return 0;let i=0,[s,n,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==r||n==o)return i;let h=this.children[s],l=t.children[n];if(h!=l)return i+h.scanIdentical(l,e);i+=h.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new B(i,e)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],h=0,l=-1,a=[];function c(t){let e;if(t.lines>n&&t instanceof P)for(let e of t.children)c(e);else t.lines>r&&(h>r||!h)?(d(),o.push(t)):t instanceof B&&h&&(e=a[a.length-1])instanceof B&&t.lines+e.lines<=32?(h+=t.lines,l+=t.length+1,a[a.length-1]=new B(e.text.concat(t.text),e.length+1+t.length)):(h+t.lines>s&&d(),h+=t.lines,l+=t.length+1,a.push(t))}function d(){0!=h&&(o.push(1==a.length?a[0]:P.from(a,l)),l=-1,h=a.length=0)}for(let e of t)c(e);return d(),1==o.length?o[0]:new P(o,e)}}function L(t,e,i=0,s=1e9){for(let n=0,r=0,o=!0;r<t.length&&n<=s;r++){let h=t[r],l=n+h.length;l>=i&&(l>s&&(h=h.slice(0,s-n)),n<i&&(h=h.slice(i-n)),o?(e[e.length-1]+=h,o=!1):e.push(h)),n=l+1}return e}function V(t,e,i){return L(t,[""],e,i)}E.empty=new B([""],0);class W{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof B?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof B?s.text.length:s.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(s instanceof B){let n=s.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,n.length>Math.max(0,t))return this.value=0==t?n:e>0?n.slice(t):n.slice(0,n.length-t),this;t-=n.length}else{let n=s.children[r+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof B?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class N{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new W(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class H{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(E.prototype[Symbol.iterator]=function(){return this.iter()},W.prototype[Symbol.iterator]=N.prototype[Symbol.iterator]=H.prototype[Symbol.iterator]=function(){return this});class Q{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}const I=/\r\n?|\n/;var z=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(z||(z={}));class F{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?(t(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(t,e=!1){G(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new F(t)}composeDesc(t){return this.empty?t:t.empty?this:j(this,t)}mapDesc(t,e=!1){return t.empty?this:X(this,t,e)}mapPos(t,e=-1,i=z.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],h=this.sections[r++],l=s+o;if(h<0){if(l>t)return n+(t-s);n+=o}else{if(i!=z.Simple&&l>=t&&(i==z.TrackDel&&s<t&&l>t||i==z.TrackBefore&&s<t||i==z.TrackAfter&&l>t))return null;if(l>t||l==t&&e<0&&!o)return t==s||e<0?n:n+h;n+=h}s=l}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&n>=t)return!(s<t&&n>e)||"cover";s=n}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new F(t)}}class $ extends F{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return G(this,((e,i,s,n,r)=>t=t.replace(s,s+(i-e),r)),!1),t}mapDesc(t,e=!1){return X(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let r=e[s],o=e[s+1];if(o>=0){e[s]=o,e[s+1]=r;let h=s>>1;for(;i.length<h;)i.push(E.empty);i.push(r?t.slice(n,n+r):E.empty)}n+=r}return new $(e,i)}compose(t){return this.empty?t:t.empty?this:j(this,t,!0)}map(t,e=!1){return t.empty?this:X(this,t,e,!0)}iterChanges(t,e=!1){G(this,t,e)}get desc(){return new F(this.sections)}filter(t){let e=[],i=[],s=[],n=new U(this);t:for(let r=0,o=0;;){let h=r==t.length?1e9:t[r++];for(;o<h||o==h&&0==n.len;){if(n.done)break t;let t=Math.min(n.len,h-o);q(s,t,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;q(e,t,r),r>0&&_(i,e,n.text),n.forward(t),o+=t}let l=t[r++];for(;o<l;){if(n.done)break t;let t=Math.min(n.len,l-o);q(e,t,-1),q(s,t,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(t),o+=t}}return{changes:new $(e,i),filtered:new F(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],r=0,o=null;function h(t=!1){if(!t&&!s.length)return;r<e&&q(s,e-r,-1);let i=new $(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function t(l){if(Array.isArray(l))for(let e of l)t(e);else if(l instanceof $){if(l.length!=e)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${e})`);h(),o=o?o.compose(l.map(o)):l}else{let{from:t,to:o=t,insert:a}=l;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=a?"string"==typeof a?E.of(a.split(i||I)):a:E.empty,d=c.length;if(t==o&&0==d)return;t<r&&h(),t>r&&q(s,t-r,-1),q(s,o-t,d),_(n,s,c),r=o}}(t),h(!o),o}static empty(t){return new $(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if("number"==typeof n)e.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)e.push(n[0],0);else{for(;i.length<s;)i.push(E.empty);i[s]=E.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new $(e,i)}}function q(t,e,i,s=!1){if(0==e&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:0==e&&0==t[n]?t[n+1]+=i:s?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function _(t,e,i){if(0==i.length)return;let s=e.length-2>>1;if(s<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<s;)t.push(E.empty);t.push(i)}}function G(t,e,i){let s=t.inserted;for(let n=0,r=0,o=0;o<t.sections.length;){let h=t.sections[o++],l=t.sections[o++];if(l<0)n+=h,r+=h;else{let a=n,c=r,d=E.empty;for(;a+=h,c+=l,l&&s&&(d=d.append(s[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)h=t.sections[o++],l=t.sections[o++];e(n,a,r,c,d),n=a,r=c}}}function X(t,e,i,s=!1){let n=[],r=s?[]:null,o=new U(t),h=new U(e);for(let t=0,e=0;;)if(-1==o.ins)t+=o.len,o.next();else if(-1==h.ins&&e<t){let i=Math.min(h.len,t-e);h.forward(i),q(n,i,-1),e+=i}else if(h.ins>=0&&(o.done||e<t||e==t&&(h.len<o.len||h.len==o.len&&!i))){for(q(n,h.ins,-1);t>e&&!o.done&&t+o.len<e+h.len;)t+=o.len,o.next();e+=h.len,h.next()}else{if(!(o.ins>=0)){if(o.done&&h.done)return r?new $(n,r):new F(n);throw new Error("Mismatched change set lengths")}{let i=0,s=t+o.len;for(;;)if(h.ins>=0&&e>t&&e+h.len<s)i+=h.ins,e+=h.len,h.next();else{if(!(-1==h.ins&&e<s))break;{let t=Math.min(h.len,s-e);i+=t,h.forward(t),e+=t}}q(n,i,o.ins),r&&_(r,n,o.text),t=s,o.next()}}}function j(t,e,i=!1){let s=[],n=i?[]:null,r=new U(t),o=new U(e);for(let t=!1;;){if(r.done&&o.done)return n?new $(s,n):new F(s);if(0==r.ins)q(s,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=s.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;q(s,e,i,t),n&&i&&_(n,s,o.text)}else-1==o.ins?(q(s,r.off?0:r.len,e,t),n&&_(n,s,r.textBit(e))):(q(s,r.off?0:r.len,o.off?0:o.ins,t),n&&!o.off&&_(n,s,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||s.length>i),r.forward2(e),o.forward(e)}}else q(s,0,o.ins,t),n&&_(n,s,o.text),o.next()}}class U{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?E.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?E.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Z{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new Z(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return Y.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return Y.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return Y.range(t.anchor,t.head)}}class Y{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:Y.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new Y([this.main])}addRange(t,e=!0){return Y.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,Y.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new Y(t.ranges.map((t=>Z.fromJSON(t))),t.main)}static single(t,e=t){return new Y([Y.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return K(t.slice(),e);i=n.to}return new Y(t,e)}static cursor(t,e=0,i,s){return new Z(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(t,e,i){let s=(null!=i?i:33554431)<<5;return e<t?new Z(e,t,24|s):new Z(t,e,s|(e>t?4:0))}}function K(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let s=t[i],n=t[i-1];if(s.empty?s.from<=n.to:s.from<n.to){let r=n.from,o=Math.max(s.to,n.to);i<=e&&e--,t.splice(--i,2,s.anchor>s.head?Y.range(o,r):Y.range(r,o))}}return new Y(t,e)}function J(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let tt=0;class et{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.extensions=n,this.id=tt++,this.default=t([])}static define(t={}){return new et(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:it),!!t.static,t.enables)}of(t){return new st([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new st(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new st(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function it(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class st{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=tt++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,r=t[n]>>1,o=2==this.type,h=!1,l=!1,a=[];for(let i of this.dependencies)"doc"==i?h=!0:"selection"==i?l=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&a.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(h&&e.docChanged||l&&(e.docChanged||e.selection)||a.some((e=>(1&yt(t,e))>0))){let e=i(t);if(o?!nt(e,t.values[r],s):!s(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure(t,e){let h=i(t),l=e.config.address[n];if(null!=l){let i=bt(e,l);if(o?nt(h,i,s):s(h,i))return t.values[r]=i,0}return t.values[r]=h,1}}}}function nt(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function rt(t,e,i){let s=i.map((e=>t[e.id])),n=i.map((t=>t.type)),r=s.filter((t=>!(1&t))),o=t[e.id]>>1;function h(t){let i=[];for(let e=0;e<s.length;e++){let r=bt(t,s[e]);if(2==n[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of s)yt(t,e);return t.values[o]=h(t),1},update(t,i){if(!r.some((e=>1&yt(t,e))))return 0;let s=h(t);return e.compare(s,t.values[o])?0:(t.values[o]=s,1)},reconfigure(t,n){let r=s.some((e=>1&yt(t,e))),l=n.config.facets[e.id],a=n.facet(e);if(l&&!r&&it(i,l))return t.values[o]=a,0;let c=h(t);return e.compare(c,a)?(t.values[o]=a,0):(t.values[o]=c,1)}}}const ot=et.define({static:!0});class ht{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new ht(tt++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(ot).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],n=this.updateF(s,i);return this.compareF(s,n)?0:(t.values[e]=n,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,ot.of({field:this,create:t})]}get extension(){return this}}const lt=4,at=3,ct=2,dt=1,ut=0;function ft(t){return e=>new gt(e,t)}const pt={lowest:ft(lt),low:ft(at),default:ft(ct),high:ft(dt),highest:ft(ut),fallback:ft(lt),extend:ft(dt),override:ft(ut)};class gt{constructor(t,e){this.inner=t,this.prec=e}}class mt{of(t){return new wt(this,t)}reconfigure(t){return mt.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class wt{constructor(t,e){this.compartment=t,this.inner=e}}class vt{constructor(t,e,i,s,n,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),r=new Map;for(let i of function(t,e,i){let s=[[],[],[],[],[]],n=new Map;function r(t,o){let h=n.get(t);if(null!=h){if(h>=o)return;let e=s[h].indexOf(t);e>-1&&s[h].splice(e,1),t instanceof wt&&i.delete(t.compartment)}if(n.set(t,o),Array.isArray(t))for(let e of t)r(e,o);else if(t instanceof wt){if(i.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(t.compartment)||t.inner;i.set(t.compartment,s),r(s,o)}else if(t instanceof gt)r(t.inner,t.prec);else if(t instanceof ht)s[o].push(t),t.provides&&r(t.provides,o);else if(t instanceof st)s[o].push(t),t.facet.extensions&&r(t.facet.extensions,o);else{let e=t.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(e,o)}}return r(t,ct),s.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof ht?s.push(i):(n[i.facet.id]||(n[i.facet.id]=[])).push(i);let o=Object.create(null),h=[],l=[];for(let t of s)o[t.id]=l.length<<1,l.push((e=>t.slot(e)));let a=null==i?void 0:i.config.facets;for(let t in n){let e=n[t],s=e[0].facet,r=a&&a[t]||[];if(e.every((t=>0==t.type)))if(o[s.id]=h.length<<1|1,it(r,e))h.push(i.facet(s));else{let t=s.combine(e.map((t=>t.value)));h.push(i&&s.compare(t,i.facet(s))?i.facet(s):t)}else{for(let t of e)0==t.type?(o[t.id]=h.length<<1|1,h.push(t.value)):(o[t.id]=l.length<<1,l.push((e=>t.dynamicSlot(e))));o[s.id]=l.length<<1,l.push((t=>rt(t,s,e)))}}let c=l.map((t=>t(o)));return new vt(t,r,c,o,h,n)}}function yt(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function bt(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const Ot=et.define(),St=et.define({combine:t=>t.some((t=>t)),static:!0}),xt=et.define({combine:t=>t.length?t[0]:void 0,static:!0}),kt=et.define(),At=et.define(),Mt=et.define(),Ct=et.define({combine:t=>!!t.length&&t[0]});class Tt{constructor(t,e){this.type=t,this.value=e}static define(){return new Dt}}class Dt{of(t){return new Tt(this,t)}}class Rt{constructor(t){this.map=t}of(t){return new Et(this,t)}}class Et{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new Et(this.type,e)}is(t){return this.type==t}static define(t={}){return new Rt(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}Et.reconfigure=Et.define(),Et.appendConfig=Et.define();class Bt{constructor(t,e,i,s,n,r){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&J(i,e.newLength),n.some((t=>t.type==Bt.time))||(this.annotations=n.concat(Bt.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(Bt.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function Pt(t,e){let i=[];for(let s=0,n=0;;){let r,o;if(s<t.length&&(n==e.length||e[n]>=t[s]))r=t[s++],o=t[s++];else{if(!(n<e.length))return i;r=e[n++],o=e[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function Lt(t,e,i){var s;let n,r,o;return i?(n=e.changes,r=$.empty(e.changes.length),o=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):null===(s=t.selection)||void 0===s?void 0:s.map(n),effects:Et.mapEffects(t.effects,n).concat(Et.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Vt(t,e,i){let s=e.selection,n=Ht(e.annotations);return e.userEvent&&(n=n.concat(Bt.userEvent.of(e.userEvent))),{changes:e.changes instanceof $?e.changes:$.of(e.changes||[],i,t.facet(xt)),selection:s&&(s instanceof Y?s:Y.single(s.anchor,s.head)),effects:Ht(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function Wt(t,e,i){let s=Vt(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=Lt(s,Vt(t,e[n],r?s.changes.newLength:t.doc.length),r)}let n=new Bt(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(Mt),s=t;for(let n=i.length-1;n>=0;n--){let r=i[n](t);r&&Object.keys(r).length&&(s=Lt(t,Vt(e,r,t.changes.newLength),!0))}return s==t?t:new Bt(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let s of e.facet(kt)){let e=s(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:Pt(i,e))}if(!0!==i){let s,n;if(!1===i)n=t.changes.invertedDesc,s=$.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,n=e.filtered.invertedDesc}t=new Bt(e,s,t.selection&&t.selection.map(n),Et.mapEffects(t.effects,n),t.annotations,t.scrollIntoView)}let s=e.facet(At);for(let i=s.length-1;i>=0;i--){let n=s[i](t);t=n instanceof Bt?n:Array.isArray(n)&&1==n.length&&n[0]instanceof Bt?n[0]:Wt(e,Ht(n),!1)}return t}(n):n)}Bt.time=Tt.define(),Bt.userEvent=Tt.define(),Bt.addToHistory=Tt.define(),Bt.remote=Tt.define();const Nt=[];function Ht(t){return null==t?Nt:Array.isArray(t)?t:[t]}var Qt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Qt||(Qt={}));const It=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let zt;try{zt=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function Ft(t){return e=>{if(!/\S/.test(e))return Qt.Space;if(function(t){if(zt)return zt.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||It.test(i)))return!0}return!1}(e))return Qt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return Qt.Word;return Qt.Other}}class $t{constructor(t,e,i,s,n,r){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)yt(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return yt(this,i),bt(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return Wt(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:n}=i;for(let e of t.effects)e.is(mt.reconfigure)?(i&&(n=new Map,i.compartments.forEach(((t,e)=>n.set(e,t))),i=null),n.set(e.value.compartment,e.value.extension)):e.is(Et.reconfigure)?(i=null,s=e.value):e.is(Et.appendConfig)&&(i=null,s=Ht(s).concat(e.value));if(i)e=t.startState.values.slice();else{i=vt.resolve(s,n,this),e=new $t(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values}new $t(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:Y.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],r=Ht(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),h=this.changes(o.changes),l=h.map(s);for(let t=0;t<i;t++)n[t]=n[t].map(l);let a=s.mapDesc(h,!0);n.push(o.range.map(a)),s=s.compose(l),r=Et.mapEffects(r,l).concat(Et.mapEffects(Ht(o.effects),a))}return{changes:s,selection:Y.create(n,e.mainIndex),effects:r}}changes(t=[]){return t instanceof $?t:$.of(t,this.doc.length,this.facet($t.lineSeparator))}toText(t){return E.of(t.split(this.facet($t.lineSeparator)||I))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(yt(this,e),bt(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof ht&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let e in i){let n=i[e],r=t[e];s.push(n.init((t=>n.spec.fromJSON(r,t))))}return $t.create({doc:t.doc,selection:Y.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=vt.resolve(t.extensions||[],new Map),i=t.doc instanceof E?t.doc:E.of((t.doc||"").split(e.staticFacet($t.lineSeparator)||I)),s=t.selection?t.selection instanceof Y?t.selection:Y.single(t.selection.anchor,t.selection.head):Y.single(0);return J(s,i.length),e.staticFacet(St)||(s=s.asSingle()),new $t(e,i,s,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet($t.tabSize)}get lineBreak(){return this.facet($t.lineSeparator)||"\n"}get readOnly(){return this.facet(Ct)}phrase(t){for(let e of this.facet($t.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(Ot))for(let r of n(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&s.push(r[t]);return s}charCategorizer(t){return Ft(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),r=t-i,o=t-i;for(;r>0;){let t=O(e,r,!1);if(n(e.slice(t,r))!=Qt.Word)break;r=t}for(;o<s;){let t=O(e,o);if(n(e.slice(o,t))!=Qt.Word)break;o=t}return r==o?null:Y.range(r+i,o+i)}}function qt(t,e,i={}){let s={};for(let e of t)for(let t of Object.keys(e)){let n=e[t],r=s[t];if(void 0===r)s[t]=n;else if(r===n||void 0===n);else{if(!Object.hasOwnProperty.call(i,t))throw new Error("Config merge conflict for field "+t);s[t]=i[t](r,n)}}for(let t in e)void 0===s[t]&&(s[t]=e[t]);return s}$t.allowMultipleSelections=St,$t.tabSize=et.define({combine:t=>t.length?t[0]:4}),$t.lineSeparator=xt,$t.readOnly=Ct,$t.phrases=et.define(),$t.languageData=Ot,$t.changeFilter=kt,$t.transactionFilter=At,$t.transactionExtender=Mt,mt.reconfigure=Et.define();const _t="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),Gt="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Xt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class jt{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function n(t,e,r,o){let h=[],l=/^@(\w+)\b/.exec(t[0]),a=l&&"keyframes"==l[1];if(l&&null==e)return r.push(t[0]+";");for(let i in e){let o=e[i];if(/&/.test(i))n(i.split(/,\s*/).map((e=>t.map((t=>e.replace(/&/,t))))).reduce(((t,e)=>t.concat(e))),o,r);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");n(s(i),o,h,a)}else null!=o&&h.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()))+": "+o+";")}(h.length||a)&&r.push((!i||l||o?t:t.map(i)).join(", ")+" {"+h.join(" ")+"}")}for(let e in t)n(s(e),t[e],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let t=Xt[_t]||1;return Xt[_t]=t+1,"ͼ"+t.toString(36)}static mount(t,e){(t[Gt]||new Zt(t)).mount(Array.isArray(e)?e:[e])}}let Ut=null;class Zt{constructor(t){if(!t.head&&t.adoptedStyleSheets&&"undefined"!=typeof CSSStyleSheet){if(Ut)return t.adoptedStyleSheets=[Ut.sheet].concat(t.adoptedStyleSheets),t[Gt]=Ut;this.sheet=new CSSStyleSheet,t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets),Ut=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");let e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[],t[Gt]=this}mount(t){let e=this.sheet,i=0,s=0;for(let n=0;n<t.length;n++){let r=t[n],o=this.modules.indexOf(r);if(o<s&&o>-1&&(this.modules.splice(o,1),s--,o=-1),-1==o){if(this.modules.splice(s++,0,r),e)for(let t=0;t<r.rules.length;t++)e.insertRule(r.rules[t],i++)}else{for(;s<o;)i+=this.modules[s++].rules.length;i+=r.rules.length,s++}}if(!e){let t="";for(let e=0;e<this.modules.length;e++)t+=this.modules[e].getRules()+"\n";this.styleTag.textContent=t}}}class Yt{eq(t){return this==t}range(t,e=t){return new Kt(t,e,this)}}Yt.prototype.startSide=Yt.prototype.endSide=0,Yt.prototype.point=!1,Yt.prototype.mapMode=z.TrackDel;class Kt{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function Jt(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class te{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,h=n[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==r)return h>=0?r:o;h>=0?o=s:r=s+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+t,this.to[n]+t,this.value[n]))return!1}map(t,e){let i=[],s=[],n=[],r=-1,o=-1;for(let h=0;h<this.value.length;h++){let l,a,c=this.value[h],d=this.from[h]+t,u=this.to[h]+t;if(d==u){let t=e.mapPos(d,c.startSide,c.mapMode);if(null==t)continue;if(l=a=t,c.startSide!=c.endSide&&(a=e.mapPos(d,c.endSide),a<l))continue}else if(l=e.mapPos(d,c.startSide),a=e.mapPos(u,c.endSide),l>a||l==a&&c.startSide>0&&c.endSide<=0)continue;(a-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,a-l)),i.push(c),s.push(l-r),n.push(a-r))}return{mapped:i.length?new te(s,n,i,o):null,pos:r}}}class ee{constructor(t,e,i=ee.empty,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(Jt)),this.isEmpty)return e.length?ee.of(e):this;let o=new ne(this,null,-1).goto(0),h=0,l=[],a=new ie;for(;o.value||h<e.length;)if(h<e.length&&(o.from-e[h].from||o.startSide-e[h].value.startSide)>=0){let t=e[h++];a.addInner(t.from,t.to,t.value)||l.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(o.chunkIndex)<e[h].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&a.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(a.addInner(o.from,o.to,o.value)||l.push(new Kt(o.from,o.to,o.value))),o.next());return a.finishInner(this.nextLayer.isEmpty&&!l.length?ee.empty:this.nextLayer.update({add:l,filter:r,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n],h=t.touchesRange(r,r+o.length);if(!1===h)s=Math.max(s,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===h){let{mapped:n,pos:h}=o.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(h))}}let n=this.nextLayer.map(t);return 0==e.length?n:new ee(i,e,n,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(e>=n&&t<=n+r.length&&!1===r.between(n,t-n,e-n,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return re.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return re.from(t).goto(e)}static compare(t,e,i,s,n=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),h=se(r,o,i),l=new he(r,h,n),a=new he(o,h,n);i.iterGaps(((t,e,i)=>le(l,t,a,e,i,s))),i.empty&&0==i.length&&le(l,0,a,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=1e9);let n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(n.length!=r.length)return!1;if(!n.length)return!0;let o=se(n,r),h=new he(n,o,0).goto(i),l=new he(r,o,0).goto(i);for(;;){if(h.to!=l.to||!ae(h.active,l.active)||h.point&&(!l.point||!h.point.eq(l.point)))return!1;if(h.to>s)return!0;h.next(),l.next()}}static spans(t,e,i,s,n=-1){var r;let o=new he(t,null,n,null===(r=s.filterPoint)||void 0===r?void 0:r.bind(s)).goto(e),h=e,l=o.openStart;for(;;){let t=Math.min(o.to,i);if(o.point?(s.point(h,t,o.point,o.activeForPoint(o.to),l),l=o.openEnd(t)+(o.to>t?1:0)):t>h&&(s.span(h,t,o.active,l),l=o.openEnd(t)),o.to>i)break;h=o.to,o.next()}return l}static of(t,e=!1){let i=new ie;for(let s of t instanceof Kt?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(Jt(e,s)>0)return t.slice().sort(Jt);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}}ee.empty=new ee([],[],null,-1),ee.empty.nextLayer=ee.empty;class ie{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new te(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new ie)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(ee.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=new ee(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function se(t,e,i){let s=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&s.set(e.chunk[t],e.chunkPos[t]);let n=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=s.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||n.add(t.chunk[e])}return n}class ne{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class re{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let r=t[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new ne(r,e,i,n));return 1==s.length?s[0]:new re(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)oe(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)oe(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),oe(this.heap,0)}}}function oe(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let n=t[s];if(s+1<t.length&&n.compare(t[s+1])>=0&&(n=t[s+1],s++),i.compare(n)<0)break;t[s]=i,t[e]=n,e=s}}class he{constructor(t,e,i,s=(()=>!0)){this.minPoint=i,this.filterPoint=s,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=re.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){ce(this.active,t),ce(this.activeTo,t),ce(this.activeRank,t),this.minActive=ue(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;de(this.active,e,i),de(this.activeTo,e,s),de(this.activeRank,e,n),t&&de(t,e,this.cursor.from),this.minActive=ue(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>t){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&ce(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let n=this.cursor.value;if(n.point)if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{if(this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank)){this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.from<t&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let e=0;for(;e<i.length&&i[e]<t;)e++;this.openStart=e+s}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function le(t,e,i,s,n,r){t.goto(e),i.goto(s);let o=s+n,h=s,l=s-e;for(;;){let e=t.to+l-i.to||t.endSide-i.endSide,s=e<0?t.to+l:i.to,n=Math.min(s,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&ae(t.activeForPoint(t.to+l),i.activeForPoint(i.to))||r.comparePoint(h,n,t.point,i.point):n>h&&!ae(t.active,i.active)&&r.compareRange(h,n,t.active,i.active),s>o)break;h=s,e<=0&&t.next(),e>=0&&i.next()}}function ae(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function ce(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function de(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function ue(t,e){let i=-1,s=1e9;for(let n=0;n<e.length;n++)(e[n]-s||t[n].endSide-t[i].endSide)<0&&(i=n,s=e[n]);return i}for(var fe={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},pe={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},ge="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),me="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),we="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),ve="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ye="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),be=ge&&(ve||+ge[1]<57)||we&&ve,Oe=0;Oe<10;Oe++)fe[48+Oe]=fe[96+Oe]=String(Oe);for(Oe=1;Oe<=24;Oe++)fe[Oe+111]="F"+Oe;for(Oe=65;Oe<=90;Oe++)fe[Oe]=String.fromCharCode(Oe+32),pe[Oe]=String.fromCharCode(Oe);for(var Se in fe)pe.hasOwnProperty(Se)||(pe[Se]=fe[Se]);function xe(t){var e=!(be&&(t.ctrlKey||t.altKey||t.metaKey)||(me||ye)&&t.shiftKey&&t.key&&1==t.key.length)&&t.key||(t.shiftKey?pe:fe)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}function ke(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Ae(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Me(t,e){if(!e.anchorNode)return!1;try{return Ae(t,e.anchorNode)}catch(t){return!1}}function Ce(t){return 3==t.nodeType?Qe(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Te(t,e,i,s){return!!i&&(Re(t,e,i,s,-1)||Re(t,e,i,s,1))}function De(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Re(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:Ee(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=De(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?Ee(t):0}}}function Ee(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Be={left:0,right:0,top:0,bottom:0};function Pe(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Le(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Ve{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let We,Ne=null;function He(t){if(t.setActive)return t.setActive();if(Ne)return t.focus(Ne);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Ne?{get preventScroll(){return Ne={preventScroll:!0},!0}}:void 0),!Ne){Ne=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function Qe(t,e,i=e){let s=We||(We=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function Ie(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function ze(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Fe{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Fe(t.parentNode,De(t),e)}static after(t,e){return new Fe(t.parentNode,De(t)+1,e)}}const $e=[];class qe{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=qe.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=_e(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=_e(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==Ee(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!qe.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=$e){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Ge(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function _e(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}qe.prototype.breakAfter=0;class Ge{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Xe(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function je(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,Xe(t,a,c,h,l,s,0,n,r)}let Ue="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Ze="undefined"!=typeof document?document:{documentElement:{style:{}}};const Ye=/Edge\/(\d+)/.exec(Ue.userAgent),Ke=/MSIE \d/.test(Ue.userAgent),Je=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ue.userAgent),ti=!!(Ke||Je||Ye),ei=!ti&&/gecko\/(\d+)/i.test(Ue.userAgent),ii=!ti&&/Chrome\/(\d+)/.exec(Ue.userAgent),si="webkitFontSmoothing"in Ze.documentElement.style,ni=!ti&&/Apple Computer/.test(Ue.vendor),ri=ni&&(/Mobile\/\w+/.test(Ue.userAgent)||Ue.maxTouchPoints>2);var oi={mac:ri||/Mac/.test(Ue.platform),windows:/Win/.test(Ue.platform),linux:/Linux|X11/.test(Ue.platform),ie:ti,ie_version:Ke?Ze.documentMode||6:Je?+Je[1]:Ye?+Ye[1]:0,gecko:ei,gecko_version:ei?+(/Firefox\/(\d+)/.exec(Ue.userAgent)||[0,0])[1]:0,chrome:!!ii,chrome_version:ii?+ii[1]:0,ios:ri,android:/Android\b/.test(Ue.userAgent),webkit:si,safari:ni,webkit_version:si?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Ze.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class hi extends qe{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof hi&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new hi(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Fe(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return ai(this.dom,t,e)}}class li extends qe{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(ze(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof li&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(je(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new li(this.mark,e,r)}domAtPos(t){return gi(this.dom,this.children,t)}coordsAt(t,e){return wi(this,t,e)}}function ai(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?oi.chrome||oi.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=Qe(t,n,r).getClientRects();if(!h.length)return Be;let l=h[(o?o<0:i>=0)?0:h.length-1];return oi.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?Pe(l,o<0):l||null}class ci extends qe{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||ci)(t,e,i)}split(t){let e=ci.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof ci&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof ci&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?Fe.before(this.dom):Fe.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return Be;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:Pe(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class di extends ci{domAtPos(t){let{topView:e,text:i}=this.widget;return e?ui(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Fe(i,Math.min(t,i.nodeValue.length)))):new Fe(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?fi(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?ui(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>ai(s,t,e))):ai(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function ui(t,e,i,s,n,r){if(i instanceof li){for(let o of i.children){let i=Ae(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?ui(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function fi(t,e,i,s){if(i instanceof li)for(let n of i.children){let i=0,r=Ae(n.dom,s);if(Ae(n.dom,t))return i+(r?fi(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class pi extends qe{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof pi&&t.side==this.side}split(){return new pi(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Fe.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof hi){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof li&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function gi(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return Fe.after(i)}return new Fe(t,0)}function mi(t,e,i){let s,{children:n}=t;i>0&&e instanceof li&&n.length&&(s=n[n.length-1])instanceof li&&s.mark.eq(e.mark)?mi(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function wi(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?Pe(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=Ce(s);return n[n.length-1]||null}function vi(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function yi(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function bi(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}hi.prototype.children=ci.prototype.children=pi.prototype.children=$e;class Oi{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Si=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Si||(Si={}));class xi extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new ki(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Mi(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=Ci(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Mi(t,e,i,s,t.widget||null,!0)}static line(t){return new Ai(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}xi.none=ee.empty;class ki extends xi{constructor(t){let{start:e,end:i}=Ci(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof ki&&this.tagName==t.tagName&&this.class==t.class&&yi(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}ki.prototype.point=!1;class Ai extends xi{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Ai&&yi(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Ai.prototype.mapMode=z.TrackBefore,Ai.prototype.point=!0;class Mi extends xi{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?Si.WidgetRange:this.startSide<=0?Si.WidgetBefore:Si.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Mi&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Ci(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function Ti(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}Mi.prototype.point=!0;class Di extends qe{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof Di))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),je(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new Di;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){yi(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){mi(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=vi(e,this.attrs||{})),i&&(this.attrs=vi({class:i},this.attrs||{}))}domAtPos(t){return gi(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(ze(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(bi(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&qe.get(i)instanceof li;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=qe.get(i))||void 0===e?void 0:e.isEditable)||oi.ios&&this.children.some((t=>t instanceof hi))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof hi))return null;let i=Ce(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return wi(this,t,e)}become(t){return!1}get type(){return Si.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof Di)return n;if(r>e)break}s=r+n.breakAfter}return null}}class Ri extends qe{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Ri&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Fe.before(this.dom):Fe.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Ri(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return $e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof Ri&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ei{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Ri&&t.type==Si.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Di),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Bi(new pi(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Bi(new hi(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof Mi)if(i.block){let{type:t}=i;t!=Si.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Ri(i.widget||new Pi("div"),r,t))}else{let o=ci.create(i.widget||new Pi("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(Bi(new pi(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(Bi(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof Mi){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new Ei(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Bi(t,e){for(let i of e)t=new li(i,[t],t.length);return t}class Pi extends Oi{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Li=[],Vi=et.define(),Wi=et.define(),Ni=et.define(),Hi=et.define(),Qi=et.define(),Ii=et.define(),zi=Et.define({map:(t,e)=>t.map(e)}),Fi=Et.define({map:(t,e)=>t.map(e)});class $i{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new $i(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const qi=Et.define({map:(t,e)=>t.map(e)});function _i(t,e,i){let s=t.facet(Hi);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Gi=et.define({combine:t=>!t.length||t[0]});class Xi{constructor(t,e){this.field=t,this.get=e}}class ji{from(t){return new Xi(this,t)}static define(){return new ji}}ji.decorations=ji.define(),ji.atomicRanges=ji.define(),ji.scrollMargins=ji.define();let Ui=0;const Zi=et.define();class Yi{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Zi.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(Ki.from((t=>({plugin:t,handlers:i})))),n&&r.push(ji.decorations.from(n)),new Yi(Ui++,t,r)}static fromClass(t,e){return Yi.define((e=>new t(e)),e)}}const Ki=ji.define();class Ji{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(_i(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){_i(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){_i(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const ts=et.define(),es=et.define(),is=et.define(),ss=et.define();class ns{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new ns(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new ns(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new ns(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class rs{constructor(t,e,i=Li){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new ns(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var os=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(os||(os={}));const hs=os.LTR,ls=os.RTL;function as(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const cs=as("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ds=as("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),us=Object.create(null),fs=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);us[e]=i,us[i]=-e}const ps=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class gs{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?ls:hs}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const ms=[];function ws(t,e){let i=t.length,s=e==hs?1:2,n=e==hs?2:1;if(!t||1==s&&!ps.test(t))return vs(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?cs[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ds[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),ms[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=ms[t];if(128==s)t<i-1&&e==ms[t+1]&&24&e?s=ms[t]=e:ms[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==ms[s];)s++;let r=t&&8==e||s<i&&8==ms[s]?1==n?1:8:256;for(let e=t;e<s;e++)ms[e]=r;t=s-1}else 8==s&&1==n&&(ms[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=us[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(fs[t+1]==-r){let e=fs[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(ms[h]=ms[fs[t]]=i),l=t;break}}else{if(189==fs.length)break;fs[l++]=h,fs[l++]=e,fs[l++]=a}else if(2==(o=ms[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=fs[e+2];if(2&i)break;if(t)fs[e+2]|=2;else{if(4&i)break;fs[e+2]|=4}}}for(let t=0;t<i;t++)if(256==ms[t]){let e=t+1;for(;e<i&&256==ms[e];)e++;let n=1==(t?ms[t-1]:s),r=n==(1==(e<i?ms[e]:s))?n?1:2:s;for(let i=t;i<e;i++)ms[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=ms[t++];for(;t<i&&s==(1!=ms[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=ms[--i];for(;i>e&&s==(2!=ms[i-1]);)i--;o.push(new gs(i,t,s?2:1))}else o.push(new gs(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==ms[t++];for(;t<i&&s==(2==ms[t]);)t++;o.push(new gs(e,t,s?1:2))}return o}function vs(t){return[new gs(0,t,0)]}let ys="";function bs(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=gs.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(ys=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Os{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=qe.get(s),r=qe.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Ss(s))||Ss(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=qe.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Ss(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class xs{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class ks extends qe{constructor(t){super(),this.view=t,this.compositionDeco=xi.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Di],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ns(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=xi.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Ms(t);if(!i)return xi.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Os([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return xi.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return xi.none;let d=qe.get(r);d instanceof di?d=d.widget.topView:d&&(d.parent=null);return xi.set(xi.replace({widget:new Cs(r,o,d)}).range(h,l))}(this.view,t.changes)),(oi.ie||oi.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new Ds;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=ns.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=oi.chrome||oi.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Ri&&t.widget instanceof As&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=Ei.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);Xe(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||oi.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(oi.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new Fe(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&Te(n.node,n.offset,h.anchorNode,h.anchorOffset)&&Te(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{oi.android&&oi.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=ke(this.root);if(s.empty){if(oi.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=Ts(n.node,n.offset,1==t?1:-1);e&&(n=new Fe(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new Fe(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new Fe(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=ke(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Di.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Gi)?this.root.activeElement==this.dom:Me(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=qe.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Di)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=Si.WidgetBefore&&n.type!=Si.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==Si.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?Ce(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==os.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Di){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=Ce(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Ge(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(xi.replace({widget:new As(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return xi.set(t)}updateDeco(){let t=this.view.pluginField(ji.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(is),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(ji.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=Le(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==os.LTR)}}class As extends Oi{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Ms(t){let e=t.observer.selectionRange,i=e.focusNode&&Ts(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof Di){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!qe.get(e);)e=e.previousSibling;let n=e?qe.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof Di)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class Cs extends Oi{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return di}}function Ts(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Ee(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Ds{constructor(){this.changes=[]}compareRange(t,e){Ti(t,e,this.changes)}comparePoint(t,e){Ti(t,e,this.changes)}}function Rs(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Es(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Bs(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Ps(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Ls(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Vs(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Ce(d);for(let u=0;u<t.length;u++){let f=t[u];n&&Bs(n,f)&&(f=Ps(Ls(f,n.bottom),n.top));let p=Rs(e,f),g=Es(i,f);if(0==p&&0==g)return 3==d.nodeType?Ws(d,e,i):Vs(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&Bs(a,f)?a=Ls(a,f.bottom):c&&Bs(c,f)&&(c=Ps(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Ws(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:Vs(s,d,i)}function Ws(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=Qe(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(oi.chrome||oi.gecko){Qe(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function Ns(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Si.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:Hs(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:Hs(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),oi.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Qe(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=Di.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Vs(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function Hs(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function Qs(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=bs(n,r,t.textDirection,o,i),l=ys;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function Is(t,e,i){let s=t.pluginField(ji.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class zs{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Gs){let i=Gs[e];t.contentDOM.addEventListener(e,(s=>{_s(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),oi.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Ki);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{_s(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){_i(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){_i(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(oi.android&&oi.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!oi.ios||!(i=Fs.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Ie(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(oi.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!oi.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Fs=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],$s=[16,17,18,20,91,92,224,225];class qs{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Vi);return i.length?i[0](e):oi.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Wi);return i.length?i[0](e):oi.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=ke(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=on(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function _s(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=qe.get(s))&&i.ignoreEvent(e))return!1;return!0}const Gs=Object.create(null),Xs=oi.ie&&oi.ie_version<15||oi.ios&&oi.webkit_version<604;function js(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=ln&&s.selection.ranges.every((t=>t.empty))&&ln==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Gs.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():$s.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let Us=0;function Zs(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=Di.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}Gs.touchstart=(t,e)=>{Us=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Gs.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Gs.mousedown=(t,e)=>{if(t.observer.flush(),Us>Date.now()-2e3&&1==on(e))return;let i=null;for(let s of t.state.facet(Ni))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=tn(t,e),s=on(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=tn(t,e),o=e),!a||!i)return n;let c=Zs(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=Zs(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>He(t.contentDOM))),t.inputState.startMouseSelection(new qs(t,e,i,s))}};let Ys=(t,e)=>t>=e.top&&t<=e.bottom,Ks=(t,e,i)=>Ys(e,i)&&t>=i.left&&t<=i.right;function Js(t,e,i,s){let n=Di.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Ks(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&Ks(i,s,h)?1:o&&Ys(s,o)?-1:1}function tn(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Js(t,i,e.clientX,e.clientY)}}const en=oi.ie&&oi.ie_version<=11;let sn=null,nn=0,rn=0;function on(t){if(!en)return t.detail;let e=sn,i=rn;return sn=t,rn=Date.now(),nn=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(nn+1)%3:1}function hn(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}Gs.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Gs.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&hn(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else hn(t,e,e.dataTransfer.getData("Text"),!0)},Gs.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Xs?null:e.clipboardData;i?(js(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),js(t,i.value)}),50)}(t)};let ln=null;function an(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Gs.copy=Gs.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;ln=n?i:null;let r=Xs?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},Gs.focus=Gs.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Gs.compositionstart=Gs.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),an(t,!0)))},Gs.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&an(t,!1)}),50)},Gs.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Gs.beforeinput=(t,e)=>{var i;let s;if(oi.chrome&&oi.android&&(s=Fs.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const cn=["pre-wrap","normal","pre-line","break-spaces"];class dn{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=os.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return cn.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=cn.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class un{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class fn{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new fn(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new fn(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var pn=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(pn||(pn={}));class gn{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return gn.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,pn.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,pn.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,pn.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=On.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new wn(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new yn(gn.of(t.slice(0,e)),r,gn.of(t.slice(i)))}}gn.prototype.size=1;class mn extends gn{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new fn(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class wn extends mn{constructor(t,e){super(t,e,Si.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof wn||s instanceof vn&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof vn?s=new wn(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):gn.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class vn extends gn{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new fn(l,a,i+o*h,o,Si.Text)}lineAt(t,e,i,s,n){if(e==pn.ByHeight)return this.blockAt(t,i,s,n);if(e==pn.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new fn(e,s-e,0,0,Si.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new fn(h,l,s+o*(a-r),o,Si.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new fn(e.from,e.length,s,h,Si.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof vn?i[i.length-1]=new vn(t.length+s):i.push(null,new vn(s-1))}if(t>0){let e=i[0];e instanceof vn?i[0]=new vn(t+e.length):i.unshift(new vn(t-1),null)}return gn.of(i)}decomposeLeft(t,e){e.push(new vn(t-1),null)}decomposeRight(t,e){e.push(null,new vn(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new vn(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new wn(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new vn(n-r).updateHeight(t,r));let l=gn.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class yn extends gn{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==pn.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==pn.ByPosNoHeight?pn.ByPosNoHeight:pn.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,pn.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&bn(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),bn(n,t)}return gn.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?gn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function bn(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof vn&&(s=t[e+1])instanceof vn&&t.splice(e-1,3,new vn(i.length+1+s.length))}class On{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof wn?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new wn(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new mn(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new wn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new vn(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof wn)return t;let e=new wn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Si.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Si.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof wn||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new wn(0,-1));let i=t;for(let t of this.nodes)t instanceof wn&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new On(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class Sn{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&Ti(t,e,this.changes,5)}}function xn(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function kn(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class An{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return xi.replace({widget:new Mn(this.size,t)}).range(this.from,this.to)}}class Mn extends Oi{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Cn{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new dn,this.scaler=Ln,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=gn.empty().applyChanges(t.facet(is),E.empty,this.heightOracle.setDoc(t.doc),[new ns(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=xi.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new Tn(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Ln:new Vn(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Wn(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(is),n=t.changedRanges,r=ns.extendWithRanges(n,function(t,e,i){let s=new Sn;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(is),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?os.RTL:os.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?kn:xn)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new un(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new Tn(s.lineAt(r-1e3*i,pn.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),pn.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,pn.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new Tn(s.lineAt(i-500,pn.ByHeight,n,0,0).from,s.lineAt(i+r+500,pn.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new Tn(this.heightMap.lineAt(i,pn.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,pn.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,pn.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,pn.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new An(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=os.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=Dn(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Rn(r,(this.visibleTop-i.top-t)/i.height),n=Rn(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=Rn(r,(this.pixelViewport.left-e)/t),n=Rn(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&Bn(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&Bn(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(Pn(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new An(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=En(s,i)-En(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){An.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=xi.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(is);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Wn(this.heightMap.lineAt(t,pn.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Wn(this.heightMap.lineAt(this.scaler.fromDOM(t),pn.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Wn(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Tn{constructor(t,e){this.from=t,this.to=e}}function Dn(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(is),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function Rn({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function En(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function Bn(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function Pn(t,e){for(let i of t)if(e(i))return i}const Ln={toDOM:t=>t,fromDOM:t=>t,scale:1};class Vn{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,pn.ByPos,t,0,0).top,o=e.lineAt(n,pn.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function Wn(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new fn(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>Wn(t,e))):t.type)}const Nn=et.define({combine:t=>t.join(" ")}),Hn=et.define({combine:t=>t.indexOf(!0)>-1}),Qn=jt.newName(),In=jt.newName(),zn=jt.newName(),Fn={"&light":"."+In,"&dark":"."+zn};function $n(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const qn=$n("."+Qn,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Fn),_n={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Gn=oi.ie&&oi.ie_version<=11;class Xn{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Ve,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(oi.ie&&oi.ie_version<=11||oi.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Gn&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Gi)?e.root.activeElement!=this.dom:!Me(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((oi.ie&&oi.ie_version<=11||oi.android&&oi.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Te(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=ke(t),i=oi.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);Te(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,_n),Gn&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Gn&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Ie(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&Me(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=jn(e,t.previousSibling||t.target.previousSibling,-1),s=jn(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function jn(t,e,i){for(;e;){let s=qe.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function Un(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new xs(i,s)),n==i&&r==s||e.push(new xs(n,r)));return e}(t),c=new Os(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||oi.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(oi.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(Gi)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Ae(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!Ae(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(oi.ios&&t.inputState.flushIOSKey(t))return;if(oi.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&Ie(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&Ie(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&Ie(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(Ii).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=Ms(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class Zn{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Cn(t.state||$t.create()),this.plugins=this.state.facet(Zi).map((t=>new Ji(t)));for(let t of this.plugins)t.update(this);this.observer=new Xn(this,((t,e,i)=>{Un(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new zs(this),this.docView=new ks(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new rs(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new $i(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(zi)?n=new $i(t.value):t.is(Fi)?n=new $i(t.value,"center"):t.is(qi)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=tr.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(ss)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Nn)!=e.state.facet(Nn)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(Qi))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Cn(t),this.plugins=t.facet(Zi).map((t=>new Ji(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new ks(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Zi),i=t.state.facet(Zi);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new Ji(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return _i(this.state,t),Jn}})),o=new rs(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=Jn)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){_i(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(Qi))t(e)}get themeClasses(){return Qn+" "+(this.state.facet(Hn)?zn:In)+" "+this.state.facet(Nn)}updateAttrs(){let t=er(this,ts,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Gi)?"true":"false",class:"cm-content",style:`${oi.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),er(this,es,e),this.observer.ignore((()=>{bi(this.contentDOM,this.contentAttrs,e),bi(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(Zn.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(ss),jt.mount(this.root,this.styleModules.concat(qn).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Kn(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Kn(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Kn(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Is(this,t,Qs(this,t,e,i))}moveByGroup(t,e){return Is(this,t,Qs(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==os.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=Di.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return Is(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=Ns(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:zi.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Ns(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return Pe(i,n[gs.find(n,t-s.from,-1,e)].dir==os.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Yn)return vs(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=ws(t.text,this.textDirection);return this.bidiCache.push(new tr(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||oi.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{He(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return qi.of(new $i("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Yi.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[Nn.of(i),ss.of($n(`.${i}`,t))];return e&&e.dark&&s.push(Hn.of(!0)),s}static baseTheme(t){return pt.lowest(ss.of($n("."+Qn,t,Fn)))}}Zn.scrollTo=zi,Zn.centerOn=Fi,Zn.styleModule=ss,Zn.inputHandler=Ii,Zn.exceptionSink=Hi,Zn.updateListener=Qi,Zn.editable=Gi,Zn.mouseSelectionStyle=Ni,Zn.dragMovesSelection=Wi,Zn.clickAddsSelectionRange=Vi,Zn.decorations=is,Zn.darkTheme=Hn,Zn.contentAttributes=es,Zn.editorAttributes=ts,Zn.lineWrapping=Zn.contentAttributes.of({class:"cm-lineWrapping"}),Zn.announce=Et.define();const Yn=4096;function Kn(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Jn={};class tr{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:os.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new tr(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function er(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&vi(r,i)}return i}const ir=oi.mac?"mac":oi.windows?"win":oi.linux?"linux":"key";function sr(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const nr=Zn.domEventHandlers({keydown:(t,e)=>ar(hr(e.state),t,e,"editor")}),rr=et.define({enables:nr}),or=new WeakMap;function hr(t){let e=t.facet(rr),i=or.get(e);return i||or.set(e,i=function(t,e=ir){let i=Object.create(null),s=Object.create(null),n=(t,e)=>{let i=s[t];if(null==i)s[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,s,r,o)=>{let h=i[t]||(i[t]=Object.create(null)),l=s.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let s,n,r,o,h=i[i.length-1];"Space"==h&&(h=" ");for(let t=0;t<i.length-1;++t){const h=i[t];if(/^(cmd|meta|m)$/i.test(h))o=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))r=!0;else{if(!/^mod$/i.test(h))throw new Error("Unrecognized modifier name: "+h);"mac"==e?o=!0:n=!0}}return s&&(h="Alt-"+h),n&&(h="Ctrl-"+h),o&&(h="Meta-"+h),r&&(h="Shift-"+h),h}(t,e)));for(let e=1;e<l.length;e++){let i=l.slice(0,e).join(" ");n(i,!0),h[i]||(h[i]={preventDefault:!0,commands:[e=>{let s=lr={view:e,prefix:i,scope:t};return setTimeout((()=>{lr==s&&(lr=null)}),4e3),!0}]})}let a=l.join(" ");n(a,!1);let c=h[a]||(h[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let lr=null;function ar(t,e,i,s){let n=xe(e),r=1==n.length&&" "!=n,o="",h=!1;lr&&lr.view==i&&lr.scope==s&&(o=lr.prefix+" ",(h=$s.indexOf(e.keyCode)<0)&&(lr=null));let l,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(h=!0)}return!1},c=t[s];if(c){if(a(c[o+sr(n,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(l=fe[e.keyCode])&&l!=n){if(a(c[o+sr(l,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+sr(n,e,!0)]))return!0}return h}const cr=!oi.ios,dr=et.define({combine:t=>qt(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})});function ur(t={}){return[dr.of(t),pr,mr]}class fr{constructor(t,e,i,s,n){this.left=t,this.top=e,this.width=i,this.height=s,this.className=n}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}const pr=Yi.fromClass(class{constructor(t){this.view=t,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=t.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=t.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),t.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(dr).cursorBlinkRate+"ms"}update(t){let e=t.startState.facet(dr)!=t.state.facet(dr);(e||t.selectionSet||t.geometryChanged||t.viewportChanged)&&this.view.requestMeasure(this.measureReq),t.transactions.some((t=>t.scrollIntoView))&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:t}=this.view,e=t.facet(dr),i=t.selection.ranges.map((t=>t.empty?[]:function(t,e){if(e.to<=t.viewport.from||e.from>=t.viewport.to)return[];let i=Math.max(e.from,t.viewport.from),s=Math.min(e.to,t.viewport.to),n=t.textDirection==os.LTR,r=t.contentDOM,o=r.getBoundingClientRect(),h=wr(t),l=window.getComputedStyle(r.firstChild),a=o.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),c=o.right-parseInt(l.paddingRight),d=yr(t,i),u=yr(t,s),f=d.type==Si.Text?d:null,p=u.type==Si.Text?u:null;t.lineWrapping&&(f&&(f=vr(t,i,f)),p&&(p=vr(t,s,p)));if(f&&p&&f.from==p.from)return m(w(e.from,e.to,f));{let i=f?w(e.from,null,f):v(d,!1),s=p?w(null,e.to,p):v(u,!0),n=[];return(f||d).to<(p||u).from-1?n.push(g(a,i.bottom,c,s.top)):i.bottom<s.top&&t.elementAtHeight((i.bottom+s.top)/2).type==Si.Text&&(i.bottom=s.top=(i.bottom+s.top)/2),m(i).concat(n).concat(m(s))}function g(t,e,i,s){return new fr(t-h.left,e-h.top-.01,i-t,s-e+.01,"cm-selectionBackground")}function m({top:t,bottom:e,horizontal:i}){let s=[];for(let n=0;n<i.length;n+=2)s.push(g(i[n],t,i[n+1],e));return s}function w(e,i,s){let r=1e9,o=-1e9,h=[];function l(e,i,l,d,u){let f=t.coordsAtPos(e,e==s.to?-2:2),p=t.coordsAtPos(l,l==s.from?2:-2);r=Math.min(f.top,p.top,r),o=Math.max(f.bottom,p.bottom,o),u==os.LTR?h.push(n&&i?a:f.left,n&&d?c:p.right):h.push(!n&&d?a:p.left,!n&&i?c:f.right)}let d=null!=e?e:s.from,u=null!=i?i:s.to;for(let s of t.visibleRanges)if(s.to>d&&s.from<u)for(let n=Math.max(s.from,d),r=Math.min(s.to,u);;){let s=t.state.doc.lineAt(n);for(let o of t.bidiSpans(s)){let t=o.from+s.from,h=o.to+s.from;if(t>=r)break;h>n&&l(Math.max(t,n),null==e&&t<=d,Math.min(h,r),null==i&&h>=u,o.dir)}if(n=s.to+1,n>=r)break}return 0==h.length&&l(d,null==e,u,null==i,t.textDirection),{top:r,bottom:o,horizontal:h}}function v(t,e){let i=o.top+(e?t.top:t.bottom);return{top:i,bottom:i,horizontal:[]}}}(this.view,t))).reduce(((t,e)=>t.concat(e))),s=[];for(let i of t.selection.ranges){let n=i==t.selection.main;if(i.empty?!n||cr:e.drawRangeCursor){let t=br(this.view,i,n);t&&s.push(t)}}return{rangePieces:i,cursors:s}}drawSel({rangePieces:t,cursors:e}){if(t.length!=this.rangePieces.length||t.some(((t,e)=>!t.eq(this.rangePieces[e])))){this.selectionLayer.textContent="";for(let e of t)this.selectionLayer.appendChild(e.draw());this.rangePieces=t}if(e.length!=this.cursors.length||e.some(((t,e)=>!t.eq(this.cursors[e])))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const t of e)this.cursorLayer.appendChild(t.draw())}else e.forEach(((e,i)=>e.adjust(t[i])));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),gr={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};cr&&(gr[".cm-line"].caretColor="transparent !important");const mr=pt.highest(Zn.theme(gr));function wr(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==os.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function vr(t,e,i){let s=Y.cursor(e);return{from:Math.max(i.from,t.moveToLineBoundary(s,!1,!0).from),to:Math.min(i.to,t.moveToLineBoundary(s,!0,!0).from),type:Si.Text}}function yr(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type))for(let t of i.type)if(t.to>e||t.to==e&&(t.to==i.to||t.type==Si.Text))return t;return i}function br(t,e,i){let s=t.coordsAtPos(e.head,e.assoc||1);if(!s)return null;let n=wr(t);return new fr(s.left-n.left,s.top-n.top,-1,s.bottom-s.top,i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const Or=Et.define({map:(t,e)=>null==t?null:e.mapPos(t)}),Sr=ht.define({create:()=>null,update:(t,e)=>(null!=t&&(t=e.changes.mapPos(t)),e.effects.reduce(((t,e)=>e.is(Or)?e.value:t),t))}),xr=Yi.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let i=t.state.field(Sr);null==i?null!=this.cursor&&(null===(e=this.cursor)||void 0===e||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(Sr)!=i||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let t=this.view.state.field(Sr),e=null!=t&&this.view.coordsAtPos(t);if(!e)return null;let i=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-i.left+this.view.scrollDOM.scrollLeft,top:e.top-i.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(t){this.cursor&&(t?(this.cursor.style.left=t.left+"px",this.cursor.style.top=t.top+"px",this.cursor.style.height=t.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(Sr)!=t&&this.view.dispatch({effects:Or.of(t)})}},{eventHandlers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){t.target!=this.view.contentDOM&&this.view.contentDOM.contains(t.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function kr(){return[Sr,xr]}function Ar(t,e,i,s,n){e.lastIndex=0;for(let r,o=t.iterRange(i,s),h=i;!o.next().done;h+=o.value.length)if(!o.lineBreak)for(;r=e.exec(o.value);)n(h+r.index,h+r.index+r[0].length,r)}class Mr{constructor(t){let{regexp:e,decoration:i,boundary:s,maxLength:n=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=e,this.getDeco="function"==typeof i?i:()=>i,this.boundary=s,this.maxLength=n}createDeco(t){let e=new ie;for(let{from:i,to:s}of function(t,e){let i=t.visibleRanges;if(1==i.length&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let s=[];for(let{from:n,to:r}of i)n=Math.max(t.state.doc.lineAt(n).from,n-e),r=Math.min(t.state.doc.lineAt(r).to,r+e),s.length&&s[s.length-1].to>=n?s[s.length-1].to=r:s.push({from:n,to:r});return s}(t,this.maxLength))Ar(t.state.doc,this.regexp,i,s,((i,s,n)=>e.add(i,s,this.getDeco(n,t,i))));return e.finish()}updateDeco(t,e){let i=1e9,s=-1;return t.docChanged&&t.changes.iterChanges(((e,n,r,o)=>{o>t.view.viewport.from&&r<t.view.viewport.to&&(i=Math.min(r,i),s=Math.max(o,s))})),t.viewportChanged||s-i>1e3?this.createDeco(t.view):s>-1?this.updateRange(t.view,e.map(t.changes),i,s):e}updateRange(t,e,i,s){for(let n of t.visibleRanges){let r=Math.max(n.from,i),o=Math.min(n.to,s);if(o>r){let i=t.state.doc.lineAt(r),s=i.to<o?t.state.doc.lineAt(o):i,h=Math.max(n.from,i.from),l=Math.min(n.to,s.to);if(this.boundary){for(;r>i.from;r--)if(this.boundary.test(i.text[r-1-i.from])){h=r;break}for(;o<s.to;o++)if(this.boundary.test(s.text[o-s.from])){l=o;break}}let a,c=[];if(i==s)for(this.regexp.lastIndex=h-i.from;(a=this.regexp.exec(i.text))&&a.index<l-i.from;){let e=a.index+i.from;c.push(this.getDeco(a,t,e).range(e,e+a[0].length))}else Ar(t.state.doc,this.regexp,h,l,((e,i,s)=>c.push(this.getDeco(s,t,e).range(e,i))));e=e.update({filterFrom:h,filterTo:l,filter:(t,e)=>t<h||e>l,add:c})}}return e}}const Cr=null!=/x/.unicode?"gu":"g",Tr=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",Cr),Dr={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Rr=null;const Er=et.define({combine(t){let e=qt(t,{render:null,specialChars:Tr,addSpecialChars:null});return(e.replaceTabs=!function(){var t;if(null==Rr&&"undefined"!=typeof document&&document.body){let e=document.body.style;Rr=null!=(null!==(t=e.tabSize)&&void 0!==t?t:e.MozTabSize)}return Rr||!1}())&&(e.specialChars=new RegExp("\t|"+e.specialChars.source,Cr)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Cr)),e}});function Br(t={}){return[Er.of(t),Pr||(Pr=Yi.fromClass(class{constructor(t){this.view=t,this.decorations=xi.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(Er)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new Mr({regexp:t.specialChars,decoration:(e,i,s)=>{let{doc:n}=i.state,r=M(e[0],0);if(9==r){let t=n.lineAt(s),e=i.state.tabSize,r=D(t.text,e,s-t.from);return xi.replace({widget:new Vr((e-r%e)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=xi.replace({widget:new Lr(t,r)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(Er);t.startState.facet(Er)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))]}let Pr=null;class Lr extends Oi{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=(i=this.code)>=32?"•":10==i?"␤":String.fromCharCode(9216+i);var i;let s=t.state.phrase("Control character")+" "+(Dr[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,s,e);if(n)return n;let r=document.createElement("span");return r.textContent=e,r.title=s,r.setAttribute("aria-label",s),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class Vr extends Oi{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="\t",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function Wr(){return Hr}const Nr=xi.line({class:"cm-activeLine"}),Hr=Yi.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let s of t.state.selection.ranges){if(!s.empty)return xi.none;let n=t.lineBlockAt(s.head);n.from>e&&(i.push(Nr.range(n.from)),e=n.from)}return xi.set(i)}},{decorations:t=>t.decorations});function Qr(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Ir(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function zr(t,e){if(!e.anchorNode)return!1;try{return Ir(t,e.anchorNode)}catch(t){return!1}}function Fr(t){return 3==t.nodeType?to(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function $r(t,e,i,s){return!!i&&(_r(t,e,i,s,-1)||_r(t,e,i,s,1))}function qr(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function _r(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:Gr(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=qr(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?Gr(t):0}}}function Gr(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Xr={left:0,right:0,top:0,bottom:0};function jr(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Ur(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Zr{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Yr,Kr=null;function Jr(t){if(t.setActive)return t.setActive();if(Kr)return t.focus(Kr);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Kr?{get preventScroll(){return Kr={preventScroll:!0},!0}}:void 0),!Kr){Kr=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function to(t,e,i=e){let s=Yr||(Yr=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function eo(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function io(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class so{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new so(t.parentNode,qr(t),e)}static after(t,e){return new so(t.parentNode,qr(t)+1,e)}}const no=[];class ro{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=ro.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=oo(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=oo(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==Gr(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!ro.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=no){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new ho(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function oo(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}ro.prototype.breakAfter=0;class ho{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function lo(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function ao(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,lo(t,a,c,h,l,s,0,n,r)}let co="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},uo="undefined"!=typeof document?document:{documentElement:{style:{}}};const fo=/Edge\/(\d+)/.exec(co.userAgent),po=/MSIE \d/.test(co.userAgent),go=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(co.userAgent),mo=!!(po||go||fo),wo=!mo&&/gecko\/(\d+)/i.test(co.userAgent),vo=!mo&&/Chrome\/(\d+)/.exec(co.userAgent),yo="webkitFontSmoothing"in uo.documentElement.style,bo=!mo&&/Apple Computer/.test(co.vendor),Oo=bo&&(/Mobile\/\w+/.test(co.userAgent)||co.maxTouchPoints>2);var So={mac:Oo||/Mac/.test(co.platform),windows:/Win/.test(co.platform),linux:/Linux|X11/.test(co.platform),ie:mo,ie_version:po?uo.documentMode||6:go?+go[1]:fo?+fo[1]:0,gecko:wo,gecko_version:wo?+(/Firefox\/(\d+)/.exec(co.userAgent)||[0,0])[1]:0,chrome:!!vo,chrome_version:vo?+vo[1]:0,ios:Oo,android:/Android\b/.test(co.userAgent),webkit:yo,safari:bo,webkit_version:yo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=uo.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class xo extends ro{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof xo&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new xo(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new so(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Ao(this.dom,t,e)}}class ko extends ro{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(io(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof ko&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(ao(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new ko(this.mark,e,r)}domAtPos(t){return Eo(this.dom,this.children,t)}coordsAt(t,e){return Po(this,t,e)}}function Ao(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?So.chrome||So.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=to(t,n,r).getClientRects();if(!h.length)return Xr;let l=h[(o?o<0:i>=0)?0:h.length-1];return So.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?jr(l,o<0):l||null}class Mo extends ro{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Mo)(t,e,i)}split(t){let e=Mo.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Mo&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Mo&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?so.before(this.dom):so.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return Xr;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:jr(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Co extends Mo{domAtPos(t){let{topView:e,text:i}=this.widget;return e?To(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new so(i,Math.min(t,i.nodeValue.length)))):new so(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Do(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?To(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Ao(s,t,e))):Ao(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function To(t,e,i,s,n,r){if(i instanceof ko){for(let o of i.children){let i=Ir(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?To(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Do(t,e,i,s){if(i instanceof ko)for(let n of i.children){let i=0,r=Ir(n.dom,s);if(Ir(n.dom,t))return i+(r?Do(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class Ro extends ro{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Ro&&t.side==this.side}split(){return new Ro(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return so.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof xo){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof ko&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function Eo(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return so.after(i)}return new so(t,0)}function Bo(t,e,i){let s,{children:n}=t;i>0&&e instanceof ko&&n.length&&(s=n[n.length-1])instanceof ko&&s.mark.eq(e.mark)?Bo(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function Po(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?jr(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=Fr(s);return n[n.length-1]||null}function Lo(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function Vo(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function Wo(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}xo.prototype.children=Mo.prototype.children=Ro.prototype.children=no;class No{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Ho=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Ho||(Ho={}));class Qo extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new Io(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Fo(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=$o(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Fo(t,e,i,s,t.widget||null,!0)}static line(t){return new zo(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Qo.none=ee.empty;class Io extends Qo{constructor(t){let{start:e,end:i}=$o(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof Io&&this.tagName==t.tagName&&this.class==t.class&&Vo(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Io.prototype.point=!1;class zo extends Qo{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof zo&&Vo(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}zo.prototype.mapMode=z.TrackBefore,zo.prototype.point=!0;class Fo extends Qo{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?Ho.WidgetRange:this.startSide<=0?Ho.WidgetBefore:Ho.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Fo&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function $o(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function qo(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}Fo.prototype.point=!0;class _o extends ro{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof _o))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),ao(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new _o;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Vo(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Bo(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Lo(e,this.attrs||{})),i&&(this.attrs=Lo({class:i},this.attrs||{}))}domAtPos(t){return Eo(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(io(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Wo(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&ro.get(i)instanceof ko;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=ro.get(i))||void 0===e?void 0:e.isEditable)||So.ios&&this.children.some((t=>t instanceof xo))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof xo))return null;let i=Fr(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return Po(this,t,e)}become(t){return!1}get type(){return Ho.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof _o)return n;if(r>e)break}s=r+n.breakAfter}return null}}class Go extends ro{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Go&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?so.before(this.dom):so.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Go(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return no}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof Go&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Xo{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Go&&t.type==Ho.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new _o),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(jo(new Ro(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(jo(new xo(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof Fo)if(i.block){let{type:t}=i;t!=Ho.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Go(i.widget||new Uo("div"),r,t))}else{let o=Mo.create(i.widget||new Uo("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(jo(new Ro(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(jo(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof Fo){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new Xo(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function jo(t,e){for(let i of e)t=new ko(i,[t],t.length);return t}class Uo extends No{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Zo=[],Yo=et.define(),Ko=et.define(),Jo=et.define(),th=et.define(),eh=et.define(),ih=et.define(),sh=Et.define({map:(t,e)=>t.map(e)}),nh=Et.define({map:(t,e)=>t.map(e)});class rh{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new rh(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const oh=Et.define({map:(t,e)=>t.map(e)});function hh(t,e,i){let s=t.facet(th);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const lh=et.define({combine:t=>!t.length||t[0]});class ah{constructor(t,e){this.field=t,this.get=e}}class ch{from(t){return new ah(this,t)}static define(){return new ch}}ch.decorations=ch.define(),ch.atomicRanges=ch.define(),ch.scrollMargins=ch.define();let dh=0;const uh=et.define();class fh{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=uh.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(ph.from((t=>({plugin:t,handlers:i})))),n&&r.push(ch.decorations.from(n)),new fh(dh++,t,r)}static fromClass(t,e){return fh.define((e=>new t(e)),e)}}const ph=ch.define();class gh{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(hh(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){hh(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){hh(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const mh=et.define(),wh=et.define(),vh=et.define(),yh=et.define();class bh{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new bh(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new bh(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new bh(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class Oh{constructor(t,e,i=Zo){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new bh(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Sh=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Sh||(Sh={}));const xh=Sh.LTR,kh=Sh.RTL;function Ah(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Mh=Ah("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Ch=Ah("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Th=Object.create(null),Dh=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Th[e]=i,Th[i]=-e}const Rh=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Eh{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?kh:xh}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Bh=[];function Ph(t,e){let i=t.length,s=e==xh?1:2,n=e==xh?2:1;if(!t||1==s&&!Rh.test(t))return Lh(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Mh[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Ch[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Bh[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Bh[t];if(128==s)t<i-1&&e==Bh[t+1]&&24&e?s=Bh[t]=e:Bh[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Bh[s];)s++;let r=t&&8==e||s<i&&8==Bh[s]?1==n?1:8:256;for(let e=t;e<s;e++)Bh[e]=r;t=s-1}else 8==s&&1==n&&(Bh[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Th[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Dh[t+1]==-r){let e=Dh[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Bh[h]=Bh[Dh[t]]=i),l=t;break}}else{if(189==Dh.length)break;Dh[l++]=h,Dh[l++]=e,Dh[l++]=a}else if(2==(o=Bh[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Dh[e+2];if(2&i)break;if(t)Dh[e+2]|=2;else{if(4&i)break;Dh[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Bh[t]){let e=t+1;for(;e<i&&256==Bh[e];)e++;let n=1==(t?Bh[t-1]:s),r=n==(1==(e<i?Bh[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Bh[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Bh[t++];for(;t<i&&s==(1!=Bh[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Bh[--i];for(;i>e&&s==(2!=Bh[i-1]);)i--;o.push(new Eh(i,t,s?2:1))}else o.push(new Eh(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Bh[t++];for(;t<i&&s==(2==Bh[t]);)t++;o.push(new Eh(e,t,s?1:2))}return o}function Lh(t){return[new Eh(0,t,0)]}let Vh="";function Wh(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=Eh.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(Vh=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Nh{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=ro.get(s),r=ro.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Hh(s))||Hh(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=ro.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Hh(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Qh{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Ih extends ro{constructor(t){super(),this.view=t,this.compositionDeco=Qo.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new _o],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new bh(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Qo.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Fh(t);if(!i)return Qo.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Nh([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return Qo.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return Qo.none;let d=ro.get(r);d instanceof Co?d=d.widget.topView:d&&(d.parent=null);return Qo.set(Qo.replace({widget:new $h(r,o,d)}).range(h,l))}(this.view,t.changes)),(So.ie||So.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new _h;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=bh.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=So.chrome||So.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Go&&t.widget instanceof zh&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=Xo.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);lo(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||So.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(So.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new so(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&$r(n.node,n.offset,h.anchorNode,h.anchorOffset)&&$r(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{So.android&&So.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=Qr(this.root);if(s.empty){if(So.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=qh(n.node,n.offset,1==t?1:-1);e&&(n=new so(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new so(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new so(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Qr(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=_o.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(lh)?this.root.activeElement==this.dom:zr(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=ro.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof _o)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=Ho.WidgetBefore&&n.type!=Ho.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==Ho.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?Fr(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==Sh.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof _o){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=Fr(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new ho(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Qo.replace({widget:new zh(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return Qo.set(t)}updateDeco(){let t=this.view.pluginField(ch.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(vh),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(ch.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=Ur(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Sh.LTR)}}class zh extends No{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Fh(t){let e=t.observer.selectionRange,i=e.focusNode&&qh(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof _o){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!ro.get(e);)e=e.previousSibling;let n=e?ro.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof _o)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class $h extends No{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Co}}function qh(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Gr(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class _h{constructor(){this.changes=[]}compareRange(t,e){qo(t,e,this.changes)}comparePoint(t,e){qo(t,e,this.changes)}}function Gh(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Xh(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function jh(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Uh(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Zh(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Yh(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Fr(d);for(let u=0;u<t.length;u++){let f=t[u];n&&jh(n,f)&&(f=Uh(Zh(f,n.bottom),n.top));let p=Gh(e,f),g=Xh(i,f);if(0==p&&0==g)return 3==d.nodeType?Kh(d,e,i):Yh(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&jh(a,f)?a=Zh(a,f.bottom):c&&jh(c,f)&&(c=Uh(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Kh(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:Yh(s,d,i)}function Kh(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=to(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(So.chrome||So.gecko){to(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function Jh(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Ho.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:tl(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:tl(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),So.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return to(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=_o.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Yh(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function tl(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function el(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=Wh(n,r,t.textDirection,o,i),l=Vh;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function il(t,e,i){let s=t.pluginField(ch.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class sl{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in ll){let i=ll[e];t.contentDOM.addEventListener(e,(s=>{hl(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),So.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(ph);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{hl(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){hh(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){hh(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(So.android&&So.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!So.ios||!(i=nl.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,eo(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(So.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!So.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const nl=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],rl=[16,17,18,20,91,92,224,225];class ol{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Yo);return i.length?i[0](e):So.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Ko);return i.length?i[0](e):So.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=Qr(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Ol(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function hl(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=ro.get(s))&&i.ignoreEvent(e))return!1;return!0}const ll=Object.create(null),al=So.ie&&So.ie_version<15||So.ios&&So.webkit_version<604;function cl(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=xl&&s.selection.ranges.every((t=>t.empty))&&xl==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ll.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():rl.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let dl=0;function ul(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=_o.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}ll.touchstart=(t,e)=>{dl=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},ll.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},ll.mousedown=(t,e)=>{if(t.observer.flush(),dl>Date.now()-2e3&&1==Ol(e))return;let i=null;for(let s of t.state.facet(Jo))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=ml(t,e),s=Ol(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=ml(t,e),o=e),!a||!i)return n;let c=ul(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=ul(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>Jr(t.contentDOM))),t.inputState.startMouseSelection(new ol(t,e,i,s))}};let fl=(t,e)=>t>=e.top&&t<=e.bottom,pl=(t,e,i)=>fl(e,i)&&t>=i.left&&t<=i.right;function gl(t,e,i,s){let n=_o.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&pl(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&pl(i,s,h)?1:o&&fl(s,o)?-1:1}function ml(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:gl(t,i,e.clientX,e.clientY)}}const wl=So.ie&&So.ie_version<=11;let vl=null,yl=0,bl=0;function Ol(t){if(!wl)return t.detail;let e=vl,i=bl;return vl=t,bl=Date.now(),yl=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(yl+1)%3:1}function Sl(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ll.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},ll.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&Sl(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else Sl(t,e,e.dataTransfer.getData("Text"),!0)},ll.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=al?null:e.clipboardData;i?(cl(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),cl(t,i.value)}),50)}(t)};let xl=null;function kl(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}ll.copy=ll.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;xl=n?i:null;let r=al?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},ll.focus=ll.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},ll.compositionstart=ll.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),kl(t,!0)))},ll.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&kl(t,!1)}),50)},ll.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},ll.beforeinput=(t,e)=>{var i;let s;if(So.chrome&&So.android&&(s=nl.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const Al=["pre-wrap","normal","pre-line","break-spaces"];class Ml{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=Sh.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return Al.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=Al.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class Cl{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Tl{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Tl(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Tl(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var Dl=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Dl||(Dl={}));class Rl{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Rl.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,Dl.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,Dl.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Dl.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=Wl.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new Bl(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Ll(Rl.of(t.slice(0,e)),r,Rl.of(t.slice(i)))}}Rl.prototype.size=1;class El extends Rl{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new Tl(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Bl extends El{constructor(t,e){super(t,e,Ho.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof Bl||s instanceof Pl&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof Pl?s=new Bl(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Rl.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Pl extends Rl{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new Tl(l,a,i+o*h,o,Ho.Text)}lineAt(t,e,i,s,n){if(e==Dl.ByHeight)return this.blockAt(t,i,s,n);if(e==Dl.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new Tl(e,s-e,0,0,Ho.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new Tl(h,l,s+o*(a-r),o,Ho.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new Tl(e.from,e.length,s,h,Ho.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof Pl?i[i.length-1]=new Pl(t.length+s):i.push(null,new Pl(s-1))}if(t>0){let e=i[0];e instanceof Pl?i[0]=new Pl(t+e.length):i.unshift(new Pl(t-1),null)}return Rl.of(i)}decomposeLeft(t,e){e.push(new Pl(t-1),null)}decomposeRight(t,e){e.push(null,new Pl(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new Pl(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new Bl(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new Pl(n-r).updateHeight(t,r));let l=Rl.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Ll extends Rl{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==Dl.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==Dl.ByPosNoHeight?Dl.ByPosNoHeight:Dl.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,Dl.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&Vl(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),Vl(n,t)}return Rl.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Rl.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Vl(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof Pl&&(s=t[e+1])instanceof Pl&&t.splice(e-1,3,new Pl(i.length+1+s.length))}class Wl{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Bl?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Bl(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new El(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Bl(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Pl(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Bl)return t;let e=new Bl(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Ho.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Ho.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Bl||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Bl(0,-1));let i=t;for(let t of this.nodes)t instanceof Bl&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new Wl(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class Nl{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&qo(t,e,this.changes,5)}}function Hl(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function Ql(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class Il{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return Qo.replace({widget:new zl(this.size,t)}).range(this.from,this.to)}}class zl extends No{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Fl{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Ml,this.scaler=Ul,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Rl.empty().applyChanges(t.facet(vh),E.empty,this.heightOracle.setDoc(t.doc),[new bh(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Qo.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new $l(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Ul:new Zl(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Yl(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(vh),n=t.changedRanges,r=bh.extendWithRanges(n,function(t,e,i){let s=new Nl;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(vh),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?Sh.RTL:Sh.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?Ql:Hl)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new Cl(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new $l(s.lineAt(r-1e3*i,Dl.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Dl.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,Dl.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new $l(s.lineAt(i-500,Dl.ByHeight,n,0,0).from,s.lineAt(i+r+500,Dl.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new $l(this.heightMap.lineAt(i,Dl.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Dl.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Dl.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,Dl.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new Il(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=Sh.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=ql(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=_l(r,(this.visibleTop-i.top-t)/i.height),n=_l(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=_l(r,(this.pixelViewport.left-e)/t),n=_l(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&Xl(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&Xl(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(jl(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new Il(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=Gl(s,i)-Gl(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){Il.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Qo.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(vh);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Yl(this.heightMap.lineAt(t,Dl.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Yl(this.heightMap.lineAt(this.scaler.fromDOM(t),Dl.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Yl(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class $l{constructor(t,e){this.from=t,this.to=e}}function ql(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(vh),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function _l({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function Gl(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function Xl(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function jl(t,e){for(let i of t)if(e(i))return i}const Ul={toDOM:t=>t,fromDOM:t=>t,scale:1};class Zl{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,Dl.ByPos,t,0,0).top,o=e.lineAt(n,Dl.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function Yl(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new Tl(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>Yl(t,e))):t.type)}const Kl=et.define({combine:t=>t.join(" ")}),Jl=et.define({combine:t=>t.indexOf(!0)>-1}),ta=jt.newName(),ea=jt.newName(),ia=jt.newName(),sa={"&light":"."+ea,"&dark":"."+ia};function na(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const ra=na("."+ta,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},sa),oa={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ha=So.ie&&So.ie_version<=11;class la{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Zr,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(So.ie&&So.ie_version<=11||So.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),ha&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(lh)?e.root.activeElement!=this.dom:!zr(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((So.ie&&So.ie_version<=11||So.android&&So.chrome)&&!e.state.selection.main.empty&&i.focusNode&&$r(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Qr(t),i=So.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);$r(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,oa),ha&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),ha&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;eo(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&zr(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=aa(e,t.previousSibling||t.target.previousSibling,-1),s=aa(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function aa(t,e,i){for(;e;){let s=ro.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function ca(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Qh(i,s)),n==i&&r==s||e.push(new Qh(n,r)));return e}(t),c=new Nh(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||So.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(So.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(lh)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Ir(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!Ir(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(So.ios&&t.inputState.flushIOSKey(t))return;if(So.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&eo(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&eo(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&eo(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(ih).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=Fh(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class da{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Fl(t.state||$t.create()),this.plugins=this.state.facet(uh).map((t=>new gh(t)));for(let t of this.plugins)t.update(this);this.observer=new la(this,((t,e,i)=>{ca(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new sl(this),this.docView=new Ih(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new Oh(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new rh(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(sh)?n=new rh(t.value):t.is(nh)?n=new rh(t.value,"center"):t.is(oh)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=ga.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(yh)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Kl)!=e.state.facet(Kl)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(eh))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Fl(t),this.plugins=t.facet(uh).map((t=>new gh(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new Ih(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(uh),i=t.state.facet(uh);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new gh(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return hh(this.state,t),pa}})),o=new Oh(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=pa)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){hh(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(eh))t(e)}get themeClasses(){return ta+" "+(this.state.facet(Jl)?ia:ea)+" "+this.state.facet(Kl)}updateAttrs(){let t=ma(this,mh,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(lh)?"true":"false",class:"cm-content",style:`${So.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),ma(this,wh,e),this.observer.ignore((()=>{Wo(this.contentDOM,this.contentAttrs,e),Wo(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(da.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(yh),jt.mount(this.root,this.styleModules.concat(ra).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=fa(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=fa(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=fa(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return il(this,t,el(this,t,e,i))}moveByGroup(t,e){return il(this,t,el(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==Sh.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=_o.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return il(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=Jh(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:sh.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Jh(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return jr(i,n[Eh.find(n,t-s.from,-1,e)].dir==Sh.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>ua)return Lh(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Ph(t.text,this.textDirection);return this.bidiCache.push(new ga(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||So.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Jr(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return oh.of(new rh("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return fh.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[Kl.of(i),yh.of(na(`.${i}`,t))];return e&&e.dark&&s.push(Jl.of(!0)),s}static baseTheme(t){return pt.lowest(yh.of(na("."+ta,t,sa)))}}da.scrollTo=sh,da.centerOn=nh,da.styleModule=yh,da.inputHandler=ih,da.exceptionSink=th,da.updateListener=eh,da.editable=lh,da.mouseSelectionStyle=Jo,da.dragMovesSelection=Ko,da.clickAddsSelectionRange=Yo,da.decorations=vh,da.darkTheme=Jl,da.contentAttributes=wh,da.editorAttributes=mh,da.lineWrapping=da.contentAttributes.of({class:"cm-lineWrapping"}),da.announce=Et.define();const ua=4096;function fa(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const pa={};class ga{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:Sh.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new ga(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function ma(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&Lo(r,i)}return i}const wa=!So.ios;const va={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};wa&&(va[".cm-line"].caretColor="transparent !important");const ya=Tt.define(),ba=Tt.define(),Oa=et.define(),Sa=et.define({combine:t=>qt(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})});const xa=ht.define({create:()=>Qa.empty,update(t,e){let i=e.state.facet(Sa),s=e.annotation(ya);if(s){let n=e.docChanged?Y.single(function(t){let e=0;return t.iterChangedRanges(((t,i)=>e=i)),e}(e.changes)):void 0,r=Ra.fromTransaction(e,n),o=s.side,h=0==o?t.undone:t.done;return h=r?Ea(h,h.length,i.minDepth,r):La(h,e.startState.selection),new Qa(0==o?s.rest:h,0==o?h:s.rest)}let n=e.annotation(ba);if("full"!=n&&"before"!=n||(t=t.isolate()),!1===e.annotation(Bt.addToHistory))return e.changes.empty?t:t.addMapping(e.changes.desc);let r=Ra.fromTransaction(e),o=e.annotation(Bt.time),h=e.annotation(Bt.userEvent);return r?t=t.addChanges(r,o,h,i.newGroupDelay,i.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,o,h,i.newGroupDelay)),"full"!=n&&"after"!=n||(t=t.isolate()),t},toJSON:t=>({done:t.done.map((t=>t.toJSON())),undone:t.undone.map((t=>t.toJSON()))}),fromJSON:t=>new Qa(t.done.map(Ra.fromJSON),t.undone.map(Ra.fromJSON))});function ka(t={}){return[xa,Sa.of(t),da.domEventHandlers({beforeinput(t,e){let i="historyUndo"==t.inputType?Ma:"historyRedo"==t.inputType?Ca:null;return!!i&&(t.preventDefault(),i(e))}})]}function Aa(t,e){return function({state:i,dispatch:s}){if(!e&&i.readOnly)return!1;let n=i.field(xa,!1);if(!n)return!1;let r=n.pop(t,i,e);return!!r&&(s(r),!0)}}const Ma=Aa(0,!1),Ca=Aa(1,!1),Ta=Aa(0,!0),Da=Aa(1,!0);class Ra{constructor(t,e,i,s,n){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=s,this.selectionsAfter=n}setSelAfter(t){return new Ra(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:null===(t=this.changes)||void 0===t?void 0:t.toJSON(),mapped:null===(e=this.mapped)||void 0===e?void 0:e.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((t=>t.toJSON()))}}static fromJSON(t){return new Ra(t.changes&&$.fromJSON(t.changes),[],t.mapped&&F.fromJSON(t.mapped),t.startSelection&&Y.fromJSON(t.startSelection),t.selectionsAfter.map(Y.fromJSON))}static fromTransaction(t,e){let i=Pa;for(let e of t.startState.facet(Oa)){let s=e(t);s.length&&(i=i.concat(s))}return!i.length&&t.changes.empty?null:new Ra(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,Pa)}static selection(t){return new Ra(void 0,Pa,void 0,void 0,t)}}function Ea(t,e,i,s){let n=e+1>i+20?e-i-1:0,r=t.slice(n,e);return r.push(s),r}function Ba(t,e){return t.length?e.length?t.concat(e):t:e}const Pa=[];function La(t,e){if(t.length){let i=t[t.length-1],s=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return s.length&&s[s.length-1].eq(e)?t:(s.push(e),Ea(t,t.length-1,1e9,i.setSelAfter(s)))}return[Ra.selection([e])]}function Va(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function Wa(t,e){if(!t.length)return t;let i=t.length,s=Pa;for(;i;){let n=Na(t[i-1],e,s);if(n.changes&&!n.changes.empty||n.effects.length){let e=t.slice(0,i);return e[i-1]=n,e}e=n.mapped,i--,s=n.selectionsAfter}return s.length?[Ra.selection(s)]:Pa}function Na(t,e,i){let s=Ba(t.selectionsAfter.length?t.selectionsAfter.map((t=>t.map(e))):Pa,i);if(!t.changes)return Ra.selection(s);let n=t.changes.map(e),r=e.mapDesc(t.changes,!0),o=t.mapped?t.mapped.composeDesc(r):r;return new Ra(n,Et.mapEffects(t.effects,e),o,t.startSelection.map(r),s)}const Ha=/^(input\.type|delete)($|\.)/;class Qa{constructor(t,e,i=0,s){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new Qa(this.done,this.undone):this}addChanges(t,e,i,s,n){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&t.changes&&(!i||Ha.test(i))&&(!o.selectionsAfter.length&&e-this.prevTime<s&&function(t,e){let i=[],s=!1;return t.iterChangedRanges(((t,e)=>i.push(t,e))),e.iterChangedRanges(((t,e,n,r)=>{for(let t=0;t<i.length;){let e=i[t++],o=i[t++];r>=e&&n<=o&&(s=!0)}})),s}(o.changes,t.changes)||"input.type.compose"==i)?Ea(r,r.length-1,n,new Ra(t.changes.compose(o.changes),Ba(t.effects,o.effects),o.mapped,o.startSelection,Pa)):Ea(r,r.length,n,t),new Qa(r,Pa,e,i)}addSelection(t,e,i,s){let n=this.done.length?this.done[this.done.length-1].selectionsAfter:Pa;return n.length>0&&e-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(r=n[n.length-1],o=t,r.ranges.length==o.ranges.length&&0===r.ranges.filter(((t,e)=>t.empty!=o.ranges[e].empty)).length)?this:new Qa(La(this.done,t),this.undone,e,i);var r,o}addMapping(t){return new Qa(Wa(this.done,t),Wa(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let s=0==t?this.done:this.undone;if(0==s.length)return null;let n=s[s.length-1];if(i&&n.selectionsAfter.length)return e.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:ya.of({side:t,rest:Va(s)}),userEvent:0==t?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let i=1==s.length?Pa:s.slice(0,s.length-1);return n.mapped&&(i=Wa(i,n.mapped)),e.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:ya.of({side:t,rest:i}),filter:!1,userEvent:0==t?"undo":"redo",scrollIntoView:!0})}return null}}Qa.empty=new Qa(Pa,Pa);const Ia=[{key:"Mod-z",run:Ma,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Ca,preventDefault:!0},{key:"Mod-u",run:Ta,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Da,preventDefault:!0}];function za(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Fa(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function $a(t,e){if(!e.anchorNode)return!1;try{return Fa(t,e.anchorNode)}catch(t){return!1}}function qa(t){return 3==t.nodeType?ic(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function _a(t,e,i,s){return!!i&&(Xa(t,e,i,s,-1)||Xa(t,e,i,s,1))}function Ga(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Xa(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:ja(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Ga(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?ja(t):0}}}function ja(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Ua={left:0,right:0,top:0,bottom:0};function Za(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Ya(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Ka{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Ja,tc=null;function ec(t){if(t.setActive)return t.setActive();if(tc)return t.focus(tc);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==tc?{get preventScroll(){return tc={preventScroll:!0},!0}}:void 0),!tc){tc=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function ic(t,e,i=e){let s=Ja||(Ja=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function sc(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function nc(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class rc{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new rc(t.parentNode,Ga(t),e)}static after(t,e){return new rc(t.parentNode,Ga(t)+1,e)}}const oc=[];class hc{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=hc.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=lc(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=lc(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==ja(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!hc.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=oc){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new ac(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function lc(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}hc.prototype.breakAfter=0;class ac{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function cc(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function dc(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,cc(t,a,c,h,l,s,0,n,r)}let uc="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},fc="undefined"!=typeof document?document:{documentElement:{style:{}}};const pc=/Edge\/(\d+)/.exec(uc.userAgent),gc=/MSIE \d/.test(uc.userAgent),mc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(uc.userAgent),wc=!!(gc||mc||pc),vc=!wc&&/gecko\/(\d+)/i.test(uc.userAgent),yc=!wc&&/Chrome\/(\d+)/.exec(uc.userAgent),bc="webkitFontSmoothing"in fc.documentElement.style,Oc=!wc&&/Apple Computer/.test(uc.vendor),Sc=Oc&&(/Mobile\/\w+/.test(uc.userAgent)||uc.maxTouchPoints>2);var xc={mac:Sc||/Mac/.test(uc.platform),windows:/Win/.test(uc.platform),linux:/Linux|X11/.test(uc.platform),ie:wc,ie_version:gc?fc.documentMode||6:mc?+mc[1]:pc?+pc[1]:0,gecko:vc,gecko_version:vc?+(/Firefox\/(\d+)/.exec(uc.userAgent)||[0,0])[1]:0,chrome:!!yc,chrome_version:yc?+yc[1]:0,ios:Sc,android:/Android\b/.test(uc.userAgent),webkit:bc,safari:Oc,webkit_version:bc?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=fc.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class kc extends hc{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof kc&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new kc(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new rc(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Mc(this.dom,t,e)}}class Ac extends hc{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(nc(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof Ac&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(dc(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Ac(this.mark,e,r)}domAtPos(t){return Bc(this.dom,this.children,t)}coordsAt(t,e){return Lc(this,t,e)}}function Mc(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?xc.chrome||xc.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=ic(t,n,r).getClientRects();if(!h.length)return Ua;let l=h[(o?o<0:i>=0)?0:h.length-1];return xc.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?Za(l,o<0):l||null}class Cc extends hc{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Cc)(t,e,i)}split(t){let e=Cc.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Cc&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Cc&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?rc.before(this.dom):rc.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return Ua;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:Za(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Tc extends Cc{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Dc(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new rc(i,Math.min(t,i.nodeValue.length)))):new rc(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Rc(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?Dc(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Mc(s,t,e))):Mc(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function Dc(t,e,i,s,n,r){if(i instanceof Ac){for(let o of i.children){let i=Fa(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?Dc(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Rc(t,e,i,s){if(i instanceof Ac)for(let n of i.children){let i=0,r=Fa(n.dom,s);if(Fa(n.dom,t))return i+(r?Rc(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class Ec extends hc{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Ec&&t.side==this.side}split(){return new Ec(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return rc.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof kc){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof Ac&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function Bc(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return rc.after(i)}return new rc(t,0)}function Pc(t,e,i){let s,{children:n}=t;i>0&&e instanceof Ac&&n.length&&(s=n[n.length-1])instanceof Ac&&s.mark.eq(e.mark)?Pc(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function Lc(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?Za(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=qa(s);return n[n.length-1]||null}function Vc(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function Wc(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function Nc(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}kc.prototype.children=Cc.prototype.children=Ec.prototype.children=oc;class Hc{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Qc=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Qc||(Qc={}));class Ic extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new zc(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new $c(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=qc(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new $c(t,e,i,s,t.widget||null,!0)}static line(t){return new Fc(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Ic.none=ee.empty;class zc extends Ic{constructor(t){let{start:e,end:i}=qc(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof zc&&this.tagName==t.tagName&&this.class==t.class&&Wc(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}zc.prototype.point=!1;class Fc extends Ic{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Fc&&Wc(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Fc.prototype.mapMode=z.TrackBefore,Fc.prototype.point=!0;class $c extends Ic{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?Qc.WidgetRange:this.startSide<=0?Qc.WidgetBefore:Qc.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof $c&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function qc(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function _c(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}$c.prototype.point=!0;class Gc extends hc{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof Gc))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),dc(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new Gc;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Wc(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Pc(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Vc(e,this.attrs||{})),i&&(this.attrs=Vc({class:i},this.attrs||{}))}domAtPos(t){return Bc(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(nc(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Nc(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&hc.get(i)instanceof Ac;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=hc.get(i))||void 0===e?void 0:e.isEditable)||xc.ios&&this.children.some((t=>t instanceof kc))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof kc))return null;let i=qa(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return Lc(this,t,e)}become(t){return!1}get type(){return Qc.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof Gc)return n;if(r>e)break}s=r+n.breakAfter}return null}}class Xc extends hc{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Xc&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?rc.before(this.dom):rc.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Xc(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return oc}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof Xc&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class jc{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Xc&&t.type==Qc.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Gc),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Uc(new Ec(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Uc(new kc(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof $c)if(i.block){let{type:t}=i;t!=Qc.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Xc(i.widget||new Zc("div"),r,t))}else{let o=Cc.create(i.widget||new Zc("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(Uc(new Ec(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(Uc(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof $c){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new jc(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Uc(t,e){for(let i of e)t=new Ac(i,[t],t.length);return t}class Zc extends Hc{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Yc=[],Kc=et.define(),Jc=et.define(),td=et.define(),ed=et.define(),id=et.define(),sd=et.define(),nd=Et.define({map:(t,e)=>t.map(e)}),rd=Et.define({map:(t,e)=>t.map(e)});class od{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new od(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const hd=Et.define({map:(t,e)=>t.map(e)});function ld(t,e,i){let s=t.facet(ed);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const ad=et.define({combine:t=>!t.length||t[0]});class cd{constructor(t,e){this.field=t,this.get=e}}class dd{from(t){return new cd(this,t)}static define(){return new dd}}dd.decorations=dd.define(),dd.atomicRanges=dd.define(),dd.scrollMargins=dd.define();let ud=0;const fd=et.define();class pd{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=fd.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(gd.from((t=>({plugin:t,handlers:i})))),n&&r.push(dd.decorations.from(n)),new pd(ud++,t,r)}static fromClass(t,e){return pd.define((e=>new t(e)),e)}}const gd=dd.define();class md{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(ld(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){ld(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){ld(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const wd=et.define(),vd=et.define(),yd=et.define(),bd=et.define();class Od{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Od(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new Od(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new Od(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class Sd{constructor(t,e,i=Yc){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Od(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var xd=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(xd||(xd={}));const kd=xd.LTR,Ad=xd.RTL;function Md(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Cd=Md("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Td=Md("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Dd=Object.create(null),Rd=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Dd[e]=i,Dd[i]=-e}const Ed=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Bd{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Ad:kd}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Pd=[];function Ld(t,e){let i=t.length,s=e==kd?1:2,n=e==kd?2:1;if(!t||1==s&&!Ed.test(t))return Vd(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Cd[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Td[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Pd[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Pd[t];if(128==s)t<i-1&&e==Pd[t+1]&&24&e?s=Pd[t]=e:Pd[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Pd[s];)s++;let r=t&&8==e||s<i&&8==Pd[s]?1==n?1:8:256;for(let e=t;e<s;e++)Pd[e]=r;t=s-1}else 8==s&&1==n&&(Pd[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Dd[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Rd[t+1]==-r){let e=Rd[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Pd[h]=Pd[Rd[t]]=i),l=t;break}}else{if(189==Rd.length)break;Rd[l++]=h,Rd[l++]=e,Rd[l++]=a}else if(2==(o=Pd[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Rd[e+2];if(2&i)break;if(t)Rd[e+2]|=2;else{if(4&i)break;Rd[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Pd[t]){let e=t+1;for(;e<i&&256==Pd[e];)e++;let n=1==(t?Pd[t-1]:s),r=n==(1==(e<i?Pd[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Pd[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Pd[t++];for(;t<i&&s==(1!=Pd[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Pd[--i];for(;i>e&&s==(2!=Pd[i-1]);)i--;o.push(new Bd(i,t,s?2:1))}else o.push(new Bd(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Pd[t++];for(;t<i&&s==(2==Pd[t]);)t++;o.push(new Bd(e,t,s?1:2))}return o}function Vd(t){return[new Bd(0,t,0)]}let Wd="";function Nd(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=Bd.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(Wd=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Hd{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=hc.get(s),r=hc.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Qd(s))||Qd(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=hc.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Qd(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Id{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class zd extends hc{constructor(t){super(),this.view=t,this.compositionDeco=Ic.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Gc],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Od(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Ic.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=$d(t);if(!i)return Ic.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Hd([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return Ic.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return Ic.none;let d=hc.get(r);d instanceof Tc?d=d.widget.topView:d&&(d.parent=null);return Ic.set(Ic.replace({widget:new qd(r,o,d)}).range(h,l))}(this.view,t.changes)),(xc.ie||xc.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new Gd;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Od.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=xc.chrome||xc.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Xc&&t.widget instanceof Fd&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=jc.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);cc(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||xc.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(xc.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new rc(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&_a(n.node,n.offset,h.anchorNode,h.anchorOffset)&&_a(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{xc.android&&xc.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=za(this.root);if(s.empty){if(xc.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=_d(n.node,n.offset,1==t?1:-1);e&&(n=new rc(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new rc(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new rc(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=za(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Gc.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(ad)?this.root.activeElement==this.dom:$a(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=hc.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Gc)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=Qc.WidgetBefore&&n.type!=Qc.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==Qc.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?qa(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==xd.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Gc){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=qa(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new ac(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Ic.replace({widget:new Fd(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return Ic.set(t)}updateDeco(){let t=this.view.pluginField(dd.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(yd),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(dd.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=Ya(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==xd.LTR)}}class Fd extends Hc{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function $d(t){let e=t.observer.selectionRange,i=e.focusNode&&_d(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof Gc){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!hc.get(e);)e=e.previousSibling;let n=e?hc.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof Gc)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class qd extends Hc{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Tc}}function _d(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=ja(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Gd{constructor(){this.changes=[]}compareRange(t,e){_c(t,e,this.changes)}comparePoint(t,e){_c(t,e,this.changes)}}function Xd(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function jd(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Ud(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Zd(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Yd(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Kd(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=qa(d);for(let u=0;u<t.length;u++){let f=t[u];n&&Ud(n,f)&&(f=Zd(Yd(f,n.bottom),n.top));let p=Xd(e,f),g=jd(i,f);if(0==p&&0==g)return 3==d.nodeType?Jd(d,e,i):Kd(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&Ud(a,f)?a=Yd(a,f.bottom):c&&Ud(c,f)&&(c=Zd(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Jd(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:Kd(s,d,i)}function Jd(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=ic(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(xc.chrome||xc.gecko){ic(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function tu(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Qc.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:eu(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:eu(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),xc.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return ic(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=Gc.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Kd(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function eu(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function iu(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=Nd(n,r,t.textDirection,o,i),l=Wd;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function su(t,e,i){let s=t.pluginField(dd.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class nu{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in au){let i=au[e];t.contentDOM.addEventListener(e,(s=>{lu(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),xc.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(gd);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{lu(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){ld(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){ld(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(xc.android&&xc.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!xc.ios||!(i=ru.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,sc(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(xc.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!xc.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const ru=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ou=[16,17,18,20,91,92,224,225];class hu{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Kc);return i.length?i[0](e):xc.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Jc);return i.length?i[0](e):xc.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=za(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Su(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function lu(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=hc.get(s))&&i.ignoreEvent(e))return!1;return!0}const au=Object.create(null),cu=xc.ie&&xc.ie_version<15||xc.ios&&xc.webkit_version<604;function du(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=ku&&s.selection.ranges.every((t=>t.empty))&&ku==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}au.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():ou.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let uu=0;function fu(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=Gc.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}au.touchstart=(t,e)=>{uu=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},au.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},au.mousedown=(t,e)=>{if(t.observer.flush(),uu>Date.now()-2e3&&1==Su(e))return;let i=null;for(let s of t.state.facet(td))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=wu(t,e),s=Su(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=wu(t,e),o=e),!a||!i)return n;let c=fu(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=fu(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>ec(t.contentDOM))),t.inputState.startMouseSelection(new hu(t,e,i,s))}};let pu=(t,e)=>t>=e.top&&t<=e.bottom,gu=(t,e,i)=>pu(e,i)&&t>=i.left&&t<=i.right;function mu(t,e,i,s){let n=Gc.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&gu(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&gu(i,s,h)?1:o&&pu(s,o)?-1:1}function wu(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:mu(t,i,e.clientX,e.clientY)}}const vu=xc.ie&&xc.ie_version<=11;let yu=null,bu=0,Ou=0;function Su(t){if(!vu)return t.detail;let e=yu,i=Ou;return yu=t,Ou=Date.now(),bu=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(bu+1)%3:1}function xu(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}au.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},au.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&xu(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else xu(t,e,e.dataTransfer.getData("Text"),!0)},au.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=cu?null:e.clipboardData;i?(du(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),du(t,i.value)}),50)}(t)};let ku=null;function Au(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}au.copy=au.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;ku=n?i:null;let r=cu?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},au.focus=au.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},au.compositionstart=au.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Au(t,!0)))},au.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&Au(t,!1)}),50)},au.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},au.beforeinput=(t,e)=>{var i;let s;if(xc.chrome&&xc.android&&(s=ru.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const Mu=["pre-wrap","normal","pre-line","break-spaces"];class Cu{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=xd.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return Mu.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=Mu.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class Tu{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Du{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Du(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Du(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var Ru=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Ru||(Ru={}));class Eu{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Eu.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,Ru.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,Ru.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Ru.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=Nu.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new Pu(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Vu(Eu.of(t.slice(0,e)),r,Eu.of(t.slice(i)))}}Eu.prototype.size=1;class Bu extends Eu{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new Du(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Pu extends Bu{constructor(t,e){super(t,e,Qc.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof Pu||s instanceof Lu&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof Lu?s=new Pu(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Eu.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Lu extends Eu{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new Du(l,a,i+o*h,o,Qc.Text)}lineAt(t,e,i,s,n){if(e==Ru.ByHeight)return this.blockAt(t,i,s,n);if(e==Ru.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new Du(e,s-e,0,0,Qc.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new Du(h,l,s+o*(a-r),o,Qc.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new Du(e.from,e.length,s,h,Qc.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof Lu?i[i.length-1]=new Lu(t.length+s):i.push(null,new Lu(s-1))}if(t>0){let e=i[0];e instanceof Lu?i[0]=new Lu(t+e.length):i.unshift(new Lu(t-1),null)}return Eu.of(i)}decomposeLeft(t,e){e.push(new Lu(t-1),null)}decomposeRight(t,e){e.push(null,new Lu(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new Lu(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new Pu(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new Lu(n-r).updateHeight(t,r));let l=Eu.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Vu extends Eu{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==Ru.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==Ru.ByPosNoHeight?Ru.ByPosNoHeight:Ru.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,Ru.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&Wu(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),Wu(n,t)}return Eu.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Eu.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Wu(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof Lu&&(s=t[e+1])instanceof Lu&&t.splice(e-1,3,new Lu(i.length+1+s.length))}class Nu{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Pu?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Pu(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new Bu(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Pu(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Lu(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Pu)return t;let e=new Pu(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Qc.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Qc.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Pu||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Pu(0,-1));let i=t;for(let t of this.nodes)t instanceof Pu&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new Nu(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class Hu{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&_c(t,e,this.changes,5)}}function Qu(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function Iu(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class zu{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return Ic.replace({widget:new Fu(this.size,t)}).range(this.from,this.to)}}class Fu extends Hc{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class $u{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Cu,this.scaler=Zu,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Eu.empty().applyChanges(t.facet(yd),E.empty,this.heightOracle.setDoc(t.doc),[new Od(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Ic.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new qu(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Zu:new Yu(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Ku(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(yd),n=t.changedRanges,r=Od.extendWithRanges(n,function(t,e,i){let s=new Hu;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(yd),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?xd.RTL:xd.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?Iu:Qu)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new Tu(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new qu(s.lineAt(r-1e3*i,Ru.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Ru.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,Ru.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new qu(s.lineAt(i-500,Ru.ByHeight,n,0,0).from,s.lineAt(i+r+500,Ru.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new qu(this.heightMap.lineAt(i,Ru.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Ru.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Ru.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,Ru.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new zu(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=xd.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=_u(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Gu(r,(this.visibleTop-i.top-t)/i.height),n=Gu(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=Gu(r,(this.pixelViewport.left-e)/t),n=Gu(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&ju(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&ju(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(Uu(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new zu(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=Xu(s,i)-Xu(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){zu.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Ic.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(yd);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Ku(this.heightMap.lineAt(t,Ru.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Ku(this.heightMap.lineAt(this.scaler.fromDOM(t),Ru.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Ku(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class qu{constructor(t,e){this.from=t,this.to=e}}function _u(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(yd),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function Gu({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function Xu(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function ju(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function Uu(t,e){for(let i of t)if(e(i))return i}const Zu={toDOM:t=>t,fromDOM:t=>t,scale:1};class Yu{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,Ru.ByPos,t,0,0).top,o=e.lineAt(n,Ru.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function Ku(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new Du(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>Ku(t,e))):t.type)}const Ju=et.define({combine:t=>t.join(" ")}),tf=et.define({combine:t=>t.indexOf(!0)>-1}),ef=jt.newName(),sf=jt.newName(),nf=jt.newName(),rf={"&light":"."+sf,"&dark":"."+nf};function of(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const hf=of("."+ef,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},rf),lf={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},af=xc.ie&&xc.ie_version<=11;class cf{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Ka,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(xc.ie&&xc.ie_version<=11||xc.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),af&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(ad)?e.root.activeElement!=this.dom:!$a(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((xc.ie&&xc.ie_version<=11||xc.android&&xc.chrome)&&!e.state.selection.main.empty&&i.focusNode&&_a(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=za(t),i=xc.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);_a(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,lf),af&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),af&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;sc(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&$a(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=df(e,t.previousSibling||t.target.previousSibling,-1),s=df(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function df(t,e,i){for(;e;){let s=hc.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function uf(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Id(i,s)),n==i&&r==s||e.push(new Id(n,r)));return e}(t),c=new Hd(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||xc.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(xc.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(ad)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Fa(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!Fa(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(xc.ios&&t.inputState.flushIOSKey(t))return;if(xc.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&sc(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&sc(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&sc(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(sd).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=$d(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class ff{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new $u(t.state||$t.create()),this.plugins=this.state.facet(fd).map((t=>new md(t)));for(let t of this.plugins)t.update(this);this.observer=new cf(this,((t,e,i)=>{uf(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new nu(this),this.docView=new zd(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new Sd(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new od(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(nd)?n=new od(t.value):t.is(rd)?n=new od(t.value,"center"):t.is(hd)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=wf.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(bd)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Ju)!=e.state.facet(Ju)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(id))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new $u(t),this.plugins=t.facet(fd).map((t=>new md(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new zd(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(fd),i=t.state.facet(fd);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new md(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return ld(this.state,t),mf}})),o=new Sd(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=mf)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){ld(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(id))t(e)}get themeClasses(){return ef+" "+(this.state.facet(tf)?nf:sf)+" "+this.state.facet(Ju)}updateAttrs(){let t=vf(this,wd,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(ad)?"true":"false",class:"cm-content",style:`${xc.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),vf(this,vd,e),this.observer.ignore((()=>{Nc(this.contentDOM,this.contentAttrs,e),Nc(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(ff.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(bd),jt.mount(this.root,this.styleModules.concat(hf).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=gf(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=gf(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=gf(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return su(this,t,iu(this,t,e,i))}moveByGroup(t,e){return su(this,t,iu(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==xd.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=Gc.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return su(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=tu(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:nd.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),tu(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return Za(i,n[Bd.find(n,t-s.from,-1,e)].dir==xd.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>pf)return Vd(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Ld(t.text,this.textDirection);return this.bidiCache.push(new wf(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||xc.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{ec(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return hd.of(new od("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return pd.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[Ju.of(i),bd.of(of(`.${i}`,t))];return e&&e.dark&&s.push(tf.of(!0)),s}static baseTheme(t){return pt.lowest(bd.of(of("."+ef,t,rf)))}}ff.scrollTo=nd,ff.centerOn=rd,ff.styleModule=bd,ff.inputHandler=sd,ff.exceptionSink=ed,ff.updateListener=id,ff.editable=ad,ff.mouseSelectionStyle=td,ff.dragMovesSelection=Jc,ff.clickAddsSelectionRange=Kc,ff.decorations=yd,ff.darkTheme=tf,ff.contentAttributes=vd,ff.editorAttributes=wd,ff.lineWrapping=ff.contentAttributes.of({class:"cm-lineWrapping"}),ff.announce=Et.define();const pf=4096;function gf(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const mf={};class wf{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:xd.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new wf(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function vf(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&Vc(r,i)}return i}const yf=!xc.ios;const bf={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};yf&&(bf[".cm-line"].caretColor="transparent !important");const Of=1024;let Sf=0;class xf{constructor(t,e){this.from=t,this.to=e}}class kf{constructor(t={}){this.id=Sf++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=Mf.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}kf.closedBy=new kf({deserialize:t=>t.split(" ")}),kf.openedBy=new kf({deserialize:t=>t.split(" ")}),kf.group=new kf({deserialize:t=>t.split(" ")}),kf.contextHash=new kf({perNode:!0}),kf.lookAhead=new kf({perNode:!0}),kf.mounted=new kf({perNode:!0});const Af=Object.create(null);class Mf{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):Af,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new Mf(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(kf.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(kf.group),s=-1;s<(i?i.length:0);s++){let n=e[s<0?t.name:i[s]];if(n)return n}}}}Mf.none=new Mf("",Object.create(null),0,8);class Cf{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let s=null;for(let e of t){let t=e(i);t&&(s||(s=Object.assign({},i.props)),s[t[0].id]=t[1])}e.push(s?new Mf(i.name,s,i.id,i.flags):i)}return new Cf(e)}}const Tf=new WeakMap,Df=new WeakMap;class Rf{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[t,e]of n)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(kf.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t,e=0){let i=null!=t&&Tf.get(this)||this.topNode,s=new If(i);return null!=t&&(s.moveTo(t,e),Tf.set(this,s._tree)),s}fullCursor(){return new If(this.topNode,1)}get topNode(){return new Wf(this,0,0,null)}resolve(t,e=0){let i=Vf(Tf.get(this)||this.topNode,t,e,!1);return Tf.set(this,i),i}resolveInner(t,e=0){let i=Vf(Df.get(this)||this.topNode,t,e,!0);return Df.set(this,i),i}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t;for(let t=this.cursor(),r=()=>t.node;;){let o=!1;if(t.from<=n&&t.to>=s&&(t.type.isAnonymous||!1!==e(t.type,t.from,t.to,r))){if(t.firstChild())continue;t.type.isAnonymous||(o=!0)}for(;o&&i&&i(t.type,t.from,t.to,r),o=t.type.isAnonymous,!t.nextSibling();){if(!t.parent())return;o=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:qf(Mf.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new Rf(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new Rf(Mf.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,maxBufferLength:n=Of,reused:r=[],minRepeatType:o=s.types.length}=t,h=Array.isArray(i)?new Ef(i,i.length):i,l=s.types,a=0,c=0;function d(t,e,i,w,v){let{id:y,start:b,end:O,size:S}=h,x=c;for(;S<0;){if(h.next(),-1==S){let e=r[y];return i.push(e),void w.push(b-t)}if(-3==S)return void(a=y);if(-4==S)return void(c=y);throw new RangeError(`Unrecognized record size: ${S}`)}let k,A,M=l[y],C=b-t;if(O-b<=n&&(A=g(h.pos-e,v))){let e=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=e.length;for(;h.pos>i;)n=m(A.start,e,n);k=new Bf(e,O-A.start,s),C=A.start-t}else{let t=h.pos-S;h.next();let e=[],i=[],s=y>=o?y:-1,r=0,l=O;for(;h.pos>t;)s>=0&&h.id==s&&h.size>=0?(h.end<=l-n&&(f(e,i,b,r,h.end,l,s,x),r=e.length,l=h.end),h.next()):d(b,t,e,i,s);if(s>=0&&r>0&&r<e.length&&f(e,i,b,r,b,l,s,x),e.reverse(),i.reverse(),s>-1&&r>0){let t=u(M);k=qf(M,e,i,0,e.length,0,O-b,t,t)}else k=p(M,e,i,O-b,x-O)}i.push(k),w.push(C)}function u(t){return(e,i,s)=>{let n,r,o=0,h=e.length-1;if(h>=0&&(n=e[h])instanceof Rf){if(!h&&n.type==t&&n.length==s)return n;(r=n.prop(kf.lookAhead))&&(o=i[h]+n.length+r)}return p(t,e,i,s,o)}}function f(t,e,i,n,r,o,h,l){let a=[],c=[];for(;t.length>n;)a.push(t.pop()),c.push(e.pop()+i-r);t.push(p(s.types[h],a,c,o-r,l-o)),e.push(r-i)}function p(t,e,i,s,n=0,r){if(a){let t=[kf.contextHash,a];r=r?[t].concat(r):[t]}if(n>25){let t=[kf.lookAhead,n];r=r?[t].concat(r):[t]}return new Rf(t,e,i,s,r)}function g(t,e){let i=h.fork(),s=0,r=0,l=0,a=i.end-n,c={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){let t=i.size;if(i.id==e&&t>=0){c.size=s,c.start=r,c.skip=l,l+=4,s+=4,i.next();continue}let h=i.pos-t;if(t<0||h<n||i.start<a)break;let d=i.id>=o?4:0,u=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break t;d+=4}else i.id>=o&&(d+=4);i.next()}r=u,s+=t,l+=d}return(e<0||s==t)&&(c.size=s,c.start=r,c.skip=l),c.size>4?c:void 0}function m(t,e,i){let{id:s,start:n,end:r,size:l}=h;if(h.next(),l>=0&&s<o){let o=i;if(l>4){let s=h.pos-(l-4);for(;h.pos>s;)i=m(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=n-t,e[--i]=s}else-3==l?a=s:-4==l&&(c=s);return i}let w=[],v=[];for(;h.pos>0;)d(t.start||0,t.bufferStart||0,w,v,-1);let y=null!==(e=t.length)&&void 0!==e?e:w.length?v[0]+w[0].length:0;return new Rf(l[t.topID],w.reverse(),v.reverse(),y)}(t)}}Rf.empty=new Rf(Mf.none,[],[],0);class Ef{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Ef(this.buffer,this.index)}}class Bf{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return Mf.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(t+=4))return n;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return n+"("+r.join(",")+")"}findChild(t,e,i,s,n){let{buffer:r}=this,o=-1;for(let h=t;h!=e&&!(Pf(n,s,r[h+1],r[h+2])&&(o=h,i>0));h=r[h+3]);return o}slice(t,e,i,s){let n=this.buffer,r=new Uint16Array(e-t);for(let s=t,o=0;s<e;)r[o++]=n[s++],r[o++]=n[s++]-i,r[o++]=n[s++]-i,r[o++]=n[s++]-t;return new Bf(r,s-i,this.set)}}function Pf(t,e,i,s){switch(t){case-2:return i<e;case-1:return s>=e&&i<e;case 0:return i<e&&s>e;case 1:return i<=e&&s>e;case 2:return s>e;case 4:return!0}}function Lf(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function Vf(t,e,i,s){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!s&&t instanceof Wf&&t.index<0?null:t.parent;if(!e)return t;t=e}if(s)for(let s=t,r=s.parent;r;s=r,r=s.parent)s instanceof Wf&&s.index<0&&(null===(n=r.enter(e,i,!0))||void 0===n?void 0:n.from)!=s.from&&(t=r);for(;;){let n=t.enter(e,i,s);if(!n)return t;t=n}}class Wf{constructor(t,e,i,s){this.node=t,this._from=e,this.index=i,this._parent=s}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(t,e,i,s,n=0){for(let r=this;;){for(let{children:o,positions:h}=r.node,l=e>0?o.length:-1;t!=l;t+=e){let l=o[t],a=h[t]+r._from;if(Pf(s,i,a,a+l.length))if(l instanceof Bf){if(2&n)continue;let o=l.findChild(0,l.buffer.length,e,i-a,s);if(o>-1)return new Qf(new Hf(r,l,t,a),null,o)}else if(1&n||!l.type.isAnonymous||zf(l)){let o;if(!(1&n)&&l.props&&(o=l.prop(kf.mounted))&&!o.overlay)return new Wf(o.tree,a,t,r);let h=new Wf(l,a,t,r);return 1&n||!h.type.isAnonymous?h:h.nextChild(e<0?l.children.length-1:0,e,i,s)}}if(1&n||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent.node.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this.node.children.length-1,-1,t,-2)}enter(t,e,i=!0,s=!0){let n;if(i&&(n=this.node.prop(kf.mounted))&&n.overlay){let i=t-this.from;for(let{from:t,to:s}of n.overlay)if((e>0?t<=i:t<i)&&(e<0?s>=i:s>i))return new Wf(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,s?0:2)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new If(this)}get tree(){return this.node}toTree(){return this.node}resolve(t,e=0){return Vf(this,t,e,!1)}resolveInner(t,e=0){return Vf(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Lf(this,t)}getChild(t,e=null,i=null){let s=Nf(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Nf(this,t,e,i)}toString(){return this.node.toString()}}function Nf(t,e,i,s){let n=t.cursor,r=[];if(!n.firstChild())return r;if(null!=i)for(;!n.type.is(i);)if(!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}class Hf{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class Qf{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new Qf(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i,s=!0){if(!s)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return r<0?null:new Qf(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Qf(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Qf(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get cursor(){return new If(this)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];t.push(i.slice(s,n,r,o)),e.push(0)}return new Rf(this.type,t,e,this.to-this.from)}resolve(t,e=0){return Vf(this,t,e,!1)}resolveInner(t,e=0){return Vf(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Lf(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=Nf(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Nf(this,t,e,i)}}class If{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof Wf)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof Wf?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=!0,s=!0){return this.buffer?!!s&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i&&!(1&this.mode),s))}parent(){if(!this.buffer)return this.yieldNode(1&this.mode?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=1&this.mode?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let s=e+t,n=t<0?-1:i.node.children.length;s!=n;s+=t){let t=i.node.children[s];if(1&this.mode||t instanceof Bf||!t.type.isAnonymous||zf(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=t;r;r=r._parent)if(r.index==s){if(s==this.index)return r;e=r,i=n+1;break t}s=this.stack[--n]}for(let t=i;t<this.stack.length;t++)e=new Qf(this.buffer,e,this.stack[t]);return this.bufferNode=new Qf(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree.node}}function zf(t){return t.children.some((t=>t instanceof Bf||!t.type.isAnonymous||zf(t)))}const Ff=new WeakMap;function $f(t,e){if(!t.isAnonymous||e instanceof Bf||e.type!=t)return 1;let i=Ff.get(e);if(null==i){i=1;for(let s of e.children){if(s.type!=t||!(s instanceof Rf)){i=1;break}i+=$f(t,s)}Ff.set(e,i)}return i}function qf(t,e,i,s,n,r,o,h,l){let a=0;for(let i=s;i<n;i++)a+=$f(t,e[i]);let c=Math.ceil(1.5*a/8),d=[],u=[];return function e(i,s,n,o,h){for(let a=n;a<o;){let n=a,f=s[a],p=$f(t,i[a]);for(a++;a<o;a++){let e=$f(t,i[a]);if(p+e>=c)break;p+=e}if(a==n+1){if(p>c){let t=i[n];e(t.children,t.positions,0,t.children.length,s[n]+h);continue}d.push(i[n])}else{let e=s[a-1]+i[a-1].length-f;d.push(qf(t,i,s,n,a,f,e,null,l))}u.push(f+h-r)}}(e,i,s,n,0),(h||l)(d,u,o)}class _f{constructor(t,e,i,s,n=!1,r=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(t,e=[],i=!1){let s=[new _f(0,t.length,t,0,!1,i)];for(let i of e)i.to>t.length&&s.push(i);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,r=t.length?t[0]:null;for(let o=0,h=0,l=0;;o++){let a=o<e.length?e[o]:null,c=a?a.fromA:1e9;if(c-h>=i)for(;r&&r.from<c;){let e=r;if(h>=e.from||c<=e.to||l){let t=Math.max(e.from,h)-l,i=Math.min(e.to,c)-l;e=t>=i?null:new _f(t,i,e.tree,e.offset+l,o>0,!!a)}if(e&&s.push(e),r.to>c)break;r=n<t.length?t[n++]:null}if(!a)break;h=a.toA,l=a.toA-a.toB}return s}}class Gf{startParse(t,e,i){return"string"==typeof t&&(t=new Xf(t)),i=i?i.length?i.map((t=>new xf(t.from,t.to))):[new xf(0,0)]:[new xf(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let t=s.advance();if(t)return t}}}class Xf{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new kf({perNode:!0});function jf(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Uf(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Zf(t,e){if(!e.anchorNode)return!1;try{return Uf(t,e.anchorNode)}catch(t){return!1}}function Yf(t){return 3==t.nodeType?ap(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Kf(t,e,i,s){return!!i&&(tp(t,e,i,s,-1)||tp(t,e,i,s,1))}function Jf(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function tp(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:ep(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Jf(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?ep(t):0}}}function ep(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const ip={left:0,right:0,top:0,bottom:0};function sp(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function np(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class rp{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let op,hp=null;function lp(t){if(t.setActive)return t.setActive();if(hp)return t.focus(hp);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==hp?{get preventScroll(){return hp={preventScroll:!0},!0}}:void 0),!hp){hp=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function ap(t,e,i=e){let s=op||(op=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function cp(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function dp(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class up{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new up(t.parentNode,Jf(t),e)}static after(t,e){return new up(t.parentNode,Jf(t)+1,e)}}const fp=[];class pp{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=pp.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=gp(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=gp(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==ep(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!pp.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=fp){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new mp(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function gp(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}pp.prototype.breakAfter=0;class mp{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function wp(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function vp(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,wp(t,a,c,h,l,s,0,n,r)}let yp="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},bp="undefined"!=typeof document?document:{documentElement:{style:{}}};const Op=/Edge\/(\d+)/.exec(yp.userAgent),Sp=/MSIE \d/.test(yp.userAgent),xp=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(yp.userAgent),kp=!!(Sp||xp||Op),Ap=!kp&&/gecko\/(\d+)/i.test(yp.userAgent),Mp=!kp&&/Chrome\/(\d+)/.exec(yp.userAgent),Cp="webkitFontSmoothing"in bp.documentElement.style,Tp=!kp&&/Apple Computer/.test(yp.vendor),Dp=Tp&&(/Mobile\/\w+/.test(yp.userAgent)||yp.maxTouchPoints>2);var Rp={mac:Dp||/Mac/.test(yp.platform),windows:/Win/.test(yp.platform),linux:/Linux|X11/.test(yp.platform),ie:kp,ie_version:Sp?bp.documentMode||6:xp?+xp[1]:Op?+Op[1]:0,gecko:Ap,gecko_version:Ap?+(/Firefox\/(\d+)/.exec(yp.userAgent)||[0,0])[1]:0,chrome:!!Mp,chrome_version:Mp?+Mp[1]:0,ios:Dp,android:/Android\b/.test(yp.userAgent),webkit:Cp,safari:Tp,webkit_version:Cp?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=bp.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Ep extends pp{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Ep&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Ep(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new up(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Pp(this.dom,t,e)}}class Bp extends pp{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(dp(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof Bp&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(vp(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Bp(this.mark,e,r)}domAtPos(t){return Qp(this.dom,this.children,t)}coordsAt(t,e){return zp(this,t,e)}}function Pp(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?Rp.chrome||Rp.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=ap(t,n,r).getClientRects();if(!h.length)return ip;let l=h[(o?o<0:i>=0)?0:h.length-1];return Rp.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?sp(l,o<0):l||null}class Lp extends pp{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Lp)(t,e,i)}split(t){let e=Lp.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Lp&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Lp&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?up.before(this.dom):up.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return ip;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:sp(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Vp extends Lp{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Wp(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new up(i,Math.min(t,i.nodeValue.length)))):new up(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Np(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?Wp(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Pp(s,t,e))):Pp(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function Wp(t,e,i,s,n,r){if(i instanceof Bp){for(let o of i.children){let i=Uf(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?Wp(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Np(t,e,i,s){if(i instanceof Bp)for(let n of i.children){let i=0,r=Uf(n.dom,s);if(Uf(n.dom,t))return i+(r?Np(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class Hp extends pp{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Hp&&t.side==this.side}split(){return new Hp(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return up.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof Ep){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof Bp&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function Qp(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return up.after(i)}return new up(t,0)}function Ip(t,e,i){let s,{children:n}=t;i>0&&e instanceof Bp&&n.length&&(s=n[n.length-1])instanceof Bp&&s.mark.eq(e.mark)?Ip(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function zp(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?sp(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=Yf(s);return n[n.length-1]||null}function Fp(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function $p(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function qp(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}Ep.prototype.children=Lp.prototype.children=Hp.prototype.children=fp;class _p{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Gp=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Gp||(Gp={}));class Xp extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new jp(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Zp(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=Yp(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Zp(t,e,i,s,t.widget||null,!0)}static line(t){return new Up(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Xp.none=ee.empty;class jp extends Xp{constructor(t){let{start:e,end:i}=Yp(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof jp&&this.tagName==t.tagName&&this.class==t.class&&$p(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}jp.prototype.point=!1;class Up extends Xp{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Up&&$p(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Up.prototype.mapMode=z.TrackBefore,Up.prototype.point=!0;class Zp extends Xp{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?Gp.WidgetRange:this.startSide<=0?Gp.WidgetBefore:Gp.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Zp&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Yp(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function Kp(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}Zp.prototype.point=!0;class Jp extends pp{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof Jp))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),vp(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new Jp;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){$p(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Ip(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Fp(e,this.attrs||{})),i&&(this.attrs=Fp({class:i},this.attrs||{}))}domAtPos(t){return Qp(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(dp(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(qp(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&pp.get(i)instanceof Bp;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=pp.get(i))||void 0===e?void 0:e.isEditable)||Rp.ios&&this.children.some((t=>t instanceof Ep))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Ep))return null;let i=Yf(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return zp(this,t,e)}become(t){return!1}get type(){return Gp.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof Jp)return n;if(r>e)break}s=r+n.breakAfter}return null}}class tg extends pp{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof tg&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?up.before(this.dom):up.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new tg(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return fp}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof tg&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class eg{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof tg&&t.type==Gp.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Jp),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(ig(new Hp(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(ig(new Ep(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof Zp)if(i.block){let{type:t}=i;t!=Gp.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new tg(i.widget||new sg("div"),r,t))}else{let o=Lp.create(i.widget||new sg("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(ig(new Hp(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(ig(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof Zp){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new eg(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function ig(t,e){for(let i of e)t=new Bp(i,[t],t.length);return t}class sg extends _p{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const ng=[],rg=et.define(),og=et.define(),hg=et.define(),lg=et.define(),ag=et.define(),cg=et.define(),dg=Et.define({map:(t,e)=>t.map(e)}),ug=Et.define({map:(t,e)=>t.map(e)});class fg{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new fg(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const pg=Et.define({map:(t,e)=>t.map(e)});function gg(t,e,i){let s=t.facet(lg);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const mg=et.define({combine:t=>!t.length||t[0]});class wg{constructor(t,e){this.field=t,this.get=e}}class vg{from(t){return new wg(this,t)}static define(){return new vg}}vg.decorations=vg.define(),vg.atomicRanges=vg.define(),vg.scrollMargins=vg.define();let yg=0;const bg=et.define();class Og{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=bg.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(Sg.from((t=>({plugin:t,handlers:i})))),n&&r.push(vg.decorations.from(n)),new Og(yg++,t,r)}static fromClass(t,e){return Og.define((e=>new t(e)),e)}}const Sg=vg.define();class xg{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(gg(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){gg(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){gg(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const kg=et.define(),Ag=et.define(),Mg=et.define(),Cg=et.define();class Tg{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Tg(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new Tg(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new Tg(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class Dg{constructor(t,e,i=ng){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Tg(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Rg=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Rg||(Rg={}));const Eg=Rg.LTR,Bg=Rg.RTL;function Pg(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Lg=Pg("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Vg=Pg("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Wg=Object.create(null),Ng=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Wg[e]=i,Wg[i]=-e}const Hg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Qg{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Bg:Eg}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Ig=[];function zg(t,e){let i=t.length,s=e==Eg?1:2,n=e==Eg?2:1;if(!t||1==s&&!Hg.test(t))return Fg(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Lg[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Vg[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Ig[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Ig[t];if(128==s)t<i-1&&e==Ig[t+1]&&24&e?s=Ig[t]=e:Ig[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Ig[s];)s++;let r=t&&8==e||s<i&&8==Ig[s]?1==n?1:8:256;for(let e=t;e<s;e++)Ig[e]=r;t=s-1}else 8==s&&1==n&&(Ig[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Wg[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Ng[t+1]==-r){let e=Ng[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Ig[h]=Ig[Ng[t]]=i),l=t;break}}else{if(189==Ng.length)break;Ng[l++]=h,Ng[l++]=e,Ng[l++]=a}else if(2==(o=Ig[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Ng[e+2];if(2&i)break;if(t)Ng[e+2]|=2;else{if(4&i)break;Ng[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Ig[t]){let e=t+1;for(;e<i&&256==Ig[e];)e++;let n=1==(t?Ig[t-1]:s),r=n==(1==(e<i?Ig[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Ig[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Ig[t++];for(;t<i&&s==(1!=Ig[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Ig[--i];for(;i>e&&s==(2!=Ig[i-1]);)i--;o.push(new Qg(i,t,s?2:1))}else o.push(new Qg(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Ig[t++];for(;t<i&&s==(2==Ig[t]);)t++;o.push(new Qg(e,t,s?1:2))}return o}function Fg(t){return[new Qg(0,t,0)]}let $g="";function qg(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=Qg.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if($g=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class _g{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=pp.get(s),r=pp.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Gg(s))||Gg(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=pp.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Gg(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Xg{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class jg extends pp{constructor(t){super(),this.view=t,this.compositionDeco=Xp.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Jp],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Tg(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Xp.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Zg(t);if(!i)return Xp.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new _g([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return Xp.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return Xp.none;let d=pp.get(r);d instanceof Vp?d=d.widget.topView:d&&(d.parent=null);return Xp.set(Xp.replace({widget:new Yg(r,o,d)}).range(h,l))}(this.view,t.changes)),(Rp.ie||Rp.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new Jg;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Tg.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=Rp.chrome||Rp.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof tg&&t.widget instanceof Ug&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=eg.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);wp(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||Rp.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(Rp.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new up(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&Kf(n.node,n.offset,h.anchorNode,h.anchorOffset)&&Kf(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{Rp.android&&Rp.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=jf(this.root);if(s.empty){if(Rp.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=Kg(n.node,n.offset,1==t?1:-1);e&&(n=new up(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new up(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new up(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=jf(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Jp.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(mg)?this.root.activeElement==this.dom:Zf(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=pp.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Jp)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=Gp.WidgetBefore&&n.type!=Gp.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==Gp.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?Yf(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==Rg.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Jp){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=Yf(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new mp(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Xp.replace({widget:new Ug(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return Xp.set(t)}updateDeco(){let t=this.view.pluginField(vg.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Mg),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(vg.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=np(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Rg.LTR)}}class Ug extends _p{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Zg(t){let e=t.observer.selectionRange,i=e.focusNode&&Kg(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof Jp){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!pp.get(e);)e=e.previousSibling;let n=e?pp.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof Jp)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class Yg extends _p{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Vp}}function Kg(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=ep(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Jg{constructor(){this.changes=[]}compareRange(t,e){Kp(t,e,this.changes)}comparePoint(t,e){Kp(t,e,this.changes)}}function tm(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function em(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function im(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function sm(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function nm(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function rm(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Yf(d);for(let u=0;u<t.length;u++){let f=t[u];n&&im(n,f)&&(f=sm(nm(f,n.bottom),n.top));let p=tm(e,f),g=em(i,f);if(0==p&&0==g)return 3==d.nodeType?om(d,e,i):rm(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&im(a,f)?a=nm(a,f.bottom):c&&im(c,f)&&(c=sm(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?om(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:rm(s,d,i)}function om(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=ap(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(Rp.chrome||Rp.gecko){ap(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function hm(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Gp.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:lm(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:lm(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),Rp.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return ap(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=Jp.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=rm(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function lm(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function am(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=qg(n,r,t.textDirection,o,i),l=$g;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function cm(t,e,i){let s=t.pluginField(vg.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class dm{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in mm){let i=mm[e];t.contentDOM.addEventListener(e,(s=>{gm(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),Rp.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Sg);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{gm(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){gg(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){gg(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(Rp.android&&Rp.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!Rp.ios||!(i=um.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,cp(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(Rp.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!Rp.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const um=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],fm=[16,17,18,20,91,92,224,225];class pm{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(rg);return i.length?i[0](e):Rp.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(og);return i.length?i[0](e):Rp.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=jf(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Dm(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function gm(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=pp.get(s))&&i.ignoreEvent(e))return!1;return!0}const mm=Object.create(null),wm=Rp.ie&&Rp.ie_version<15||Rp.ios&&Rp.webkit_version<604;function vm(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=Em&&s.selection.ranges.every((t=>t.empty))&&Em==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}mm.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():fm.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let ym=0;function bm(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=Jp.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}mm.touchstart=(t,e)=>{ym=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},mm.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},mm.mousedown=(t,e)=>{if(t.observer.flush(),ym>Date.now()-2e3&&1==Dm(e))return;let i=null;for(let s of t.state.facet(hg))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=km(t,e),s=Dm(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=km(t,e),o=e),!a||!i)return n;let c=bm(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=bm(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>lp(t.contentDOM))),t.inputState.startMouseSelection(new pm(t,e,i,s))}};let Om=(t,e)=>t>=e.top&&t<=e.bottom,Sm=(t,e,i)=>Om(e,i)&&t>=i.left&&t<=i.right;function xm(t,e,i,s){let n=Jp.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Sm(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&Sm(i,s,h)?1:o&&Om(s,o)?-1:1}function km(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:xm(t,i,e.clientX,e.clientY)}}const Am=Rp.ie&&Rp.ie_version<=11;let Mm=null,Cm=0,Tm=0;function Dm(t){if(!Am)return t.detail;let e=Mm,i=Tm;return Mm=t,Tm=Date.now(),Cm=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Cm+1)%3:1}function Rm(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}mm.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},mm.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&Rm(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else Rm(t,e,e.dataTransfer.getData("Text"),!0)},mm.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=wm?null:e.clipboardData;i?(vm(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),vm(t,i.value)}),50)}(t)};let Em=null;function Bm(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}mm.copy=mm.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;Em=n?i:null;let r=wm?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},mm.focus=mm.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},mm.compositionstart=mm.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Bm(t,!0)))},mm.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&Bm(t,!1)}),50)},mm.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},mm.beforeinput=(t,e)=>{var i;let s;if(Rp.chrome&&Rp.android&&(s=um.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const Pm=["pre-wrap","normal","pre-line","break-spaces"];class Lm{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=Rg.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return Pm.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=Pm.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class Vm{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Wm{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Wm(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Wm(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var Nm=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Nm||(Nm={}));class Hm{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Hm.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,Nm.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,Nm.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Nm.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=qm.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new Im(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Fm(Hm.of(t.slice(0,e)),r,Hm.of(t.slice(i)))}}Hm.prototype.size=1;class Qm extends Hm{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new Wm(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Im extends Qm{constructor(t,e){super(t,e,Gp.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof Im||s instanceof zm&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof zm?s=new Im(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Hm.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class zm extends Hm{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new Wm(l,a,i+o*h,o,Gp.Text)}lineAt(t,e,i,s,n){if(e==Nm.ByHeight)return this.blockAt(t,i,s,n);if(e==Nm.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new Wm(e,s-e,0,0,Gp.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new Wm(h,l,s+o*(a-r),o,Gp.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new Wm(e.from,e.length,s,h,Gp.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof zm?i[i.length-1]=new zm(t.length+s):i.push(null,new zm(s-1))}if(t>0){let e=i[0];e instanceof zm?i[0]=new zm(t+e.length):i.unshift(new zm(t-1),null)}return Hm.of(i)}decomposeLeft(t,e){e.push(new zm(t-1),null)}decomposeRight(t,e){e.push(null,new zm(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new zm(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new Im(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new zm(n-r).updateHeight(t,r));let l=Hm.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Fm extends Hm{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==Nm.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==Nm.ByPosNoHeight?Nm.ByPosNoHeight:Nm.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,Nm.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&$m(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),$m(n,t)}return Hm.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Hm.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function $m(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof zm&&(s=t[e+1])instanceof zm&&t.splice(e-1,3,new zm(i.length+1+s.length))}class qm{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Im?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Im(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new Qm(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Im(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new zm(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Im)return t;let e=new Im(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Gp.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Gp.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Im||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Im(0,-1));let i=t;for(let t of this.nodes)t instanceof Im&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new qm(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class _m{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&Kp(t,e,this.changes,5)}}function Gm(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function Xm(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class jm{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return Xp.replace({widget:new Um(this.size,t)}).range(this.from,this.to)}}class Um extends _p{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Zm{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Lm,this.scaler=sw,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Hm.empty().applyChanges(t.facet(Mg),E.empty,this.heightOracle.setDoc(t.doc),[new Tg(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Xp.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new Ym(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?sw:new nw(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:rw(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(Mg),n=t.changedRanges,r=Tg.extendWithRanges(n,function(t,e,i){let s=new _m;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(Mg),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?Rg.RTL:Rg.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?Xm:Gm)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new Vm(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new Ym(s.lineAt(r-1e3*i,Nm.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Nm.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,Nm.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new Ym(s.lineAt(i-500,Nm.ByHeight,n,0,0).from,s.lineAt(i+r+500,Nm.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new Ym(this.heightMap.lineAt(i,Nm.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Nm.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Nm.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,Nm.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new jm(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=Rg.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=Km(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Jm(r,(this.visibleTop-i.top-t)/i.height),n=Jm(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=Jm(r,(this.pixelViewport.left-e)/t),n=Jm(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&ew(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&ew(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(iw(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new jm(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=tw(s,i)-tw(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){jm.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Xp.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Mg);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||rw(this.heightMap.lineAt(t,Nm.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return rw(this.heightMap.lineAt(this.scaler.fromDOM(t),Nm.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return rw(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Ym{constructor(t,e){this.from=t,this.to=e}}function Km(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(Mg),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function Jm({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function tw(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function ew(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function iw(t,e){for(let i of t)if(e(i))return i}const sw={toDOM:t=>t,fromDOM:t=>t,scale:1};class nw{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,Nm.ByPos,t,0,0).top,o=e.lineAt(n,Nm.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function rw(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new Wm(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>rw(t,e))):t.type)}const ow=et.define({combine:t=>t.join(" ")}),hw=et.define({combine:t=>t.indexOf(!0)>-1}),lw=jt.newName(),aw=jt.newName(),cw=jt.newName(),dw={"&light":"."+aw,"&dark":"."+cw};function uw(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const fw=uw("."+lw,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},dw),pw={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},gw=Rp.ie&&Rp.ie_version<=11;class mw{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new rp,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(Rp.ie&&Rp.ie_version<=11||Rp.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),gw&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(mg)?e.root.activeElement!=this.dom:!Zf(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((Rp.ie&&Rp.ie_version<=11||Rp.android&&Rp.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Kf(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=jf(t),i=Rp.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);Kf(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,pw),gw&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),gw&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;cp(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&Zf(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=ww(e,t.previousSibling||t.target.previousSibling,-1),s=ww(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function ww(t,e,i){for(;e;){let s=pp.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function vw(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Xg(i,s)),n==i&&r==s||e.push(new Xg(n,r)));return e}(t),c=new _g(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||Rp.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(Rp.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(mg)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Uf(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!Uf(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(Rp.ios&&t.inputState.flushIOSKey(t))return;if(Rp.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&cp(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&cp(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&cp(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(cg).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=Zg(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class yw{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Zm(t.state||$t.create()),this.plugins=this.state.facet(bg).map((t=>new xg(t)));for(let t of this.plugins)t.update(this);this.observer=new mw(this,((t,e,i)=>{vw(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new dm(this),this.docView=new jg(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new Dg(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new fg(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(dg)?n=new fg(t.value):t.is(ug)?n=new fg(t.value,"center"):t.is(pg)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=xw.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Cg)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(ow)!=e.state.facet(ow)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(ag))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Zm(t),this.plugins=t.facet(bg).map((t=>new xg(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new jg(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(bg),i=t.state.facet(bg);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new xg(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return gg(this.state,t),Sw}})),o=new Dg(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=Sw)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){gg(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(ag))t(e)}get themeClasses(){return lw+" "+(this.state.facet(hw)?cw:aw)+" "+this.state.facet(ow)}updateAttrs(){let t=kw(this,kg,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(mg)?"true":"false",class:"cm-content",style:`${Rp.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),kw(this,Ag,e),this.observer.ignore((()=>{qp(this.contentDOM,this.contentAttrs,e),qp(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(yw.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Cg),jt.mount(this.root,this.styleModules.concat(fw).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Ow(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Ow(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Ow(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return cm(this,t,am(this,t,e,i))}moveByGroup(t,e){return cm(this,t,am(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==Rg.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=Jp.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return cm(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=hm(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:dg.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),hm(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return sp(i,n[Qg.find(n,t-s.from,-1,e)].dir==Rg.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>bw)return Fg(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=zg(t.text,this.textDirection);return this.bidiCache.push(new xw(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||Rp.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{lp(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return pg.of(new fg("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Og.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[ow.of(i),Cg.of(uw(`.${i}`,t))];return e&&e.dark&&s.push(hw.of(!0)),s}static baseTheme(t){return pt.lowest(Cg.of(uw("."+lw,t,dw)))}}yw.scrollTo=dg,yw.centerOn=ug,yw.styleModule=Cg,yw.inputHandler=cg,yw.exceptionSink=lg,yw.updateListener=ag,yw.editable=mg,yw.mouseSelectionStyle=hg,yw.dragMovesSelection=og,yw.clickAddsSelectionRange=rg,yw.decorations=Mg,yw.darkTheme=hw,yw.contentAttributes=Ag,yw.editorAttributes=kg,yw.lineWrapping=yw.contentAttributes.of({class:"cm-lineWrapping"}),yw.announce=Et.define();const bw=4096;function Ow(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Sw={};class xw{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:Rg.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new xw(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function kw(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&Fp(r,i)}return i}const Aw=!Rp.ios;const Mw={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Aw&&(Mw[".cm-line"].caretColor="transparent !important");var Cw;const Tw=new kf;class Dw{constructor(t,e,i,s=[]){this.data=t,this.topNode=i,$t.prototype.hasOwnProperty("tree")||Object.defineProperty($t.prototype,"tree",{get(){return Bw(this)}}),this.parser=e,this.extension=[zw.of(this),$t.languageData.of(((t,e,i)=>t.facet(Rw(t,e,i))))].concat(s)}isActiveAt(t,e,i=-1){return Rw(t,e,i)==this.data}findRegions(t){let e=t.facet(zw);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(t,e)=>{if(t.prop(Tw)==this.data)return void i.push({from:e,to:e+t.length});let n=t.prop(kf.mounted);if(n){if(n.tree.prop(Tw)==this.data){if(n.overlay)for(let t of n.overlay)i.push({from:t.from+e,to:t.to+e});else i.push({from:e,to:e+t.length});return}if(n.overlay){let t=i.length;if(s(n.tree,n.overlay[0].from+e),i.length>t)return}}for(let i=0;i<t.children.length;i++){let n=t.children[i];n instanceof Rf&&s(n,t.positions[i]+e)}};return s(Bw(t),0),i}get allowsNesting(){return!0}}function Rw(t,e,i){let s=t.facet(zw);if(!s)return null;let n=s.data;if(s.allowsNesting)for(let s=Bw(t).topNode;s;s=s.enter(e,i,!0,!1))n=s.type.prop(Tw)||n;return n}Dw.setState=Et.define();class Ew extends Dw{constructor(t,e){super(t,e,e.topNode),this.parser=e}static define(t){let e=(i=t.languageData,et.define({combine:i?t=>t.concat(i):void 0}));var i;return new Ew(e,t.parser.configure({props:[Tw.add((t=>t.isTop?e:void 0))]}))}configure(t){return new Ew(this.data,this.parser.configure(t))}get allowsNesting(){return this.parser.wrappers.length>0}}function Bw(t){let e=t.field(Dw.state,!1);return e?e.tree:Rf.empty}class Pw{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Lw=null;class Vw{constructor(t,e,i=[],s,n,r,o,h){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=r,this.skipped=o,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new Pw(this.state.doc),this.fragments)}work(t,e){return null!=e&&e>=this.state.doc.length&&(e=void 0),this.tree!=Rf.empty&&this.isDone(null!=e?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof t){let e=Date.now()+t;t=()=>Date.now()>e}for(this.parse||(this.parse=this.startParse()),null!=e&&(null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(_f.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=e?e:this.state.doc.length)))return!0;this.parse=this.startParse()}if(t())return!1}}))}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext((()=>{for(;!(e=this.parse.advance()););})),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(_f.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Lw;Lw=this;try{return t()}finally{Lw=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Ww(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:r,skipped:o}=this;if(this.takeTree(),!t.empty){let e=[];if(t.iterChangedRanges(((t,i,s,n)=>e.push({fromA:t,toA:i,fromB:s,toB:n}))),i=_f.applyChanges(i,e),s=Rf.empty,n=0,r={from:t.mapPos(r.from,-1),to:t.mapPos(r.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),s=t.mapPos(e.to,-1);i<s&&o.push({from:i,to:s})}}}return new Vw(this.parser,e,i,s,n,r,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:i,to:s}=this.skipped[e];i<t.to&&s>t.from&&(this.fragments=Ww(this.fragments,i,s),this.skipped.splice(e--,1))}return!(this.skipped.length>=e)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends Gf{createParse(e,i,s){let n=s[0].from,r=s[s.length-1].to;return{parsedPos:n,advance(){let e=Lw;if(e){for(let t of s)e.tempSkipped.push(t);t&&(e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t)}return this.parsedPos=r,new Rf(Mf.none,[],[],r-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return Lw}}function Ww(t,e,i){return _f.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class Nw{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new Nw(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=new Vw(t.facet(zw).parser,t,[],Rf.empty,0,{from:0,to:e},[],null);return i.work(20,e)||i.takeTree(),new Nw(i)}}Dw.state=ht.define({create:Nw.init,update(t,e){for(let t of e.effects)if(t.is(Dw.setState))return t.value;return e.startState.facet(zw)!=e.state.facet(zw)?Nw.init(e.state):t.apply(e)}});let Hw=t=>{let e=setTimeout((()=>t()),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(Hw=t=>{let e=-1,i=setTimeout((()=>{e=requestIdleCallback(t,{timeout:400})}),100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const Qw="undefined"!=typeof navigator&&(null===(Cw=navigator.scheduling)||void 0===Cw?void 0:Cw.isInputPending)?()=>navigator.scheduling.isInputPending():null,Iw=Og.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(Dw.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(Dw.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=Hw(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(Dw.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,t&&!Qw?Math.max(25,t.timeRemaining()-5):1e9),o=n.context.treeLen<s&&i.doc.length>s+1e3,h=n.context.work((()=>Qw&&Qw()||Date.now()>r),s+(o?0:1e5));this.chunkBudget-=Date.now()-e,(h||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:Dw.setState.of(new Nw(n.context))})),this.chunkBudget>0&&(!h||o)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then((()=>this.scheduleWork())).catch((t=>gg(this.view.state,t))).then((()=>this.workScheduled--)),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),zw=et.define({combine:t=>t.length?t[0]:null,enables:[Dw.state,Iw]});class Fw{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}const $w=et.define(),qw=et.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function _w(t){let e=t.facet(qw);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function Gw(t,e){let i="",s=t.tabSize;if(9==t.facet(qw).charCodeAt(0))for(;e>=s;)i+="\t",e-=s;for(let t=0;t<e;t++)i+=" ";return i}function Xw(t,e){t instanceof $t&&(t=new jw(t));for(let i of t.state.facet($w)){let s=i(t,e);if(null!=s)return s}let i=Bw(t.state);return i?function(t,e,i){return Yw(e.resolveInner(i).enterUnfinishedNodesBefore(i),i,t)}(t,i,e):null}class jw{constructor(t,e={}){this.state=t,this.options=e,this.unit=_w(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:s,simulateDoubleBreak:n}=this.options;return null!=s&&s>=i.from&&s<=i.to?n&&s==t?{text:"",from:t}:(e<0?s<t:s<=t)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(t,e);return i.slice(t-s,Math.min(i.length,t+100-s))}column(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.countColumn(i,t-s),r=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return r>-1&&(n+=r-this.countColumn(i,i.search(/\S|$/))),n}countColumn(t,e=t.length){return D(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.options.overrideIndentation;if(n){let t=n(s);if(t>-1)return t}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Uw=new kf;function Zw(t){let e=t.type.prop(Uw);if(e)return e;let i,s=t.firstChild;if(s&&(i=s.type.prop(kf.closedBy))){let e=t.lastChild,s=e&&i.indexOf(e.name)>-1;return t=>iv(t,!0,1,void 0,s&&!function(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}(t)?e.from:void 0)}return null==t.parent?Kw:null}function Yw(t,e,i){for(;t;t=t.parent){let s=Zw(t);if(s)return s(new Jw(i,e,t))}return null}function Kw(){return 0}class Jw extends jw{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let t=this.state.doc.lineAt(this.node.from);for(;;){let e=this.node.resolve(t.from);for(;e.parent&&e.parent.from==e.from;)e=e.parent;if(tv(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)}continue(){let t=this.node.parent;return t?Yw(t,this.pos,this.base):0}}function tv(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function ev({closing:t,align:e=!0,units:i=1}){return s=>iv(s,e,i,t)}function iv(t,e,i,s,n){let r=t.textAfter,o=r.match(/^\s*/)[0].length,h=s&&r.slice(o,o+s.length)==s||n==t.pos+o,l=e?function(t){let e=t.node,i=e.childAfter(e.from),s=e.lastChild;if(!i)return null;let n=t.options.simulateBreak,r=t.state.doc.lineAt(i.from),o=null==n||n<=r.from?r.to:Math.min(r.to,n);for(let t=i.to;;){let n=e.childAfter(t);if(!n||n==s)return null;if(!n.type.isSkipped)return n.from<o?i:null;t=n.to}}(t):null;return l?h?t.column(l.from):t.column(l.to):t.baseIndent+(h?0:t.unit*i)}function sv({except:t,units:e=1}={}){return i=>{let s=t&&t.test(i.textAfter);return i.baseIndent+(s?0:e*i.unit)}}function nv(){return $t.transactionFilter.of((t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:s}=t.newSelection.main,n=i.lineAt(s);if(s>n.from+200)return t;let r=i.sliceString(n.from,s);if(!e.some((t=>t.test(r))))return t;let{state:o}=t,h=-1,l=[];for(let{head:t}of o.selection.ranges){let e=o.doc.lineAt(t);if(e.from==h)continue;h=e.from;let i=Xw(o,e.from);if(null==i)continue;let s=/^\s*/.exec(e.text)[0],n=Gw(o,i);s!=n&&l.push({from:e.from,to:e.from+s.length,insert:n})}return l.length?[t,{changes:l,sequential:!0}]:t}))}const rv=et.define(),ov=new kf;function hv(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function lv(t,e,i){for(let s of t.facet(rv)){let n=s(t,e,i);if(n)return n}return function(t,e,i){let s=Bw(t);if(0==s.length)return null;let n=null;for(let r=s.resolveInner(i);r;r=r.parent){if(r.to<=i||r.from>i)continue;if(n&&r.from<e)break;let o=r.type.prop(ov);if(o&&(r.to<s.length-50||s.length==t.doc.length||!hv(r))){let s=o(r,t);s&&s.from<=i&&s.from>=e&&s.to>i&&(n=s)}}return n}(t,e,i)}function av(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function cv(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function dv(t,e){if(!e.anchorNode)return!1;try{return cv(t,e.anchorNode)}catch(t){return!1}}function uv(t){return 3==t.nodeType?kv(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function fv(t,e,i,s){return!!i&&(gv(t,e,i,s,-1)||gv(t,e,i,s,1))}function pv(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function gv(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:mv(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=pv(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?mv(t):0}}}function mv(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const wv={left:0,right:0,top:0,bottom:0};function vv(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function yv(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class bv{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Ov,Sv=null;function xv(t){if(t.setActive)return t.setActive();if(Sv)return t.focus(Sv);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Sv?{get preventScroll(){return Sv={preventScroll:!0},!0}}:void 0),!Sv){Sv=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function kv(t,e,i=e){let s=Ov||(Ov=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function Av(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function Mv(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Cv{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Cv(t.parentNode,pv(t),e)}static after(t,e){return new Cv(t.parentNode,pv(t)+1,e)}}const Tv=[];class Dv{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=Dv.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=Rv(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=Rv(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==mv(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Dv.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Tv){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Ev(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Rv(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Dv.prototype.breakAfter=0;class Ev{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Bv(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function Pv(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,Bv(t,a,c,h,l,s,0,n,r)}let Lv="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Vv="undefined"!=typeof document?document:{documentElement:{style:{}}};const Wv=/Edge\/(\d+)/.exec(Lv.userAgent),Nv=/MSIE \d/.test(Lv.userAgent),Hv=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Lv.userAgent),Qv=!!(Nv||Hv||Wv),Iv=!Qv&&/gecko\/(\d+)/i.test(Lv.userAgent),zv=!Qv&&/Chrome\/(\d+)/.exec(Lv.userAgent),Fv="webkitFontSmoothing"in Vv.documentElement.style,$v=!Qv&&/Apple Computer/.test(Lv.vendor),qv=$v&&(/Mobile\/\w+/.test(Lv.userAgent)||Lv.maxTouchPoints>2);var _v={mac:qv||/Mac/.test(Lv.platform),windows:/Win/.test(Lv.platform),linux:/Linux|X11/.test(Lv.platform),ie:Qv,ie_version:Nv?Vv.documentMode||6:Hv?+Hv[1]:Wv?+Wv[1]:0,gecko:Iv,gecko_version:Iv?+(/Firefox\/(\d+)/.exec(Lv.userAgent)||[0,0])[1]:0,chrome:!!zv,chrome_version:zv?+zv[1]:0,ios:qv,android:/Android\b/.test(Lv.userAgent),webkit:Fv,safari:$v,webkit_version:Fv?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Vv.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Gv extends Dv{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Gv&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Gv(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Cv(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return jv(this.dom,t,e)}}class Xv extends Dv{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Mv(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof Xv&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(Pv(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Xv(this.mark,e,r)}domAtPos(t){return ty(this.dom,this.children,t)}coordsAt(t,e){return iy(this,t,e)}}function jv(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?_v.chrome||_v.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=kv(t,n,r).getClientRects();if(!h.length)return wv;let l=h[(o?o<0:i>=0)?0:h.length-1];return _v.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?vv(l,o<0):l||null}class Uv extends Dv{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Uv)(t,e,i)}split(t){let e=Uv.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Uv&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Uv&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?Cv.before(this.dom):Cv.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return wv;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:vv(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Zv extends Uv{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Yv(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Cv(i,Math.min(t,i.nodeValue.length)))):new Cv(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Kv(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?Yv(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>jv(s,t,e))):jv(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function Yv(t,e,i,s,n,r){if(i instanceof Xv){for(let o of i.children){let i=cv(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?Yv(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Kv(t,e,i,s){if(i instanceof Xv)for(let n of i.children){let i=0,r=cv(n.dom,s);if(cv(n.dom,t))return i+(r?Kv(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class Jv extends Dv{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Jv&&t.side==this.side}split(){return new Jv(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Cv.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof Gv){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof Xv&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function ty(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return Cv.after(i)}return new Cv(t,0)}function ey(t,e,i){let s,{children:n}=t;i>0&&e instanceof Xv&&n.length&&(s=n[n.length-1])instanceof Xv&&s.mark.eq(e.mark)?ey(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function iy(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?vv(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=uv(s);return n[n.length-1]||null}function sy(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function ny(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function ry(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}Gv.prototype.children=Uv.prototype.children=Jv.prototype.children=Tv;class oy{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var hy=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(hy||(hy={}));class ly extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new ay(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new dy(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=uy(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new dy(t,e,i,s,t.widget||null,!0)}static line(t){return new cy(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}ly.none=ee.empty;class ay extends ly{constructor(t){let{start:e,end:i}=uy(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof ay&&this.tagName==t.tagName&&this.class==t.class&&ny(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}ay.prototype.point=!1;class cy extends ly{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof cy&&ny(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}cy.prototype.mapMode=z.TrackBefore,cy.prototype.point=!0;class dy extends ly{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?hy.WidgetRange:this.startSide<=0?hy.WidgetBefore:hy.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof dy&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function uy(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function fy(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}dy.prototype.point=!0;class py extends Dv{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof py))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Pv(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new py;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){ny(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){ey(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=sy(e,this.attrs||{})),i&&(this.attrs=sy({class:i},this.attrs||{}))}domAtPos(t){return ty(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Mv(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ry(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Dv.get(i)instanceof Xv;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=Dv.get(i))||void 0===e?void 0:e.isEditable)||_v.ios&&this.children.some((t=>t instanceof Gv))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Gv))return null;let i=uv(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return iy(this,t,e)}become(t){return!1}get type(){return hy.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof py)return n;if(r>e)break}s=r+n.breakAfter}return null}}class gy extends Dv{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof gy&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Cv.before(this.dom):Cv.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new gy(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Tv}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof gy&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class my{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof gy&&t.type==hy.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new py),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(wy(new Jv(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(wy(new Gv(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof dy)if(i.block){let{type:t}=i;t!=hy.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new gy(i.widget||new vy("div"),r,t))}else{let o=Uv.create(i.widget||new vy("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(wy(new Jv(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(wy(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof dy){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new my(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function wy(t,e){for(let i of e)t=new Xv(i,[t],t.length);return t}class vy extends oy{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const yy=[],by=et.define(),Oy=et.define(),Sy=et.define(),xy=et.define(),ky=et.define(),Ay=et.define(),My=Et.define({map:(t,e)=>t.map(e)}),Cy=Et.define({map:(t,e)=>t.map(e)});class Ty{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new Ty(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Dy=Et.define({map:(t,e)=>t.map(e)});function Ry(t,e,i){let s=t.facet(xy);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Ey=et.define({combine:t=>!t.length||t[0]});class By{constructor(t,e){this.field=t,this.get=e}}class Py{from(t){return new By(this,t)}static define(){return new Py}}Py.decorations=Py.define(),Py.atomicRanges=Py.define(),Py.scrollMargins=Py.define();let Ly=0;const Vy=et.define();class Wy{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Vy.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(Ny.from((t=>({plugin:t,handlers:i})))),n&&r.push(Py.decorations.from(n)),new Wy(Ly++,t,r)}static fromClass(t,e){return Wy.define((e=>new t(e)),e)}}const Ny=Py.define();class Hy{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Ry(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Ry(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Ry(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Qy=et.define(),Iy=et.define(),zy=et.define(),Fy=et.define();class $y{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new $y(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new $y(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new $y(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class qy{constructor(t,e,i=yy){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new $y(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var _y=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(_y||(_y={}));const Gy=_y.LTR,Xy=_y.RTL;function jy(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Uy=jy("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Zy=jy("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Yy=Object.create(null),Ky=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Yy[e]=i,Yy[i]=-e}const Jy=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class tb{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Xy:Gy}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const eb=[];function ib(t,e){let i=t.length,s=e==Gy?1:2,n=e==Gy?2:1;if(!t||1==s&&!Jy.test(t))return sb(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Uy[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Zy[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),eb[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=eb[t];if(128==s)t<i-1&&e==eb[t+1]&&24&e?s=eb[t]=e:eb[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==eb[s];)s++;let r=t&&8==e||s<i&&8==eb[s]?1==n?1:8:256;for(let e=t;e<s;e++)eb[e]=r;t=s-1}else 8==s&&1==n&&(eb[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Yy[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Ky[t+1]==-r){let e=Ky[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(eb[h]=eb[Ky[t]]=i),l=t;break}}else{if(189==Ky.length)break;Ky[l++]=h,Ky[l++]=e,Ky[l++]=a}else if(2==(o=eb[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Ky[e+2];if(2&i)break;if(t)Ky[e+2]|=2;else{if(4&i)break;Ky[e+2]|=4}}}for(let t=0;t<i;t++)if(256==eb[t]){let e=t+1;for(;e<i&&256==eb[e];)e++;let n=1==(t?eb[t-1]:s),r=n==(1==(e<i?eb[e]:s))?n?1:2:s;for(let i=t;i<e;i++)eb[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=eb[t++];for(;t<i&&s==(1!=eb[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=eb[--i];for(;i>e&&s==(2!=eb[i-1]);)i--;o.push(new tb(i,t,s?2:1))}else o.push(new tb(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==eb[t++];for(;t<i&&s==(2==eb[t]);)t++;o.push(new tb(e,t,s?1:2))}return o}function sb(t){return[new tb(0,t,0)]}let nb="";function rb(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=tb.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(nb=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class ob{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=Dv.get(s),r=Dv.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:hb(s))||hb(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Dv.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function hb(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class lb{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class ab extends Dv{constructor(t){super(),this.view=t,this.compositionDeco=ly.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new py],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new $y(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ly.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=db(t);if(!i)return ly.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new ob([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return ly.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return ly.none;let d=Dv.get(r);d instanceof Zv?d=d.widget.topView:d&&(d.parent=null);return ly.set(ly.replace({widget:new ub(r,o,d)}).range(h,l))}(this.view,t.changes)),(_v.ie||_v.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new pb;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=$y.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=_v.chrome||_v.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof gy&&t.widget instanceof cb&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=my.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);Bv(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||_v.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(_v.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new Cv(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&fv(n.node,n.offset,h.anchorNode,h.anchorOffset)&&fv(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{_v.android&&_v.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=av(this.root);if(s.empty){if(_v.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=fb(n.node,n.offset,1==t?1:-1);e&&(n=new Cv(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new Cv(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new Cv(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=av(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=py.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ey)?this.root.activeElement==this.dom:dv(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Dv.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof py)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=hy.WidgetBefore&&n.type!=hy.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==hy.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?uv(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==_y.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof py){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=uv(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Ev(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(ly.replace({widget:new cb(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return ly.set(t)}updateDeco(){let t=this.view.pluginField(Py.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(zy),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(Py.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=yv(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==_y.LTR)}}class cb extends oy{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function db(t){let e=t.observer.selectionRange,i=e.focusNode&&fb(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof py){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Dv.get(e);)e=e.previousSibling;let n=e?Dv.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof py)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class ub extends oy{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Zv}}function fb(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=mv(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class pb{constructor(){this.changes=[]}compareRange(t,e){fy(t,e,this.changes)}comparePoint(t,e){fy(t,e,this.changes)}}function gb(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function mb(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function wb(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function vb(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function yb(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function bb(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=uv(d);for(let u=0;u<t.length;u++){let f=t[u];n&&wb(n,f)&&(f=vb(yb(f,n.bottom),n.top));let p=gb(e,f),g=mb(i,f);if(0==p&&0==g)return 3==d.nodeType?Ob(d,e,i):bb(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&wb(a,f)?a=yb(a,f.bottom):c&&wb(c,f)&&(c=vb(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Ob(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:bb(s,d,i)}function Ob(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=kv(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(_v.chrome||_v.gecko){kv(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function Sb(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=hy.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:xb(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:xb(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),_v.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return kv(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=py.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=bb(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function xb(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function kb(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=rb(n,r,t.textDirection,o,i),l=nb;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function Ab(t,e,i){let s=t.pluginField(Py.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class Mb{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Eb){let i=Eb[e];t.contentDOM.addEventListener(e,(s=>{Rb(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),_v.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Ny);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Rb(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Ry(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){Ry(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(_v.android&&_v.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!_v.ios||!(i=Cb.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Av(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(_v.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!_v.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Cb=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Tb=[16,17,18,20,91,92,224,225];class Db{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(by);return i.length?i[0](e):_v.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Oy);return i.length?i[0](e):_v.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=av(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=qb(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Rb(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=Dv.get(s))&&i.ignoreEvent(e))return!1;return!0}const Eb=Object.create(null),Bb=_v.ie&&_v.ie_version<15||_v.ios&&_v.webkit_version<604;function Pb(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=Gb&&s.selection.ranges.every((t=>t.empty))&&Gb==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Eb.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():Tb.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let Lb=0;function Vb(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=py.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}Eb.touchstart=(t,e)=>{Lb=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Eb.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Eb.mousedown=(t,e)=>{if(t.observer.flush(),Lb>Date.now()-2e3&&1==qb(e))return;let i=null;for(let s of t.state.facet(Sy))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Qb(t,e),s=qb(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Qb(t,e),o=e),!a||!i)return n;let c=Vb(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=Vb(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>xv(t.contentDOM))),t.inputState.startMouseSelection(new Db(t,e,i,s))}};let Wb=(t,e)=>t>=e.top&&t<=e.bottom,Nb=(t,e,i)=>Wb(e,i)&&t>=i.left&&t<=i.right;function Hb(t,e,i,s){let n=py.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Nb(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&Nb(i,s,h)?1:o&&Wb(s,o)?-1:1}function Qb(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Hb(t,i,e.clientX,e.clientY)}}const Ib=_v.ie&&_v.ie_version<=11;let zb=null,Fb=0,$b=0;function qb(t){if(!Ib)return t.detail;let e=zb,i=$b;return zb=t,$b=Date.now(),Fb=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Fb+1)%3:1}function _b(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}Eb.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Eb.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&_b(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else _b(t,e,e.dataTransfer.getData("Text"),!0)},Eb.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Bb?null:e.clipboardData;i?(Pb(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Pb(t,i.value)}),50)}(t)};let Gb=null;function Xb(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Eb.copy=Eb.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;Gb=n?i:null;let r=Bb?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},Eb.focus=Eb.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Eb.compositionstart=Eb.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Xb(t,!0)))},Eb.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&Xb(t,!1)}),50)},Eb.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Eb.beforeinput=(t,e)=>{var i;let s;if(_v.chrome&&_v.android&&(s=Cb.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const jb=["pre-wrap","normal","pre-line","break-spaces"];class Ub{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=_y.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return jb.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=jb.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class Zb{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Yb{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Yb(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Yb(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var Kb=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Kb||(Kb={}));class Jb{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Jb.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,Kb.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,Kb.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Kb.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=rO.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new eO(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new sO(Jb.of(t.slice(0,e)),r,Jb.of(t.slice(i)))}}Jb.prototype.size=1;class tO extends Jb{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new Yb(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class eO extends tO{constructor(t,e){super(t,e,hy.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof eO||s instanceof iO&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof iO?s=new eO(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Jb.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class iO extends Jb{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new Yb(l,a,i+o*h,o,hy.Text)}lineAt(t,e,i,s,n){if(e==Kb.ByHeight)return this.blockAt(t,i,s,n);if(e==Kb.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new Yb(e,s-e,0,0,hy.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new Yb(h,l,s+o*(a-r),o,hy.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new Yb(e.from,e.length,s,h,hy.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof iO?i[i.length-1]=new iO(t.length+s):i.push(null,new iO(s-1))}if(t>0){let e=i[0];e instanceof iO?i[0]=new iO(t+e.length):i.unshift(new iO(t-1),null)}return Jb.of(i)}decomposeLeft(t,e){e.push(new iO(t-1),null)}decomposeRight(t,e){e.push(null,new iO(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new iO(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new eO(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new iO(n-r).updateHeight(t,r));let l=Jb.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class sO extends Jb{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==Kb.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==Kb.ByPosNoHeight?Kb.ByPosNoHeight:Kb.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,Kb.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&nO(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),nO(n,t)}return Jb.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Jb.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function nO(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof iO&&(s=t[e+1])instanceof iO&&t.splice(e-1,3,new iO(i.length+1+s.length))}class rO{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof eO?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new eO(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new tO(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new eO(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new iO(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof eO)return t;let e=new eO(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=hy.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=hy.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof eO||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new eO(0,-1));let i=t;for(let t of this.nodes)t instanceof eO&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new rO(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class oO{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&fy(t,e,this.changes,5)}}function hO(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function lO(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class aO{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return ly.replace({widget:new cO(this.size,t)}).range(this.from,this.to)}}class cO extends oy{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class dO{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Ub,this.scaler=vO,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Jb.empty().applyChanges(t.facet(zy),E.empty,this.heightOracle.setDoc(t.doc),[new $y(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ly.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new uO(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?vO:new yO(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:bO(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(zy),n=t.changedRanges,r=$y.extendWithRanges(n,function(t,e,i){let s=new oO;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(zy),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?_y.RTL:_y.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?lO:hO)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new Zb(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new uO(s.lineAt(r-1e3*i,Kb.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Kb.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,Kb.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new uO(s.lineAt(i-500,Kb.ByHeight,n,0,0).from,s.lineAt(i+r+500,Kb.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new uO(this.heightMap.lineAt(i,Kb.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Kb.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Kb.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,Kb.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new aO(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=_y.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=fO(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=pO(r,(this.visibleTop-i.top-t)/i.height),n=pO(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=pO(r,(this.pixelViewport.left-e)/t),n=pO(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&mO(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&mO(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(wO(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new aO(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=gO(s,i)-gO(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){aO.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=ly.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(zy);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||bO(this.heightMap.lineAt(t,Kb.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return bO(this.heightMap.lineAt(this.scaler.fromDOM(t),Kb.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return bO(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class uO{constructor(t,e){this.from=t,this.to=e}}function fO(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(zy),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function pO({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function gO(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function mO(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function wO(t,e){for(let i of t)if(e(i))return i}const vO={toDOM:t=>t,fromDOM:t=>t,scale:1};class yO{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,Kb.ByPos,t,0,0).top,o=e.lineAt(n,Kb.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function bO(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new Yb(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>bO(t,e))):t.type)}const OO=et.define({combine:t=>t.join(" ")}),SO=et.define({combine:t=>t.indexOf(!0)>-1}),xO=jt.newName(),kO=jt.newName(),AO=jt.newName(),MO={"&light":"."+kO,"&dark":"."+AO};function CO(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const TO=CO("."+xO,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},MO),DO={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},RO=_v.ie&&_v.ie_version<=11;class EO{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new bv,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(_v.ie&&_v.ie_version<=11||_v.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),RO&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Ey)?e.root.activeElement!=this.dom:!dv(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((_v.ie&&_v.ie_version<=11||_v.android&&_v.chrome)&&!e.state.selection.main.empty&&i.focusNode&&fv(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=av(t),i=_v.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);fv(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,DO),RO&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),RO&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Av(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&dv(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=BO(e,t.previousSibling||t.target.previousSibling,-1),s=BO(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function BO(t,e,i){for(;e;){let s=Dv.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function PO(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new lb(i,s)),n==i&&r==s||e.push(new lb(n,r)));return e}(t),c=new ob(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||_v.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(_v.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(Ey)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!cv(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!cv(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(_v.ios&&t.inputState.flushIOSKey(t))return;if(_v.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&Av(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&Av(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&Av(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(Ay).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=db(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class LO{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new dO(t.state||$t.create()),this.plugins=this.state.facet(Vy).map((t=>new Hy(t)));for(let t of this.plugins)t.update(this);this.observer=new EO(this,((t,e,i)=>{PO(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Mb(this),this.docView=new ab(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new qy(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new Ty(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(My)?n=new Ty(t.value):t.is(Cy)?n=new Ty(t.value,"center"):t.is(Dy)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=HO.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Fy)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(OO)!=e.state.facet(OO)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(ky))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new dO(t),this.plugins=t.facet(Vy).map((t=>new Hy(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new ab(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Vy),i=t.state.facet(Vy);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new Hy(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return Ry(this.state,t),NO}})),o=new qy(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=NO)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){Ry(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(ky))t(e)}get themeClasses(){return xO+" "+(this.state.facet(SO)?AO:kO)+" "+this.state.facet(OO)}updateAttrs(){let t=QO(this,Qy,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ey)?"true":"false",class:"cm-content",style:`${_v.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),QO(this,Iy,e),this.observer.ignore((()=>{ry(this.contentDOM,this.contentAttrs,e),ry(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(LO.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Fy),jt.mount(this.root,this.styleModules.concat(TO).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=WO(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=WO(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=WO(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Ab(this,t,kb(this,t,e,i))}moveByGroup(t,e){return Ab(this,t,kb(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==_y.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=py.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return Ab(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=Sb(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:My.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Sb(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return vv(i,n[tb.find(n,t-s.from,-1,e)].dir==_y.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>VO)return sb(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=ib(t.text,this.textDirection);return this.bidiCache.push(new HO(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||_v.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{xv(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Dy.of(new Ty("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Wy.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[OO.of(i),Fy.of(CO(`.${i}`,t))];return e&&e.dark&&s.push(SO.of(!0)),s}static baseTheme(t){return pt.lowest(Fy.of(CO("."+xO,t,MO)))}}LO.scrollTo=My,LO.centerOn=Cy,LO.styleModule=Fy,LO.inputHandler=Ay,LO.exceptionSink=xy,LO.updateListener=ky,LO.editable=Ey,LO.mouseSelectionStyle=Sy,LO.dragMovesSelection=Oy,LO.clickAddsSelectionRange=by,LO.decorations=zy,LO.darkTheme=SO,LO.contentAttributes=Iy,LO.editorAttributes=Qy,LO.lineWrapping=LO.contentAttributes.of({class:"cm-lineWrapping"}),LO.announce=Et.define();const VO=4096;function WO(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const NO={};class HO{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:_y.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new HO(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function QO(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&sy(r,i)}return i}const IO=!_v.ios;const zO={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};IO&&(zO[".cm-line"].caretColor="transparent !important");class FO extends Yt{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}FO.prototype.elementClass="",FO.prototype.toDOM=void 0,FO.prototype.mapMode=z.TrackBefore,FO.prototype.startSide=FO.prototype.endSide=-1,FO.prototype.point=!0;const $O=et.define(),qO={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ee.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},_O=et.define();function GO(t){return[UO(),_O.of(Object.assign(Object.assign({},qO),t))]}const XO=LO.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}}),jO=et.define({combine:t=>t.some((t=>t))});function UO(t){let e=[ZO,XO];return t&&!1===t.fixed&&e.push(jO.of(!0)),e}const ZO=Wy.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=t.state.facet(_O).map((e=>new tS(t,e)));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!t.state.facet(jO),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,s=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(s<.8*(i.to-i.from))}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(jO)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=ee.iter(this.view.state.facet($O),this.view.viewport.from),s=[],n=this.gutters.map((t=>new JO(t,this.view.viewport,-this.view.documentPadding.top)));for(let t of this.view.viewportLineBlocks){let e;if(Array.isArray(t.type)){for(let i of t.type)if(i.type==hy.Text){e=i;break}}else e=t.type==hy.Text?t:void 0;if(e){s.length&&(s=[]),KO(i,s,t.from);for(let t of n)t.line(this.view,e,s)}}for(let t of n)t.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(_O),i=t.state.facet(_O),s=t.docChanged||t.heightChanged||t.viewportChanged||!ee.eq(t.startState.facet($O),t.state.facet($O),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let e of this.gutters)e.update(t)&&(s=!0);else{s=!0;let n=[];for(let s of i){let i=e.indexOf(s);i<0?n.push(new tS(this.view,s)):(this.gutters[i].update(t),n.push(this.gutters[i]))}for(let t of this.gutters)t.dom.remove(),n.indexOf(t)<0&&t.destroy();for(let t of n)this.dom.appendChild(t.dom);this.gutters=n}return s}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:Py.scrollMargins.from((t=>0!=t.gutters.length&&t.fixed?t.view.textDirection==_y.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}:null))});function YO(t){return Array.isArray(t)?t:[t]}function KO(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}class JO{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=ee.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),KO(this.cursor,this.localMarkers,e.from);let s=i.length?this.localMarkers.concat(i):this.localMarkers,n=this.gutter.config.lineMarker(t,e,s);n&&s.unshift(n);let r=this.gutter;if(0==s.length&&!r.config.renderEmptyElements)return;let o=e.top-this.height;if(this.i==r.elements.length){let i=new eS(t,e.height,o,s);r.elements.push(i),r.dom.appendChild(i.dom)}else r.elements[this.i].update(t,e.height,o,s);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class tS{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,(s=>{let n=t.lineBlockAtHeight(s.clientY-t.documentTop);e.domEventHandlers[i](t,n,s)&&s.preventDefault()}));this.markers=YO(e.markers(t)),e.initialSpacer&&(this.spacer=new eS(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=YO(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let e=this.config.updateSpacer(this.spacer.markers[0],t);e!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[e])}let i=t.view.viewport;return!ee.eq(this.markers,e,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(t)}destroy(){for(let t of this.elements)t.destroy()}}class eS{constructor(t,e,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.update(t,e,i,s)}update(t,e,i,s){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}(this.markers,s)||this.setMarkers(t,s)}setMarkers(t,e){let i="cm-gutterElement",s=this.dom.firstChild;for(let n=0,r=0;;){let o=r,h=n<e.length?e[n++]:null,l=!1;if(h){let t=h.elementClass;t&&(i+=" "+t);for(let t=r;t<this.markers.length;t++)if(this.markers[t].compare(h)){o=t,l=!0;break}}else o=this.markers.length;for(;r<o;){let t=this.markers[r++];if(t.toDOM){t.destroy(s);let e=s.nextSibling;s.remove(),s=e}}if(!h)break;h.toDOM&&(l?s=s.nextSibling:this.dom.insertBefore(h.toDOM(t),s)),l&&r++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}const iS=et.define(),sS=et.define({combine:t=>qt(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let t in e){let s=i[t],n=e[t];i[t]=s?(t,e,i)=>s(t,e,i)||n(t,e,i):n}return i}})});class nS extends FO{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function rS(t,e){return t.state.facet(sS).formatNumber(e,t.state)}const oS=_O.compute([sS],(t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:t=>t.state.facet(iS),lineMarker:(t,e,i)=>i.some((t=>t.toDOM))?null:new nS(rS(t,t.state.doc.lineAt(e.from).number)),lineMarkerChange:t=>t.startState.facet(sS)!=t.state.facet(sS),initialSpacer:t=>new nS(rS(t,lS(t.state.doc.lines))),updateSpacer(t,e){let i=rS(e.view,lS(e.view.state.doc.lines));return i==t.number?t:new nS(i)},domEventHandlers:t.facet(sS).domEventHandlers})));function hS(t={}){return[sS.of(t),UO(),oS]}function lS(t){let e=9;for(;e<t;)e=10*e+9;return e}const aS=new class extends FO{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},cS=$O.compute(["selection"],(t=>{let e=[],i=-1;for(let s of t.selection.ranges)if(s.empty){let n=t.doc.lineAt(s.head).from;n>i&&(i=n,e.push(aS.range(n)))}return ee.of(e)}));function dS(){return cS}function uS(t,e){let i=e.mapPos(t.from,1),s=e.mapPos(t.to,-1);return i>=s?void 0:{from:i,to:s}}const fS=Et.define({map:uS}),pS=Et.define({map:uS});function gS(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some((t=>t.from<=i&&t.to>=i))||e.push(t.lineBlockAt(i));return e}const mS=ht.define({create:()=>Ic.none,update(t,e){t=t.map(e.changes);for(let i of e.effects)i.is(fS)&&!vS(t,i.value.from,i.value.to)?t=t.update({add:[AS.range(i.value.from,i.value.to)]}):i.is(pS)&&(t=t.update({filter:(t,e)=>i.value.from!=t||i.value.to!=e,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:s}=e.selection.main;t.between(s,s,((t,e)=>{t<s&&e>s&&(i=!0)})),i&&(t=t.update({filterFrom:s,filterTo:s,filter:(t,e)=>e<=s||t>=s}))}return t},provide:t=>ff.decorations.from(t)});function wS(t,e,i){var s;let n=null;return null===(s=t.field(mS,!1))||void 0===s||s.between(e,i,((t,e)=>{(!n||n.from>t)&&(n={from:t,to:e})})),n}function vS(t,e,i){let s=!1;return t.between(e,e,((t,n)=>{t==e&&n==i&&(s=!0)})),s}function yS(t,e){return t.field(mS,!1)?e:e.concat(Et.appendConfig.of(kS()))}function bS(t,e,i=!0){let s=t.state.doc.lineAt(e.from).number,n=t.state.doc.lineAt(e.to).number;return ff.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${s} ${t.state.phrase("to")} ${n}.`)}const OS=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:t=>{for(let e of gS(t)){let i=lv(t.state,e.from,e.to);if(i)return t.dispatch({effects:yS(t.state,[fS.of(i),bS(t,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:t=>{if(!t.state.field(mS,!1))return!1;let e=[];for(let i of gS(t)){let s=wS(t.state,i.from,i.to);s&&e.push(pS.of(s),bS(t,s,!1))}return e.length&&t.dispatch({effects:e}),e.length>0}},{key:"Ctrl-Alt-[",run:t=>{let{state:e}=t,i=[];for(let s=0;s<e.doc.length;){let n=t.lineBlockAt(s),r=lv(e,n.from,n.to);r&&i.push(fS.of(r)),s=(r?t.lineBlockAt(r.to):n).to+1}return i.length&&t.dispatch({effects:yS(t.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:t=>{let e=t.state.field(mS,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,((t,e)=>{i.push(pS.of({from:t,to:e}))})),t.dispatch({effects:i}),!0}}],SS={placeholderDOM:null,placeholderText:"…"},xS=et.define({combine:t=>qt(t,SS)});function kS(t){let e=[mS,DS];return t&&e.push(xS.of(t)),e}const AS=Ic.replace({widget:new class extends Hc{toDOM(t){let{state:e}=t,i=e.facet(xS),s=e=>{let i=t.lineBlockAt(t.posAtDOM(e.target)),s=wS(t.state,i.from,i.to);s&&t.dispatch({effects:pS.of(s)}),e.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(t,s);let n=document.createElement("span");return n.textContent=i.placeholderText,n.setAttribute("aria-label",e.phrase("folded code")),n.title=e.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=s,n}}}),MS={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};class CS extends FO{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function TS(t={}){let e=Object.assign(Object.assign({},MS),t),i=new CS(e,!0),s=new CS(e,!1),n=pd.fromClass(class{constructor(t){this.from=t.viewport.from,this.markers=this.buildMarkers(t)}update(t){(t.docChanged||t.viewportChanged||t.startState.facet(zw)!=t.state.facet(zw)||t.startState.field(mS,!1)!=t.state.field(mS,!1)||Bw(t.startState)!=Bw(t.state))&&(this.markers=this.buildMarkers(t.view))}buildMarkers(t){let e=new ie;for(let n of t.viewportLineBlocks){let r=wS(t.state,n.from,n.to)?s:lv(t.state,n.from,n.to)?i:null;r&&e.add(n.from,n.from,r)}return e.finish()}}),{domEventHandlers:r}=e;return[n,GO({class:"cm-foldGutter",markers(t){var e;return(null===(e=t.plugin(n))||void 0===e?void 0:e.markers)||ee.empty},initialSpacer:()=>new CS(e,!1),domEventHandlers:Object.assign(Object.assign({},r),{click:(t,e,i)=>{if(r.click&&r.click(t,e,i))return!0;let s=wS(t.state,e.from,e.to);if(s)return t.dispatch({effects:pS.of(s)}),!0;let n=lv(t.state,e.from,e.to);return!!n&&(t.dispatch({effects:fS.of(n)}),!0)}})}),kS()]}const DS=ff.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});function RS(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function ES(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function BS(t,e){if(!e.anchorNode)return!1;try{return ES(t,e.anchorNode)}catch(t){return!1}}function PS(t){return 3==t.nodeType?_S(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function LS(t,e,i,s){return!!i&&(WS(t,e,i,s,-1)||WS(t,e,i,s,1))}function VS(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function WS(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:NS(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=VS(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?NS(t):0}}}function NS(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const HS={left:0,right:0,top:0,bottom:0};function QS(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function IS(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class zS{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let FS,$S=null;function qS(t){if(t.setActive)return t.setActive();if($S)return t.focus($S);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==$S?{get preventScroll(){return $S={preventScroll:!0},!0}}:void 0),!$S){$S=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function _S(t,e,i=e){let s=FS||(FS=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function GS(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function XS(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class jS{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new jS(t.parentNode,VS(t),e)}static after(t,e){return new jS(t.parentNode,VS(t)+1,e)}}const US=[];class ZS{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=ZS.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=YS(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=YS(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==NS(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!ZS.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=US){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new KS(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function YS(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}ZS.prototype.breakAfter=0;class KS{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function JS(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function tx(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,JS(t,a,c,h,l,s,0,n,r)}let ex="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},ix="undefined"!=typeof document?document:{documentElement:{style:{}}};const sx=/Edge\/(\d+)/.exec(ex.userAgent),nx=/MSIE \d/.test(ex.userAgent),rx=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ex.userAgent),ox=!!(nx||rx||sx),hx=!ox&&/gecko\/(\d+)/i.test(ex.userAgent),lx=!ox&&/Chrome\/(\d+)/.exec(ex.userAgent),ax="webkitFontSmoothing"in ix.documentElement.style,cx=!ox&&/Apple Computer/.test(ex.vendor),dx=cx&&(/Mobile\/\w+/.test(ex.userAgent)||ex.maxTouchPoints>2);var ux={mac:dx||/Mac/.test(ex.platform),windows:/Win/.test(ex.platform),linux:/Linux|X11/.test(ex.platform),ie:ox,ie_version:nx?ix.documentMode||6:rx?+rx[1]:sx?+sx[1]:0,gecko:hx,gecko_version:hx?+(/Firefox\/(\d+)/.exec(ex.userAgent)||[0,0])[1]:0,chrome:!!lx,chrome_version:lx?+lx[1]:0,ios:dx,android:/Android\b/.test(ex.userAgent),webkit:ax,safari:cx,webkit_version:ax?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=ix.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class fx extends ZS{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof fx&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new fx(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new jS(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return gx(this.dom,t,e)}}class px extends ZS{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(XS(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof px&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(tx(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new px(this.mark,e,r)}domAtPos(t){return Ox(this.dom,this.children,t)}coordsAt(t,e){return xx(this,t,e)}}function gx(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?ux.chrome||ux.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=_S(t,n,r).getClientRects();if(!h.length)return HS;let l=h[(o?o<0:i>=0)?0:h.length-1];return ux.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?QS(l,o<0):l||null}class mx extends ZS{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||mx)(t,e,i)}split(t){let e=mx.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof mx&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof mx&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?jS.before(this.dom):jS.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return HS;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:QS(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class wx extends mx{domAtPos(t){let{topView:e,text:i}=this.widget;return e?vx(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new jS(i,Math.min(t,i.nodeValue.length)))):new jS(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?yx(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?vx(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>gx(s,t,e))):gx(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function vx(t,e,i,s,n,r){if(i instanceof px){for(let o of i.children){let i=ES(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?vx(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function yx(t,e,i,s){if(i instanceof px)for(let n of i.children){let i=0,r=ES(n.dom,s);if(ES(n.dom,t))return i+(r?yx(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class bx extends ZS{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof bx&&t.side==this.side}split(){return new bx(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return jS.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof fx){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof px&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function Ox(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return jS.after(i)}return new jS(t,0)}function Sx(t,e,i){let s,{children:n}=t;i>0&&e instanceof px&&n.length&&(s=n[n.length-1])instanceof px&&s.mark.eq(e.mark)?Sx(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function xx(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?QS(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=PS(s);return n[n.length-1]||null}function kx(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function Ax(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function Mx(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}fx.prototype.children=mx.prototype.children=bx.prototype.children=US;class Cx{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Tx=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Tx||(Tx={}));class Dx extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new Rx(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Bx(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=Px(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Bx(t,e,i,s,t.widget||null,!0)}static line(t){return new Ex(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Dx.none=ee.empty;class Rx extends Dx{constructor(t){let{start:e,end:i}=Px(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof Rx&&this.tagName==t.tagName&&this.class==t.class&&Ax(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Rx.prototype.point=!1;class Ex extends Dx{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Ex&&Ax(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Ex.prototype.mapMode=z.TrackBefore,Ex.prototype.point=!0;class Bx extends Dx{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?Tx.WidgetRange:this.startSide<=0?Tx.WidgetBefore:Tx.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Bx&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Px(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function Lx(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}Bx.prototype.point=!0;class Vx extends ZS{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof Vx))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),tx(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new Vx;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Ax(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Sx(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=kx(e,this.attrs||{})),i&&(this.attrs=kx({class:i},this.attrs||{}))}domAtPos(t){return Ox(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(XS(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Mx(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&ZS.get(i)instanceof px;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=ZS.get(i))||void 0===e?void 0:e.isEditable)||ux.ios&&this.children.some((t=>t instanceof fx))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof fx))return null;let i=PS(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return xx(this,t,e)}become(t){return!1}get type(){return Tx.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof Vx)return n;if(r>e)break}s=r+n.breakAfter}return null}}class Wx extends ZS{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Wx&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?jS.before(this.dom):jS.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Wx(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return US}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof Wx&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Nx{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Wx&&t.type==Tx.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Vx),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Hx(new bx(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Hx(new fx(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof Bx)if(i.block){let{type:t}=i;t!=Tx.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Wx(i.widget||new Qx("div"),r,t))}else{let o=mx.create(i.widget||new Qx("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(Hx(new bx(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(Hx(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof Bx){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new Nx(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Hx(t,e){for(let i of e)t=new px(i,[t],t.length);return t}class Qx extends Cx{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Ix=[],zx=et.define(),Fx=et.define(),$x=et.define(),qx=et.define(),_x=et.define(),Gx=et.define(),Xx=Et.define({map:(t,e)=>t.map(e)}),jx=Et.define({map:(t,e)=>t.map(e)});class Ux{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new Ux(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Zx=Et.define({map:(t,e)=>t.map(e)});function Yx(t,e,i){let s=t.facet(qx);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Kx=et.define({combine:t=>!t.length||t[0]});class Jx{constructor(t,e){this.field=t,this.get=e}}class tk{from(t){return new Jx(this,t)}static define(){return new tk}}tk.decorations=tk.define(),tk.atomicRanges=tk.define(),tk.scrollMargins=tk.define();let ek=0;const ik=et.define();class sk{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=ik.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(nk.from((t=>({plugin:t,handlers:i})))),n&&r.push(tk.decorations.from(n)),new sk(ek++,t,r)}static fromClass(t,e){return sk.define((e=>new t(e)),e)}}const nk=tk.define();class rk{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Yx(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Yx(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Yx(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const ok=et.define(),hk=et.define(),lk=et.define(),ak=et.define();class ck{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new ck(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new ck(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new ck(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class dk{constructor(t,e,i=Ix){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new ck(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var uk=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(uk||(uk={}));const fk=uk.LTR,pk=uk.RTL;function gk(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const mk=gk("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),wk=gk("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),vk=Object.create(null),yk=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);vk[e]=i,vk[i]=-e}const bk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Ok{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?pk:fk}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Sk=[];function xk(t,e){let i=t.length,s=e==fk?1:2,n=e==fk?2:1;if(!t||1==s&&!bk.test(t))return kk(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?mk[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?wk[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Sk[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Sk[t];if(128==s)t<i-1&&e==Sk[t+1]&&24&e?s=Sk[t]=e:Sk[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Sk[s];)s++;let r=t&&8==e||s<i&&8==Sk[s]?1==n?1:8:256;for(let e=t;e<s;e++)Sk[e]=r;t=s-1}else 8==s&&1==n&&(Sk[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=vk[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(yk[t+1]==-r){let e=yk[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Sk[h]=Sk[yk[t]]=i),l=t;break}}else{if(189==yk.length)break;yk[l++]=h,yk[l++]=e,yk[l++]=a}else if(2==(o=Sk[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=yk[e+2];if(2&i)break;if(t)yk[e+2]|=2;else{if(4&i)break;yk[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Sk[t]){let e=t+1;for(;e<i&&256==Sk[e];)e++;let n=1==(t?Sk[t-1]:s),r=n==(1==(e<i?Sk[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Sk[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Sk[t++];for(;t<i&&s==(1!=Sk[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Sk[--i];for(;i>e&&s==(2!=Sk[i-1]);)i--;o.push(new Ok(i,t,s?2:1))}else o.push(new Ok(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Sk[t++];for(;t<i&&s==(2==Sk[t]);)t++;o.push(new Ok(e,t,s?1:2))}return o}function kk(t){return[new Ok(0,t,0)]}let Ak="";function Mk(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=Ok.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(Ak=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Ck{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=ZS.get(s),r=ZS.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Tk(s))||Tk(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=ZS.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Tk(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Dk{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Rk extends ZS{constructor(t){super(),this.view=t,this.compositionDeco=Dx.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Vx],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ck(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Dx.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Bk(t);if(!i)return Dx.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Ck([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return Dx.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return Dx.none;let d=ZS.get(r);d instanceof wx?d=d.widget.topView:d&&(d.parent=null);return Dx.set(Dx.replace({widget:new Pk(r,o,d)}).range(h,l))}(this.view,t.changes)),(ux.ie||ux.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new Vk;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=ck.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=ux.chrome||ux.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Wx&&t.widget instanceof Ek&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=Nx.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);JS(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||ux.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(ux.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new jS(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&LS(n.node,n.offset,h.anchorNode,h.anchorOffset)&&LS(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{ux.android&&ux.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=RS(this.root);if(s.empty){if(ux.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=Lk(n.node,n.offset,1==t?1:-1);e&&(n=new jS(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new jS(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new jS(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=RS(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Vx.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Kx)?this.root.activeElement==this.dom:BS(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=ZS.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Vx)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=Tx.WidgetBefore&&n.type!=Tx.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==Tx.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?PS(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==uk.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Vx){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=PS(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new KS(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Dx.replace({widget:new Ek(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return Dx.set(t)}updateDeco(){let t=this.view.pluginField(tk.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(lk),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(tk.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=IS(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==uk.LTR)}}class Ek extends Cx{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Bk(t){let e=t.observer.selectionRange,i=e.focusNode&&Lk(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof Vx){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!ZS.get(e);)e=e.previousSibling;let n=e?ZS.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof Vx)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class Pk extends Cx{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return wx}}function Lk(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=NS(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Vk{constructor(){this.changes=[]}compareRange(t,e){Lx(t,e,this.changes)}comparePoint(t,e){Lx(t,e,this.changes)}}function Wk(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Nk(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Hk(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Qk(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Ik(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function zk(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=PS(d);for(let u=0;u<t.length;u++){let f=t[u];n&&Hk(n,f)&&(f=Qk(Ik(f,n.bottom),n.top));let p=Wk(e,f),g=Nk(i,f);if(0==p&&0==g)return 3==d.nodeType?Fk(d,e,i):zk(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&Hk(a,f)?a=Ik(a,f.bottom):c&&Hk(c,f)&&(c=Qk(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Fk(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:zk(s,d,i)}function Fk(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=_S(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(ux.chrome||ux.gecko){_S(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function $k(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Tx.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:qk(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:qk(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),ux.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return _S(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=Vx.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=zk(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function qk(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function _k(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=Mk(n,r,t.textDirection,o,i),l=Ak;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function Gk(t,e,i){let s=t.pluginField(tk.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class Xk{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Kk){let i=Kk[e];t.contentDOM.addEventListener(e,(s=>{Yk(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),ux.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(nk);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Yk(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Yx(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){Yx(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(ux.android&&ux.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!ux.ios||!(i=jk.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,GS(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(ux.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!ux.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const jk=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Uk=[16,17,18,20,91,92,224,225];class Zk{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(zx);return i.length?i[0](e):ux.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Fx);return i.length?i[0](e):ux.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=RS(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=dA(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Yk(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=ZS.get(s))&&i.ignoreEvent(e))return!1;return!0}const Kk=Object.create(null),Jk=ux.ie&&ux.ie_version<15||ux.ios&&ux.webkit_version<604;function tA(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=fA&&s.selection.ranges.every((t=>t.empty))&&fA==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Kk.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():Uk.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let eA=0;function iA(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=Vx.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}Kk.touchstart=(t,e)=>{eA=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Kk.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Kk.mousedown=(t,e)=>{if(t.observer.flush(),eA>Date.now()-2e3&&1==dA(e))return;let i=null;for(let s of t.state.facet($x))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=oA(t,e),s=dA(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=oA(t,e),o=e),!a||!i)return n;let c=iA(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=iA(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>qS(t.contentDOM))),t.inputState.startMouseSelection(new Zk(t,e,i,s))}};let sA=(t,e)=>t>=e.top&&t<=e.bottom,nA=(t,e,i)=>sA(e,i)&&t>=i.left&&t<=i.right;function rA(t,e,i,s){let n=Vx.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&nA(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&nA(i,s,h)?1:o&&sA(s,o)?-1:1}function oA(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:rA(t,i,e.clientX,e.clientY)}}const hA=ux.ie&&ux.ie_version<=11;let lA=null,aA=0,cA=0;function dA(t){if(!hA)return t.detail;let e=lA,i=cA;return lA=t,cA=Date.now(),aA=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(aA+1)%3:1}function uA(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}Kk.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Kk.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&uA(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else uA(t,e,e.dataTransfer.getData("Text"),!0)},Kk.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Jk?null:e.clipboardData;i?(tA(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),tA(t,i.value)}),50)}(t)};let fA=null;function pA(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Kk.copy=Kk.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;fA=n?i:null;let r=Jk?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},Kk.focus=Kk.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Kk.compositionstart=Kk.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),pA(t,!0)))},Kk.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&pA(t,!1)}),50)},Kk.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Kk.beforeinput=(t,e)=>{var i;let s;if(ux.chrome&&ux.android&&(s=jk.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const gA=["pre-wrap","normal","pre-line","break-spaces"];class mA{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=uk.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return gA.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=gA.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class wA{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class vA{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new vA(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new vA(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var yA=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(yA||(yA={}));class bA{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return bA.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,yA.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,yA.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,yA.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=MA.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new SA(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new kA(bA.of(t.slice(0,e)),r,bA.of(t.slice(i)))}}bA.prototype.size=1;class OA extends bA{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new vA(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class SA extends OA{constructor(t,e){super(t,e,Tx.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof SA||s instanceof xA&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof xA?s=new SA(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):bA.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class xA extends bA{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new vA(l,a,i+o*h,o,Tx.Text)}lineAt(t,e,i,s,n){if(e==yA.ByHeight)return this.blockAt(t,i,s,n);if(e==yA.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new vA(e,s-e,0,0,Tx.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new vA(h,l,s+o*(a-r),o,Tx.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new vA(e.from,e.length,s,h,Tx.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof xA?i[i.length-1]=new xA(t.length+s):i.push(null,new xA(s-1))}if(t>0){let e=i[0];e instanceof xA?i[0]=new xA(t+e.length):i.unshift(new xA(t-1),null)}return bA.of(i)}decomposeLeft(t,e){e.push(new xA(t-1),null)}decomposeRight(t,e){e.push(null,new xA(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new xA(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new SA(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new xA(n-r).updateHeight(t,r));let l=bA.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class kA extends bA{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==yA.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==yA.ByPosNoHeight?yA.ByPosNoHeight:yA.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,yA.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&AA(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),AA(n,t)}return bA.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?bA.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function AA(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof xA&&(s=t[e+1])instanceof xA&&t.splice(e-1,3,new xA(i.length+1+s.length))}class MA{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof SA?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new SA(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new OA(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new SA(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new xA(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof SA)return t;let e=new SA(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Tx.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Tx.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof SA||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new SA(0,-1));let i=t;for(let t of this.nodes)t instanceof SA&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new MA(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class CA{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&Lx(t,e,this.changes,5)}}function TA(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function DA(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class RA{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return Dx.replace({widget:new EA(this.size,t)}).range(this.from,this.to)}}class EA extends Cx{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class BA{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new mA,this.scaler=QA,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=bA.empty().applyChanges(t.facet(lk),E.empty,this.heightOracle.setDoc(t.doc),[new ck(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Dx.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new PA(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?QA:new IA(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:zA(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(lk),n=t.changedRanges,r=ck.extendWithRanges(n,function(t,e,i){let s=new CA;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(lk),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?uk.RTL:uk.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?DA:TA)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new wA(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new PA(s.lineAt(r-1e3*i,yA.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),yA.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,yA.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new PA(s.lineAt(i-500,yA.ByHeight,n,0,0).from,s.lineAt(i+r+500,yA.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new PA(this.heightMap.lineAt(i,yA.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,yA.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,yA.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,yA.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new RA(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=uk.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=LA(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=VA(r,(this.visibleTop-i.top-t)/i.height),n=VA(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=VA(r,(this.pixelViewport.left-e)/t),n=VA(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&NA(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&NA(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(HA(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new RA(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=WA(s,i)-WA(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){RA.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Dx.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(lk);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||zA(this.heightMap.lineAt(t,yA.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return zA(this.heightMap.lineAt(this.scaler.fromDOM(t),yA.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return zA(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class PA{constructor(t,e){this.from=t,this.to=e}}function LA(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(lk),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function VA({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function WA(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function NA(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function HA(t,e){for(let i of t)if(e(i))return i}const QA={toDOM:t=>t,fromDOM:t=>t,scale:1};class IA{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,yA.ByPos,t,0,0).top,o=e.lineAt(n,yA.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function zA(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new vA(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>zA(t,e))):t.type)}const FA=et.define({combine:t=>t.join(" ")}),$A=et.define({combine:t=>t.indexOf(!0)>-1}),qA=jt.newName(),_A=jt.newName(),GA=jt.newName(),XA={"&light":"."+_A,"&dark":"."+GA};function jA(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const UA=jA("."+qA,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},XA),ZA={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},YA=ux.ie&&ux.ie_version<=11;class KA{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new zS,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(ux.ie&&ux.ie_version<=11||ux.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),YA&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Kx)?e.root.activeElement!=this.dom:!BS(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((ux.ie&&ux.ie_version<=11||ux.android&&ux.chrome)&&!e.state.selection.main.empty&&i.focusNode&&LS(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=RS(t),i=ux.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);LS(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,ZA),YA&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),YA&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;GS(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&BS(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=JA(e,t.previousSibling||t.target.previousSibling,-1),s=JA(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function JA(t,e,i){for(;e;){let s=ZS.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function tM(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Dk(i,s)),n==i&&r==s||e.push(new Dk(n,r)));return e}(t),c=new Ck(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||ux.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(ux.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(Kx)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!ES(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!ES(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(ux.ios&&t.inputState.flushIOSKey(t))return;if(ux.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&GS(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&GS(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&GS(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(Gx).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=Bk(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class eM{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new BA(t.state||$t.create()),this.plugins=this.state.facet(ik).map((t=>new rk(t)));for(let t of this.plugins)t.update(this);this.observer=new KA(this,((t,e,i)=>{tM(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Xk(this),this.docView=new Rk(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new dk(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new Ux(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(Xx)?n=new Ux(t.value):t.is(jx)?n=new Ux(t.value,"center"):t.is(Zx)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=rM.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(ak)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(FA)!=e.state.facet(FA)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(_x))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new BA(t),this.plugins=t.facet(ik).map((t=>new rk(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new Rk(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ik),i=t.state.facet(ik);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new rk(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return Yx(this.state,t),nM}})),o=new dk(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=nM)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){Yx(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(_x))t(e)}get themeClasses(){return qA+" "+(this.state.facet($A)?GA:_A)+" "+this.state.facet(FA)}updateAttrs(){let t=oM(this,ok,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Kx)?"true":"false",class:"cm-content",style:`${ux.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),oM(this,hk,e),this.observer.ignore((()=>{Mx(this.contentDOM,this.contentAttrs,e),Mx(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(eM.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(ak),jt.mount(this.root,this.styleModules.concat(UA).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=sM(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=sM(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=sM(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Gk(this,t,_k(this,t,e,i))}moveByGroup(t,e){return Gk(this,t,_k(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==uk.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=Vx.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return Gk(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=$k(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:Xx.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),$k(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return QS(i,n[Ok.find(n,t-s.from,-1,e)].dir==uk.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>iM)return kk(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=xk(t.text,this.textDirection);return this.bidiCache.push(new rM(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||ux.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{qS(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Zx.of(new Ux("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return sk.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[FA.of(i),ak.of(jA(`.${i}`,t))];return e&&e.dark&&s.push($A.of(!0)),s}static baseTheme(t){return pt.lowest(ak.of(jA("."+qA,t,XA)))}}eM.scrollTo=Xx,eM.centerOn=jx,eM.styleModule=ak,eM.inputHandler=Gx,eM.exceptionSink=qx,eM.updateListener=_x,eM.editable=Kx,eM.mouseSelectionStyle=$x,eM.dragMovesSelection=Fx,eM.clickAddsSelectionRange=zx,eM.decorations=lk,eM.darkTheme=$A,eM.contentAttributes=hk,eM.editorAttributes=ok,eM.lineWrapping=eM.contentAttributes.of({class:"cm-lineWrapping"}),eM.announce=Et.define();const iM=4096;function sM(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const nM={};class rM{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:uk.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new rM(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function oM(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&kx(r,i)}return i}const hM=!ux.ios;const lM={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};hM&&(lM[".cm-line"].caretColor="transparent !important");const aM=eM.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),cM=et.define({combine:t=>qt(t,{afterCursor:!0,brackets:"()[]{}",maxScanDistance:1e4})}),dM=Dx.mark({class:"cm-matchingBracket"}),uM=Dx.mark({class:"cm-nonmatchingBracket"}),fM=ht.define({create:()=>Dx.none,update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],s=e.state.facet(cM);for(let t of e.state.selection.ranges){if(!t.empty)continue;let n=wM(e.state,t.head,-1,s)||t.head>0&&wM(e.state,t.head-1,1,s)||s.afterCursor&&(wM(e.state,t.head,1,s)||t.head<e.state.doc.length&&wM(e.state,t.head+1,-1,s));if(!n)continue;let r=n.matched?dM:uM;i.push(r.range(n.start.from,n.start.to)),n.end&&i.push(r.range(n.end.from,n.end.to))}return Dx.set(i,!0)},provide:t=>eM.decorations.from(t)}),pM=[fM,aM];function gM(t={}){return[cM.of(t),pM]}function mM(t,e,i){let s=t.prop(e<0?kf.openedBy:kf.closedBy);if(s)return s;if(1==t.name.length){let s=i.indexOf(t.name);if(s>-1&&s%2==(e<0?1:0))return[i[s+e]]}return null}function wM(t,e,i,s={}){let n=s.maxScanDistance||1e4,r=s.brackets||"()[]{}",o=Bw(t),h=o.resolveInner(e,i);for(let s=h;s;s=s.parent){let n=mM(s.type,i,r);if(n&&s.from<s.to)return vM(t,e,i,s,n,r)}return function(t,e,i,s,n,r,o){let h=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=o.indexOf(h);if(l<0||l%2==0!=i>0)return null;let a={from:i<0?e-1:e,to:i>0?e+1:e},c=t.doc.iterRange(e,i>0?t.doc.length:0),d=0;for(let t=0;!c.next().done&&t<=r;){let r=c.value;i<0&&(t+=r.length);let h=e+t*i;for(let t=i>0?0:r.length-1,e=i>0?r.length:-1;t!=e;t+=i){let e=o.indexOf(r[t]);if(!(e<0||s.resolve(h+t,1).type!=n))if(e%2==0==i>0)d++;else{if(1==d)return{start:a,end:{from:h+t,to:h+t+1},matched:e>>1==l>>1};d--}}i>0&&(t+=r.length)}return c.done?{start:a,matched:!1}:null}(t,e,i,o,h.type,n,r)}function vM(t,e,i,s,n,r){let o=s.parent,h={from:s.from,to:s.to},l=0,a=null==o?void 0:o.cursor;if(a&&(i<0?a.childBefore(s.from):a.childAfter(s.to)))do{if(i<0?a.to<=s.from:a.from>=s.to){if(0==l&&n.indexOf(a.type.name)>-1&&a.from<a.to)return{start:h,end:{from:a.from,to:a.to},matched:!0};if(mM(a.type,i,r))l++;else if(mM(a.type,-i,r)&&(l--,0==l))return{start:h,end:a.from==a.to?void 0:{from:a.from,to:a.to},matched:!1}}}while(i<0?a.prevSibling():a.nextSibling());return{start:h,matched:!1}}function yM(t,e){return Y.create(t.ranges.map(e),t.mainIndex)}function bM(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function OM({state:t,dispatch:e},i){let s=yM(t.selection,i);return!s.eq(t.selection)&&(e(bM(t,s)),!0)}function SM(t,e){return Y.cursor(e?t.to:t.from)}function xM(t,e){return OM(t,(i=>i.empty?t.moveByChar(i,e):SM(i,e)))}const kM=t=>xM(t,t.textDirection!=os.LTR),AM=t=>xM(t,t.textDirection==os.LTR);function MM(t,e){return OM(t,(i=>i.empty?t.moveByGroup(i,e):SM(i,e)))}function CM(t,e,i){if(e.type.prop(i))return!0;let s=e.to-e.from;return s&&(s>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function TM(t,e,i){let s,n,r=Bw(t).resolveInner(e.head),o=i?kf.closedBy:kf.openedBy;for(let s=e.head;;){let e=i?r.childAfter(s):r.childBefore(s);if(!e)break;CM(t,e,o)?r=e:s=i?e.to:e.from}return n=r.type.prop(o)&&(s=i?wM(t,r.from,1):wM(t,r.to,-1))&&s.matched?i?s.end.to:s.end.from:i?r.to:r.from,Y.cursor(n,i?-1:1)}function DM(t,e){return OM(t,(i=>{if(!i.empty)return SM(i,e);let s=t.moveVertically(i,e);return s.head!=i.head?s:t.moveToLineBoundary(i,e)}))}const RM=t=>DM(t,!1),EM=t=>DM(t,!0);function BM(t,e){let{state:i}=t,s=yM(i.selection,(i=>i.empty?t.moveVertically(i,e,t.dom.clientHeight):SM(i,e)));if(s.eq(i.selection))return!1;let n=t.coordsAtPos(i.selection.main.head),r=t.scrollDOM.getBoundingClientRect();return t.dispatch(bM(i,s),{effects:n&&n.top>r.top&&n.bottom<r.bottom?Zn.scrollIntoView(s.main.head,{y:"start",yMargin:n.top-r.top}):void 0}),!0}const PM=t=>BM(t,!1),LM=t=>BM(t,!0);function VM(t,e,i){let s=t.lineBlockAt(e.head),n=t.moveToLineBoundary(e,i);if(n.head==e.head&&n.head!=(i?s.to:s.from)&&(n=t.moveToLineBoundary(e,i,!1)),!i&&n.head==s.from&&s.length){let i=/^\s*/.exec(t.state.sliceDoc(s.from,Math.min(s.from+100,s.to)))[0].length;i&&e.head!=s.from+i&&(n=Y.cursor(s.from+i))}return n}const WM=t=>OM(t,(e=>VM(t,e,!0))),NM=t=>OM(t,(e=>VM(t,e,!1)));function HM(t,e,i){let s=!1,n=yM(t.selection,(e=>{let n=wM(t,e.head,-1)||wM(t,e.head,1)||e.head>0&&wM(t,e.head-1,1)||e.head<t.doc.length&&wM(t,e.head+1,-1);if(!n||!n.end)return e;s=!0;let r=n.start.from==e.head?n.end.to:n.end.from;return i?Y.range(e.anchor,r):Y.cursor(r)}));return!!s&&(e(bM(t,n)),!0)}function QM(t,e){let i=yM(t.state.selection,(t=>{let i=e(t);return Y.range(t.anchor,i.head,i.goalColumn)}));return!i.eq(t.state.selection)&&(t.dispatch(bM(t.state,i)),!0)}function IM(t,e){return QM(t,(i=>t.moveByChar(i,e)))}const zM=t=>IM(t,t.textDirection!=os.LTR),FM=t=>IM(t,t.textDirection==os.LTR);function $M(t,e){return QM(t,(i=>t.moveByGroup(i,e)))}function qM(t,e){return QM(t,(i=>t.moveVertically(i,e)))}const _M=t=>qM(t,!1),GM=t=>qM(t,!0);function XM(t,e){return QM(t,(i=>t.moveVertically(i,e,t.dom.clientHeight)))}const jM=t=>XM(t,!1),UM=t=>XM(t,!0),ZM=t=>QM(t,(e=>VM(t,e,!0))),YM=t=>QM(t,(e=>VM(t,e,!1))),KM=({state:t,dispatch:e})=>(e(bM(t,{anchor:0})),!0),JM=({state:t,dispatch:e})=>(e(bM(t,{anchor:t.doc.length})),!0),tC=({state:t,dispatch:e})=>(e(bM(t,{anchor:t.selection.main.anchor,head:0})),!0),eC=({state:t,dispatch:e})=>(e(bM(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0);function iC({state:t,dispatch:e},i){if(t.readOnly)return!1;let s="delete.selection",n=t.changeByRange((t=>{let{from:e,to:n}=t;if(e==n){let t=i(e);t<e?s="delete.backward":t>e&&(s="delete.forward"),e=Math.min(e,t),n=Math.max(n,t)}return e==n?{range:t}:{changes:{from:e,to:n},range:Y.cursor(e)}}));return!n.changes.empty&&(e(t.update(n,{scrollIntoView:!0,userEvent:s})),!0)}function sC(t,e,i){if(t instanceof Zn)for(let s of t.pluginField(ji.atomicRanges))s.between(e,e,((t,s)=>{t<e&&s>e&&(e=i?s:t)}));return e}const nC=(t,e)=>iC(t,(i=>{let s,n,{state:r}=t,o=r.doc.lineAt(i);if(!e&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(s=o.text.slice(0,i-o.from))){if("\t"==s[s.length-1])return i-1;let t=D(s,r.tabSize)%_w(r)||_w(r);for(let e=0;e<t&&" "==s[s.length-1-e];e++)i--;n=i}else n=O(o.text,i-o.from,e,e)+o.from,n==i&&o.number!=(e?r.doc.lines:1)&&(n+=e?1:-1);return sC(t,n,e)})),rC=t=>nC(t,!1),oC=t=>nC(t,!0),hC=(t,e)=>iC(t,(i=>{let s=i,{state:n}=t,r=n.doc.lineAt(s),o=n.charCategorizer(s);for(let t=null;;){if(s==(e?r.to:r.from)){s==i&&r.number!=(e?n.doc.lines:1)&&(s+=e?1:-1);break}let h=O(r.text,s-r.from,e)+r.from,l=r.text.slice(Math.min(s,h)-r.from,Math.max(s,h)-r.from),a=o(l);if(null!=t&&a!=t)break;" "==l&&s==i||(t=a),s=h}return sC(t,s,e)})),lC=t=>hC(t,!1),aC=t=>iC(t,(e=>{let i=t.lineBlockAt(e).to;return sC(t,e<i?i:Math.min(t.state.doc.length,e+1),!0)}));function cC(t){let e=[],i=-1;for(let s of t.selection.ranges){let n=t.doc.lineAt(s.from),r=t.doc.lineAt(s.to);if(s.empty||s.to!=r.from||(r=t.doc.lineAt(s.to-1)),i>=n.number){let t=e[e.length-1];t.to=r.to,t.ranges.push(s)}else e.push({from:n.from,to:r.to,ranges:[s]});i=r.number+1}return e}function dC(t,e,i){if(t.readOnly)return!1;let s=[],n=[];for(let e of cC(t)){if(i?e.to==t.doc.length:0==e.from)continue;let r=t.doc.lineAt(i?e.to+1:e.from-1),o=r.length+1;if(i){s.push({from:e.to,to:r.to},{from:e.from,insert:r.text+t.lineBreak});for(let i of e.ranges)n.push(Y.range(Math.min(t.doc.length,i.anchor+o),Math.min(t.doc.length,i.head+o)))}else{s.push({from:r.from,to:e.from},{from:e.to,insert:t.lineBreak+r.text});for(let t of e.ranges)n.push(Y.range(t.anchor-o,t.head-o))}}return!!s.length&&(e(t.update({changes:s,scrollIntoView:!0,selection:Y.create(n,t.selection.mainIndex),userEvent:"move.line"})),!0)}function uC(t,e,i){if(t.readOnly)return!1;let s=[];for(let e of cC(t))i?s.push({from:e.from,insert:t.doc.slice(e.from,e.to)+t.lineBreak}):s.push({from:e.to,insert:t.lineBreak+t.doc.slice(e.from,e.to)});return e(t.update({changes:s,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const fC=pC(!1);function pC(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let s=e.changeByRange((i=>{let{from:s,to:n}=i,r=e.doc.lineAt(s),o=!t&&s==n&&function(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i,s=Bw(t).resolveInner(e),n=s.childBefore(e),r=s.childAfter(e);return n&&r&&n.to<=e&&r.from>=e&&(i=n.type.prop(kf.closedBy))&&i.indexOf(r.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(r.from).from?{from:n.to,to:r.from}:null}(e,s);t&&(s=n=(n<=r.to?r:e.doc.lineAt(n)).to);let h=new jw(e,{simulateBreak:s,simulateDoubleBreak:!!o}),l=Xw(h,s);for(null==l&&(l=/^\s*/.exec(e.doc.lineAt(s).text)[0].length);n<r.to&&/\s/.test(r.text[n-r.from]);)n++;o?({from:s,to:n}=o):s>r.from&&s<r.from+100&&!/\S/.test(r.text.slice(0,s))&&(s=r.from);let a=["",Gw(e,l)];return o&&a.push(Gw(e,h.lineIndent(r.from,-1))),{changes:{from:s,to:n,insert:E.of(a)},range:Y.cursor(s+1+a[1].length)}}));return i(e.update(s,{scrollIntoView:!0,userEvent:"input"})),!0}}function gC(t,e){let i=-1;return t.changeByRange((s=>{let n=[];for(let r=s.from;r<=s.to;){let o=t.doc.lineAt(r);o.number>i&&(s.empty||s.to>o.from)&&(e(o,n,s),i=o.number),r=o.to+1}let r=t.changes(n);return{changes:n,range:Y.range(r.mapPos(s.anchor,1),r.mapPos(s.head,1))}}))}const mC=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(gC(t,((e,i)=>{i.push({from:e.from,insert:t.facet(qw)})})),{userEvent:"input.indent"})),!0),wC=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(gC(t,((e,i)=>{let s=/^\s*/.exec(e.text)[0];if(!s)return;let n=D(s,t.tabSize),r=0,o=Gw(t,Math.max(0,n-_w(t)));for(;r<s.length&&r<o.length&&s.charCodeAt(r)==o.charCodeAt(r);)r++;i.push({from:e.from+r,to:e.from+s.length,insert:o.slice(r)})})),{userEvent:"delete.dedent"})),!0),vC=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:t=>OM(t,(e=>TM(t.state,e,t.textDirection!=os.LTR))),shift:t=>QM(t,(e=>TM(t.state,e,t.textDirection!=os.LTR)))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:t=>OM(t,(e=>TM(t.state,e,t.textDirection==os.LTR))),shift:t=>QM(t,(e=>TM(t.state,e,t.textDirection==os.LTR)))},{key:"Alt-ArrowUp",run:({state:t,dispatch:e})=>dC(t,e,!1)},{key:"Shift-Alt-ArrowUp",run:({state:t,dispatch:e})=>uC(t,e,!1)},{key:"Alt-ArrowDown",run:({state:t,dispatch:e})=>dC(t,e,!0)},{key:"Shift-Alt-ArrowDown",run:({state:t,dispatch:e})=>uC(t,e,!0)},{key:"Escape",run:({state:t,dispatch:e})=>{let i=t.selection,s=null;return i.ranges.length>1?s=Y.create([i.main]):i.main.empty||(s=Y.create([Y.cursor(i.main.head)])),!!s&&(e(bM(t,s)),!0)}},{key:"Mod-Enter",run:pC(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:t,dispatch:e})=>{let i=cC(t).map((({from:e,to:i})=>Y.range(e,Math.min(i+1,t.doc.length))));return e(t.update({selection:Y.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:t,dispatch:e})=>{let i=yM(t.selection,(e=>{var i;let s=Bw(t).resolveInner(e.head,1);for(;!(s.from<e.from&&s.to>=e.to||s.to>e.to&&s.from<=e.from)&&(null===(i=s.parent)||void 0===i?void 0:i.parent);)s=s.parent;return Y.range(s.to,s.from)}));return e(bM(t,i)),!0},preventDefault:!0},{key:"Mod-[",run:wC},{key:"Mod-]",run:mC},{key:"Mod-Alt-\\",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),s=new jw(t,{overrideIndentation:t=>{let e=i[t];return null==e?-1:e}}),n=gC(t,((e,n,r)=>{let o=Xw(s,e.from);if(null==o)return;/\S/.test(e.text)||(o=0);let h=/^\s*/.exec(e.text)[0],l=Gw(t,o);(h!=l||r.from<e.from+h.length)&&(i[e.from]=o,n.push({from:e.from,to:e.from+h.length,insert:l}))}));return n.changes.empty||e(t.update(n,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(cC(e).map((({from:t,to:i})=>(t>0?t--:i<e.doc.length&&i++,{from:t,to:i})))),s=yM(e.selection,(e=>t.moveVertically(e,!0))).map(i);return t.dispatch({changes:i,selection:s,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:t,dispatch:e})=>HM(t,e,!1)}].concat([{key:"ArrowLeft",run:kM,shift:zM,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:t=>MM(t,t.textDirection!=os.LTR),shift:t=>$M(t,t.textDirection!=os.LTR)},{mac:"Cmd-ArrowLeft",run:NM,shift:YM},{key:"ArrowRight",run:AM,shift:FM,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:t=>MM(t,t.textDirection==os.LTR),shift:t=>$M(t,t.textDirection==os.LTR)},{mac:"Cmd-ArrowRight",run:WM,shift:ZM},{key:"ArrowUp",run:RM,shift:_M,preventDefault:!0},{mac:"Cmd-ArrowUp",run:KM,shift:tC},{mac:"Ctrl-ArrowUp",run:PM,shift:jM},{key:"ArrowDown",run:EM,shift:GM,preventDefault:!0},{mac:"Cmd-ArrowDown",run:JM,shift:eC},{mac:"Ctrl-ArrowDown",run:LM,shift:UM},{key:"PageUp",run:PM,shift:jM},{key:"PageDown",run:LM,shift:UM},{key:"Home",run:NM,shift:YM},{key:"Mod-Home",run:KM,shift:tC},{key:"End",run:WM,shift:ZM},{key:"Mod-End",run:JM,shift:eC},{key:"Enter",run:fC},{key:"Mod-a",run:({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:rC,shift:rC},{key:"Delete",run:oC},{key:"Mod-Backspace",mac:"Alt-Backspace",run:lC},{key:"Mod-Delete",mac:"Alt-Delete",run:t=>hC(t,!0)},{mac:"Mod-Backspace",run:t=>iC(t,(e=>{let i=t.lineBlockAt(e).from;return sC(t,e>i?i:Math.max(0,e-1),!1)}))},{mac:"Mod-Delete",run:aC}].concat([{key:"Ctrl-b",run:kM,shift:zM,preventDefault:!0},{key:"Ctrl-f",run:AM,shift:FM},{key:"Ctrl-p",run:RM,shift:_M},{key:"Ctrl-n",run:EM,shift:GM},{key:"Ctrl-a",run:t=>OM(t,(e=>Y.cursor(t.lineBlockAt(e.head).from,1))),shift:t=>QM(t,(e=>Y.cursor(t.lineBlockAt(e.head).from)))},{key:"Ctrl-e",run:t=>OM(t,(e=>Y.cursor(t.lineBlockAt(e.head).to,-1))),shift:t=>QM(t,(e=>Y.cursor(t.lineBlockAt(e.head).to)))},{key:"Ctrl-d",run:oC},{key:"Ctrl-h",run:rC},{key:"Ctrl-k",run:aC},{key:"Ctrl-Alt-h",run:lC},{key:"Ctrl-o",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:E.of(["",""])},range:Y.cursor(t.from)})));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((e=>{if(!e.empty||0==e.from||e.from==t.doc.length)return{range:e};let i=e.from,s=t.doc.lineAt(i),n=i==s.from?i-1:O(s.text,i-s.from,!1)+s.from,r=i==s.to?i+1:O(s.text,i-s.from,!0)+s.from;return{changes:{from:n,to:r,insert:t.doc.slice(i,r).append(t.doc.slice(n,i))},range:Y.cursor(r)}}));return!i.changes.empty&&(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:LM}].map((t=>({mac:t.key,run:t.run,shift:t.shift})))));function yC(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function bC(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function OC(t,e){if(!e.anchorNode)return!1;try{return bC(t,e.anchorNode)}catch(t){return!1}}function SC(t){return 3==t.nodeType?LC(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function xC(t,e,i,s){return!!i&&(AC(t,e,i,s,-1)||AC(t,e,i,s,1))}function kC(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function AC(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:MC(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=kC(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?MC(t):0}}}function MC(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const CC={left:0,right:0,top:0,bottom:0};function TC(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function DC(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class RC{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let EC,BC=null;function PC(t){if(t.setActive)return t.setActive();if(BC)return t.focus(BC);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==BC?{get preventScroll(){return BC={preventScroll:!0},!0}}:void 0),!BC){BC=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function LC(t,e,i=e){let s=EC||(EC=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function VC(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function WC(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class NC{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new NC(t.parentNode,kC(t),e)}static after(t,e){return new NC(t.parentNode,kC(t)+1,e)}}const HC=[];class QC{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=QC.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=IC(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=IC(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==MC(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!QC.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=HC){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new zC(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function IC(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}QC.prototype.breakAfter=0;class zC{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function FC(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function $C(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,FC(t,a,c,h,l,s,0,n,r)}let qC="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},_C="undefined"!=typeof document?document:{documentElement:{style:{}}};const GC=/Edge\/(\d+)/.exec(qC.userAgent),XC=/MSIE \d/.test(qC.userAgent),jC=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qC.userAgent),UC=!!(XC||jC||GC),ZC=!UC&&/gecko\/(\d+)/i.test(qC.userAgent),YC=!UC&&/Chrome\/(\d+)/.exec(qC.userAgent),KC="webkitFontSmoothing"in _C.documentElement.style,JC=!UC&&/Apple Computer/.test(qC.vendor),tT=JC&&(/Mobile\/\w+/.test(qC.userAgent)||qC.maxTouchPoints>2);var eT={mac:tT||/Mac/.test(qC.platform),windows:/Win/.test(qC.platform),linux:/Linux|X11/.test(qC.platform),ie:UC,ie_version:XC?_C.documentMode||6:jC?+jC[1]:GC?+GC[1]:0,gecko:ZC,gecko_version:ZC?+(/Firefox\/(\d+)/.exec(qC.userAgent)||[0,0])[1]:0,chrome:!!YC,chrome_version:YC?+YC[1]:0,ios:tT,android:/Android\b/.test(qC.userAgent),webkit:KC,safari:JC,webkit_version:KC?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=_C.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class iT extends QC{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof iT&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new iT(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new NC(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return nT(this.dom,t,e)}}class sT extends QC{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(WC(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof sT&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&($C(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new sT(this.mark,e,r)}domAtPos(t){return cT(this.dom,this.children,t)}coordsAt(t,e){return uT(this,t,e)}}function nT(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?eT.chrome||eT.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=LC(t,n,r).getClientRects();if(!h.length)return CC;let l=h[(o?o<0:i>=0)?0:h.length-1];return eT.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?TC(l,o<0):l||null}class rT extends QC{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||rT)(t,e,i)}split(t){let e=rT.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof rT&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof rT&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?NC.before(this.dom):NC.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return CC;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:TC(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class oT extends rT{domAtPos(t){let{topView:e,text:i}=this.widget;return e?hT(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new NC(i,Math.min(t,i.nodeValue.length)))):new NC(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?lT(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?hT(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>nT(s,t,e))):nT(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function hT(t,e,i,s,n,r){if(i instanceof sT){for(let o of i.children){let i=bC(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?hT(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function lT(t,e,i,s){if(i instanceof sT)for(let n of i.children){let i=0,r=bC(n.dom,s);if(bC(n.dom,t))return i+(r?lT(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class aT extends QC{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof aT&&t.side==this.side}split(){return new aT(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return NC.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof iT){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof sT&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function cT(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return NC.after(i)}return new NC(t,0)}function dT(t,e,i){let s,{children:n}=t;i>0&&e instanceof sT&&n.length&&(s=n[n.length-1])instanceof sT&&s.mark.eq(e.mark)?dT(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function uT(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?TC(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=SC(s);return n[n.length-1]||null}function fT(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function pT(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function gT(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}iT.prototype.children=rT.prototype.children=aT.prototype.children=HC;class mT{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var wT=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(wT||(wT={}));class vT extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new yT(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new OT(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=ST(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new OT(t,e,i,s,t.widget||null,!0)}static line(t){return new bT(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}vT.none=ee.empty;class yT extends vT{constructor(t){let{start:e,end:i}=ST(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof yT&&this.tagName==t.tagName&&this.class==t.class&&pT(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}yT.prototype.point=!1;class bT extends vT{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof bT&&pT(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}bT.prototype.mapMode=z.TrackBefore,bT.prototype.point=!0;class OT extends vT{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?wT.WidgetRange:this.startSide<=0?wT.WidgetBefore:wT.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof OT&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function ST(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function xT(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}OT.prototype.point=!0;class kT extends QC{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof kT))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),$C(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new kT;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){pT(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){dT(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=fT(e,this.attrs||{})),i&&(this.attrs=fT({class:i},this.attrs||{}))}domAtPos(t){return cT(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(WC(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(gT(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&QC.get(i)instanceof sT;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=QC.get(i))||void 0===e?void 0:e.isEditable)||eT.ios&&this.children.some((t=>t instanceof iT))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof iT))return null;let i=SC(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return uT(this,t,e)}become(t){return!1}get type(){return wT.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof kT)return n;if(r>e)break}s=r+n.breakAfter}return null}}class AT extends QC{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof AT&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?NC.before(this.dom):NC.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new AT(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return HC}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof AT&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class MT{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof AT&&t.type==wT.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new kT),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(CT(new aT(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(CT(new iT(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof OT)if(i.block){let{type:t}=i;t!=wT.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new AT(i.widget||new TT("div"),r,t))}else{let o=rT.create(i.widget||new TT("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(CT(new aT(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(CT(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof OT){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new MT(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function CT(t,e){for(let i of e)t=new sT(i,[t],t.length);return t}class TT extends mT{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const DT=[],RT=et.define(),ET=et.define(),BT=et.define(),PT=et.define(),LT=et.define(),VT=et.define(),WT=Et.define({map:(t,e)=>t.map(e)}),NT=Et.define({map:(t,e)=>t.map(e)});class HT{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new HT(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const QT=Et.define({map:(t,e)=>t.map(e)});function IT(t,e,i){let s=t.facet(PT);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const zT=et.define({combine:t=>!t.length||t[0]});class FT{constructor(t,e){this.field=t,this.get=e}}class $T{from(t){return new FT(this,t)}static define(){return new $T}}$T.decorations=$T.define(),$T.atomicRanges=$T.define(),$T.scrollMargins=$T.define();let qT=0;const _T=et.define();class GT{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=_T.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(XT.from((t=>({plugin:t,handlers:i})))),n&&r.push($T.decorations.from(n)),new GT(qT++,t,r)}static fromClass(t,e){return GT.define((e=>new t(e)),e)}}const XT=$T.define();class jT{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(IT(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){IT(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){IT(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const UT=et.define(),ZT=et.define(),YT=et.define(),KT=et.define();class JT{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new JT(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new JT(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new JT(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class tD{constructor(t,e,i=DT){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new JT(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var eD=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(eD||(eD={}));const iD=eD.LTR,sD=eD.RTL;function nD(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const rD=nD("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),oD=nD("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),hD=Object.create(null),lD=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);hD[e]=i,hD[i]=-e}const aD=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class cD{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?sD:iD}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const dD=[];function uD(t,e){let i=t.length,s=e==iD?1:2,n=e==iD?2:1;if(!t||1==s&&!aD.test(t))return fD(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?rD[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?oD[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),dD[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=dD[t];if(128==s)t<i-1&&e==dD[t+1]&&24&e?s=dD[t]=e:dD[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==dD[s];)s++;let r=t&&8==e||s<i&&8==dD[s]?1==n?1:8:256;for(let e=t;e<s;e++)dD[e]=r;t=s-1}else 8==s&&1==n&&(dD[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=hD[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(lD[t+1]==-r){let e=lD[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(dD[h]=dD[lD[t]]=i),l=t;break}}else{if(189==lD.length)break;lD[l++]=h,lD[l++]=e,lD[l++]=a}else if(2==(o=dD[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=lD[e+2];if(2&i)break;if(t)lD[e+2]|=2;else{if(4&i)break;lD[e+2]|=4}}}for(let t=0;t<i;t++)if(256==dD[t]){let e=t+1;for(;e<i&&256==dD[e];)e++;let n=1==(t?dD[t-1]:s),r=n==(1==(e<i?dD[e]:s))?n?1:2:s;for(let i=t;i<e;i++)dD[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=dD[t++];for(;t<i&&s==(1!=dD[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=dD[--i];for(;i>e&&s==(2!=dD[i-1]);)i--;o.push(new cD(i,t,s?2:1))}else o.push(new cD(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==dD[t++];for(;t<i&&s==(2==dD[t]);)t++;o.push(new cD(e,t,s?1:2))}return o}function fD(t){return[new cD(0,t,0)]}let pD="";function gD(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=cD.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(pD=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class mD{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=QC.get(s),r=QC.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:wD(s))||wD(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=QC.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function wD(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class vD{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class yD extends QC{constructor(t){super(),this.view=t,this.compositionDeco=vT.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new kT],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new JT(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=vT.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=OD(t);if(!i)return vT.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new mD([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return vT.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return vT.none;let d=QC.get(r);d instanceof oT?d=d.widget.topView:d&&(d.parent=null);return vT.set(vT.replace({widget:new SD(r,o,d)}).range(h,l))}(this.view,t.changes)),(eT.ie||eT.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new kD;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=JT.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=eT.chrome||eT.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof AT&&t.widget instanceof bD&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=MT.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);FC(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||eT.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(eT.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new NC(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&xC(n.node,n.offset,h.anchorNode,h.anchorOffset)&&xC(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{eT.android&&eT.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=yC(this.root);if(s.empty){if(eT.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=xD(n.node,n.offset,1==t?1:-1);e&&(n=new NC(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new NC(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new NC(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=yC(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=kT.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(zT)?this.root.activeElement==this.dom:OC(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=QC.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof kT)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=wT.WidgetBefore&&n.type!=wT.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==wT.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?SC(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==eD.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof kT){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=SC(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new zC(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(vT.replace({widget:new bD(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return vT.set(t)}updateDeco(){let t=this.view.pluginField($T.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(YT),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField($T.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=DC(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==eD.LTR)}}class bD extends mT{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function OD(t){let e=t.observer.selectionRange,i=e.focusNode&&xD(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof kT){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!QC.get(e);)e=e.previousSibling;let n=e?QC.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof kT)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class SD extends mT{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return oT}}function xD(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=MC(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class kD{constructor(){this.changes=[]}compareRange(t,e){xT(t,e,this.changes)}comparePoint(t,e){xT(t,e,this.changes)}}function AD(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function MD(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function CD(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function TD(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function DD(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function RD(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=SC(d);for(let u=0;u<t.length;u++){let f=t[u];n&&CD(n,f)&&(f=TD(DD(f,n.bottom),n.top));let p=AD(e,f),g=MD(i,f);if(0==p&&0==g)return 3==d.nodeType?ED(d,e,i):RD(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&CD(a,f)?a=DD(a,f.bottom):c&&CD(c,f)&&(c=TD(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?ED(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:RD(s,d,i)}function ED(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=LC(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(eT.chrome||eT.gecko){LC(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function BD(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=wT.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:PD(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:PD(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),eT.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return LC(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=kT.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=RD(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function PD(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function LD(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=gD(n,r,t.textDirection,o,i),l=pD;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function VD(t,e,i){let s=t.pluginField($T.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class WD{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in zD){let i=zD[e];t.contentDOM.addEventListener(e,(s=>{ID(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),eT.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(XT);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{ID(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){IT(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){IT(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(eT.android&&eT.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!eT.ios||!(i=ND.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,VC(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(eT.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!eT.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const ND=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],HD=[16,17,18,20,91,92,224,225];class QD{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(RT);return i.length?i[0](e):eT.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(ET);return i.length?i[0](e):eT.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=yC(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=tR(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function ID(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=QC.get(s))&&i.ignoreEvent(e))return!1;return!0}const zD=Object.create(null),FD=eT.ie&&eT.ie_version<15||eT.ios&&eT.webkit_version<604;function $D(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=iR&&s.selection.ranges.every((t=>t.empty))&&iR==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}zD.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():HD.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let qD=0;function _D(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=kT.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}zD.touchstart=(t,e)=>{qD=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},zD.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},zD.mousedown=(t,e)=>{if(t.observer.flush(),qD>Date.now()-2e3&&1==tR(e))return;let i=null;for(let s of t.state.facet(BT))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=UD(t,e),s=tR(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=UD(t,e),o=e),!a||!i)return n;let c=_D(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=_D(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>PC(t.contentDOM))),t.inputState.startMouseSelection(new QD(t,e,i,s))}};let GD=(t,e)=>t>=e.top&&t<=e.bottom,XD=(t,e,i)=>GD(e,i)&&t>=i.left&&t<=i.right;function jD(t,e,i,s){let n=kT.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&XD(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&XD(i,s,h)?1:o&&GD(s,o)?-1:1}function UD(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:jD(t,i,e.clientX,e.clientY)}}const ZD=eT.ie&&eT.ie_version<=11;let YD=null,KD=0,JD=0;function tR(t){if(!ZD)return t.detail;let e=YD,i=JD;return YD=t,JD=Date.now(),KD=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(KD+1)%3:1}function eR(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}zD.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},zD.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&eR(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else eR(t,e,e.dataTransfer.getData("Text"),!0)},zD.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=FD?null:e.clipboardData;i?($D(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),$D(t,i.value)}),50)}(t)};let iR=null;function sR(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}zD.copy=zD.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;iR=n?i:null;let r=FD?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},zD.focus=zD.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},zD.compositionstart=zD.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),sR(t,!0)))},zD.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&sR(t,!1)}),50)},zD.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},zD.beforeinput=(t,e)=>{var i;let s;if(eT.chrome&&eT.android&&(s=ND.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const nR=["pre-wrap","normal","pre-line","break-spaces"];class rR{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=eD.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return nR.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=nR.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class oR{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class hR{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new hR(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new hR(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var lR=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(lR||(lR={}));class aR{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return aR.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,lR.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,lR.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,lR.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=gR.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new dR(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new fR(aR.of(t.slice(0,e)),r,aR.of(t.slice(i)))}}aR.prototype.size=1;class cR extends aR{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new hR(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class dR extends cR{constructor(t,e){super(t,e,wT.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof dR||s instanceof uR&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof uR?s=new dR(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):aR.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class uR extends aR{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new hR(l,a,i+o*h,o,wT.Text)}lineAt(t,e,i,s,n){if(e==lR.ByHeight)return this.blockAt(t,i,s,n);if(e==lR.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new hR(e,s-e,0,0,wT.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new hR(h,l,s+o*(a-r),o,wT.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new hR(e.from,e.length,s,h,wT.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof uR?i[i.length-1]=new uR(t.length+s):i.push(null,new uR(s-1))}if(t>0){let e=i[0];e instanceof uR?i[0]=new uR(t+e.length):i.unshift(new uR(t-1),null)}return aR.of(i)}decomposeLeft(t,e){e.push(new uR(t-1),null)}decomposeRight(t,e){e.push(null,new uR(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new uR(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new dR(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new uR(n-r).updateHeight(t,r));let l=aR.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class fR extends aR{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==lR.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==lR.ByPosNoHeight?lR.ByPosNoHeight:lR.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,lR.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&pR(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),pR(n,t)}return aR.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?aR.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function pR(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof uR&&(s=t[e+1])instanceof uR&&t.splice(e-1,3,new uR(i.length+1+s.length))}class gR{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof dR?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new dR(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new cR(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new dR(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new uR(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof dR)return t;let e=new dR(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=wT.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=wT.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof dR||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new dR(0,-1));let i=t;for(let t of this.nodes)t instanceof dR&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new gR(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class mR{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&xT(t,e,this.changes,5)}}function wR(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function vR(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class yR{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return vT.replace({widget:new bR(this.size,t)}).range(this.from,this.to)}}class bR extends mT{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class OR{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new rR,this.scaler=TR,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=aR.empty().applyChanges(t.facet(YT),E.empty,this.heightOracle.setDoc(t.doc),[new JT(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=vT.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new SR(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?TR:new DR(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:RR(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(YT),n=t.changedRanges,r=JT.extendWithRanges(n,function(t,e,i){let s=new mR;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(YT),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?eD.RTL:eD.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?vR:wR)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new oR(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new SR(s.lineAt(r-1e3*i,lR.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),lR.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,lR.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new SR(s.lineAt(i-500,lR.ByHeight,n,0,0).from,s.lineAt(i+r+500,lR.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new SR(this.heightMap.lineAt(i,lR.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,lR.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,lR.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,lR.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new yR(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=eD.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=xR(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=kR(r,(this.visibleTop-i.top-t)/i.height),n=kR(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=kR(r,(this.pixelViewport.left-e)/t),n=kR(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&MR(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&MR(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(CR(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new yR(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=AR(s,i)-AR(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){yR.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=vT.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(YT);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||RR(this.heightMap.lineAt(t,lR.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return RR(this.heightMap.lineAt(this.scaler.fromDOM(t),lR.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return RR(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class SR{constructor(t,e){this.from=t,this.to=e}}function xR(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(YT),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function kR({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function AR(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function MR(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function CR(t,e){for(let i of t)if(e(i))return i}const TR={toDOM:t=>t,fromDOM:t=>t,scale:1};class DR{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,lR.ByPos,t,0,0).top,o=e.lineAt(n,lR.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function RR(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new hR(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>RR(t,e))):t.type)}const ER=et.define({combine:t=>t.join(" ")}),BR=et.define({combine:t=>t.indexOf(!0)>-1}),PR=jt.newName(),LR=jt.newName(),VR=jt.newName(),WR={"&light":"."+LR,"&dark":"."+VR};function NR(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const HR=NR("."+PR,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},WR),QR={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},IR=eT.ie&&eT.ie_version<=11;class zR{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new RC,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(eT.ie&&eT.ie_version<=11||eT.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),IR&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(zT)?e.root.activeElement!=this.dom:!OC(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((eT.ie&&eT.ie_version<=11||eT.android&&eT.chrome)&&!e.state.selection.main.empty&&i.focusNode&&xC(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=yC(t),i=eT.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);xC(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,QR),IR&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),IR&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;VC(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&OC(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=FR(e,t.previousSibling||t.target.previousSibling,-1),s=FR(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function FR(t,e,i){for(;e;){let s=QC.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function $R(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new vD(i,s)),n==i&&r==s||e.push(new vD(n,r)));return e}(t),c=new mD(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||eT.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(eT.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(zT)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!bC(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!bC(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(eT.ios&&t.inputState.flushIOSKey(t))return;if(eT.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&VC(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&VC(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&VC(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(VT).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=OD(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class qR{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new OR(t.state||$t.create()),this.plugins=this.state.facet(_T).map((t=>new jT(t)));for(let t of this.plugins)t.update(this);this.observer=new zR(this,((t,e,i)=>{$R(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new WD(this),this.docView=new yD(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new tD(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new HT(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(WT)?n=new HT(t.value):t.is(NT)?n=new HT(t.value,"center"):t.is(QT)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=jR.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(KT)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(ER)!=e.state.facet(ER)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(LT))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new OR(t),this.plugins=t.facet(_T).map((t=>new jT(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new yD(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(_T),i=t.state.facet(_T);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new jT(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return IT(this.state,t),XR}})),o=new tD(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=XR)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){IT(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(LT))t(e)}get themeClasses(){return PR+" "+(this.state.facet(BR)?VR:LR)+" "+this.state.facet(ER)}updateAttrs(){let t=UR(this,UT,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(zT)?"true":"false",class:"cm-content",style:`${eT.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),UR(this,ZT,e),this.observer.ignore((()=>{gT(this.contentDOM,this.contentAttrs,e),gT(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(qR.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(KT),jt.mount(this.root,this.styleModules.concat(HR).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=GR(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=GR(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=GR(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return VD(this,t,LD(this,t,e,i))}moveByGroup(t,e){return VD(this,t,LD(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==eD.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=kT.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return VD(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=BD(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:WT.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),BD(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return TC(i,n[cD.find(n,t-s.from,-1,e)].dir==eD.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>_R)return fD(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=uD(t.text,this.textDirection);return this.bidiCache.push(new jR(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||eT.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{PC(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return QT.of(new HT("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return GT.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[ER.of(i),KT.of(NR(`.${i}`,t))];return e&&e.dark&&s.push(BR.of(!0)),s}static baseTheme(t){return pt.lowest(KT.of(NR("."+PR,t,WR)))}}qR.scrollTo=WT,qR.centerOn=NT,qR.styleModule=KT,qR.inputHandler=VT,qR.exceptionSink=PT,qR.updateListener=LT,qR.editable=zT,qR.mouseSelectionStyle=BT,qR.dragMovesSelection=ET,qR.clickAddsSelectionRange=RT,qR.decorations=YT,qR.darkTheme=BR,qR.contentAttributes=ZT,qR.editorAttributes=UT,qR.lineWrapping=qR.contentAttributes.of({class:"cm-lineWrapping"}),qR.announce=Et.define();const _R=4096;function GR(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const XR={};class jR{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:eD.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new jR(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function UR(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&fT(r,i)}return i}const ZR=!eT.ios;const YR={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};ZR&&(YR[".cm-line"].caretColor="transparent !important");const KR={brackets:["(","[","{","'",'"'],before:")]}:;>"},JR=Et.define({map(t,e){let i=e.mapPos(t,-1,z.TrackAfter);return null==i?void 0:i}}),tE=Et.define({map:(t,e)=>e.mapPos(t)}),eE=new class extends Yt{};eE.startSide=1,eE.endSide=-1;const iE=ht.define({create:()=>ee.empty,update(t,e){if(e.selection){let i=e.state.doc.lineAt(e.selection.main.head).from,s=e.startState.doc.lineAt(e.startState.selection.main.head).from;i!=e.changes.mapPos(s,-1)&&(t=ee.empty)}t=t.map(e.changes);for(let i of e.effects)i.is(JR)?t=t.update({add:[eE.range(i.value,i.value+1)]}):i.is(tE)&&(t=t.update({filter:t=>t!=i.value}));return t}});function sE(){return[hE,iE]}function nE(t){for(let e=0;e<"()[]{}<>".length;e+=2)if("()[]{}<>".charCodeAt(e)==t)return"()[]{}<>".charAt(e+1);return C(t<128?t:t+1)}function rE(t,e){return t.languageDataAt("closeBrackets",e)[0]||KR}const oE="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),hE=qR.inputHandler.of(((t,e,i,s)=>{if((oE?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let n=t.state.selection.main;if(s.length>2||2==s.length&&1==T(M(s,0))||e!=n.from||i!=n.to)return!1;let r=function(t,e){let i=rE(t,t.selection.main.head),s=i.brackets||KR.brackets;for(let n of s){let r=nE(M(n,0));if(e==n)return r==n?fE(t,n,s.indexOf(n+n+n)>-1):dE(t,n,r,i.before||KR.before);if(e==r&&aE(t,t.selection.main.from))return uE(t,n,r)}return null}(t.state,s);return!!r&&(t.dispatch(r),!0)})),lE=[{key:"Backspace",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=rE(t,t.selection.main.head).brackets||KR.brackets,s=null,n=t.changeByRange((e=>{if(e.empty){let s=function(t,e){let i=t.sliceString(e-2,e);return T(M(i,0))==i.length?i:i.slice(1)}(t.doc,e.head);for(let n of i)if(n==s&&cE(t.doc,e.head)==nE(M(n,0)))return{changes:{from:e.head-n.length,to:e.head+n.length},range:Y.cursor(e.head-n.length),userEvent:"delete.backward"}}return{range:s=e}}));return s||e(t.update(n,{scrollIntoView:!0})),!s}}];function aE(t,e){let i=!1;return t.field(iE).between(0,t.doc.length,(t=>{t==e&&(i=!0)})),i}function cE(t,e){let i=t.sliceString(e,e+2);return i.slice(0,T(M(i,0)))}function dE(t,e,i,s){let n=null,r=t.changeByRange((r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:i,from:r.to}],effects:JR.of(r.to+e.length),range:Y.range(r.anchor+e.length,r.head+e.length)};let o=cE(t.doc,r.head);return!o||/\s/.test(o)||s.indexOf(o)>-1?{changes:{insert:e+i,from:r.head},effects:JR.of(r.head+e.length),range:Y.cursor(r.head+e.length)}:{range:n=r}}));return n?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function uE(t,e,i){let s=null,n=t.selection.ranges.map((e=>e.empty&&cE(t.doc,e.head)==i?Y.cursor(e.head+i.length):s=e));return s?null:t.update({selection:Y.create(n,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map((({from:t})=>tE.of(t)))})}function fE(t,e,i){let s=null,n=t.changeByRange((n=>{if(!n.empty)return{changes:[{insert:e,from:n.from},{insert:e,from:n.to}],effects:JR.of(n.to+e.length),range:Y.range(n.anchor+e.length,n.head+e.length)};let r=n.head,o=cE(t.doc,r);if(o==e){if(pE(t,r))return{changes:{insert:e+e,from:r},effects:JR.of(r+e.length),range:Y.cursor(r+e.length)};if(aE(t,r)){let s=i&&t.sliceDoc(r,r+3*e.length)==e+e+e;return{range:Y.cursor(r+e.length*(s?3:1)),effects:tE.of(r)}}}else{if(i&&t.sliceDoc(r-2*e.length,r)==e+e&&pE(t,r-2*e.length))return{changes:{insert:e+e+e+e,from:r},effects:JR.of(r+e.length),range:Y.cursor(r+e.length)};if(t.charCategorizer(r)(o)!=Qt.Word){let i=t.sliceDoc(r-1,r);if(i!=e&&t.charCategorizer(r)(i)!=Qt.Word&&!function(t,e,i){let s=Bw(t).resolveInner(e,-1);for(let n=0;n<5;n++){if(t.sliceDoc(s.from,s.from+i.length)==i)return!0;let n=s.to==e&&s.parent;if(!n)break;s=n}return!1}(t,r,e))return{changes:{insert:e+e,from:r},effects:JR.of(r+e.length),range:Y.cursor(r+e.length)}}}return{range:s=n}}));return s?null:t.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function pE(t,e){let i=Bw(t).resolveInner(e+1);return i.parent&&i.from==e}function gE(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function mE(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function wE(t,e){if(!e.anchorNode)return!1;try{return mE(t,e.anchorNode)}catch(t){return!1}}function vE(t){return 3==t.nodeType?RE(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function yE(t,e,i,s){return!!i&&(OE(t,e,i,s,-1)||OE(t,e,i,s,1))}function bE(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function OE(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:SE(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=bE(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?SE(t):0}}}function SE(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const xE={left:0,right:0,top:0,bottom:0};function kE(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function AE(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class ME{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let CE,TE=null;function DE(t){if(t.setActive)return t.setActive();if(TE)return t.focus(TE);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==TE?{get preventScroll(){return TE={preventScroll:!0},!0}}:void 0),!TE){TE=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function RE(t,e,i=e){let s=CE||(CE=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function EE(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function BE(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class PE{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new PE(t.parentNode,bE(t),e)}static after(t,e){return new PE(t.parentNode,bE(t)+1,e)}}const LE=[];class VE{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=VE.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=WE(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=WE(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==SE(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!VE.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=LE){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new NE(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function WE(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}VE.prototype.breakAfter=0;class NE{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function HE(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function QE(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,HE(t,a,c,h,l,s,0,n,r)}let IE="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},zE="undefined"!=typeof document?document:{documentElement:{style:{}}};const FE=/Edge\/(\d+)/.exec(IE.userAgent),$E=/MSIE \d/.test(IE.userAgent),qE=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(IE.userAgent),_E=!!($E||qE||FE),GE=!_E&&/gecko\/(\d+)/i.test(IE.userAgent),XE=!_E&&/Chrome\/(\d+)/.exec(IE.userAgent),jE="webkitFontSmoothing"in zE.documentElement.style,UE=!_E&&/Apple Computer/.test(IE.vendor),ZE=UE&&(/Mobile\/\w+/.test(IE.userAgent)||IE.maxTouchPoints>2);var YE={mac:ZE||/Mac/.test(IE.platform),windows:/Win/.test(IE.platform),linux:/Linux|X11/.test(IE.platform),ie:_E,ie_version:$E?zE.documentMode||6:qE?+qE[1]:FE?+FE[1]:0,gecko:GE,gecko_version:GE?+(/Firefox\/(\d+)/.exec(IE.userAgent)||[0,0])[1]:0,chrome:!!XE,chrome_version:XE?+XE[1]:0,ios:ZE,android:/Android\b/.test(IE.userAgent),webkit:jE,safari:UE,webkit_version:jE?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=zE.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class KE extends VE{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof KE&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new KE(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new PE(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return tB(this.dom,t,e)}}class JE extends VE{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(BE(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof JE&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(QE(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new JE(this.mark,e,r)}domAtPos(t){return oB(this.dom,this.children,t)}coordsAt(t,e){return lB(this,t,e)}}function tB(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?YE.chrome||YE.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=RE(t,n,r).getClientRects();if(!h.length)return xE;let l=h[(o?o<0:i>=0)?0:h.length-1];return YE.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?kE(l,o<0):l||null}class eB extends VE{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||eB)(t,e,i)}split(t){let e=eB.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof eB&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof eB&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?PE.before(this.dom):PE.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return xE;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:kE(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class iB extends eB{domAtPos(t){let{topView:e,text:i}=this.widget;return e?sB(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new PE(i,Math.min(t,i.nodeValue.length)))):new PE(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?nB(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?sB(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>tB(s,t,e))):tB(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function sB(t,e,i,s,n,r){if(i instanceof JE){for(let o of i.children){let i=mE(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?sB(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function nB(t,e,i,s){if(i instanceof JE)for(let n of i.children){let i=0,r=mE(n.dom,s);if(mE(n.dom,t))return i+(r?nB(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class rB extends VE{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof rB&&t.side==this.side}split(){return new rB(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return PE.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof KE){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof JE&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function oB(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return PE.after(i)}return new PE(t,0)}function hB(t,e,i){let s,{children:n}=t;i>0&&e instanceof JE&&n.length&&(s=n[n.length-1])instanceof JE&&s.mark.eq(e.mark)?hB(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function lB(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?kE(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=vE(s);return n[n.length-1]||null}function aB(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function cB(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function dB(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}KE.prototype.children=eB.prototype.children=rB.prototype.children=LE;class uB{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var fB=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(fB||(fB={}));class pB extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new gB(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new wB(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=vB(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new wB(t,e,i,s,t.widget||null,!0)}static line(t){return new mB(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}pB.none=ee.empty;class gB extends pB{constructor(t){let{start:e,end:i}=vB(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof gB&&this.tagName==t.tagName&&this.class==t.class&&cB(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}gB.prototype.point=!1;class mB extends pB{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof mB&&cB(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}mB.prototype.mapMode=z.TrackBefore,mB.prototype.point=!0;class wB extends pB{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?fB.WidgetRange:this.startSide<=0?fB.WidgetBefore:fB.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof wB&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function vB(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function yB(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}wB.prototype.point=!0;class bB extends VE{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof bB))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),QE(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new bB;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){cB(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){hB(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=aB(e,this.attrs||{})),i&&(this.attrs=aB({class:i},this.attrs||{}))}domAtPos(t){return oB(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(BE(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(dB(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&VE.get(i)instanceof JE;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=VE.get(i))||void 0===e?void 0:e.isEditable)||YE.ios&&this.children.some((t=>t instanceof KE))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof KE))return null;let i=vE(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return lB(this,t,e)}become(t){return!1}get type(){return fB.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof bB)return n;if(r>e)break}s=r+n.breakAfter}return null}}class OB extends VE{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof OB&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?PE.before(this.dom):PE.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new OB(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return LE}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof OB&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class SB{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof OB&&t.type==fB.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new bB),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(xB(new rB(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(xB(new KE(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof wB)if(i.block){let{type:t}=i;t!=fB.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new OB(i.widget||new kB("div"),r,t))}else{let o=eB.create(i.widget||new kB("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(xB(new rB(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(xB(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof wB){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new SB(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function xB(t,e){for(let i of e)t=new JE(i,[t],t.length);return t}class kB extends uB{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const AB=[],MB=et.define(),CB=et.define(),TB=et.define(),DB=et.define(),RB=et.define(),EB=et.define(),BB=Et.define({map:(t,e)=>t.map(e)}),PB=Et.define({map:(t,e)=>t.map(e)});class LB{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new LB(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const VB=Et.define({map:(t,e)=>t.map(e)});function WB(t,e,i){let s=t.facet(DB);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const NB=et.define({combine:t=>!t.length||t[0]});class HB{constructor(t,e){this.field=t,this.get=e}}class QB{from(t){return new HB(this,t)}static define(){return new QB}}QB.decorations=QB.define(),QB.atomicRanges=QB.define(),QB.scrollMargins=QB.define();let IB=0;const zB=et.define();class FB{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=zB.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push($B.from((t=>({plugin:t,handlers:i})))),n&&r.push(QB.decorations.from(n)),new FB(IB++,t,r)}static fromClass(t,e){return FB.define((e=>new t(e)),e)}}const $B=QB.define();class qB{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(WB(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){WB(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){WB(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const _B=et.define(),GB=et.define(),XB=et.define(),jB=et.define();class UB{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new UB(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new UB(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new UB(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class ZB{constructor(t,e,i=AB){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new UB(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var YB=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(YB||(YB={}));const KB=YB.LTR,JB=YB.RTL;function tP(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const eP=tP("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),iP=tP("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),sP=Object.create(null),nP=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);sP[e]=i,sP[i]=-e}const rP=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class oP{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?JB:KB}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const hP=[];function lP(t,e){let i=t.length,s=e==KB?1:2,n=e==KB?2:1;if(!t||1==s&&!rP.test(t))return aP(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?eP[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?iP[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),hP[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=hP[t];if(128==s)t<i-1&&e==hP[t+1]&&24&e?s=hP[t]=e:hP[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==hP[s];)s++;let r=t&&8==e||s<i&&8==hP[s]?1==n?1:8:256;for(let e=t;e<s;e++)hP[e]=r;t=s-1}else 8==s&&1==n&&(hP[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=sP[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(nP[t+1]==-r){let e=nP[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(hP[h]=hP[nP[t]]=i),l=t;break}}else{if(189==nP.length)break;nP[l++]=h,nP[l++]=e,nP[l++]=a}else if(2==(o=hP[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=nP[e+2];if(2&i)break;if(t)nP[e+2]|=2;else{if(4&i)break;nP[e+2]|=4}}}for(let t=0;t<i;t++)if(256==hP[t]){let e=t+1;for(;e<i&&256==hP[e];)e++;let n=1==(t?hP[t-1]:s),r=n==(1==(e<i?hP[e]:s))?n?1:2:s;for(let i=t;i<e;i++)hP[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=hP[t++];for(;t<i&&s==(1!=hP[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=hP[--i];for(;i>e&&s==(2!=hP[i-1]);)i--;o.push(new oP(i,t,s?2:1))}else o.push(new oP(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==hP[t++];for(;t<i&&s==(2==hP[t]);)t++;o.push(new oP(e,t,s?1:2))}return o}function aP(t){return[new oP(0,t,0)]}let cP="";function dP(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=oP.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(cP=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class uP{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=VE.get(s),r=VE.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:fP(s))||fP(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=VE.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function fP(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class pP{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class gP extends VE{constructor(t){super(),this.view=t,this.compositionDeco=pB.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new bB],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new UB(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=pB.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=wP(t);if(!i)return pB.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new uP([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return pB.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return pB.none;let d=VE.get(r);d instanceof iB?d=d.widget.topView:d&&(d.parent=null);return pB.set(pB.replace({widget:new vP(r,o,d)}).range(h,l))}(this.view,t.changes)),(YE.ie||YE.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new bP;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=UB.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=YE.chrome||YE.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof OB&&t.widget instanceof mP&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=SB.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);HE(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||YE.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(YE.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new PE(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&yE(n.node,n.offset,h.anchorNode,h.anchorOffset)&&yE(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{YE.android&&YE.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=gE(this.root);if(s.empty){if(YE.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=yP(n.node,n.offset,1==t?1:-1);e&&(n=new PE(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new PE(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new PE(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=gE(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=bB.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(NB)?this.root.activeElement==this.dom:wE(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=VE.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof bB)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=fB.WidgetBefore&&n.type!=fB.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==fB.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?vE(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==YB.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof bB){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=vE(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new NE(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(pB.replace({widget:new mP(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return pB.set(t)}updateDeco(){let t=this.view.pluginField(QB.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(XB),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(QB.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=AE(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==YB.LTR)}}class mP extends uB{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function wP(t){let e=t.observer.selectionRange,i=e.focusNode&&yP(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof bB){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!VE.get(e);)e=e.previousSibling;let n=e?VE.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof bB)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class vP extends uB{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return iB}}function yP(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=SE(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class bP{constructor(){this.changes=[]}compareRange(t,e){yB(t,e,this.changes)}comparePoint(t,e){yB(t,e,this.changes)}}function OP(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function SP(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function xP(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function kP(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function AP(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function MP(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=vE(d);for(let u=0;u<t.length;u++){let f=t[u];n&&xP(n,f)&&(f=kP(AP(f,n.bottom),n.top));let p=OP(e,f),g=SP(i,f);if(0==p&&0==g)return 3==d.nodeType?CP(d,e,i):MP(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&xP(a,f)?a=AP(a,f.bottom):c&&xP(c,f)&&(c=kP(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?CP(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:MP(s,d,i)}function CP(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=RE(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(YE.chrome||YE.gecko){RE(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function TP(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=fB.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:DP(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:DP(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),YE.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return RE(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=bB.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=MP(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function DP(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function RP(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=dP(n,r,t.textDirection,o,i),l=cP;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function EP(t,e,i){let s=t.pluginField(QB.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class BP{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in NP){let i=NP[e];t.contentDOM.addEventListener(e,(s=>{WP(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),YE.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField($B);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{WP(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){WB(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){WB(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(YE.android&&YE.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!YE.ios||!(i=PP.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,EE(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(YE.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!YE.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const PP=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],LP=[16,17,18,20,91,92,224,225];class VP{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(MB);return i.length?i[0](e):YE.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(CB);return i.length?i[0](e):YE.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=gE(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=ZP(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function WP(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=VE.get(s))&&i.ignoreEvent(e))return!1;return!0}const NP=Object.create(null),HP=YE.ie&&YE.ie_version<15||YE.ios&&YE.webkit_version<604;function QP(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=KP&&s.selection.ranges.every((t=>t.empty))&&KP==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}NP.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():LP.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let IP=0;function zP(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=bB.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}NP.touchstart=(t,e)=>{IP=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},NP.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},NP.mousedown=(t,e)=>{if(t.observer.flush(),IP>Date.now()-2e3&&1==ZP(e))return;let i=null;for(let s of t.state.facet(TB))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=_P(t,e),s=ZP(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=_P(t,e),o=e),!a||!i)return n;let c=zP(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=zP(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>DE(t.contentDOM))),t.inputState.startMouseSelection(new VP(t,e,i,s))}};let FP=(t,e)=>t>=e.top&&t<=e.bottom,$P=(t,e,i)=>FP(e,i)&&t>=i.left&&t<=i.right;function qP(t,e,i,s){let n=bB.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&$P(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&$P(i,s,h)?1:o&&FP(s,o)?-1:1}function _P(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:qP(t,i,e.clientX,e.clientY)}}const GP=YE.ie&&YE.ie_version<=11;let XP=null,jP=0,UP=0;function ZP(t){if(!GP)return t.detail;let e=XP,i=UP;return XP=t,UP=Date.now(),jP=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(jP+1)%3:1}function YP(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}NP.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},NP.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&YP(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else YP(t,e,e.dataTransfer.getData("Text"),!0)},NP.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=HP?null:e.clipboardData;i?(QP(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),QP(t,i.value)}),50)}(t)};let KP=null;function JP(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}NP.copy=NP.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;KP=n?i:null;let r=HP?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},NP.focus=NP.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},NP.compositionstart=NP.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),JP(t,!0)))},NP.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&JP(t,!1)}),50)},NP.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},NP.beforeinput=(t,e)=>{var i;let s;if(YE.chrome&&YE.android&&(s=PP.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const tL=["pre-wrap","normal","pre-line","break-spaces"];class eL{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=YB.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return tL.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=tL.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class iL{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class sL{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new sL(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new sL(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var nL=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(nL||(nL={}));class rL{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return rL.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,nL.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,nL.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,nL.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=dL.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new hL(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new aL(rL.of(t.slice(0,e)),r,rL.of(t.slice(i)))}}rL.prototype.size=1;class oL extends rL{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new sL(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class hL extends oL{constructor(t,e){super(t,e,fB.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof hL||s instanceof lL&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof lL?s=new hL(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):rL.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class lL extends rL{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new sL(l,a,i+o*h,o,fB.Text)}lineAt(t,e,i,s,n){if(e==nL.ByHeight)return this.blockAt(t,i,s,n);if(e==nL.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new sL(e,s-e,0,0,fB.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new sL(h,l,s+o*(a-r),o,fB.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new sL(e.from,e.length,s,h,fB.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof lL?i[i.length-1]=new lL(t.length+s):i.push(null,new lL(s-1))}if(t>0){let e=i[0];e instanceof lL?i[0]=new lL(t+e.length):i.unshift(new lL(t-1),null)}return rL.of(i)}decomposeLeft(t,e){e.push(new lL(t-1),null)}decomposeRight(t,e){e.push(null,new lL(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new lL(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new hL(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new lL(n-r).updateHeight(t,r));let l=rL.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class aL extends rL{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==nL.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==nL.ByPosNoHeight?nL.ByPosNoHeight:nL.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,nL.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&cL(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),cL(n,t)}return rL.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?rL.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function cL(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof lL&&(s=t[e+1])instanceof lL&&t.splice(e-1,3,new lL(i.length+1+s.length))}class dL{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof hL?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new hL(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new oL(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new hL(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new lL(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof hL)return t;let e=new hL(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=fB.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=fB.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof hL||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new hL(0,-1));let i=t;for(let t of this.nodes)t instanceof hL&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new dL(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class uL{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&yB(t,e,this.changes,5)}}function fL(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function pL(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class gL{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return pB.replace({widget:new mL(this.size,t)}).range(this.from,this.to)}}class mL extends uB{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class wL{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new eL,this.scaler=kL,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=rL.empty().applyChanges(t.facet(XB),E.empty,this.heightOracle.setDoc(t.doc),[new UB(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=pB.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new vL(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?kL:new AL(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:ML(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(XB),n=t.changedRanges,r=UB.extendWithRanges(n,function(t,e,i){let s=new uL;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(XB),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?YB.RTL:YB.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?pL:fL)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new iL(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new vL(s.lineAt(r-1e3*i,nL.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),nL.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,nL.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new vL(s.lineAt(i-500,nL.ByHeight,n,0,0).from,s.lineAt(i+r+500,nL.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new vL(this.heightMap.lineAt(i,nL.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,nL.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,nL.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,nL.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new gL(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=YB.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=yL(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=bL(r,(this.visibleTop-i.top-t)/i.height),n=bL(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=bL(r,(this.pixelViewport.left-e)/t),n=bL(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&SL(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&SL(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(xL(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new gL(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=OL(s,i)-OL(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){gL.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=pB.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(XB);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||ML(this.heightMap.lineAt(t,nL.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return ML(this.heightMap.lineAt(this.scaler.fromDOM(t),nL.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return ML(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class vL{constructor(t,e){this.from=t,this.to=e}}function yL(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(XB),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function bL({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function OL(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function SL(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function xL(t,e){for(let i of t)if(e(i))return i}const kL={toDOM:t=>t,fromDOM:t=>t,scale:1};class AL{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,nL.ByPos,t,0,0).top,o=e.lineAt(n,nL.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function ML(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new sL(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>ML(t,e))):t.type)}const CL=et.define({combine:t=>t.join(" ")}),TL=et.define({combine:t=>t.indexOf(!0)>-1}),DL=jt.newName(),RL=jt.newName(),EL=jt.newName(),BL={"&light":"."+RL,"&dark":"."+EL};function PL(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const LL=PL("."+DL,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},BL),VL={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},WL=YE.ie&&YE.ie_version<=11;class NL{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new ME,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(YE.ie&&YE.ie_version<=11||YE.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),WL&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(NB)?e.root.activeElement!=this.dom:!wE(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((YE.ie&&YE.ie_version<=11||YE.android&&YE.chrome)&&!e.state.selection.main.empty&&i.focusNode&&yE(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=gE(t),i=YE.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);yE(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,VL),WL&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),WL&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;EE(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&wE(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=HL(e,t.previousSibling||t.target.previousSibling,-1),s=HL(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function HL(t,e,i){for(;e;){let s=VE.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function QL(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new pP(i,s)),n==i&&r==s||e.push(new pP(n,r)));return e}(t),c=new uP(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||YE.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(YE.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(NB)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!mE(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!mE(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(YE.ios&&t.inputState.flushIOSKey(t))return;if(YE.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&EE(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&EE(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&EE(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(EB).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=wP(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class IL{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new wL(t.state||$t.create()),this.plugins=this.state.facet(zB).map((t=>new qB(t)));for(let t of this.plugins)t.update(this);this.observer=new NL(this,((t,e,i)=>{QL(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new BP(this),this.docView=new gP(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new ZB(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new LB(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(BB)?n=new LB(t.value):t.is(PB)?n=new LB(t.value,"center"):t.is(VB)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=qL.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(jB)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(CL)!=e.state.facet(CL)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(RB))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new wL(t),this.plugins=t.facet(zB).map((t=>new qB(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new gP(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(zB),i=t.state.facet(zB);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new qB(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return WB(this.state,t),$L}})),o=new ZB(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=$L)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){WB(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(RB))t(e)}get themeClasses(){return DL+" "+(this.state.facet(TL)?EL:RL)+" "+this.state.facet(CL)}updateAttrs(){let t=_L(this,_B,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(NB)?"true":"false",class:"cm-content",style:`${YE.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),_L(this,GB,e),this.observer.ignore((()=>{dB(this.contentDOM,this.contentAttrs,e),dB(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(IL.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(jB),jt.mount(this.root,this.styleModules.concat(LL).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=FL(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=FL(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=FL(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return EP(this,t,RP(this,t,e,i))}moveByGroup(t,e){return EP(this,t,RP(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==YB.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=bB.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return EP(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=TP(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:BB.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),TP(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return kE(i,n[oP.find(n,t-s.from,-1,e)].dir==YB.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>zL)return aP(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=lP(t.text,this.textDirection);return this.bidiCache.push(new qL(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||YE.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{DE(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return VB.of(new LB("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return FB.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[CL.of(i),jB.of(PL(`.${i}`,t))];return e&&e.dark&&s.push(TL.of(!0)),s}static baseTheme(t){return pt.lowest(jB.of(PL("."+DL,t,BL)))}}IL.scrollTo=BB,IL.centerOn=PB,IL.styleModule=jB,IL.inputHandler=EB,IL.exceptionSink=DB,IL.updateListener=RB,IL.editable=NB,IL.mouseSelectionStyle=TB,IL.dragMovesSelection=CB,IL.clickAddsSelectionRange=MB,IL.decorations=XB,IL.darkTheme=TL,IL.contentAttributes=GB,IL.editorAttributes=_B,IL.lineWrapping=IL.contentAttributes.of({class:"cm-lineWrapping"}),IL.announce=Et.define();const zL=4096;function FL(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const $L={};class qL{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:YB.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new qL(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function _L(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&aB(r,i)}return i}const GL=YE.mac?"mac":YE.windows?"win":YE.linux?"linux":"key";function XL(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const jL=IL.domEventHandlers({keydown:(t,e)=>JL(YL(e.state),t,e,"editor")}),UL=et.define({enables:jL}),ZL=new WeakMap;function YL(t){let e=t.facet(UL),i=ZL.get(e);return i||ZL.set(e,i=function(t,e=GL){let i=Object.create(null),s=Object.create(null),n=(t,e)=>{let i=s[t];if(null==i)s[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,s,r,o)=>{let h=i[t]||(i[t]=Object.create(null)),l=s.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let s,n,r,o,h=i[i.length-1];"Space"==h&&(h=" ");for(let t=0;t<i.length-1;++t){const h=i[t];if(/^(cmd|meta|m)$/i.test(h))o=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))r=!0;else{if(!/^mod$/i.test(h))throw new Error("Unrecognized modifier name: "+h);"mac"==e?o=!0:n=!0}}return s&&(h="Alt-"+h),n&&(h="Ctrl-"+h),o&&(h="Meta-"+h),r&&(h="Shift-"+h),h}(t,e)));for(let e=1;e<l.length;e++){let i=l.slice(0,e).join(" ");n(i,!0),h[i]||(h[i]={preventDefault:!0,commands:[e=>{let s=KL={view:e,prefix:i,scope:t};return setTimeout((()=>{KL==s&&(KL=null)}),4e3),!0}]})}let a=l.join(" ");n(a,!1);let c=h[a]||(h[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let KL=null;function JL(t,e,i,s){let n=xe(e),r=1==n.length&&" "!=n,o="",h=!1;KL&&KL.view==i&&KL.scope==s&&(o=KL.prefix+" ",(h=LP.indexOf(e.keyCode)<0)&&(KL=null));let l,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(h=!0)}return!1},c=t[s];if(c){if(a(c[o+XL(n,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(l=fe[e.keyCode])&&l!=n){if(a(c[o+XL(l,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+XL(n,e,!0)]))return!0}return h}const tV=!YE.ios;const eV={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};tV&&(eV[".cm-line"].caretColor="transparent !important");function iV(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function sV(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function nV(t,e){if(!e.anchorNode)return!1;try{return sV(t,e.anchorNode)}catch(t){return!1}}function rV(t){return 3==t.nodeType?wV(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function oV(t,e,i,s){return!!i&&(lV(t,e,i,s,-1)||lV(t,e,i,s,1))}function hV(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function lV(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:aV(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=hV(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?aV(t):0}}}function aV(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const cV={left:0,right:0,top:0,bottom:0};function dV(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function uV(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class fV{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let pV,gV=null;function mV(t){if(t.setActive)return t.setActive();if(gV)return t.focus(gV);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==gV?{get preventScroll(){return gV={preventScroll:!0},!0}}:void 0),!gV){gV=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function wV(t,e,i=e){let s=pV||(pV=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function vV(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function yV(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class bV{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new bV(t.parentNode,hV(t),e)}static after(t,e){return new bV(t.parentNode,hV(t)+1,e)}}const OV=[];class SV{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=SV.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=xV(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=xV(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==aV(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!SV.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=OV){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new kV(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function xV(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}SV.prototype.breakAfter=0;class kV{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function AV(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function MV(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,AV(t,a,c,h,l,s,0,n,r)}let CV="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},TV="undefined"!=typeof document?document:{documentElement:{style:{}}};const DV=/Edge\/(\d+)/.exec(CV.userAgent),RV=/MSIE \d/.test(CV.userAgent),EV=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(CV.userAgent),BV=!!(RV||EV||DV),PV=!BV&&/gecko\/(\d+)/i.test(CV.userAgent),LV=!BV&&/Chrome\/(\d+)/.exec(CV.userAgent),VV="webkitFontSmoothing"in TV.documentElement.style,WV=!BV&&/Apple Computer/.test(CV.vendor),NV=WV&&(/Mobile\/\w+/.test(CV.userAgent)||CV.maxTouchPoints>2);var HV={mac:NV||/Mac/.test(CV.platform),windows:/Win/.test(CV.platform),linux:/Linux|X11/.test(CV.platform),ie:BV,ie_version:RV?TV.documentMode||6:EV?+EV[1]:DV?+DV[1]:0,gecko:PV,gecko_version:PV?+(/Firefox\/(\d+)/.exec(CV.userAgent)||[0,0])[1]:0,chrome:!!LV,chrome_version:LV?+LV[1]:0,ios:NV,android:/Android\b/.test(CV.userAgent),webkit:VV,safari:WV,webkit_version:VV?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=TV.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class QV extends SV{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof QV&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new QV(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new bV(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return zV(this.dom,t,e)}}class IV extends SV{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(yV(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof IV&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(MV(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new IV(this.mark,e,r)}domAtPos(t){return XV(this.dom,this.children,t)}coordsAt(t,e){return UV(this,t,e)}}function zV(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?HV.chrome||HV.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=wV(t,n,r).getClientRects();if(!h.length)return cV;let l=h[(o?o<0:i>=0)?0:h.length-1];return HV.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?dV(l,o<0):l||null}class FV extends SV{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||FV)(t,e,i)}split(t){let e=FV.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof FV&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof FV&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?bV.before(this.dom):bV.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return cV;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:dV(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class $V extends FV{domAtPos(t){let{topView:e,text:i}=this.widget;return e?qV(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new bV(i,Math.min(t,i.nodeValue.length)))):new bV(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?_V(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?qV(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>zV(s,t,e))):zV(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function qV(t,e,i,s,n,r){if(i instanceof IV){for(let o of i.children){let i=sV(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?qV(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function _V(t,e,i,s){if(i instanceof IV)for(let n of i.children){let i=0,r=sV(n.dom,s);if(sV(n.dom,t))return i+(r?_V(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class GV extends SV{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof GV&&t.side==this.side}split(){return new GV(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return bV.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof QV){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof IV&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function XV(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return bV.after(i)}return new bV(t,0)}function jV(t,e,i){let s,{children:n}=t;i>0&&e instanceof IV&&n.length&&(s=n[n.length-1])instanceof IV&&s.mark.eq(e.mark)?jV(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function UV(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?dV(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=rV(s);return n[n.length-1]||null}function ZV(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function YV(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function KV(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}QV.prototype.children=FV.prototype.children=GV.prototype.children=OV;class JV{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var tW=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(tW||(tW={}));class eW extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new iW(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new nW(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=rW(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new nW(t,e,i,s,t.widget||null,!0)}static line(t){return new sW(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}eW.none=ee.empty;class iW extends eW{constructor(t){let{start:e,end:i}=rW(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof iW&&this.tagName==t.tagName&&this.class==t.class&&YV(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}iW.prototype.point=!1;class sW extends eW{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof sW&&YV(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}sW.prototype.mapMode=z.TrackBefore,sW.prototype.point=!0;class nW extends eW{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?tW.WidgetRange:this.startSide<=0?tW.WidgetBefore:tW.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof nW&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function rW(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function oW(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}nW.prototype.point=!0;class hW extends SV{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof hW))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),MV(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new hW;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){YV(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){jV(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=ZV(e,this.attrs||{})),i&&(this.attrs=ZV({class:i},this.attrs||{}))}domAtPos(t){return XV(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(yV(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(KV(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&SV.get(i)instanceof IV;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=SV.get(i))||void 0===e?void 0:e.isEditable)||HV.ios&&this.children.some((t=>t instanceof QV))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof QV))return null;let i=rV(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return UV(this,t,e)}become(t){return!1}get type(){return tW.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof hW)return n;if(r>e)break}s=r+n.breakAfter}return null}}class lW extends SV{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof lW&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?bV.before(this.dom):bV.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new lW(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return OV}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof lW&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class aW{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof lW&&t.type==tW.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new hW),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(cW(new GV(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(cW(new QV(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof nW)if(i.block){let{type:t}=i;t!=tW.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new lW(i.widget||new dW("div"),r,t))}else{let o=FV.create(i.widget||new dW("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(cW(new GV(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(cW(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof nW){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new aW(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function cW(t,e){for(let i of e)t=new IV(i,[t],t.length);return t}class dW extends JV{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const uW=[],fW=et.define(),pW=et.define(),gW=et.define(),mW=et.define(),wW=et.define(),vW=et.define(),yW=Et.define({map:(t,e)=>t.map(e)}),bW=Et.define({map:(t,e)=>t.map(e)});class OW{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new OW(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const SW=Et.define({map:(t,e)=>t.map(e)});function xW(t,e,i){let s=t.facet(mW);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const kW=et.define({combine:t=>!t.length||t[0]});class AW{constructor(t,e){this.field=t,this.get=e}}class MW{from(t){return new AW(this,t)}static define(){return new MW}}MW.decorations=MW.define(),MW.atomicRanges=MW.define(),MW.scrollMargins=MW.define();let CW=0;const TW=et.define();class DW{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=TW.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(RW.from((t=>({plugin:t,handlers:i})))),n&&r.push(MW.decorations.from(n)),new DW(CW++,t,r)}static fromClass(t,e){return DW.define((e=>new t(e)),e)}}const RW=MW.define();class EW{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(xW(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){xW(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){xW(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const BW=et.define(),PW=et.define(),LW=et.define(),VW=et.define();class WW{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new WW(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new WW(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new WW(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class NW{constructor(t,e,i=uW){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new WW(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var HW=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(HW||(HW={}));const QW=HW.LTR,IW=HW.RTL;function zW(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const FW=zW("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),$W=zW("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),qW=Object.create(null),_W=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);qW[e]=i,qW[i]=-e}const GW=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class XW{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?IW:QW}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const jW=[];function UW(t,e){let i=t.length,s=e==QW?1:2,n=e==QW?2:1;if(!t||1==s&&!GW.test(t))return ZW(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?FW[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?$W[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),jW[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=jW[t];if(128==s)t<i-1&&e==jW[t+1]&&24&e?s=jW[t]=e:jW[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==jW[s];)s++;let r=t&&8==e||s<i&&8==jW[s]?1==n?1:8:256;for(let e=t;e<s;e++)jW[e]=r;t=s-1}else 8==s&&1==n&&(jW[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=qW[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(_W[t+1]==-r){let e=_W[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(jW[h]=jW[_W[t]]=i),l=t;break}}else{if(189==_W.length)break;_W[l++]=h,_W[l++]=e,_W[l++]=a}else if(2==(o=jW[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=_W[e+2];if(2&i)break;if(t)_W[e+2]|=2;else{if(4&i)break;_W[e+2]|=4}}}for(let t=0;t<i;t++)if(256==jW[t]){let e=t+1;for(;e<i&&256==jW[e];)e++;let n=1==(t?jW[t-1]:s),r=n==(1==(e<i?jW[e]:s))?n?1:2:s;for(let i=t;i<e;i++)jW[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=jW[t++];for(;t<i&&s==(1!=jW[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=jW[--i];for(;i>e&&s==(2!=jW[i-1]);)i--;o.push(new XW(i,t,s?2:1))}else o.push(new XW(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==jW[t++];for(;t<i&&s==(2==jW[t]);)t++;o.push(new XW(e,t,s?1:2))}return o}function ZW(t){return[new XW(0,t,0)]}let YW="";function KW(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=XW.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(YW=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class JW{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=SV.get(s),r=SV.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:tN(s))||tN(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=SV.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function tN(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class eN{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class iN extends SV{constructor(t){super(),this.view=t,this.compositionDeco=eW.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new hW],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new WW(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=eW.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=nN(t);if(!i)return eW.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new JW([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return eW.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return eW.none;let d=SV.get(r);d instanceof $V?d=d.widget.topView:d&&(d.parent=null);return eW.set(eW.replace({widget:new rN(r,o,d)}).range(h,l))}(this.view,t.changes)),(HV.ie||HV.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new hN;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=WW.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=HV.chrome||HV.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof lW&&t.widget instanceof sN&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=aW.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);AV(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||HV.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(HV.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new bV(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&oV(n.node,n.offset,h.anchorNode,h.anchorOffset)&&oV(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{HV.android&&HV.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=iV(this.root);if(s.empty){if(HV.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=oN(n.node,n.offset,1==t?1:-1);e&&(n=new bV(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new bV(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new bV(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=iV(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=hW.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(kW)?this.root.activeElement==this.dom:nV(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=SV.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof hW)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=tW.WidgetBefore&&n.type!=tW.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==tW.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?rV(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==HW.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof hW){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=rV(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new kV(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(eW.replace({widget:new sN(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return eW.set(t)}updateDeco(){let t=this.view.pluginField(MW.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(LW),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(MW.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=uV(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==HW.LTR)}}class sN extends JV{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function nN(t){let e=t.observer.selectionRange,i=e.focusNode&&oN(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof hW){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!SV.get(e);)e=e.previousSibling;let n=e?SV.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof hW)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class rN extends JV{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return $V}}function oN(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=aV(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class hN{constructor(){this.changes=[]}compareRange(t,e){oW(t,e,this.changes)}comparePoint(t,e){oW(t,e,this.changes)}}function lN(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function aN(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function cN(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function dN(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function uN(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function fN(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=rV(d);for(let u=0;u<t.length;u++){let f=t[u];n&&cN(n,f)&&(f=dN(uN(f,n.bottom),n.top));let p=lN(e,f),g=aN(i,f);if(0==p&&0==g)return 3==d.nodeType?pN(d,e,i):fN(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&cN(a,f)?a=uN(a,f.bottom):c&&cN(c,f)&&(c=dN(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?pN(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:fN(s,d,i)}function pN(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=wV(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(HV.chrome||HV.gecko){wV(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function gN(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=tW.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:mN(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:mN(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),HV.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return wV(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=hW.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=fN(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function mN(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function wN(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=KW(n,r,t.textDirection,o,i),l=YW;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function vN(t,e,i){let s=t.pluginField(MW.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class yN{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in kN){let i=kN[e];t.contentDOM.addEventListener(e,(s=>{xN(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),HV.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(RW);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{xN(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){xW(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){xW(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(HV.android&&HV.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!HV.ios||!(i=bN.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,vV(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(HV.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!HV.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const bN=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ON=[16,17,18,20,91,92,224,225];class SN{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(fW);return i.length?i[0](e):HV.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(pW);return i.length?i[0](e):HV.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=iV(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=NN(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function xN(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=SV.get(s))&&i.ignoreEvent(e))return!1;return!0}const kN=Object.create(null),AN=HV.ie&&HV.ie_version<15||HV.ios&&HV.webkit_version<604;function MN(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=QN&&s.selection.ranges.every((t=>t.empty))&&QN==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}kN.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():ON.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let CN=0;function TN(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=hW.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}kN.touchstart=(t,e)=>{CN=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},kN.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},kN.mousedown=(t,e)=>{if(t.observer.flush(),CN>Date.now()-2e3&&1==NN(e))return;let i=null;for(let s of t.state.facet(gW))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=BN(t,e),s=NN(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=BN(t,e),o=e),!a||!i)return n;let c=TN(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=TN(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>mV(t.contentDOM))),t.inputState.startMouseSelection(new SN(t,e,i,s))}};let DN=(t,e)=>t>=e.top&&t<=e.bottom,RN=(t,e,i)=>DN(e,i)&&t>=i.left&&t<=i.right;function EN(t,e,i,s){let n=hW.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&RN(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&RN(i,s,h)?1:o&&DN(s,o)?-1:1}function BN(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:EN(t,i,e.clientX,e.clientY)}}const PN=HV.ie&&HV.ie_version<=11;let LN=null,VN=0,WN=0;function NN(t){if(!PN)return t.detail;let e=LN,i=WN;return LN=t,WN=Date.now(),VN=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(VN+1)%3:1}function HN(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}kN.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},kN.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&HN(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else HN(t,e,e.dataTransfer.getData("Text"),!0)},kN.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=AN?null:e.clipboardData;i?(MN(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),MN(t,i.value)}),50)}(t)};let QN=null;function IN(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}kN.copy=kN.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;QN=n?i:null;let r=AN?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},kN.focus=kN.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},kN.compositionstart=kN.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),IN(t,!0)))},kN.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&IN(t,!1)}),50)},kN.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},kN.beforeinput=(t,e)=>{var i;let s;if(HV.chrome&&HV.android&&(s=bN.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const zN=["pre-wrap","normal","pre-line","break-spaces"];class FN{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=HW.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return zN.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=zN.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class $N{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class qN{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new qN(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new qN(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var _N=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(_N||(_N={}));class GN{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return GN.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,_N.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,_N.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,_N.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=KN.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new jN(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new ZN(GN.of(t.slice(0,e)),r,GN.of(t.slice(i)))}}GN.prototype.size=1;class XN extends GN{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new qN(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class jN extends XN{constructor(t,e){super(t,e,tW.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof jN||s instanceof UN&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof UN?s=new jN(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):GN.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class UN extends GN{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new qN(l,a,i+o*h,o,tW.Text)}lineAt(t,e,i,s,n){if(e==_N.ByHeight)return this.blockAt(t,i,s,n);if(e==_N.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new qN(e,s-e,0,0,tW.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new qN(h,l,s+o*(a-r),o,tW.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new qN(e.from,e.length,s,h,tW.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof UN?i[i.length-1]=new UN(t.length+s):i.push(null,new UN(s-1))}if(t>0){let e=i[0];e instanceof UN?i[0]=new UN(t+e.length):i.unshift(new UN(t-1),null)}return GN.of(i)}decomposeLeft(t,e){e.push(new UN(t-1),null)}decomposeRight(t,e){e.push(null,new UN(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new UN(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new jN(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new UN(n-r).updateHeight(t,r));let l=GN.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class ZN extends GN{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==_N.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==_N.ByPosNoHeight?_N.ByPosNoHeight:_N.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,_N.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&YN(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),YN(n,t)}return GN.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?GN.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function YN(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof UN&&(s=t[e+1])instanceof UN&&t.splice(e-1,3,new UN(i.length+1+s.length))}class KN{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof jN?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new jN(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new XN(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new jN(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new UN(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof jN)return t;let e=new jN(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=tW.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=tW.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof jN||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new jN(0,-1));let i=t;for(let t of this.nodes)t instanceof jN&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new KN(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class JN{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&oW(t,e,this.changes,5)}}function tH(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function eH(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class iH{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return eW.replace({widget:new sH(this.size,t)}).range(this.from,this.to)}}class sH extends JV{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class nH{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new FN,this.scaler=dH,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=GN.empty().applyChanges(t.facet(LW),E.empty,this.heightOracle.setDoc(t.doc),[new WW(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=eW.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new rH(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?dH:new uH(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:fH(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(LW),n=t.changedRanges,r=WW.extendWithRanges(n,function(t,e,i){let s=new JN;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(LW),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?HW.RTL:HW.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?eH:tH)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new $N(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new rH(s.lineAt(r-1e3*i,_N.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),_N.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,_N.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new rH(s.lineAt(i-500,_N.ByHeight,n,0,0).from,s.lineAt(i+r+500,_N.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new rH(this.heightMap.lineAt(i,_N.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,_N.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,_N.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,_N.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new iH(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=HW.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=oH(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=hH(r,(this.visibleTop-i.top-t)/i.height),n=hH(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=hH(r,(this.pixelViewport.left-e)/t),n=hH(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&aH(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&aH(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(cH(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new iH(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=lH(s,i)-lH(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){iH.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=eW.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(LW);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||fH(this.heightMap.lineAt(t,_N.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return fH(this.heightMap.lineAt(this.scaler.fromDOM(t),_N.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return fH(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class rH{constructor(t,e){this.from=t,this.to=e}}function oH(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(LW),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function hH({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function lH(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function aH(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function cH(t,e){for(let i of t)if(e(i))return i}const dH={toDOM:t=>t,fromDOM:t=>t,scale:1};class uH{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,_N.ByPos,t,0,0).top,o=e.lineAt(n,_N.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function fH(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new qN(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>fH(t,e))):t.type)}const pH=et.define({combine:t=>t.join(" ")}),gH=et.define({combine:t=>t.indexOf(!0)>-1}),mH=jt.newName(),wH=jt.newName(),vH=jt.newName(),yH={"&light":"."+wH,"&dark":"."+vH};function bH(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const OH=bH("."+mH,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},yH),SH={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},xH=HV.ie&&HV.ie_version<=11;class kH{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new fV,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(HV.ie&&HV.ie_version<=11||HV.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),xH&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(kW)?e.root.activeElement!=this.dom:!nV(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((HV.ie&&HV.ie_version<=11||HV.android&&HV.chrome)&&!e.state.selection.main.empty&&i.focusNode&&oV(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=iV(t),i=HV.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);oV(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,SH),xH&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),xH&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;vV(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&nV(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=AH(e,t.previousSibling||t.target.previousSibling,-1),s=AH(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function AH(t,e,i){for(;e;){let s=SV.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function MH(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new eN(i,s)),n==i&&r==s||e.push(new eN(n,r)));return e}(t),c=new JW(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||HV.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(HV.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(kW)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!sV(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!sV(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(HV.ios&&t.inputState.flushIOSKey(t))return;if(HV.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&vV(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&vV(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&vV(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(vW).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=nN(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class CH{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new nH(t.state||$t.create()),this.plugins=this.state.facet(TW).map((t=>new EW(t)));for(let t of this.plugins)t.update(this);this.observer=new kH(this,((t,e,i)=>{MH(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new yN(this),this.docView=new iN(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new NW(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new OW(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(yW)?n=new OW(t.value):t.is(bW)?n=new OW(t.value,"center"):t.is(SW)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=EH.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(VW)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(pH)!=e.state.facet(pH)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(wW))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new nH(t),this.plugins=t.facet(TW).map((t=>new EW(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new iN(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(TW),i=t.state.facet(TW);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new EW(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return xW(this.state,t),RH}})),o=new NW(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=RH)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){xW(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(wW))t(e)}get themeClasses(){return mH+" "+(this.state.facet(gH)?vH:wH)+" "+this.state.facet(pH)}updateAttrs(){let t=BH(this,BW,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(kW)?"true":"false",class:"cm-content",style:`${HV.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),BH(this,PW,e),this.observer.ignore((()=>{KV(this.contentDOM,this.contentAttrs,e),KV(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(CH.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(VW),jt.mount(this.root,this.styleModules.concat(OH).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=DH(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=DH(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=DH(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return vN(this,t,wN(this,t,e,i))}moveByGroup(t,e){return vN(this,t,wN(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==HW.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=hW.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return vN(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=gN(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:yW.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),gN(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return dV(i,n[XW.find(n,t-s.from,-1,e)].dir==HW.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>TH)return ZW(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=UW(t.text,this.textDirection);return this.bidiCache.push(new EH(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||HV.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{mV(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return SW.of(new OW("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return DW.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[pH.of(i),VW.of(bH(`.${i}`,t))];return e&&e.dark&&s.push(gH.of(!0)),s}static baseTheme(t){return pt.lowest(VW.of(bH("."+mH,t,yH)))}}CH.scrollTo=yW,CH.centerOn=bW,CH.styleModule=VW,CH.inputHandler=vW,CH.exceptionSink=mW,CH.updateListener=wW,CH.editable=kW,CH.mouseSelectionStyle=gW,CH.dragMovesSelection=pW,CH.clickAddsSelectionRange=fW,CH.decorations=LW,CH.darkTheme=gH,CH.contentAttributes=PW,CH.editorAttributes=BW,CH.lineWrapping=CH.contentAttributes.of({class:"cm-lineWrapping"}),CH.announce=Et.define();const TH=4096;function DH(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const RH={};class EH{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:HW.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new EH(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function BH(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&ZV(r,i)}return i}const PH=!HV.ios;const LH={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};PH&&(LH[".cm-line"].caretColor="transparent !important");const VH=et.define({combine(t){let e,i;for(let s of t)e=e||s.topContainer,i=i||s.bottomContainer;return{topContainer:e,bottomContainer:i}}});function WH(t,e){let i=t.plugin(NH),s=i?i.specs.indexOf(e):-1;return s>-1?i.panels[s]:null}const NH=DW.fromClass(class{constructor(t){this.input=t.state.facet(zH),this.specs=this.input.filter((t=>t)),this.panels=this.specs.map((e=>e(t)));let e=t.state.facet(VH);this.top=new HH(t,!0,e.topContainer),this.bottom=new HH(t,!1,e.bottomContainer),this.top.sync(this.panels.filter((t=>t.top))),this.bottom.sync(this.panels.filter((t=>!t.top)));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(t){let e=t.state.facet(VH);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new HH(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new HH(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(zH);if(i!=this.input){let e=i.filter((t=>t)),s=[],n=[],r=[],o=[];for(let i of e){let e,h=this.specs.indexOf(i);h<0?(e=i(t.view),o.push(e)):(e=this.panels[h],e.update&&e.update(t)),s.push(e),(e.top?n:r).push(e)}this.specs=e,this.panels=s,this.top.sync(n),this.bottom.sync(r);for(let t of o)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}else for(let e of this.panels)e.update&&e.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:MW.scrollMargins.from((t=>({top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()})))});class HH{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=QH(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=QH(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function QH(t){let e=t.nextSibling;return t.remove(),e}const IH=CH.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}}),zH=et.define({enables:[NH,IH]});function FH(){var t=arguments[0];"string"==typeof t&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){var n=i[s];"string"==typeof n?t.setAttribute(s,n):null!=n&&(t[s]=n)}e++}for(;e<arguments.length;e++)$H(t,arguments[e]);return t}function $H(t,e){if("string"==typeof e)t.appendChild(document.createTextNode(e));else if(null==e);else if(null!=e.nodeType)t.appendChild(e);else{if(!Array.isArray(e))throw new RangeError("Unsupported child node: "+e);for(var i=0;i<e.length;i++)$H(t,e[i])}}const qH="function"==typeof String.prototype.normalize?t=>t.normalize("NFKD"):t=>t;class _H{constructor(t,e,i=0,s=t.length,n){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(i,s),this.bufferStart=i,this.normalize=n?t=>n(qH(t)):qH,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return M(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=C(t),i=this.bufferStart+this.bufferPos;this.bufferPos+=T(t);let s=this.normalize(e);for(let t=0,n=i;;t++){let r=s.charCodeAt(t),o=this.match(r,n);if(o)return this.value=o,this;if(t==s.length-1)break;n==i&&t<e.length&&e.charCodeAt(t)==r&&n++}}}match(t,e){let i=null;for(let s=0;s<this.matches.length;s+=2){let n=this.matches[s],r=!1;this.query.charCodeAt(n)==t&&(n==this.query.length-1?i={from:this.matches[s+1],to:e+1}:(this.matches[s]++,r=!0)),r||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==t&&(1==this.query.length?i={from:e,to:e+1}:this.matches.push(1,e)),i}}"undefined"!=typeof Symbol&&(_H.prototype[Symbol.iterator]=function(){return this});const GH={from:-1,to:-1,match:/.*/.exec("")},XH="gm"+(null==/x/.unicode?"":"u");class jH{constructor(t,e,i,s=0,n=t.length){if(this.to=n,this.curLine="",this.done=!1,this.value=GH,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new YH(t,e,i,s,n);this.re=new RegExp(e,XH+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=t.iter();let r=t.lineAt(s);this.curLineStart=r.from,this.matchPos=s,this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let i=this.curLineStart+e.index,s=i+e[0].length;if(this.matchPos=s+(i==s?1:0),i==this.curLine.length&&this.nextLine(),i<s||i>this.value.to)return this.value={from:i,to:s,match:e},this;t=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),t=0}}}}const UH=new WeakMap;class ZH{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,i){let s=UH.get(t);if(!s||s.from>=i||s.to<=e){let s=new ZH(e,t.sliceString(e,i));return UH.set(t,s),s}if(s.from==e&&s.to==i)return s;let{text:n,from:r}=s;return r>e&&(n=t.sliceString(e,r)+n,r=e),s.to<i&&(n+=t.sliceString(s.to,i)),UH.set(t,new ZH(r,n)),new ZH(e,n.slice(e-r,i-r))}}class YH{constructor(t,e,i,s,n){this.text=t,this.to=n,this.done=!1,this.value=GH,this.matchPos=s,this.re=new RegExp(e,XH+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=ZH.get(t,s,this.chunkEnd(s+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e&&this.flat.to<this.to&&e.index+e[0].length>this.flat.text.length-10&&(e=null),e){let t=this.flat.from+e.index,i=t+e[0].length;return this.value={from:t,to:i,match:e},this.matchPos=i+(t==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=ZH.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function KH(t){let e=FH("input",{class:"cm-textfield",name:"line"});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!i)return;let{state:s}=t,n=s.doc.lineAt(s.selection.main.head),[,r,o,h,l]=i,a=h?+h.slice(1):0,c=o?+o:n.number;if(o&&l){let t=c/100;r&&(t=t*("-"==r?-1:1)+n.number/s.doc.lines),c=Math.round(s.doc.lines*t)}else o&&r&&(c=c*("-"==r?-1:1)+n.number);let d=s.doc.line(Math.max(1,Math.min(s.doc.lines,c)));t.dispatch({effects:JH.of(!1),selection:Y.cursor(d.from+Math.max(0,Math.min(a,d.length))),scrollIntoView:!0}),t.focus()}return{dom:FH("form",{class:"cm-gotoLine",onkeydown:e=>{27==e.keyCode?(e.preventDefault(),t.dispatch({effects:JH.of(!1)}),t.focus()):13==e.keyCode&&(e.preventDefault(),i())},onsubmit:t=>{t.preventDefault(),i()}},FH("label",t.state.phrase("Go to line"),": ",e)," ",FH("button",{class:"cm-button",type:"submit"},t.state.phrase("go"))),pos:-10}}"undefined"!=typeof Symbol&&(jH.prototype[Symbol.iterator]=YH.prototype[Symbol.iterator]=function(){return this});const JH=Et.define(),tQ=ht.define({create:()=>!0,update(t,e){for(let i of e.effects)i.is(JH)&&(t=i.value);return t},provide:t=>zH.from(t,(t=>t?KH:null))}),eQ=IL.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),iQ={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!0},sQ=et.define({combine:t=>qt(t,iQ,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})});function nQ(t){let e=[aQ,lQ];return t&&e.push(sQ.of(t)),e}const rQ=pB.mark({class:"cm-selectionMatch"}),oQ=pB.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function hQ(t,e,i,s){return!(0!=i&&t(e.sliceDoc(i-1,i))==Qt.Word||s!=e.doc.length&&t(e.sliceDoc(s,s+1))==Qt.Word)}const lQ=FB.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(sQ),{state:i}=t,s=i.selection;if(s.ranges.length>1)return pB.none;let n,r=s.main,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return pB.none;let t=i.wordAt(r.head);if(!t)return pB.none;o=i.charCategorizer(r.head),n=i.sliceDoc(t.from,t.to)}else{let t=r.to-r.from;if(t<e.minSelectionLength||t>200)return pB.none;if(e.wholeWords){if(n=i.sliceDoc(r.from,r.to),o=i.charCategorizer(r.head),!hQ(o,i,r.from,r.to)||!function(t,e,i,s){return t(e.sliceDoc(i,i+1))==Qt.Word&&t(e.sliceDoc(s-1,s))==Qt.Word}(o,i,r.from,r.to))return pB.none}else if(n=i.sliceDoc(r.from,r.to).trim(),!n)return pB.none}let h=[];for(let s of t.visibleRanges){let t=new _H(i.doc,n,s.from,s.to);for(;!t.next().done;){let{from:s,to:n}=t.value;if((!o||hQ(o,i,s,n))&&(r.empty&&s<=r.from&&n>=r.to?h.push(oQ.range(s,n)):(s>=r.to||n<=r.from)&&h.push(rQ.range(s,n)),h.length>e.maxMatches))return pB.none}}return pB.set(h)}},{decorations:t=>t.decorations}),aQ=IL.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const cQ=et.define({combine(t){var e;return{top:t.reduce(((t,e)=>null!=t?t:e.top),void 0)||!1,caseSensitive:t.reduce(((t,e)=>null!=t?t:e.caseSensitive||e.matchCase),void 0)||!1,createPanel:(null===(e=t.find((t=>t.createPanel)))||void 0===e?void 0:e.createPanel)||(t=>new VQ(t))}}});class dQ{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||function(t){try{return new RegExp(t,XH),!0}catch(t){return!1}}(this.search)),this.unquoted=this.search.replace(/\\([nrt\\])/g,((t,e)=>"n"==e?"\n":"r"==e?"\r":"t"==e?"\t":"\\"))}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp}create(){return this.regexp?new mQ(this):new pQ(this)}getCursor(t,e=0,i=t.length){return this.regexp?gQ(this,t,e,i):fQ(this,t,e,i)}}class uQ{constructor(t){this.spec=t}}function fQ(t,e,i,s){return new _H(e,t.unquoted,i,s,t.caseSensitive?void 0:t=>t.toLowerCase())}class pQ extends uQ{constructor(t){super(t)}nextMatch(t,e,i){let s=fQ(this.spec,t,i,t.length).nextOverlapping();return s.done&&(s=fQ(this.spec,t,0,e).nextOverlapping()),s.done?null:s.value}prevMatchInRange(t,e,i){for(let s=i;;){let i=Math.max(e,s-1e4-this.spec.unquoted.length),n=fQ(this.spec,t,i,s),r=null;for(;!n.nextOverlapping().done;)r=n.value;if(r)return r;if(i==e)return null;s-=1e4}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace}matchAll(t,e){let i=fQ(this.spec,t,0,t.length),s=[];for(;!i.next().done;){if(s.length>=e)return null;s.push(i.value)}return s}highlight(t,e,i,s){let n=fQ(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,t.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}function gQ(t,e,i,s){return new jH(e,t.search,t.caseSensitive?void 0:{ignoreCase:!0},i,s)}class mQ extends uQ{nextMatch(t,e,i){let s=gQ(this.spec,t,i,t.length).next();return s.done&&(s=gQ(this.spec,t,0,e).next()),s.done?null:s.value}prevMatchInRange(t,e,i){for(let s=1;;s++){let n=Math.max(e,i-1e4*s),r=gQ(this.spec,t,n,i),o=null;for(;!r.next().done;)o=r.value;if(o&&(n==e||o.from>n+10))return o;if(n==e)return null}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace.replace(/\$([$&\d+])/g,((e,i)=>"$"==i?"$":"&"==i?t.match[0]:"0"!=i&&+i<t.match.length?t.match[i]:e))}matchAll(t,e){let i=gQ(this.spec,t,0,t.length),s=[];for(;!i.next().done;){if(s.length>=e)return null;s.push(i.value)}return s}highlight(t,e,i,s){let n=gQ(this.spec,t,Math.max(0,e-250),Math.min(i+250,t.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}const wQ=Et.define(),vQ=Et.define(),yQ=ht.define({create:t=>new bQ(EQ(t).create(),null),update(t,e){for(let i of e.effects)i.is(wQ)?t=new bQ(i.value.create(),t.panel):i.is(vQ)&&(t=new bQ(t.query,i.value?RQ:null));return t},provide:t=>zH.from(t,(t=>t.panel))});class bQ{constructor(t,e){this.query=t,this.panel=e}}const OQ=pB.mark({class:"cm-searchMatch"}),SQ=pB.mark({class:"cm-searchMatch cm-searchMatch-selected"}),xQ=FB.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(yQ))}update(t){let e=t.state.field(yQ);(e!=t.startState.field(yQ)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return pB.none;let{view:i}=this,s=new ie;for(let e=0,n=i.visibleRanges,r=n.length;e<r;e++){let{from:o,to:h}=n[e];for(;e<r-1&&h>n[e+1].from-500;)h=n[++e].to;t.highlight(i.state.doc,o,h,((t,e)=>{let n=i.state.selection.ranges.some((i=>i.from==t&&i.to==e));s.add(t,e,n?SQ:OQ)}))}return s.finish()}},{decorations:t=>t.decorations});function kQ(t){return e=>{let i=e.state.field(yQ,!1);return i&&i.query.spec.valid?t(e,i):BQ(e)}}const AQ=kQ(((t,{query:e})=>{let{from:i,to:s}=t.state.selection.main,n=e.nextMatch(t.state.doc,i,s);return!(!n||n.from==i&&n.to==s)&&(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:HQ(t,n),userEvent:"select.search"}),!0)})),MQ=kQ(((t,{query:e})=>{let{state:i}=t,{from:s,to:n}=i.selection.main,r=e.prevMatch(i.doc,s,n);return!!r&&(t.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:HQ(t,r),userEvent:"select.search"}),!0)})),CQ=kQ(((t,{query:e})=>{let i=e.matchAll(t.state.doc,1e3);return!(!i||!i.length)&&(t.dispatch({selection:Y.create(i.map((t=>Y.range(t.from,t.to)))),userEvent:"select.search.matches"}),!0)})),TQ=kQ(((t,{query:e})=>{let{state:i}=t,{from:s,to:n}=i.selection.main;if(i.readOnly)return!1;let r=e.nextMatch(i.doc,s,s);if(!r)return!1;let o,h,l=[];if(r.from==s&&r.to==n&&(h=i.toText(e.getReplacement(r)),l.push({from:r.from,to:r.to,insert:h}),r=e.nextMatch(i.doc,r.from,r.to)),r){let t=0==l.length||l[0].from>=r.to?0:r.to-r.from-h.length;o={anchor:r.from-t,head:r.to-t}}return t.dispatch({changes:l,selection:o,scrollIntoView:!!o,effects:r?HQ(t,r):void 0,userEvent:"input.replace"}),!0})),DQ=kQ(((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state.doc,1e9).map((t=>{let{from:i,to:s}=t;return{from:i,to:s,insert:e.getReplacement(t)}}));return!!i.length&&(t.dispatch({changes:i,userEvent:"input.replace.all"}),!0)}));function RQ(t){return t.state.facet(cQ).createPanel(t)}function EQ(t,e){var i;let s=t.selection.main,n=s.empty||s.to>s.from+100?"":t.sliceDoc(s.from,s.to),r=null!==(i=null==e?void 0:e.caseSensitive)&&void 0!==i?i:t.facet(cQ).caseSensitive;return e&&!n?e:new dQ({search:n.replace(/\n/g,"\\n"),caseSensitive:r})}const BQ=t=>{let e=t.state.field(yQ,!1);if(e&&e.panel){let i=WH(t,RQ);if(!i)return!1;let s=i.dom.querySelector("[name=search]");if(s!=t.root.activeElement){let i=EQ(t.state,e.query.spec);i.valid&&t.dispatch({effects:wQ.of(i)}),s.focus(),s.select()}}else t.dispatch({effects:[vQ.of(!0),e?wQ.of(EQ(t.state,e.query.spec)):Et.appendConfig.of(IQ)]});return!0},PQ=t=>{let e=t.state.field(yQ,!1);if(!e||!e.panel)return!1;let i=WH(t,RQ);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:vQ.of(!1)}),!0},LQ=[{key:"Mod-f",run:BQ,scope:"editor search-panel"},{key:"F3",run:AQ,shift:MQ,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:AQ,shift:MQ,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:PQ,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:s,to:n}=i.main,r=[],o=0;for(let e=new _H(t.doc,t.sliceDoc(s,n));!e.next().done;){if(r.length>1e3)return!1;e.value.from==s&&(o=r.length),r.push(Y.range(e.value.from,e.value.to))}return e(t.update({selection:Y.create(r,o),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:t=>{let e=WH(t,KH);if(!e){let i=[JH.of(!0)];null==t.state.field(tQ,!1)&&i.push(Et.appendConfig.of([tQ,eQ])),t.dispatch({effects:i}),e=WH(t,KH)}return e&&e.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some((t=>t.from===t.to)))return(({state:t,dispatch:e})=>{let{selection:i}=t,s=Y.create(i.ranges.map((e=>t.wordAt(e.head)||Y.cursor(e.head))),i.mainIndex);return!s.eq(i)&&(e(t.update({selection:s})),!0)})({state:t,dispatch:e});let s=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some((e=>t.sliceDoc(e.from,e.to)!=s)))return!1;let n=function(t,e){let{main:i,ranges:s}=t.selection,n=t.wordAt(i.head),r=n&&n.from==i.from&&n.to==i.to;for(let i=!1,n=new _H(t.doc,e,s[s.length-1].to);;){if(n.next(),!n.done){if(i&&s.some((t=>t.from==n.value.from)))continue;if(r){let e=t.wordAt(n.value.from);if(!e||e.from!=n.value.from||e.to!=n.value.to)continue}return n.value}if(i)return null;n=new _H(t.doc,e,0,Math.max(0,s[s.length-1].from-1)),i=!0}}(t,s);return!!n&&(e(t.update({selection:t.selection.addRange(Y.range(n.from,n.to),!1),effects:IL.scrollIntoView(n.to)})),!0)},preventDefault:!0}];class VQ{constructor(t){this.view=t;let e=this.query=t.state.field(yQ).query.spec;function i(t,e,i){return FH("button",{class:"cm-button",name:t,onclick:e,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=FH("input",{value:e.search,placeholder:WQ(t,"Find"),"aria-label":WQ(t,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=FH("input",{value:e.replace,placeholder:WQ(t,"Replace"),"aria-label":WQ(t,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=FH("input",{type:"checkbox",name:"case",checked:e.caseSensitive,onchange:this.commit}),this.reField=FH("input",{type:"checkbox",name:"re",checked:e.regexp,onchange:this.commit}),this.dom=FH("div",{onkeydown:t=>this.keydown(t),class:"cm-search"},[this.searchField,i("next",(()=>AQ(t)),[WQ(t,"next")]),i("prev",(()=>MQ(t)),[WQ(t,"previous")]),i("select",(()=>CQ(t)),[WQ(t,"all")]),FH("label",null,[this.caseField,WQ(t,"match case")]),FH("label",null,[this.reField,WQ(t,"regexp")]),...t.state.readOnly?[]:[FH("br"),this.replaceField,i("replace",(()=>TQ(t)),[WQ(t,"replace")]),i("replaceAll",(()=>DQ(t)),[WQ(t,"replace all")]),FH("button",{name:"close",onclick:()=>PQ(t),"aria-label":WQ(t,"close"),type:"button"},["×"])]])}commit(){let t=new dQ({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:wQ.of(t)}))}keydown(t){var e,i,s;e=this.view,i=t,s="search-panel",JL(YL(e.state),i,e,s)?t.preventDefault():13==t.keyCode&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?MQ:AQ)(this.view)):13==t.keyCode&&t.target==this.replaceField&&(t.preventDefault(),TQ(this.view))}update(t){for(let e of t.transactions)for(let t of e.effects)t.is(wQ)&&!t.value.eq(this.query)&&this.setQuery(t.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(cQ).top}}function WQ(t,e){return t.state.phrase(e)}const NQ=/[\s\.,:;?!]/;function HQ(t,{from:e,to:i}){let s=t.state.doc.lineAt(e).from,n=t.state.doc.lineAt(i).to,r=Math.max(s,e-30),o=Math.min(n,i+30),h=t.state.sliceDoc(r,o);if(r!=s)for(let t=0;t<30;t++)if(!NQ.test(h[t+1])&&NQ.test(h[t])){h=h.slice(t);break}if(o!=n)for(let t=h.length-1;t>h.length-30;t--)if(!NQ.test(h[t-1])&&NQ.test(h[t])){h=h.slice(0,t);break}return IL.announce.of(`${t.state.phrase("current match")}. ${h} ${t.state.phrase("on line")} ${t.state.doc.lineAt(e).number}`)}const QQ=IL.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),IQ=[yQ,pt.lowest(xQ),QQ];function zQ(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function FQ(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function $Q(t,e){if(!e.anchorNode)return!1;try{return FQ(t,e.anchorNode)}catch(t){return!1}}function qQ(t){return 3==t.nodeType?iI(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function _Q(t,e,i,s){return!!i&&(XQ(t,e,i,s,-1)||XQ(t,e,i,s,1))}function GQ(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function XQ(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:jQ(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=GQ(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?jQ(t):0}}}function jQ(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const UQ={left:0,right:0,top:0,bottom:0};function ZQ(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function YQ(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class KQ{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let JQ,tI=null;function eI(t){if(t.setActive)return t.setActive();if(tI)return t.focus(tI);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==tI?{get preventScroll(){return tI={preventScroll:!0},!0}}:void 0),!tI){tI=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function iI(t,e,i=e){let s=JQ||(JQ=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function sI(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function nI(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class rI{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new rI(t.parentNode,GQ(t),e)}static after(t,e){return new rI(t.parentNode,GQ(t)+1,e)}}const oI=[];class hI{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=hI.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=lI(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=lI(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==jQ(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!hI.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=oI){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new aI(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function lI(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}hI.prototype.breakAfter=0;class aI{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function cI(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function dI(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,cI(t,a,c,h,l,s,0,n,r)}let uI="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},fI="undefined"!=typeof document?document:{documentElement:{style:{}}};const pI=/Edge\/(\d+)/.exec(uI.userAgent),gI=/MSIE \d/.test(uI.userAgent),mI=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(uI.userAgent),wI=!!(gI||mI||pI),vI=!wI&&/gecko\/(\d+)/i.test(uI.userAgent),yI=!wI&&/Chrome\/(\d+)/.exec(uI.userAgent),bI="webkitFontSmoothing"in fI.documentElement.style,OI=!wI&&/Apple Computer/.test(uI.vendor),SI=OI&&(/Mobile\/\w+/.test(uI.userAgent)||uI.maxTouchPoints>2);var xI={mac:SI||/Mac/.test(uI.platform),windows:/Win/.test(uI.platform),linux:/Linux|X11/.test(uI.platform),ie:wI,ie_version:gI?fI.documentMode||6:mI?+mI[1]:pI?+pI[1]:0,gecko:vI,gecko_version:vI?+(/Firefox\/(\d+)/.exec(uI.userAgent)||[0,0])[1]:0,chrome:!!yI,chrome_version:yI?+yI[1]:0,ios:SI,android:/Android\b/.test(uI.userAgent),webkit:bI,safari:OI,webkit_version:bI?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=fI.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class kI extends hI{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof kI&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new kI(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new rI(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return MI(this.dom,t,e)}}class AI extends hI{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(nI(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof AI&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(dI(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new AI(this.mark,e,r)}domAtPos(t){return BI(this.dom,this.children,t)}coordsAt(t,e){return LI(this,t,e)}}function MI(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?xI.chrome||xI.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=iI(t,n,r).getClientRects();if(!h.length)return UQ;let l=h[(o?o<0:i>=0)?0:h.length-1];return xI.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?ZQ(l,o<0):l||null}class CI extends hI{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||CI)(t,e,i)}split(t){let e=CI.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof CI&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof CI&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?rI.before(this.dom):rI.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return UQ;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:ZQ(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class TI extends CI{domAtPos(t){let{topView:e,text:i}=this.widget;return e?DI(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new rI(i,Math.min(t,i.nodeValue.length)))):new rI(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?RI(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?DI(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>MI(s,t,e))):MI(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function DI(t,e,i,s,n,r){if(i instanceof AI){for(let o of i.children){let i=FQ(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?DI(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function RI(t,e,i,s){if(i instanceof AI)for(let n of i.children){let i=0,r=FQ(n.dom,s);if(FQ(n.dom,t))return i+(r?RI(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class EI extends hI{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof EI&&t.side==this.side}split(){return new EI(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return rI.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof kI){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof AI&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function BI(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return rI.after(i)}return new rI(t,0)}function PI(t,e,i){let s,{children:n}=t;i>0&&e instanceof AI&&n.length&&(s=n[n.length-1])instanceof AI&&s.mark.eq(e.mark)?PI(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function LI(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?ZQ(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=qQ(s);return n[n.length-1]||null}function VI(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function WI(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function NI(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}kI.prototype.children=CI.prototype.children=EI.prototype.children=oI;class HI{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var QI=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(QI||(QI={}));class II extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new zI(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new $I(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=qI(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new $I(t,e,i,s,t.widget||null,!0)}static line(t){return new FI(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}II.none=ee.empty;class zI extends II{constructor(t){let{start:e,end:i}=qI(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof zI&&this.tagName==t.tagName&&this.class==t.class&&WI(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}zI.prototype.point=!1;class FI extends II{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof FI&&WI(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}FI.prototype.mapMode=z.TrackBefore,FI.prototype.point=!0;class $I extends II{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?QI.WidgetRange:this.startSide<=0?QI.WidgetBefore:QI.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof $I&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function qI(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function _I(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}$I.prototype.point=!0;class GI extends hI{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof GI))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),dI(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new GI;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){WI(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){PI(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=VI(e,this.attrs||{})),i&&(this.attrs=VI({class:i},this.attrs||{}))}domAtPos(t){return BI(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(nI(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(NI(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&hI.get(i)instanceof AI;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=hI.get(i))||void 0===e?void 0:e.isEditable)||xI.ios&&this.children.some((t=>t instanceof kI))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof kI))return null;let i=qQ(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return LI(this,t,e)}become(t){return!1}get type(){return QI.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof GI)return n;if(r>e)break}s=r+n.breakAfter}return null}}class XI extends hI{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof XI&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?rI.before(this.dom):rI.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new XI(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return oI}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof XI&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class jI{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof XI&&t.type==QI.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new GI),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(UI(new EI(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(UI(new kI(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof $I)if(i.block){let{type:t}=i;t!=QI.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new XI(i.widget||new ZI("div"),r,t))}else{let o=CI.create(i.widget||new ZI("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(UI(new EI(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(UI(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof $I){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new jI(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function UI(t,e){for(let i of e)t=new AI(i,[t],t.length);return t}class ZI extends HI{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const YI=[],KI=et.define(),JI=et.define(),tz=et.define(),ez=et.define(),iz=et.define(),sz=et.define(),nz=Et.define({map:(t,e)=>t.map(e)}),rz=Et.define({map:(t,e)=>t.map(e)});class oz{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new oz(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const hz=Et.define({map:(t,e)=>t.map(e)});function lz(t,e,i){let s=t.facet(ez);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const az=et.define({combine:t=>!t.length||t[0]});class cz{constructor(t,e){this.field=t,this.get=e}}class dz{from(t){return new cz(this,t)}static define(){return new dz}}dz.decorations=dz.define(),dz.atomicRanges=dz.define(),dz.scrollMargins=dz.define();let uz=0;const fz=et.define();class pz{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=fz.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(gz.from((t=>({plugin:t,handlers:i})))),n&&r.push(dz.decorations.from(n)),new pz(uz++,t,r)}static fromClass(t,e){return pz.define((e=>new t(e)),e)}}const gz=dz.define();class mz{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(lz(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){lz(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){lz(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const wz=et.define(),vz=et.define(),yz=et.define(),bz=et.define();class Oz{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Oz(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new Oz(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new Oz(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class Sz{constructor(t,e,i=YI){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Oz(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var xz=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(xz||(xz={}));const kz=xz.LTR,Az=xz.RTL;function Mz(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Cz=Mz("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Tz=Mz("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Dz=Object.create(null),Rz=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Dz[e]=i,Dz[i]=-e}const Ez=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Bz{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Az:kz}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Pz=[];function Lz(t,e){let i=t.length,s=e==kz?1:2,n=e==kz?2:1;if(!t||1==s&&!Ez.test(t))return Vz(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Cz[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Tz[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Pz[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Pz[t];if(128==s)t<i-1&&e==Pz[t+1]&&24&e?s=Pz[t]=e:Pz[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Pz[s];)s++;let r=t&&8==e||s<i&&8==Pz[s]?1==n?1:8:256;for(let e=t;e<s;e++)Pz[e]=r;t=s-1}else 8==s&&1==n&&(Pz[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Dz[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Rz[t+1]==-r){let e=Rz[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Pz[h]=Pz[Rz[t]]=i),l=t;break}}else{if(189==Rz.length)break;Rz[l++]=h,Rz[l++]=e,Rz[l++]=a}else if(2==(o=Pz[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Rz[e+2];if(2&i)break;if(t)Rz[e+2]|=2;else{if(4&i)break;Rz[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Pz[t]){let e=t+1;for(;e<i&&256==Pz[e];)e++;let n=1==(t?Pz[t-1]:s),r=n==(1==(e<i?Pz[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Pz[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Pz[t++];for(;t<i&&s==(1!=Pz[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Pz[--i];for(;i>e&&s==(2!=Pz[i-1]);)i--;o.push(new Bz(i,t,s?2:1))}else o.push(new Bz(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Pz[t++];for(;t<i&&s==(2==Pz[t]);)t++;o.push(new Bz(e,t,s?1:2))}return o}function Vz(t){return[new Bz(0,t,0)]}let Wz="";function Nz(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=Bz.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(Wz=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Hz{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=hI.get(s),r=hI.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Qz(s))||Qz(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=hI.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Qz(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Iz{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class zz extends hI{constructor(t){super(),this.view=t,this.compositionDeco=II.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new GI],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Oz(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=II.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=$z(t);if(!i)return II.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Hz([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return II.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return II.none;let d=hI.get(r);d instanceof TI?d=d.widget.topView:d&&(d.parent=null);return II.set(II.replace({widget:new qz(r,o,d)}).range(h,l))}(this.view,t.changes)),(xI.ie||xI.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new Gz;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Oz.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=xI.chrome||xI.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof XI&&t.widget instanceof Fz&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=jI.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);cI(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||xI.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(xI.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new rI(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&_Q(n.node,n.offset,h.anchorNode,h.anchorOffset)&&_Q(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{xI.android&&xI.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=zQ(this.root);if(s.empty){if(xI.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=_z(n.node,n.offset,1==t?1:-1);e&&(n=new rI(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new rI(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new rI(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=zQ(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=GI.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(az)?this.root.activeElement==this.dom:$Q(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=hI.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof GI)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=QI.WidgetBefore&&n.type!=QI.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==QI.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?qQ(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==xz.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof GI){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=qQ(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new aI(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(II.replace({widget:new Fz(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return II.set(t)}updateDeco(){let t=this.view.pluginField(dz.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(yz),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(dz.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=YQ(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==xz.LTR)}}class Fz extends HI{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function $z(t){let e=t.observer.selectionRange,i=e.focusNode&&_z(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof GI){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!hI.get(e);)e=e.previousSibling;let n=e?hI.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof GI)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class qz extends HI{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return TI}}function _z(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=jQ(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Gz{constructor(){this.changes=[]}compareRange(t,e){_I(t,e,this.changes)}comparePoint(t,e){_I(t,e,this.changes)}}function Xz(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function jz(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Uz(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Zz(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Yz(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Kz(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=qQ(d);for(let u=0;u<t.length;u++){let f=t[u];n&&Uz(n,f)&&(f=Zz(Yz(f,n.bottom),n.top));let p=Xz(e,f),g=jz(i,f);if(0==p&&0==g)return 3==d.nodeType?Jz(d,e,i):Kz(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&Uz(a,f)?a=Yz(a,f.bottom):c&&Uz(c,f)&&(c=Zz(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Jz(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:Kz(s,d,i)}function Jz(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=iI(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(xI.chrome||xI.gecko){iI(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function tF(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=QI.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:eF(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:eF(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),xI.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return iI(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=GI.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Kz(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function eF(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function iF(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=Nz(n,r,t.textDirection,o,i),l=Wz;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function sF(t,e,i){let s=t.pluginField(dz.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class nF{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in aF){let i=aF[e];t.contentDOM.addEventListener(e,(s=>{lF(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),xI.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(gz);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{lF(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){lz(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){lz(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(xI.android&&xI.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!xI.ios||!(i=rF.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,sI(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(xI.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!xI.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const rF=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],oF=[16,17,18,20,91,92,224,225];class hF{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(KI);return i.length?i[0](e):xI.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(JI);return i.length?i[0](e):xI.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=zQ(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=SF(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function lF(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=hI.get(s))&&i.ignoreEvent(e))return!1;return!0}const aF=Object.create(null),cF=xI.ie&&xI.ie_version<15||xI.ios&&xI.webkit_version<604;function dF(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=kF&&s.selection.ranges.every((t=>t.empty))&&kF==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}aF.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():oF.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let uF=0;function fF(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=GI.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}aF.touchstart=(t,e)=>{uF=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},aF.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},aF.mousedown=(t,e)=>{if(t.observer.flush(),uF>Date.now()-2e3&&1==SF(e))return;let i=null;for(let s of t.state.facet(tz))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=wF(t,e),s=SF(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=wF(t,e),o=e),!a||!i)return n;let c=fF(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=fF(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>eI(t.contentDOM))),t.inputState.startMouseSelection(new hF(t,e,i,s))}};let pF=(t,e)=>t>=e.top&&t<=e.bottom,gF=(t,e,i)=>pF(e,i)&&t>=i.left&&t<=i.right;function mF(t,e,i,s){let n=GI.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&gF(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&gF(i,s,h)?1:o&&pF(s,o)?-1:1}function wF(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:mF(t,i,e.clientX,e.clientY)}}const vF=xI.ie&&xI.ie_version<=11;let yF=null,bF=0,OF=0;function SF(t){if(!vF)return t.detail;let e=yF,i=OF;return yF=t,OF=Date.now(),bF=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(bF+1)%3:1}function xF(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}aF.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},aF.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&xF(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else xF(t,e,e.dataTransfer.getData("Text"),!0)},aF.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=cF?null:e.clipboardData;i?(dF(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),dF(t,i.value)}),50)}(t)};let kF=null;function AF(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}aF.copy=aF.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;kF=n?i:null;let r=cF?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},aF.focus=aF.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},aF.compositionstart=aF.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),AF(t,!0)))},aF.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&AF(t,!1)}),50)},aF.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},aF.beforeinput=(t,e)=>{var i;let s;if(xI.chrome&&xI.android&&(s=rF.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const MF=["pre-wrap","normal","pre-line","break-spaces"];class CF{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=xz.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return MF.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=MF.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class TF{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class DF{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new DF(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new DF(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var RF=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(RF||(RF={}));class EF{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return EF.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,RF.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,RF.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,RF.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=NF.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new PF(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new VF(EF.of(t.slice(0,e)),r,EF.of(t.slice(i)))}}EF.prototype.size=1;class BF extends EF{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new DF(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class PF extends BF{constructor(t,e){super(t,e,QI.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof PF||s instanceof LF&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof LF?s=new PF(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):EF.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class LF extends EF{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new DF(l,a,i+o*h,o,QI.Text)}lineAt(t,e,i,s,n){if(e==RF.ByHeight)return this.blockAt(t,i,s,n);if(e==RF.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new DF(e,s-e,0,0,QI.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new DF(h,l,s+o*(a-r),o,QI.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new DF(e.from,e.length,s,h,QI.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof LF?i[i.length-1]=new LF(t.length+s):i.push(null,new LF(s-1))}if(t>0){let e=i[0];e instanceof LF?i[0]=new LF(t+e.length):i.unshift(new LF(t-1),null)}return EF.of(i)}decomposeLeft(t,e){e.push(new LF(t-1),null)}decomposeRight(t,e){e.push(null,new LF(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new LF(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new PF(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new LF(n-r).updateHeight(t,r));let l=EF.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class VF extends EF{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==RF.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==RF.ByPosNoHeight?RF.ByPosNoHeight:RF.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,RF.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&WF(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),WF(n,t)}return EF.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?EF.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function WF(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof LF&&(s=t[e+1])instanceof LF&&t.splice(e-1,3,new LF(i.length+1+s.length))}class NF{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof PF?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new PF(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new BF(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new PF(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new LF(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof PF)return t;let e=new PF(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=QI.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=QI.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof PF||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new PF(0,-1));let i=t;for(let t of this.nodes)t instanceof PF&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new NF(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class HF{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&_I(t,e,this.changes,5)}}function QF(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function IF(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class zF{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return II.replace({widget:new FF(this.size,t)}).range(this.from,this.to)}}class FF extends HI{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class $F{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new CF,this.scaler=ZF,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=EF.empty().applyChanges(t.facet(yz),E.empty,this.heightOracle.setDoc(t.doc),[new Oz(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=II.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new qF(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?ZF:new YF(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:KF(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(yz),n=t.changedRanges,r=Oz.extendWithRanges(n,function(t,e,i){let s=new HF;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(yz),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?xz.RTL:xz.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?IF:QF)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new TF(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new qF(s.lineAt(r-1e3*i,RF.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),RF.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,RF.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new qF(s.lineAt(i-500,RF.ByHeight,n,0,0).from,s.lineAt(i+r+500,RF.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new qF(this.heightMap.lineAt(i,RF.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,RF.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,RF.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,RF.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new zF(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=xz.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=_F(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=GF(r,(this.visibleTop-i.top-t)/i.height),n=GF(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=GF(r,(this.pixelViewport.left-e)/t),n=GF(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&jF(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&jF(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(UF(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new zF(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=XF(s,i)-XF(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){zF.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=II.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(yz);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||KF(this.heightMap.lineAt(t,RF.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return KF(this.heightMap.lineAt(this.scaler.fromDOM(t),RF.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return KF(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class qF{constructor(t,e){this.from=t,this.to=e}}function _F(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(yz),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function GF({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function XF(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function jF(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function UF(t,e){for(let i of t)if(e(i))return i}const ZF={toDOM:t=>t,fromDOM:t=>t,scale:1};class YF{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,RF.ByPos,t,0,0).top,o=e.lineAt(n,RF.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function KF(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new DF(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>KF(t,e))):t.type)}const JF=et.define({combine:t=>t.join(" ")}),t$=et.define({combine:t=>t.indexOf(!0)>-1}),e$=jt.newName(),i$=jt.newName(),s$=jt.newName(),n$={"&light":"."+i$,"&dark":"."+s$};function r$(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const o$=r$("."+e$,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},n$),h$={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},l$=xI.ie&&xI.ie_version<=11;class a${constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new KQ,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(xI.ie&&xI.ie_version<=11||xI.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),l$&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(az)?e.root.activeElement!=this.dom:!$Q(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((xI.ie&&xI.ie_version<=11||xI.android&&xI.chrome)&&!e.state.selection.main.empty&&i.focusNode&&_Q(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=zQ(t),i=xI.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);_Q(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,h$),l$&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),l$&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;sI(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&$Q(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=c$(e,t.previousSibling||t.target.previousSibling,-1),s=c$(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function c$(t,e,i){for(;e;){let s=hI.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function d$(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Iz(i,s)),n==i&&r==s||e.push(new Iz(n,r)));return e}(t),c=new Hz(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||xI.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(xI.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(az)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!FQ(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!FQ(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(xI.ios&&t.inputState.flushIOSKey(t))return;if(xI.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&sI(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&sI(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&sI(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(sz).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=$z(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class u${constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new $F(t.state||$t.create()),this.plugins=this.state.facet(fz).map((t=>new mz(t)));for(let t of this.plugins)t.update(this);this.observer=new a$(this,((t,e,i)=>{d$(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new nF(this),this.docView=new zz(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new Sz(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new oz(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(nz)?n=new oz(t.value):t.is(rz)?n=new oz(t.value,"center"):t.is(hz)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=m$.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(bz)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(JF)!=e.state.facet(JF)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(iz))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new $F(t),this.plugins=t.facet(fz).map((t=>new mz(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new zz(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(fz),i=t.state.facet(fz);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new mz(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return lz(this.state,t),g$}})),o=new Sz(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=g$)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){lz(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(iz))t(e)}get themeClasses(){return e$+" "+(this.state.facet(t$)?s$:i$)+" "+this.state.facet(JF)}updateAttrs(){let t=w$(this,wz,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(az)?"true":"false",class:"cm-content",style:`${xI.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),w$(this,vz,e),this.observer.ignore((()=>{NI(this.contentDOM,this.contentAttrs,e),NI(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(u$.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(bz),jt.mount(this.root,this.styleModules.concat(o$).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=p$(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=p$(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=p$(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return sF(this,t,iF(this,t,e,i))}moveByGroup(t,e){return sF(this,t,iF(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==xz.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=GI.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return sF(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=tF(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:nz.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),tF(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return ZQ(i,n[Bz.find(n,t-s.from,-1,e)].dir==xz.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>f$)return Vz(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Lz(t.text,this.textDirection);return this.bidiCache.push(new m$(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||xI.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{eI(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return hz.of(new oz("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return pz.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[JF.of(i),bz.of(r$(`.${i}`,t))];return e&&e.dark&&s.push(t$.of(!0)),s}static baseTheme(t){return pt.lowest(bz.of(r$("."+e$,t,n$)))}}u$.scrollTo=nz,u$.centerOn=rz,u$.styleModule=bz,u$.inputHandler=sz,u$.exceptionSink=ez,u$.updateListener=iz,u$.editable=az,u$.mouseSelectionStyle=tz,u$.dragMovesSelection=JI,u$.clickAddsSelectionRange=KI,u$.decorations=yz,u$.darkTheme=t$,u$.contentAttributes=vz,u$.editorAttributes=wz,u$.lineWrapping=u$.contentAttributes.of({class:"cm-lineWrapping"}),u$.announce=Et.define();const f$=4096;function p$(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const g$={};class m${constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:xz.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new m$(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function w$(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&VI(r,i)}return i}const v$=!xI.ios;const y$={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};v$&&(y$[".cm-line"].caretColor="transparent !important");const b$="undefined"!=typeof navigator&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);class O${constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter((t=>t)),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter((t=>t));if(e===this.input){for(let e of this.tooltipViews)e.update&&e.update(t);return!1}let s=[];for(let e=0;e<i.length;e++){let n=i[e],r=-1;if(n){for(let t=0;t<this.tooltips.length;t++){let e=this.tooltips[t];e&&e.create==n.create&&(r=t)}if(r<0)s[e]=this.createTooltipView(n);else{let i=s[e]=this.tooltipViews[r];i.update&&i.update(t)}}}for(let t of this.tooltipViews)s.indexOf(t)<0&&t.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=s,!0}}function S$(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const x$=et.define({combine:t=>{var e,i,s;return{position:b$?"absolute":(null===(e=t.find((t=>t.position)))||void 0===e?void 0:e.position)||"fixed",parent:(null===(i=t.find((t=>t.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(s=t.find((t=>t.tooltipSpace)))||void 0===s?void 0:s.tooltipSpace)||S$}}}),k$=pz.fromClass(class{constructor(t){var e;this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let i=t.state.facet(x$);this.position=i.position,this.parent=i.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new O$(t,C$,(t=>this.createTooltip(t))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),null===(e=t.dom.ownerDocument.defaultView)||void 0===e||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let i=e||t.geometryChanged,s=t.state.facet(x$);if(s.position!=this.position){this.position=s.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;i=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top="-10000px",this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;null===(t=this.view.dom.ownerDocument.defaultView)||void 0===t||t.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();null===(e=this.intersectionObserver)||void 0===e||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map(((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((({dom:t})=>t.getBoundingClientRect())),space:this.view.state.facet(x$).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:i}=t,s=[];for(let n=0;n<this.manager.tooltips.length;n++){let r=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:h}=o,l=t.pos[n],a=t.size[n];if(!l||l.bottom<=Math.max(e.top,i.top)||l.top>=Math.min(e.bottom,i.bottom)||l.right<Math.max(e.left,i.left)-.1||l.left>Math.min(e.right,i.right)+.1){h.style.top="-10000px";continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,d=c?7:0,u=a.right-a.left,f=a.bottom-a.top,p=o.offset||M$,g=this.view.textDirection==xz.LTR,m=a.width>i.right-i.left?g?i.left:i.right-a.width:g?Math.min(l.left-(c?14:0)+p.x,i.right-u):Math.max(i.left,l.left-u+(c?14:0)-p.x),w=!!r.above;!r.strictSide&&(w?l.top-(a.bottom-a.top)-p.y<i.top:l.bottom+(a.bottom-a.top)+p.y>i.bottom)&&w==i.bottom-l.bottom>l.top-i.top&&(w=!w);let v=w?l.top-f-d-p.y:l.bottom+d+p.y,y=m+u;if(!0!==o.overlap)for(let t of s)t.left<y&&t.right>m&&t.top<v+f&&t.bottom>v&&(v=w?t.top-f-2-d:t.bottom+d+2);"absolute"==this.position?(h.style.top=v-t.parent.top+"px",h.style.left=m-t.parent.left+"px"):(h.style.top=v+"px",h.style.left=m+"px"),c&&(c.style.left=l.left+(g?p.x:-p.x)-(m+14-7)+"px"),!0!==o.overlap&&s.push({left:m,top:v,right:y,bottom:v+f}),h.classList.toggle("cm-tooltip-above",w),h.classList.toggle("cm-tooltip-below",!w),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top="-10000px"}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),A$=u$.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),M$={x:0,y:0},C$=et.define({enables:[k$,A$]}),T$=et.define();class D${constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new O$(t,T$,(t=>this.createHostedView(t)))}static create(t){return new D$(t)}createHostedView(t){let e=t.create(this.view);return e.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(e.dom),this.mounted&&e.mount&&e.mount(this.view),e}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned()}update(t){this.manager.update(t)}}const R$=C$.compute([T$],(t=>{let e=t.facet(T$).filter((t=>t));return 0===e.length?null:{pos:Math.min(...e.map((t=>t.pos))),end:Math.max(...e.filter((t=>null!=t.end)).map((t=>t.end))),create:D$.create,above:e[0].above,arrow:e.some((t=>t.arrow))}}));class E${constructor(t,e,i,s,n){this.view=t,this.source=e,this.field=i,this.setHover=s,this.hoverTime=n,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){var t;clearTimeout(this.restartTimeout);let{lastMove:e}=this,i=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(null==i)return;let s=this.view.coordsAtPos(i);if(null==s||e.y<s.top||e.y>s.bottom||e.x<s.left-this.view.defaultCharacterWidth||e.x>s.right+this.view.defaultCharacterWidth)return;let n=this.view.bidiSpans(this.view.state.doc.lineAt(i)).find((t=>t.from<=i&&t.to>=i)),r=n&&n.dir==xz.RTL?-1:1,o=this.source(this.view,i,e.x<s.left?-r:r);if(null===(t=o)||void 0===t?void 0:t.then){let t=this.pending={pos:i};o.then((e=>{this.pending==t&&(this.pending=null,e&&this.view.dispatch({effects:this.setHover.of(e)}))}),(t=>lz(this.view.state,t,"hover tooltip")))}else o&&this.view.dispatch({effects:this.setHover.of(o)})}mousemove(t){var e;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!function(t){for(let e=t;e;e=e.parentNode)if(1==e.nodeType&&e.classList.contains("cm-tooltip"))return!0;return!1}(this.lastMove.target)||this.pending){let{pos:s}=i||this.pending,n=null!==(e=null==i?void 0:i.end)&&void 0!==e?e:s;(s==n?this.view.posAtCoords(this.lastMove)==s:function(t,e,i,s,n,r){let o=document.createRange(),h=t.domAtPos(e),l=t.domAtPos(i);o.setEnd(l.node,l.offset),o.setStart(h.node,h.offset);let a=o.getClientRects();o.detach();for(let t=0;t<a.length;t++){let e=a[t];if(Math.max(e.top-n,n-e.bottom,e.left-s,s-e.right)<=r)return!0}return!1}(this.view,s,n,t.clientX,t.clientY,6))||(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function B$(t,e={}){let i=Et.define(),s=ht.define({create:()=>null,update(t,s){if(t&&e.hideOnChange&&(s.docChanged||s.selection))return null;for(let t of s.effects){if(t.is(i))return t.value;if(t.is(L$))return null}if(t&&s.docChanged){let e=s.changes.mapPos(t.pos,-1,z.TrackDel);if(null==e)return null;let i=Object.assign(Object.create(null),t);return i.pos=e,null!=t.end&&(i.end=s.changes.mapPos(t.end)),i}return t},provide:t=>T$.from(t)});return[s,pz.define((n=>new E$(n,t,s,i,e.hoverTime||300))),R$]}function P$(t,e){let i=t.plugin(k$);if(!i)return null;let s=i.manager.tooltips.indexOf(e);return s<0?null:i.manager.tooltipViews[s]}const L$=Et.define();class V${constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=Bw(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),s=e.text.slice(i-e.from,this.pos-e.from),n=s.search(I$(t,!1));return n<0?null:{from:i+n,to:this.pos,text:s.slice(n)}}get aborted(){return null==this.abortListeners}addEventListener(t,e){"abort"==t&&this.abortListeners&&this.abortListeners.push(e)}}function W$(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function N$(t){let e=t.map((t=>"string"==typeof t?{label:t}:t)),[i,s]=e.every((t=>/^\w+$/.test(t.label)))?[/\w*$/,/\w+$/]:function(t){let e=Object.create(null),i=Object.create(null);for(let{label:s}of t){e[s[0]]=!0;for(let t=1;t<s.length;t++)i[s[t]]=!0}let s=W$(e)+W$(i)+"*$";return[new RegExp("^"+s),new RegExp(s)]}(e);return t=>{let n=t.matchBefore(s);return n||t.explicit?{from:n?n.from:t.pos,options:e,span:i}:null}}class H${constructor(t,e,i){this.completion=t,this.source=e,this.match=i}}function Q$(t){return t.selection.main.head}function I$(t,e){var i;let{source:s}=t,n=e&&"^"!=s[0],r="$"!=s[s.length-1];return n||r?new RegExp(`${n?"^":""}(?:${s})${r?"$":""}`,null!==(i=t.flags)&&void 0!==i?i:t.ignoreCase?"i":""):t}const z$=Tt.define();function F$(t,e){let i=e.completion.apply||e.completion.label,s=e.source;"string"==typeof i?t.dispatch({changes:{from:s.from,to:s.to,insert:i},selection:{anchor:s.from+i.length},userEvent:"input.complete",annotations:z$.of(e.completion)}):i(t,e.completion,s.from,s.to)}const $$=new WeakMap;function q$(t){if(!Array.isArray(t))return t;let e=$$.get(t);return e||$$.set(t,e=N$(t)),e}class _${constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let e=0;e<t.length;){let i=M(t,e),s=T(i);this.chars.push(i);let n=t.slice(e,e+s),r=n.toUpperCase();this.folded.push(M(r==n?n.toLowerCase():r,0)),e+=s}this.astral=t.length!=this.chars.length}match(t){if(0==this.pattern.length)return[0];if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:s,precise:n,byWord:r}=this;if(1==e.length){let s=M(t,0);return s==e[0]?[0,0,T(s)]:s==i[0]?[-200,0,T(s)]:null}let o=t.indexOf(this.pattern);if(0==o)return[0,0,this.pattern.length];let h=e.length,l=0;if(o<0){for(let n=0,r=Math.min(t.length,200);n<r&&l<h;){let r=M(t,n);r!=e[l]&&r!=i[l]||(s[l++]=n),n+=T(r)}if(l<h)return null}let a=0,c=0,d=!1,u=0,f=-1,p=-1,g=/[a-z]/.test(t),m=!0;for(let s=0,l=Math.min(t.length,200),w=0;s<l&&c<h;){let l=M(t,s);o<0&&(a<h&&l==e[a]&&(n[a++]=s),u<h&&(l==e[u]||l==i[u]?(0==u&&(f=s),p=s+1,u++):u=0));let v,y=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(v=C(l))!=v.toLowerCase()?1:v!=v.toUpperCase()?2:0;(!s||1==y&&g||0==w&&0!=y)&&(e[c]==l||i[c]==l&&(d=!0)?r[c++]=s:r.length&&(m=!1)),w=y,s+=T(l)}return c==h&&0==r[0]&&m?this.result((d?-200:0)-100,r,t):u==h&&0==f?[-200-t.length,0,p]:o>-1?[-700-t.length,o,o+this.pattern.length]:u==h?[-900-t.length,f,p]:c==h?this.result((d?-200:0)-100-700+(m?0:-1100),r,t):2==e.length?null:this.result((s[0]?-700:0)-200-1100,s,t)}result(t,e,i){let s=[t-i.length],n=1;for(let t of e){let e=t+(this.astral?T(M(i,t)):1);n>1&&s[n-1]==t?s[n-1]=e:(s[n++]=t,s[n++]=e)}return s}}const G$=et.define({combine:t=>qt(t,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(t,e)=>t&&e,icons:(t,e)=>t&&e,optionClass:(t,e)=>i=>function(t,e){return t?e?t+" "+e:t:e}(t(i),e(i)),addToOptions:(t,e)=>t.concat(e)})});function X$(t,e,i){if(t<=i)return{from:0,to:t};if(e<=t>>1){let t=Math.floor(e/i);return{from:t*i,to:(t+1)*i}}let s=Math.floor((t-e)/i);return{from:t-(s+1)*i,to:t-s*i}}class j${constructor(t,e){this.view=t,this.stateField=e,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:t=>this.positionInfo(t),key:this};let i=t.state.field(e),{options:s,selected:n}=i.open,r=t.state.facet(G$);this.optionContent=function(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(t){let e=document.createElement("div");return e.classList.add("cm-completionIcon"),t.type&&e.classList.add(...t.type.split(/\s+/g).map((t=>"cm-completionIcon-"+t))),e.setAttribute("aria-hidden","true"),e},position:20}),e.push({render(t,e,i){let s=document.createElement("span");s.className="cm-completionLabel";let{label:n}=t,r=0;for(let t=1;t<i.length;){let e=i[t++],o=i[t++];e>r&&s.appendChild(document.createTextNode(n.slice(r,e)));let h=s.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(n.slice(e,o))),h.className="cm-completionMatchedText",r=o}return r<n.length&&s.appendChild(document.createTextNode(n.slice(r))),s},position:50},{render(t){if(!t.detail)return null;let e=document.createElement("span");return e.className="cm-completionDetail",e.textContent=t.detail,e},position:80}),e.sort(((t,e)=>t.position-e.position)).map((t=>t.render))}(r),this.optionClass=r.optionClass,this.range=X$(s.length,n,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(e=>{for(let i,n=e.target;n&&n!=this.dom;n=n.parentNode)if("LI"==n.nodeName&&(i=/-(\d+)$/.exec(n.id))&&+i[1]<s.length)return F$(t,s[+i[1]]),void e.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(s,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(t){t.state.field(this.stateField)!=t.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=X$(e.options.length,e.selected,this.view.state.facet(G$).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e.options,t.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(e.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=e.options[e.selected],{info:s}=i;if(!s)return;let n="string"==typeof s?document.createTextNode(s):s(i);if(!n)return;"then"in n?n.then((e=>{e&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(e)})).catch((t=>_i(this.view.state,t,"completion info"))):this.addInfoPane(n)}}addInfoPane(t){let e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo",e.appendChild(t),this.dom.appendChild(e),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,s=this.range.from;i;i=i.nextSibling,s++)s==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return e&&function(t,e){let i=t.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<i.top?t.scrollTop-=i.top-s.top:s.bottom>i.bottom&&(t.scrollTop+=s.bottom-i.bottom)}(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),s=t.getBoundingClientRect();if(s.top>Math.min(innerHeight,e.bottom)-10||s.bottom<Math.max(0,e.top)+10)return null;let n=Math.max(0,Math.min(s.top,innerHeight-i.height))-e.top,r=this.view.textDirection==os.RTL,o=e.left,h=innerWidth-e.right;return r&&o<Math.min(i.width,h)?r=!1:!r&&h<Math.min(i.width,o)&&(r=!0),{top:n,left:r}}positionInfo(t){this.info&&(this.info.style.top=(t?t.top:-1e6)+"px",t&&(this.info.classList.toggle("cm-completionInfo-left",t.left),this.info.classList.toggle("cm-completionInfo-right",!t.left)))}createListBox(t,e,i){const s=document.createElement("ul");s.id=e,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true");for(let n=i.from;n<i.to;n++){let{completion:i,match:r}=t[n];const o=s.appendChild(document.createElement("li"));o.id=e+"-"+n,o.setAttribute("role","option");let h=this.optionClass(i);h&&(o.className=h);for(let t of this.optionContent){let e=t(i,this.view.state,r);e&&o.appendChild(e)}}return i.from&&s.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&s.classList.add("cm-completionListIncompleteBottom"),s}}function U$(t){return 100*(t.boost||0)+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}class Z${constructor(t,e,i,s,n){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=s,this.selected=n}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new Z$(this.options,J$(e,t),this.tooltip,this.timestamp,t)}static build(t,e,i,s,n){let r=function(t,e){let i=[],s=0;for(let n of t)if(n.hasResult())if(!1===n.result.filter)for(let t of n.result.options)i.push(new H$(t,n,[1e9-s++]));else{let t,s=new _$(e.sliceDoc(n.from,n.to));for(let e of n.result.options)(t=s.match(e.label))&&(null!=e.boost&&(t[0]+=e.boost),i.push(new H$(e,n,t)))}let n=[],r=null;for(let t of i.sort(eq)){if(300==n.length)break;r&&r.label==t.completion.label&&r.detail==t.completion.detail&&r.type==t.completion.type&&r.apply==t.completion.apply?U$(t.completion)>U$(r)&&(n[n.length-1]=t):n.push(t),r=t.completion}return n}(t,e);if(!r.length)return null;let o=0;if(s&&s.selected){let t=s.options[s.selected].completion;for(let e=0;e<r.length;e++)if(r[e].completion==t){o=e;break}}return new Z$(r,J$(i,o),{pos:t.reduce(((t,e)=>e.hasResult()?Math.min(t,e.from):t),1e8),create:(h=aq,t=>new j$(t,h)),above:n.aboveCursor},s?s.timestamp:Date.now(),o);var h}map(t){return new Z$(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class Y${constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new Y$(tq,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(t){let{state:e}=t,i=e.facet(G$),s=(i.override||e.languageDataAt("autocomplete",Q$(e)).map(q$)).map((e=>(this.active.find((t=>t.source==e))||new sq(e,this.active.some((t=>0!=t.state))?1:0)).update(t,i)));s.length==this.active.length&&s.every(((t,e)=>t==this.active[e]))&&(s=this.active);let n=t.selection||s.some((e=>e.hasResult()&&t.changes.touchesRange(e.from,e.to)))||!function(t,e){if(t==e)return!0;for(let i=0,s=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;s<e.length&&!e[s].hasResult;)s++;let n=i==t.length,r=s==e.length;if(n||r)return n==r;if(t[i++].result!=e[s++].result)return!1}}(s,this.active)?Z$.build(s,e,this.id,this.open,i):this.open&&t.docChanged?this.open.map(t.changes):this.open;!n&&s.every((t=>1!=t.state))&&s.some((t=>t.hasResult()))&&(s=s.map((t=>t.hasResult()?new sq(t.source,0):t)));for(let e of t.effects)e.is(lq)&&(n=n&&n.setSelected(e.value,this.id));return s==this.active&&n==this.open?this:new Y$(s,this.id,n)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:K$}}const K$={"aria-autocomplete":"list"};function J$(t,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":t+"-"+e,"aria-controls":t}}const tq=[];function eq(t,e){let i=e.match[0]-t.match[0];return i||t.completion.label.localeCompare(e.completion.label)}function iq(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class sq{constructor(t,e,i=-1){this.source=t,this.state=e,this.explicitPos=i}hasResult(){return!1}update(t,e){let i=iq(t),s=this;i?s=s.handleUserEvent(t,i,e):t.docChanged?s=s.handleChange(t):t.selection&&0!=s.state&&(s=new sq(s.source,0));for(let e of t.effects)if(e.is(rq))s=new sq(s.source,1,e.value?Q$(t.state):-1);else if(e.is(oq))s=new sq(s.source,0);else if(e.is(hq))for(let t of e.value)t.source==s.source&&(s=t);return s}handleUserEvent(t,e,i){return"delete"!=e&&i.activateOnTyping?new sq(this.source,1):this.map(t.changes)}handleChange(t){return t.changes.touchesRange(Q$(t.startState))?new sq(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new sq(this.source,this.state,t.mapPos(this.explicitPos))}}class nq extends sq{constructor(t,e,i,s,n,r){super(t,2,e),this.result=i,this.from=s,this.to=n,this.span=r}hasResult(){return!0}handleUserEvent(t,e,i){let s=t.changes.mapPos(this.from),n=t.changes.mapPos(this.to,1),r=Q$(t.state);if((this.explicitPos<0?r<=s:r<this.from)||r>n||"delete"==e&&Q$(t.startState)==this.from)return new sq(this.source,"input"==e&&i.activateOnTyping?1:0);let o=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return this.span&&(s==n||this.span.test(t.state.sliceDoc(s,n)))?new nq(this.source,o,this.result,s,n,this.span):new sq(this.source,1,o)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new sq(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new nq(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1),this.span)}}const rq=Et.define(),oq=Et.define(),hq=Et.define({map:(t,e)=>t.map((t=>t.map(e)))}),lq=Et.define(),aq=ht.define({create:()=>Y$.start(),update:(t,e)=>t.update(e),provide:t=>[C$.from(t,(t=>t.tooltip)),Zn.contentAttributes.from(t,(t=>t.attrs))]});function cq(t,e="option"){return i=>{let s=i.state.field(aq,!1);if(!s||!s.open||Date.now()-s.open.timestamp<75)return!1;let n,r=1;"page"==e&&(n=P$(i,s.open.tooltip))&&(r=Math.max(2,Math.floor(n.dom.offsetHeight/n.dom.querySelector("li").offsetHeight)-1));let o=s.open.selected+r*(t?1:-1),{length:h}=s.open.options;return o<0?o="page"==e?0:h-1:o>=h&&(o="page"==e?h-1:0),i.dispatch({effects:lq.of(o)}),!0}}class dq{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const uq=Yi.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(aq).active)1==e.state&&this.startQuery(e)}update(t){let e=t.state.field(aq);if(!t.selectionSet&&!t.docChanged&&t.startState.field(aq)==e)return;let i=t.transactions.some((t=>(t.selection||t.docChanged)&&!iq(t)));for(let e=0;e<this.running.length;e++){let s=this.running[e];if(i||s.updates.length+t.transactions.length>50&&Date.now()-s.time>1e3){for(let t of s.context.abortListeners)try{t()}catch(t){_i(this.view.state,t)}s.context.abortListeners=null,this.running.splice(e--,1)}else s.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some((t=>1==t.state&&!this.running.some((e=>e.active.source==t.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let e of t.transactions)"input"==iq(e)?this.composing=2:2==this.composing&&e.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(aq);for(let t of e.active)1!=t.state||this.running.some((e=>e.active.source==t.source))||this.startQuery(t)}startQuery(t){let{state:e}=this.view,i=Q$(e),s=new V$(e,i,t.explicitPos==i),n=new dq(t,s);this.running.push(n),Promise.resolve(t.source(s)).then((t=>{n.context.aborted||(n.done=t||null,this.scheduleAccept())}),(t=>{this.view.dispatch({effects:oq.of(null)}),_i(this.view.state,t)}))}scheduleAccept(){this.running.every((t=>void 0!==t.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(G$);for(let s=0;s<this.running.length;s++){let n=this.running[s];if(void 0===n.done)continue;if(this.running.splice(s--,1),n.done){let s=new nq(n.active.source,n.active.explicitPos,n.done,n.done.from,null!==(t=n.done.to)&&void 0!==t?t:Q$(n.updates.length?n.updates[0].startState:this.view.state),n.done.span&&!1!==n.done.filter?I$(n.done.span,!0):null);for(let t of n.updates)s=s.update(t,i);if(s.hasResult()){e.push(s);continue}}let r=this.view.state.field(aq).active.find((t=>t.source==n.active.source));if(r&&1==r.state)if(null==n.done){let t=new sq(n.active.source,0);for(let e of n.updates)t=t.update(e,i);1!=t.state&&e.push(t)}else this.startQuery(r)}e.length&&this.view.dispatch({effects:hq.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:rq.of(!1)})),20),this.composing=0}}}),fq=Zn.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});function pq(t={}){return[aq,G$.of(t),uq,mq,fq]}const gq=[{key:"Ctrl-Space",run:t=>!!t.state.field(aq,!1)&&(t.dispatch({effects:rq.of(!0)}),!0)},{key:"Escape",run:t=>{let e=t.state.field(aq,!1);return!(!e||!e.active.some((t=>0!=t.state)))&&(t.dispatch({effects:oq.of(null)}),!0)}},{key:"ArrowDown",run:cq(!0)},{key:"ArrowUp",run:cq(!1)},{key:"PageDown",run:cq(!0,"page")},{key:"PageUp",run:cq(!1,"page")},{key:"Enter",run:t=>{let e=t.state.field(aq,!1);return!(t.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<75)&&(F$(t,e.open.options[e.open.selected]),!0)}}],mq=pt.highest(rr.computeN([G$],(t=>t.facet(G$).defaultKeymap?[gq]:[])));function wq(t,e){return({state:i,dispatch:s})=>{if(i.readOnly)return!1;let n=t(e,i);return!!n&&(s(i.update(n)),!0)}}const vq=wq(kq,0),yq=wq(xq,0),bq=wq(((t,e)=>xq(t,e,function(t){let e=[];for(let i of t.selection.ranges){let s=t.doc.lineAt(i.from),n=i.to<=s.to?s:t.doc.lineAt(i.to),r=e.length-1;r>=0&&e[r].to>s.from?e[r].to=n.to:e.push({from:s.from,to:n.to})}return e}(e))),0),Oq=[{key:"Mod-/",run:t=>{let e=Sq(t.state);return e.line?vq(t):!!e.block&&bq(t)}},{key:"Alt-A",run:yq}];function Sq(t,e=t.selection.main.head){let i=t.languageDataAt("commentTokens",e);return i.length?i[0]:{}}function xq(t,e,i=e.selection.ranges){let s=i.map((t=>Sq(e,t.from).block));if(!s.every((t=>t)))return null;let n=i.map(((t,i)=>function(t,{open:e,close:i},s,n){let r,o,h=t.sliceDoc(s-50,s),l=t.sliceDoc(n,n+50),a=/\s*$/.exec(h)[0].length,c=/^\s*/.exec(l)[0].length,d=h.length-a;if(h.slice(d-e.length,d)==e&&l.slice(c,c+i.length)==i)return{open:{pos:s-a,margin:a&&1},close:{pos:n+c,margin:c&&1}};n-s<=100?r=o=t.sliceDoc(s,n):(r=t.sliceDoc(s,s+50),o=t.sliceDoc(n-50,n));let u=/^\s*/.exec(r)[0].length,f=/\s*$/.exec(o)[0].length,p=o.length-f-i.length;return r.slice(u,u+e.length)==e&&o.slice(p,p+i.length)==i?{open:{pos:s+u+e.length,margin:/\s/.test(r.charAt(u+e.length))?1:0},close:{pos:n-f-i.length,margin:/\s/.test(o.charAt(p-1))?1:0}}:null}(e,s[i],t.from,t.to)));if(2!=t&&!n.every((t=>t)))return{changes:e.changes(i.map(((t,e)=>n[e]?[]:[{from:t.from,insert:s[e].open+" "},{from:t.to,insert:" "+s[e].close}])))};if(1!=t&&n.some((t=>t))){let t=[];for(let e,i=0;i<n.length;i++)if(e=n[i]){let n=s[i],{open:r,close:o}=e;t.push({from:r.pos-n.open.length,to:r.pos+r.margin},{from:o.pos-o.margin,to:o.pos+n.close.length})}return{changes:t}}return null}function kq(t,e,i=e.selection.ranges){let s=[],n=-1;for(let{from:t,to:r}of i){let i=s.length,o=1e9;for(let i=t;i<=r;){let h=e.doc.lineAt(i);if(h.from>n&&(t==r||r>h.from)){n=h.from;let t=Sq(e,i).line;if(!t)continue;let r=/^\s*/.exec(h.text)[0].length,l=r==h.length,a=h.text.slice(r,r+t.length)==t?r:-1;r<h.text.length&&r<o&&(o=r),s.push({line:h,comment:a,token:t,indent:r,empty:l,single:!1})}i=h.to+1}if(o<1e9)for(let t=i;t<s.length;t++)s[t].indent<s[t].line.text.length&&(s[t].indent=o);s.length==i+1&&(s[i].single=!0)}if(2!=t&&s.some((t=>t.comment<0&&(!t.empty||t.single)))){let t=[];for(let{line:e,token:i,indent:n,empty:r,single:o}of s)!o&&r||t.push({from:e.from+n,insert:i+" "});let i=e.changes(t);return{changes:i,selection:e.selection.map(i,1)}}if(1!=t&&s.some((t=>t.comment>=0))){let t=[];for(let{line:e,comment:i,token:n}of s)if(i>=0){let s=e.from+i,r=s+n.length;" "==e.text[r-e.from]&&r++,t.push({from:s,to:r})}return{changes:t}}return null}function Aq(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Mq(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Cq(t,e){if(!e.anchorNode)return!1;try{return Mq(t,e.anchorNode)}catch(t){return!1}}function Tq(t){return 3==t.nodeType?Iq(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Dq(t,e,i,s){return!!i&&(Eq(t,e,i,s,-1)||Eq(t,e,i,s,1))}function Rq(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Eq(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:Bq(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Rq(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?Bq(t):0}}}function Bq(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Pq={left:0,right:0,top:0,bottom:0};function Lq(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Vq(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Wq{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Nq,Hq=null;function Qq(t){if(t.setActive)return t.setActive();if(Hq)return t.focus(Hq);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Hq?{get preventScroll(){return Hq={preventScroll:!0},!0}}:void 0),!Hq){Hq=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function Iq(t,e,i=e){let s=Nq||(Nq=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function zq(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function Fq(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class $q{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new $q(t.parentNode,Rq(t),e)}static after(t,e){return new $q(t.parentNode,Rq(t)+1,e)}}const qq=[];class _q{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=_q.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=Gq(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=Gq(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==Bq(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!_q.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=qq){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Xq(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Gq(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}_q.prototype.breakAfter=0;class Xq{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function jq(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function Uq(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,jq(t,a,c,h,l,s,0,n,r)}let Zq="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Yq="undefined"!=typeof document?document:{documentElement:{style:{}}};const Kq=/Edge\/(\d+)/.exec(Zq.userAgent),Jq=/MSIE \d/.test(Zq.userAgent),t_=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Zq.userAgent),e_=!!(Jq||t_||Kq),i_=!e_&&/gecko\/(\d+)/i.test(Zq.userAgent),s_=!e_&&/Chrome\/(\d+)/.exec(Zq.userAgent),n_="webkitFontSmoothing"in Yq.documentElement.style,r_=!e_&&/Apple Computer/.test(Zq.vendor),o_=r_&&(/Mobile\/\w+/.test(Zq.userAgent)||Zq.maxTouchPoints>2);var h_={mac:o_||/Mac/.test(Zq.platform),windows:/Win/.test(Zq.platform),linux:/Linux|X11/.test(Zq.platform),ie:e_,ie_version:Jq?Yq.documentMode||6:t_?+t_[1]:Kq?+Kq[1]:0,gecko:i_,gecko_version:i_?+(/Firefox\/(\d+)/.exec(Zq.userAgent)||[0,0])[1]:0,chrome:!!s_,chrome_version:s_?+s_[1]:0,ios:o_,android:/Android\b/.test(Zq.userAgent),webkit:n_,safari:r_,webkit_version:n_?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Yq.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class l_ extends _q{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof l_&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new l_(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new $q(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return c_(this.dom,t,e)}}class a_ extends _q{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Fq(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof a_&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(Uq(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new a_(this.mark,e,r)}domAtPos(t){return m_(this.dom,this.children,t)}coordsAt(t,e){return v_(this,t,e)}}function c_(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?h_.chrome||h_.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=Iq(t,n,r).getClientRects();if(!h.length)return Pq;let l=h[(o?o<0:i>=0)?0:h.length-1];return h_.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?Lq(l,o<0):l||null}class d_ extends _q{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||d_)(t,e,i)}split(t){let e=d_.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof d_&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof d_&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?$q.before(this.dom):$q.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return Pq;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:Lq(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class u_ extends d_{domAtPos(t){let{topView:e,text:i}=this.widget;return e?f_(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new $q(i,Math.min(t,i.nodeValue.length)))):new $q(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?p_(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?f_(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>c_(s,t,e))):c_(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function f_(t,e,i,s,n,r){if(i instanceof a_){for(let o of i.children){let i=Mq(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?f_(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function p_(t,e,i,s){if(i instanceof a_)for(let n of i.children){let i=0,r=Mq(n.dom,s);if(Mq(n.dom,t))return i+(r?p_(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class g_ extends _q{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof g_&&t.side==this.side}split(){return new g_(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return $q.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof l_){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof a_&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function m_(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return $q.after(i)}return new $q(t,0)}function w_(t,e,i){let s,{children:n}=t;i>0&&e instanceof a_&&n.length&&(s=n[n.length-1])instanceof a_&&s.mark.eq(e.mark)?w_(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function v_(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?Lq(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=Tq(s);return n[n.length-1]||null}function y_(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function b_(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function O_(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}l_.prototype.children=d_.prototype.children=g_.prototype.children=qq;class S_{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var x_=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(x_||(x_={}));class k_ extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new A_(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new C_(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=T_(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new C_(t,e,i,s,t.widget||null,!0)}static line(t){return new M_(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}k_.none=ee.empty;class A_ extends k_{constructor(t){let{start:e,end:i}=T_(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof A_&&this.tagName==t.tagName&&this.class==t.class&&b_(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}A_.prototype.point=!1;class M_ extends k_{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof M_&&b_(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}M_.prototype.mapMode=z.TrackBefore,M_.prototype.point=!0;class C_ extends k_{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?x_.WidgetRange:this.startSide<=0?x_.WidgetBefore:x_.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof C_&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function T_(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function D_(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}C_.prototype.point=!0;class R_ extends _q{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof R_))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Uq(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new R_;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){b_(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){w_(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=y_(e,this.attrs||{})),i&&(this.attrs=y_({class:i},this.attrs||{}))}domAtPos(t){return m_(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Fq(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(O_(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&_q.get(i)instanceof a_;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=_q.get(i))||void 0===e?void 0:e.isEditable)||h_.ios&&this.children.some((t=>t instanceof l_))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof l_))return null;let i=Tq(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return v_(this,t,e)}become(t){return!1}get type(){return x_.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof R_)return n;if(r>e)break}s=r+n.breakAfter}return null}}class E_ extends _q{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof E_&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?$q.before(this.dom):$q.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new E_(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return qq}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof E_&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class B_{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof E_&&t.type==x_.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new R_),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(P_(new g_(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(P_(new l_(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof C_)if(i.block){let{type:t}=i;t!=x_.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new E_(i.widget||new L_("div"),r,t))}else{let o=d_.create(i.widget||new L_("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(P_(new g_(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(P_(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof C_){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new B_(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function P_(t,e){for(let i of e)t=new a_(i,[t],t.length);return t}class L_ extends S_{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const V_=[],W_=et.define(),N_=et.define(),H_=et.define(),Q_=et.define(),I_=et.define(),z_=et.define(),F_=Et.define({map:(t,e)=>t.map(e)}),$_=Et.define({map:(t,e)=>t.map(e)});class q_{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new q_(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const __=Et.define({map:(t,e)=>t.map(e)});function G_(t,e,i){let s=t.facet(Q_);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const X_=et.define({combine:t=>!t.length||t[0]});class j_{constructor(t,e){this.field=t,this.get=e}}class U_{from(t){return new j_(this,t)}static define(){return new U_}}U_.decorations=U_.define(),U_.atomicRanges=U_.define(),U_.scrollMargins=U_.define();let Z_=0;const Y_=et.define();class K_{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Y_.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(J_.from((t=>({plugin:t,handlers:i})))),n&&r.push(U_.decorations.from(n)),new K_(Z_++,t,r)}static fromClass(t,e){return K_.define((e=>new t(e)),e)}}const J_=U_.define();class tG{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(G_(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){G_(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){G_(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const eG=et.define(),iG=et.define(),sG=et.define(),nG=et.define();class rG{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new rG(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new rG(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new rG(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class oG{constructor(t,e,i=V_){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new rG(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var hG=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(hG||(hG={}));const lG=hG.LTR,aG=hG.RTL;function cG(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const dG=cG("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),uG=cG("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),fG=Object.create(null),pG=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);fG[e]=i,fG[i]=-e}const gG=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class mG{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?aG:lG}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const wG=[];function vG(t,e){let i=t.length,s=e==lG?1:2,n=e==lG?2:1;if(!t||1==s&&!gG.test(t))return yG(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?dG[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?uG[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),wG[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=wG[t];if(128==s)t<i-1&&e==wG[t+1]&&24&e?s=wG[t]=e:wG[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==wG[s];)s++;let r=t&&8==e||s<i&&8==wG[s]?1==n?1:8:256;for(let e=t;e<s;e++)wG[e]=r;t=s-1}else 8==s&&1==n&&(wG[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=fG[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(pG[t+1]==-r){let e=pG[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(wG[h]=wG[pG[t]]=i),l=t;break}}else{if(189==pG.length)break;pG[l++]=h,pG[l++]=e,pG[l++]=a}else if(2==(o=wG[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=pG[e+2];if(2&i)break;if(t)pG[e+2]|=2;else{if(4&i)break;pG[e+2]|=4}}}for(let t=0;t<i;t++)if(256==wG[t]){let e=t+1;for(;e<i&&256==wG[e];)e++;let n=1==(t?wG[t-1]:s),r=n==(1==(e<i?wG[e]:s))?n?1:2:s;for(let i=t;i<e;i++)wG[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=wG[t++];for(;t<i&&s==(1!=wG[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=wG[--i];for(;i>e&&s==(2!=wG[i-1]);)i--;o.push(new mG(i,t,s?2:1))}else o.push(new mG(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==wG[t++];for(;t<i&&s==(2==wG[t]);)t++;o.push(new mG(e,t,s?1:2))}return o}function yG(t){return[new mG(0,t,0)]}let bG="";function OG(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=mG.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(bG=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class SG{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=_q.get(s),r=_q.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:xG(s))||xG(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=_q.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function xG(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class kG{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class AG extends _q{constructor(t){super(),this.view=t,this.compositionDeco=k_.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new R_],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new rG(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=k_.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=CG(t);if(!i)return k_.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new SG([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return k_.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return k_.none;let d=_q.get(r);d instanceof u_?d=d.widget.topView:d&&(d.parent=null);return k_.set(k_.replace({widget:new TG(r,o,d)}).range(h,l))}(this.view,t.changes)),(h_.ie||h_.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new RG;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=rG.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=h_.chrome||h_.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof E_&&t.widget instanceof MG&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=B_.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);jq(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||h_.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(h_.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new $q(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&Dq(n.node,n.offset,h.anchorNode,h.anchorOffset)&&Dq(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{h_.android&&h_.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=Aq(this.root);if(s.empty){if(h_.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=DG(n.node,n.offset,1==t?1:-1);e&&(n=new $q(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new $q(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new $q(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Aq(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=R_.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(X_)?this.root.activeElement==this.dom:Cq(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=_q.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof R_)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=x_.WidgetBefore&&n.type!=x_.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==x_.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?Tq(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==hG.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof R_){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=Tq(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Xq(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(k_.replace({widget:new MG(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return k_.set(t)}updateDeco(){let t=this.view.pluginField(U_.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(sG),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(U_.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=Vq(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==hG.LTR)}}class MG extends S_{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function CG(t){let e=t.observer.selectionRange,i=e.focusNode&&DG(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof R_){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!_q.get(e);)e=e.previousSibling;let n=e?_q.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof R_)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class TG extends S_{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return u_}}function DG(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Bq(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class RG{constructor(){this.changes=[]}compareRange(t,e){D_(t,e,this.changes)}comparePoint(t,e){D_(t,e,this.changes)}}function EG(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function BG(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function PG(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function LG(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function VG(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function WG(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Tq(d);for(let u=0;u<t.length;u++){let f=t[u];n&&PG(n,f)&&(f=LG(VG(f,n.bottom),n.top));let p=EG(e,f),g=BG(i,f);if(0==p&&0==g)return 3==d.nodeType?NG(d,e,i):WG(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&PG(a,f)?a=VG(a,f.bottom):c&&PG(c,f)&&(c=LG(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?NG(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:WG(s,d,i)}function NG(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=Iq(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(h_.chrome||h_.gecko){Iq(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function HG(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=x_.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:QG(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:QG(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),h_.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Iq(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=R_.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=WG(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function QG(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function IG(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=OG(n,r,t.textDirection,o,i),l=bG;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function zG(t,e,i){let s=t.pluginField(U_.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class FG{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in XG){let i=XG[e];t.contentDOM.addEventListener(e,(s=>{GG(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),h_.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(J_);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{GG(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){G_(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){G_(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(h_.android&&h_.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!h_.ios||!(i=$G.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,zq(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(h_.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!h_.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const $G=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],qG=[16,17,18,20,91,92,224,225];class _G{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(W_);return i.length?i[0](e):h_.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(N_);return i.length?i[0](e):h_.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=Aq(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=oX(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function GG(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=_q.get(s))&&i.ignoreEvent(e))return!1;return!0}const XG=Object.create(null),jG=h_.ie&&h_.ie_version<15||h_.ios&&h_.webkit_version<604;function UG(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=lX&&s.selection.ranges.every((t=>t.empty))&&lX==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}XG.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():qG.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let ZG=0;function YG(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=R_.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}XG.touchstart=(t,e)=>{ZG=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},XG.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},XG.mousedown=(t,e)=>{if(t.observer.flush(),ZG>Date.now()-2e3&&1==oX(e))return;let i=null;for(let s of t.state.facet(H_))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=eX(t,e),s=oX(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=eX(t,e),o=e),!a||!i)return n;let c=YG(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=YG(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>Qq(t.contentDOM))),t.inputState.startMouseSelection(new _G(t,e,i,s))}};let KG=(t,e)=>t>=e.top&&t<=e.bottom,JG=(t,e,i)=>KG(e,i)&&t>=i.left&&t<=i.right;function tX(t,e,i,s){let n=R_.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&JG(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&JG(i,s,h)?1:o&&KG(s,o)?-1:1}function eX(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:tX(t,i,e.clientX,e.clientY)}}const iX=h_.ie&&h_.ie_version<=11;let sX=null,nX=0,rX=0;function oX(t){if(!iX)return t.detail;let e=sX,i=rX;return sX=t,rX=Date.now(),nX=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(nX+1)%3:1}function hX(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}XG.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},XG.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&hX(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else hX(t,e,e.dataTransfer.getData("Text"),!0)},XG.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=jG?null:e.clipboardData;i?(UG(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),UG(t,i.value)}),50)}(t)};let lX=null;function aX(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}XG.copy=XG.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;lX=n?i:null;let r=jG?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},XG.focus=XG.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},XG.compositionstart=XG.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),aX(t,!0)))},XG.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&aX(t,!1)}),50)},XG.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},XG.beforeinput=(t,e)=>{var i;let s;if(h_.chrome&&h_.android&&(s=$G.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const cX=["pre-wrap","normal","pre-line","break-spaces"];class dX{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=hG.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return cX.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=cX.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class uX{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class fX{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new fX(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new fX(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var pX=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(pX||(pX={}));class gX{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return gX.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,pX.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,pX.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,pX.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=OX.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new wX(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new yX(gX.of(t.slice(0,e)),r,gX.of(t.slice(i)))}}gX.prototype.size=1;class mX extends gX{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new fX(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class wX extends mX{constructor(t,e){super(t,e,x_.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof wX||s instanceof vX&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof vX?s=new wX(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):gX.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class vX extends gX{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new fX(l,a,i+o*h,o,x_.Text)}lineAt(t,e,i,s,n){if(e==pX.ByHeight)return this.blockAt(t,i,s,n);if(e==pX.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new fX(e,s-e,0,0,x_.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new fX(h,l,s+o*(a-r),o,x_.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new fX(e.from,e.length,s,h,x_.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof vX?i[i.length-1]=new vX(t.length+s):i.push(null,new vX(s-1))}if(t>0){let e=i[0];e instanceof vX?i[0]=new vX(t+e.length):i.unshift(new vX(t-1),null)}return gX.of(i)}decomposeLeft(t,e){e.push(new vX(t-1),null)}decomposeRight(t,e){e.push(null,new vX(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new vX(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new wX(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new vX(n-r).updateHeight(t,r));let l=gX.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class yX extends gX{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==pX.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==pX.ByPosNoHeight?pX.ByPosNoHeight:pX.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,pX.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&bX(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),bX(n,t)}return gX.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?gX.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function bX(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof vX&&(s=t[e+1])instanceof vX&&t.splice(e-1,3,new vX(i.length+1+s.length))}class OX{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof wX?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new wX(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new mX(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new wX(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new vX(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof wX)return t;let e=new wX(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=x_.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=x_.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof wX||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new wX(0,-1));let i=t;for(let t of this.nodes)t instanceof wX&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new OX(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class SX{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&D_(t,e,this.changes,5)}}function xX(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function kX(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class AX{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return k_.replace({widget:new MX(this.size,t)}).range(this.from,this.to)}}class MX extends S_{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class CX{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new dX,this.scaler=LX,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=gX.empty().applyChanges(t.facet(sG),E.empty,this.heightOracle.setDoc(t.doc),[new rG(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=k_.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new TX(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?LX:new VX(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:WX(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(sG),n=t.changedRanges,r=rG.extendWithRanges(n,function(t,e,i){let s=new SX;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(sG),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?hG.RTL:hG.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?kX:xX)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new uX(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new TX(s.lineAt(r-1e3*i,pX.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),pX.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,pX.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new TX(s.lineAt(i-500,pX.ByHeight,n,0,0).from,s.lineAt(i+r+500,pX.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new TX(this.heightMap.lineAt(i,pX.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,pX.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,pX.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,pX.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new AX(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=hG.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=DX(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=RX(r,(this.visibleTop-i.top-t)/i.height),n=RX(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=RX(r,(this.pixelViewport.left-e)/t),n=RX(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&BX(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&BX(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(PX(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new AX(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=EX(s,i)-EX(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){AX.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=k_.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(sG);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||WX(this.heightMap.lineAt(t,pX.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return WX(this.heightMap.lineAt(this.scaler.fromDOM(t),pX.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return WX(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class TX{constructor(t,e){this.from=t,this.to=e}}function DX(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(sG),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function RX({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function EX(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function BX(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function PX(t,e){for(let i of t)if(e(i))return i}const LX={toDOM:t=>t,fromDOM:t=>t,scale:1};class VX{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,pX.ByPos,t,0,0).top,o=e.lineAt(n,pX.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function WX(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new fX(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>WX(t,e))):t.type)}const NX=et.define({combine:t=>t.join(" ")}),HX=et.define({combine:t=>t.indexOf(!0)>-1}),QX=jt.newName(),IX=jt.newName(),zX=jt.newName(),FX={"&light":"."+IX,"&dark":"."+zX};function $X(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const qX=$X("."+QX,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},FX),_X={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},GX=h_.ie&&h_.ie_version<=11;class XX{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Wq,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(h_.ie&&h_.ie_version<=11||h_.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),GX&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(X_)?e.root.activeElement!=this.dom:!Cq(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((h_.ie&&h_.ie_version<=11||h_.android&&h_.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Dq(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Aq(t),i=h_.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);Dq(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,_X),GX&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),GX&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;zq(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&Cq(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=jX(e,t.previousSibling||t.target.previousSibling,-1),s=jX(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function jX(t,e,i){for(;e;){let s=_q.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function UX(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new kG(i,s)),n==i&&r==s||e.push(new kG(n,r)));return e}(t),c=new SG(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||h_.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(h_.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(X_)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Mq(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!Mq(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(h_.ios&&t.inputState.flushIOSKey(t))return;if(h_.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&zq(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&zq(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&zq(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(z_).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=CG(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class ZX{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new CX(t.state||$t.create()),this.plugins=this.state.facet(Y_).map((t=>new tG(t)));for(let t of this.plugins)t.update(this);this.observer=new XX(this,((t,e,i)=>{UX(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new FG(this),this.docView=new AG(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new oG(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new q_(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(F_)?n=new q_(t.value):t.is($_)?n=new q_(t.value,"center"):t.is(__)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=tj.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(nG)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(NX)!=e.state.facet(NX)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(I_))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new CX(t),this.plugins=t.facet(Y_).map((t=>new tG(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new AG(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Y_),i=t.state.facet(Y_);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new tG(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return G_(this.state,t),JX}})),o=new oG(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=JX)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){G_(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(I_))t(e)}get themeClasses(){return QX+" "+(this.state.facet(HX)?zX:IX)+" "+this.state.facet(NX)}updateAttrs(){let t=ej(this,eG,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(X_)?"true":"false",class:"cm-content",style:`${h_.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),ej(this,iG,e),this.observer.ignore((()=>{O_(this.contentDOM,this.contentAttrs,e),O_(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(ZX.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(nG),jt.mount(this.root,this.styleModules.concat(qX).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=KX(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=KX(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=KX(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return zG(this,t,IG(this,t,e,i))}moveByGroup(t,e){return zG(this,t,IG(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==hG.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=R_.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return zG(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=HG(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:F_.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),HG(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return Lq(i,n[mG.find(n,t-s.from,-1,e)].dir==hG.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>YX)return yG(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=vG(t.text,this.textDirection);return this.bidiCache.push(new tj(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||h_.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Qq(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return __.of(new q_("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return K_.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[NX.of(i),nG.of($X(`.${i}`,t))];return e&&e.dark&&s.push(HX.of(!0)),s}static baseTheme(t){return pt.lowest(nG.of($X("."+QX,t,FX)))}}ZX.scrollTo=F_,ZX.centerOn=$_,ZX.styleModule=nG,ZX.inputHandler=z_,ZX.exceptionSink=Q_,ZX.updateListener=I_,ZX.editable=X_,ZX.mouseSelectionStyle=H_,ZX.dragMovesSelection=N_,ZX.clickAddsSelectionRange=W_,ZX.decorations=sG,ZX.darkTheme=HX,ZX.contentAttributes=iG,ZX.editorAttributes=eG,ZX.lineWrapping=ZX.contentAttributes.of({class:"cm-lineWrapping"}),ZX.announce=Et.define();const YX=4096;function KX(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const JX={};class tj{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:hG.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new tj(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function ej(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&y_(r,i)}return i}const ij=!h_.ios;const sj={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};ij&&(sj[".cm-line"].caretColor="transparent !important");function nj(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),s=t.state.doc.lineAt(i),n=i-s.from,r=n>2e3?-1:n==s.length?function(t,e){let i=t.coordsAtPos(t.viewport.from);return i?Math.round(Math.abs((i.left-e)/t.defaultCharacterWidth)):-1}(t,e.clientX):D(s.text,t.state.tabSize,i-s.from);return{line:s.number,col:r,off:n}}function rj(t,e){let i=nj(t,e),s=t.state.selection;return i?{update(t){if(t.docChanged){let e=t.changes.mapPos(t.startState.doc.line(i.line).from),n=t.state.doc.lineAt(e);i={line:n.number,col:i.col,off:Math.min(i.off,n.length)},s=s.map(t.changes)}},get(e,n,r){let o=nj(t,e);if(!o)return s;let h=function(t,e,i){let s=Math.min(e.line,i.line),n=Math.max(e.line,i.line),r=[];if(e.off>2e3||i.off>2e3||e.col<0||i.col<0){let o=Math.min(e.off,i.off),h=Math.max(e.off,i.off);for(let e=s;e<=n;e++){let i=t.doc.line(e);i.length<=h&&r.push(Y.range(i.from+o,i.to+h))}}else{let o=Math.min(e.col,i.col),h=Math.max(e.col,i.col);for(let e=s;e<=n;e++){let i=t.doc.line(e),s=R(i.text,o,t.tabSize,!0);if(s>-1){let e=R(i.text,h,t.tabSize);r.push(Y.range(i.from+s,i.from+e))}}}return r}(t.state,i,o);return h.length?r?Y.create(h.concat(s.ranges)):Y.create(h):s}}:null}function oj(t){let e=(null==t?void 0:t.eventFilter)||(t=>t.altKey&&0==t.button);return ZX.mouseSelectionStyle.of(((t,i)=>e(i)?rj(t,i):null))}const hj={Alt:[18,t=>t.altKey],Control:[17,t=>t.ctrlKey],Shift:[16,t=>t.shiftKey],Meta:[91,t=>t.metaKey]},lj={style:"cursor: crosshair"};function aj(t={}){let[e,i]=hj[t.key||"Alt"],s=K_.fromClass(class{constructor(t){this.view=t,this.isDown=!1}set(t){this.isDown!=t&&(this.isDown=t,this.view.update([]))}},{eventHandlers:{keydown(t){this.set(t.keyCode==e||i(t))},keyup(t){t.keyCode!=e&&i(t)||this.set(!1)}}});return[s,ZX.contentAttributes.of((t=>{var e;return(null===(e=t.plugin(s))||void 0===e?void 0:e.isDown)?lj:null}))]}function cj(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function dj(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function uj(t,e){if(!e.anchorNode)return!1;try{return dj(t,e.anchorNode)}catch(t){return!1}}function fj(t){return 3==t.nodeType?Aj(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function pj(t,e,i,s){return!!i&&(mj(t,e,i,s,-1)||mj(t,e,i,s,1))}function gj(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function mj(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:wj(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=gj(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?wj(t):0}}}function wj(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const vj={left:0,right:0,top:0,bottom:0};function yj(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function bj(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Oj{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Sj,xj=null;function kj(t){if(t.setActive)return t.setActive();if(xj)return t.focus(xj);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==xj?{get preventScroll(){return xj={preventScroll:!0},!0}}:void 0),!xj){xj=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function Aj(t,e,i=e){let s=Sj||(Sj=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function Mj(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function Cj(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Tj{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Tj(t.parentNode,gj(t),e)}static after(t,e){return new Tj(t.parentNode,gj(t)+1,e)}}const Dj=[];class Rj{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=Rj.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=Ej(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=Ej(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==wj(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Rj.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Dj){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Bj(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Ej(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Rj.prototype.breakAfter=0;class Bj{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Pj(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function Lj(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,Pj(t,a,c,h,l,s,0,n,r)}let Vj="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Wj="undefined"!=typeof document?document:{documentElement:{style:{}}};const Nj=/Edge\/(\d+)/.exec(Vj.userAgent),Hj=/MSIE \d/.test(Vj.userAgent),Qj=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Vj.userAgent),Ij=!!(Hj||Qj||Nj),zj=!Ij&&/gecko\/(\d+)/i.test(Vj.userAgent),Fj=!Ij&&/Chrome\/(\d+)/.exec(Vj.userAgent),$j="webkitFontSmoothing"in Wj.documentElement.style,qj=!Ij&&/Apple Computer/.test(Vj.vendor),_j=qj&&(/Mobile\/\w+/.test(Vj.userAgent)||Vj.maxTouchPoints>2);var Gj={mac:_j||/Mac/.test(Vj.platform),windows:/Win/.test(Vj.platform),linux:/Linux|X11/.test(Vj.platform),ie:Ij,ie_version:Hj?Wj.documentMode||6:Qj?+Qj[1]:Nj?+Nj[1]:0,gecko:zj,gecko_version:zj?+(/Firefox\/(\d+)/.exec(Vj.userAgent)||[0,0])[1]:0,chrome:!!Fj,chrome_version:Fj?+Fj[1]:0,ios:_j,android:/Android\b/.test(Vj.userAgent),webkit:$j,safari:qj,webkit_version:$j?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Wj.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Xj extends Rj{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Xj&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Xj(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Tj(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Uj(this.dom,t,e)}}class jj extends Rj{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Cj(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof jj&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(Lj(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new jj(this.mark,e,r)}domAtPos(t){return eU(this.dom,this.children,t)}coordsAt(t,e){return sU(this,t,e)}}function Uj(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?Gj.chrome||Gj.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=Aj(t,n,r).getClientRects();if(!h.length)return vj;let l=h[(o?o<0:i>=0)?0:h.length-1];return Gj.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?yj(l,o<0):l||null}class Zj extends Rj{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Zj)(t,e,i)}split(t){let e=Zj.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Zj&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Zj&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?Tj.before(this.dom):Tj.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return vj;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:yj(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Yj extends Zj{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Kj(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Tj(i,Math.min(t,i.nodeValue.length)))):new Tj(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Jj(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?Kj(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Uj(s,t,e))):Uj(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function Kj(t,e,i,s,n,r){if(i instanceof jj){for(let o of i.children){let i=dj(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?Kj(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Jj(t,e,i,s){if(i instanceof jj)for(let n of i.children){let i=0,r=dj(n.dom,s);if(dj(n.dom,t))return i+(r?Jj(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class tU extends Rj{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof tU&&t.side==this.side}split(){return new tU(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Tj.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof Xj){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof jj&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function eU(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return Tj.after(i)}return new Tj(t,0)}function iU(t,e,i){let s,{children:n}=t;i>0&&e instanceof jj&&n.length&&(s=n[n.length-1])instanceof jj&&s.mark.eq(e.mark)?iU(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function sU(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?yj(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=fj(s);return n[n.length-1]||null}function nU(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function rU(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function oU(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}Xj.prototype.children=Zj.prototype.children=tU.prototype.children=Dj;class hU{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var lU=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(lU||(lU={}));class aU extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new cU(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new uU(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=fU(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new uU(t,e,i,s,t.widget||null,!0)}static line(t){return new dU(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}aU.none=ee.empty;class cU extends aU{constructor(t){let{start:e,end:i}=fU(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof cU&&this.tagName==t.tagName&&this.class==t.class&&rU(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}cU.prototype.point=!1;class dU extends aU{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof dU&&rU(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}dU.prototype.mapMode=z.TrackBefore,dU.prototype.point=!0;class uU extends aU{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?lU.WidgetRange:this.startSide<=0?lU.WidgetBefore:lU.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof uU&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function fU(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function pU(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}uU.prototype.point=!0;class gU extends Rj{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof gU))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Lj(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new gU;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){rU(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){iU(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=nU(e,this.attrs||{})),i&&(this.attrs=nU({class:i},this.attrs||{}))}domAtPos(t){return eU(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Cj(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(oU(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Rj.get(i)instanceof jj;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=Rj.get(i))||void 0===e?void 0:e.isEditable)||Gj.ios&&this.children.some((t=>t instanceof Xj))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Xj))return null;let i=fj(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return sU(this,t,e)}become(t){return!1}get type(){return lU.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof gU)return n;if(r>e)break}s=r+n.breakAfter}return null}}class mU extends Rj{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof mU&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Tj.before(this.dom):Tj.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new mU(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Dj}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof mU&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class wU{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof mU&&t.type==lU.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new gU),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(vU(new tU(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(vU(new Xj(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof uU)if(i.block){let{type:t}=i;t!=lU.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new mU(i.widget||new yU("div"),r,t))}else{let o=Zj.create(i.widget||new yU("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(vU(new tU(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(vU(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof uU){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new wU(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function vU(t,e){for(let i of e)t=new jj(i,[t],t.length);return t}class yU extends hU{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const bU=[],OU=et.define(),SU=et.define(),xU=et.define(),kU=et.define(),AU=et.define(),MU=et.define(),CU=Et.define({map:(t,e)=>t.map(e)}),TU=Et.define({map:(t,e)=>t.map(e)});class DU{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new DU(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const RU=Et.define({map:(t,e)=>t.map(e)});function EU(t,e,i){let s=t.facet(kU);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const BU=et.define({combine:t=>!t.length||t[0]});class PU{constructor(t,e){this.field=t,this.get=e}}class LU{from(t){return new PU(this,t)}static define(){return new LU}}LU.decorations=LU.define(),LU.atomicRanges=LU.define(),LU.scrollMargins=LU.define();let VU=0;const WU=et.define();class NU{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=WU.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(HU.from((t=>({plugin:t,handlers:i})))),n&&r.push(LU.decorations.from(n)),new NU(VU++,t,r)}static fromClass(t,e){return NU.define((e=>new t(e)),e)}}const HU=LU.define();class QU{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(EU(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){EU(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){EU(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const IU=et.define(),zU=et.define(),FU=et.define(),$U=et.define();class qU{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new qU(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new qU(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new qU(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class _U{constructor(t,e,i=bU){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new qU(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var GU=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(GU||(GU={}));const XU=GU.LTR,jU=GU.RTL;function UU(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const ZU=UU("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),YU=UU("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),KU=Object.create(null),JU=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);KU[e]=i,KU[i]=-e}const tZ=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class eZ{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?jU:XU}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const iZ=[];function sZ(t,e){let i=t.length,s=e==XU?1:2,n=e==XU?2:1;if(!t||1==s&&!tZ.test(t))return nZ(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?ZU[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?YU[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),iZ[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=iZ[t];if(128==s)t<i-1&&e==iZ[t+1]&&24&e?s=iZ[t]=e:iZ[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==iZ[s];)s++;let r=t&&8==e||s<i&&8==iZ[s]?1==n?1:8:256;for(let e=t;e<s;e++)iZ[e]=r;t=s-1}else 8==s&&1==n&&(iZ[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=KU[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(JU[t+1]==-r){let e=JU[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(iZ[h]=iZ[JU[t]]=i),l=t;break}}else{if(189==JU.length)break;JU[l++]=h,JU[l++]=e,JU[l++]=a}else if(2==(o=iZ[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=JU[e+2];if(2&i)break;if(t)JU[e+2]|=2;else{if(4&i)break;JU[e+2]|=4}}}for(let t=0;t<i;t++)if(256==iZ[t]){let e=t+1;for(;e<i&&256==iZ[e];)e++;let n=1==(t?iZ[t-1]:s),r=n==(1==(e<i?iZ[e]:s))?n?1:2:s;for(let i=t;i<e;i++)iZ[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=iZ[t++];for(;t<i&&s==(1!=iZ[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=iZ[--i];for(;i>e&&s==(2!=iZ[i-1]);)i--;o.push(new eZ(i,t,s?2:1))}else o.push(new eZ(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==iZ[t++];for(;t<i&&s==(2==iZ[t]);)t++;o.push(new eZ(e,t,s?1:2))}return o}function nZ(t){return[new eZ(0,t,0)]}let rZ="";function oZ(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=eZ.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(rZ=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class hZ{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=Rj.get(s),r=Rj.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:lZ(s))||lZ(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Rj.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function lZ(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class aZ{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class cZ extends Rj{constructor(t){super(),this.view=t,this.compositionDeco=aU.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new gU],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new qU(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=aU.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=uZ(t);if(!i)return aU.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new hZ([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return aU.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return aU.none;let d=Rj.get(r);d instanceof Yj?d=d.widget.topView:d&&(d.parent=null);return aU.set(aU.replace({widget:new fZ(r,o,d)}).range(h,l))}(this.view,t.changes)),(Gj.ie||Gj.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new gZ;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=qU.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=Gj.chrome||Gj.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof mU&&t.widget instanceof dZ&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=wU.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);Pj(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||Gj.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(Gj.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new Tj(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&pj(n.node,n.offset,h.anchorNode,h.anchorOffset)&&pj(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{Gj.android&&Gj.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=cj(this.root);if(s.empty){if(Gj.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=pZ(n.node,n.offset,1==t?1:-1);e&&(n=new Tj(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new Tj(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new Tj(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=cj(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=gU.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(BU)?this.root.activeElement==this.dom:uj(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Rj.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof gU)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=lU.WidgetBefore&&n.type!=lU.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==lU.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?fj(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==GU.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof gU){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=fj(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Bj(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(aU.replace({widget:new dZ(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return aU.set(t)}updateDeco(){let t=this.view.pluginField(LU.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(FU),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(LU.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=bj(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==GU.LTR)}}class dZ extends hU{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function uZ(t){let e=t.observer.selectionRange,i=e.focusNode&&pZ(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof gU){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Rj.get(e);)e=e.previousSibling;let n=e?Rj.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof gU)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class fZ extends hU{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Yj}}function pZ(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=wj(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class gZ{constructor(){this.changes=[]}compareRange(t,e){pU(t,e,this.changes)}comparePoint(t,e){pU(t,e,this.changes)}}function mZ(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function wZ(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function vZ(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function yZ(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function bZ(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function OZ(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=fj(d);for(let u=0;u<t.length;u++){let f=t[u];n&&vZ(n,f)&&(f=yZ(bZ(f,n.bottom),n.top));let p=mZ(e,f),g=wZ(i,f);if(0==p&&0==g)return 3==d.nodeType?SZ(d,e,i):OZ(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&vZ(a,f)?a=bZ(a,f.bottom):c&&vZ(c,f)&&(c=yZ(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?SZ(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:OZ(s,d,i)}function SZ(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=Aj(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(Gj.chrome||Gj.gecko){Aj(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function xZ(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=lU.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:kZ(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:kZ(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),Gj.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Aj(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=gU.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=OZ(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function kZ(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function AZ(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=oZ(n,r,t.textDirection,o,i),l=rZ;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function MZ(t,e,i){let s=t.pluginField(LU.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class CZ{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in BZ){let i=BZ[e];t.contentDOM.addEventListener(e,(s=>{EZ(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),Gj.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(HU);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{EZ(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){EU(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){EU(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(Gj.android&&Gj.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!Gj.ios||!(i=TZ.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Mj(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(Gj.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!Gj.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const TZ=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],DZ=[16,17,18,20,91,92,224,225];class RZ{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(OU);return i.length?i[0](e):Gj.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(SU);return i.length?i[0](e):Gj.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=cj(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=_Z(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function EZ(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=Rj.get(s))&&i.ignoreEvent(e))return!1;return!0}const BZ=Object.create(null),PZ=Gj.ie&&Gj.ie_version<15||Gj.ios&&Gj.webkit_version<604;function LZ(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=XZ&&s.selection.ranges.every((t=>t.empty))&&XZ==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}BZ.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():DZ.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let VZ=0;function WZ(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=gU.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}BZ.touchstart=(t,e)=>{VZ=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},BZ.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},BZ.mousedown=(t,e)=>{if(t.observer.flush(),VZ>Date.now()-2e3&&1==_Z(e))return;let i=null;for(let s of t.state.facet(xU))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=IZ(t,e),s=_Z(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=IZ(t,e),o=e),!a||!i)return n;let c=WZ(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=WZ(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>kj(t.contentDOM))),t.inputState.startMouseSelection(new RZ(t,e,i,s))}};let NZ=(t,e)=>t>=e.top&&t<=e.bottom,HZ=(t,e,i)=>NZ(e,i)&&t>=i.left&&t<=i.right;function QZ(t,e,i,s){let n=gU.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&HZ(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&HZ(i,s,h)?1:o&&NZ(s,o)?-1:1}function IZ(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:QZ(t,i,e.clientX,e.clientY)}}const zZ=Gj.ie&&Gj.ie_version<=11;let FZ=null,$Z=0,qZ=0;function _Z(t){if(!zZ)return t.detail;let e=FZ,i=qZ;return FZ=t,qZ=Date.now(),$Z=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?($Z+1)%3:1}function GZ(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}BZ.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},BZ.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&GZ(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else GZ(t,e,e.dataTransfer.getData("Text"),!0)},BZ.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=PZ?null:e.clipboardData;i?(LZ(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),LZ(t,i.value)}),50)}(t)};let XZ=null;function jZ(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}BZ.copy=BZ.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;XZ=n?i:null;let r=PZ?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},BZ.focus=BZ.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},BZ.compositionstart=BZ.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),jZ(t,!0)))},BZ.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&jZ(t,!1)}),50)},BZ.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},BZ.beforeinput=(t,e)=>{var i;let s;if(Gj.chrome&&Gj.android&&(s=TZ.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const UZ=["pre-wrap","normal","pre-line","break-spaces"];class ZZ{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=GU.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return UZ.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=UZ.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class YZ{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class KZ{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new KZ(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new KZ(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var JZ=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(JZ||(JZ={}));class tY{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return tY.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,JZ.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,JZ.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,JZ.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=oY.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new iY(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new nY(tY.of(t.slice(0,e)),r,tY.of(t.slice(i)))}}tY.prototype.size=1;class eY extends tY{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new KZ(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class iY extends eY{constructor(t,e){super(t,e,lU.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof iY||s instanceof sY&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof sY?s=new iY(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):tY.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class sY extends tY{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new KZ(l,a,i+o*h,o,lU.Text)}lineAt(t,e,i,s,n){if(e==JZ.ByHeight)return this.blockAt(t,i,s,n);if(e==JZ.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new KZ(e,s-e,0,0,lU.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new KZ(h,l,s+o*(a-r),o,lU.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new KZ(e.from,e.length,s,h,lU.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof sY?i[i.length-1]=new sY(t.length+s):i.push(null,new sY(s-1))}if(t>0){let e=i[0];e instanceof sY?i[0]=new sY(t+e.length):i.unshift(new sY(t-1),null)}return tY.of(i)}decomposeLeft(t,e){e.push(new sY(t-1),null)}decomposeRight(t,e){e.push(null,new sY(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new sY(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new iY(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new sY(n-r).updateHeight(t,r));let l=tY.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class nY extends tY{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==JZ.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==JZ.ByPosNoHeight?JZ.ByPosNoHeight:JZ.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,JZ.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&rY(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),rY(n,t)}return tY.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?tY.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function rY(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof sY&&(s=t[e+1])instanceof sY&&t.splice(e-1,3,new sY(i.length+1+s.length))}class oY{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof iY?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new iY(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new eY(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new iY(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new sY(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof iY)return t;let e=new iY(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=lU.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=lU.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof iY||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new iY(0,-1));let i=t;for(let t of this.nodes)t instanceof iY&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new oY(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class hY{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&pU(t,e,this.changes,5)}}function lY(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function aY(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class cY{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return aU.replace({widget:new dY(this.size,t)}).range(this.from,this.to)}}class dY extends hU{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class uY{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new ZZ,this.scaler=yY,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=tY.empty().applyChanges(t.facet(FU),E.empty,this.heightOracle.setDoc(t.doc),[new qU(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=aU.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new fY(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?yY:new bY(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:OY(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(FU),n=t.changedRanges,r=qU.extendWithRanges(n,function(t,e,i){let s=new hY;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(FU),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?GU.RTL:GU.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?aY:lY)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new YZ(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new fY(s.lineAt(r-1e3*i,JZ.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),JZ.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,JZ.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new fY(s.lineAt(i-500,JZ.ByHeight,n,0,0).from,s.lineAt(i+r+500,JZ.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new fY(this.heightMap.lineAt(i,JZ.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,JZ.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,JZ.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,JZ.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new cY(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=GU.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=pY(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=gY(r,(this.visibleTop-i.top-t)/i.height),n=gY(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=gY(r,(this.pixelViewport.left-e)/t),n=gY(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&wY(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&wY(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(vY(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new cY(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=mY(s,i)-mY(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){cY.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=aU.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(FU);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||OY(this.heightMap.lineAt(t,JZ.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return OY(this.heightMap.lineAt(this.scaler.fromDOM(t),JZ.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return OY(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class fY{constructor(t,e){this.from=t,this.to=e}}function pY(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(FU),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function gY({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function mY(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function wY(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function vY(t,e){for(let i of t)if(e(i))return i}const yY={toDOM:t=>t,fromDOM:t=>t,scale:1};class bY{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,JZ.ByPos,t,0,0).top,o=e.lineAt(n,JZ.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function OY(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new KZ(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>OY(t,e))):t.type)}const SY=et.define({combine:t=>t.join(" ")}),xY=et.define({combine:t=>t.indexOf(!0)>-1}),kY=jt.newName(),AY=jt.newName(),MY=jt.newName(),CY={"&light":"."+AY,"&dark":"."+MY};function TY(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const DY=TY("."+kY,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},CY),RY={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},EY=Gj.ie&&Gj.ie_version<=11;class BY{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Oj,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(Gj.ie&&Gj.ie_version<=11||Gj.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),EY&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(BU)?e.root.activeElement!=this.dom:!uj(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((Gj.ie&&Gj.ie_version<=11||Gj.android&&Gj.chrome)&&!e.state.selection.main.empty&&i.focusNode&&pj(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=cj(t),i=Gj.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);pj(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,RY),EY&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),EY&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Mj(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&uj(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=PY(e,t.previousSibling||t.target.previousSibling,-1),s=PY(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function PY(t,e,i){for(;e;){let s=Rj.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function LY(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new aZ(i,s)),n==i&&r==s||e.push(new aZ(n,r)));return e}(t),c=new hZ(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||Gj.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(Gj.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(BU)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!dj(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!dj(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(Gj.ios&&t.inputState.flushIOSKey(t))return;if(Gj.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&Mj(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&Mj(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&Mj(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(MU).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=uZ(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class VY{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new uY(t.state||$t.create()),this.plugins=this.state.facet(WU).map((t=>new QU(t)));for(let t of this.plugins)t.update(this);this.observer=new BY(this,((t,e,i)=>{LY(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new CZ(this),this.docView=new cZ(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new _U(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new DU(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(CU)?n=new DU(t.value):t.is(TU)?n=new DU(t.value,"center"):t.is(RU)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=QY.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet($U)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(SY)!=e.state.facet(SY)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(AU))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new uY(t),this.plugins=t.facet(WU).map((t=>new QU(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new cZ(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(WU),i=t.state.facet(WU);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new QU(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return EU(this.state,t),HY}})),o=new _U(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=HY)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){EU(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(AU))t(e)}get themeClasses(){return kY+" "+(this.state.facet(xY)?MY:AY)+" "+this.state.facet(SY)}updateAttrs(){let t=IY(this,IU,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(BU)?"true":"false",class:"cm-content",style:`${Gj.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),IY(this,zU,e),this.observer.ignore((()=>{oU(this.contentDOM,this.contentAttrs,e),oU(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(VY.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet($U),jt.mount(this.root,this.styleModules.concat(DY).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=NY(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=NY(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=NY(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return MZ(this,t,AZ(this,t,e,i))}moveByGroup(t,e){return MZ(this,t,AZ(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==GU.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=gU.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return MZ(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=xZ(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:CU.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),xZ(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return yj(i,n[eZ.find(n,t-s.from,-1,e)].dir==GU.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>WY)return nZ(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=sZ(t.text,this.textDirection);return this.bidiCache.push(new QY(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||Gj.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{kj(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return RU.of(new DU("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return NU.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[SY.of(i),$U.of(TY(`.${i}`,t))];return e&&e.dark&&s.push(xY.of(!0)),s}static baseTheme(t){return pt.lowest($U.of(TY("."+kY,t,CY)))}}VY.scrollTo=CU,VY.centerOn=TU,VY.styleModule=$U,VY.inputHandler=MU,VY.exceptionSink=kU,VY.updateListener=AU,VY.editable=BU,VY.mouseSelectionStyle=xU,VY.dragMovesSelection=SU,VY.clickAddsSelectionRange=OU,VY.decorations=FU,VY.darkTheme=xY,VY.contentAttributes=zU,VY.editorAttributes=IU,VY.lineWrapping=VY.contentAttributes.of({class:"cm-lineWrapping"}),VY.announce=Et.define();const WY=4096;function NY(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const HY={};class QY{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:GU.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new QY(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function IY(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&nU(r,i)}return i}const zY=!Gj.ios;const FY={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};zY&&(FY[".cm-line"].caretColor="transparent !important");let $Y=0;class qY{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=$Y++}static define(t){if(null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let e=new qY([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new GY;return e=>e.modified.indexOf(t)>-1?e:GY.get(e.base||e,e.modified.concat(t).sort(((t,e)=>t.id-e.id)))}}let _Y=0;class GY{constructor(){this.instances=[],this.id=_Y++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find((i=>{return i.base==t&&(s=e,n=i.modified,s.length==n.length&&s.every(((t,e)=>t==n[e])));var s,n}));if(i)return i;let s=[],n=new qY(s,t,e);for(let t of e)t.instances.push(n);let r=XY(e);for(let e of t.set)for(let t of r)s.push(GY.get(e,t));return n}}function XY(t){let e=[t];for(let i=0;i<t.length;i++)for(let s of XY(t.slice(0,i).concat(t.slice(i+1))))e.push(s);return e}function jY(t){let e=Object.create(null);for(let i in t){let s=t[i];Array.isArray(s)||(s=[s]);for(let t of i.split(" "))if(t){let i=[],n=2,r=t;for(let e=0;;){if("..."==r&&e>0&&e+3==t.length){n=1;break}let s=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!s)throw new RangeError("Invalid path: "+t);if(i.push("*"==s[0]?null:'"'==s[0][0]?JSON.parse(s[0]):s[0]),e+=s[0].length,e==t.length)break;let o=t[e++];if(e==t.length&&"!"==o){n=0;break}if("/"!=o)throw new RangeError("Invalid path: "+t);r=t.slice(e)}let o=i.length-1,h=i[o];if(!h)throw new RangeError("Invalid path: "+t);let l=new JY(s,n,o>0?i.slice(0,o):null);e[h]=l.sort(e[h])}}return UY.add(e)}const UY=new kf,ZY=et.define({combine:t=>t.length?tK.combinedMatch(t):null}),YY=et.define({combine:t=>t.length?t[0].match:null});function KY(t){return t.facet(ZY)||t.facet(YY)}class JY{constructor(t,e,i,s){this.tags=t,this.mode=e,this.context=i,this.next=s}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}class tK{constructor(t,e){let i;function s(t){let e=jt.newName();return(i||(i=Object.create(null)))["."+e]=t,e}this.map=Object.create(null),this.all="string"==typeof e.all?e.all:e.all?s(e.all):null;for(let e of t){let t=(e.class||s(Object.assign({},e,{tag:null})))+(this.all?" "+this.all:""),i=e.tag;if(Array.isArray(i))for(let e of i)this.map[e.id]=t;else this.map[i.id]=t}this.module=i?new jt(i):null,this.scope=e.scope||null,this.match=this.match.bind(this);let n=[iK];this.module&&n.push(VY.styleModule.of(this.module)),this.extension=n.concat(null==e.themeType?ZY.of(this):ZY.computeN([VY.darkTheme],(t=>t.facet(VY.darkTheme)==("dark"==e.themeType)?[this]:[]))),this.fallback=n.concat(YY.of(this))}match(t,e){if(this.scope&&e!=this.scope)return null;for(let e of t.set){let i=this.map[e.id];if(void 0!==i)return e!=t&&(this.map[t.id]=i),i}return this.map[t.id]=this.all}static combinedMatch(t){if(1==t.length)return t[0].match;let e=t.some((t=>t.scope))?void 0:Object.create(null);return(i,s)=>{let n=e&&e[i.id];if(void 0!==n)return n;let r=null;for(let e of t){let t=e.match(i,s);t&&(r=r?r+" "+t:t)}return e&&(e[i.id]=r),r}}static define(t,e){return new tK(t,e||{})}static get(t,e,i){let s=KY(t);return s&&s(e,i||Mf.none)}}class eK{constructor(t){this.markCache=Object.create(null),this.tree=Bw(t.state),this.decorations=this.buildDeco(t,KY(t.state))}update(t){let e=Bw(t.state),i=KY(t.state),s=i!=t.startState.facet(ZY);e.length<t.view.viewport.to&&!s&&e.type==this.tree.type?this.decorations=this.decorations.map(t.changes):(e!=this.tree||t.viewportChanged||s)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i))}buildDeco(t,e){if(!e||!this.tree.length)return aU.none;let i=new ie;for(let{from:s,to:n}of t.visibleRanges)rK(this.tree,s,n,e,((t,e,s)=>{i.add(t,e,this.markCache[s]||(this.markCache[s]=aU.mark({class:s})))}));return i.finish()}}const iK=pt.high(NU.fromClass(eK,{decorations:t=>t.decorations})),sK=[""];class nK{constructor(t,e,i){this.at=t,this.style=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,s,n,r){let{type:o,from:h,to:l}=t;if(h>=i||l<=e)return;sK[n]=o.name,o.isTop&&(r=o);let a=s,c=o.prop(UY),d=!1;for(;c;){if(!c.context||oK(c.context,sK,n)){for(let t of c.tags){let e=this.style(t,r);e&&(a&&(a+=" "),a+=e,1==c.mode?s+=(s?" ":"")+e:0==c.mode&&(d=!0))}break}c=c.next}if(this.startSpan(t.from,a),d)return;let u=t.tree&&t.tree.prop(kf.mounted);if(u&&u.overlay){let o=t.node.enter(u.overlay[0].from+h,1),c=t.firstChild();for(let d=0,f=h;;d++){let p=d<u.overlay.length?u.overlay[d]:null,g=p?p.from+h:l,m=Math.max(e,f),w=Math.min(i,g);if(m<w&&c)for(;t.from<w&&(this.highlightRange(t,m,w,s,n+1,r),this.startSpan(Math.min(i,t.to),a),!(t.to>=g)&&t.nextSibling()););if(!p||g>i)break;f=p.to+h,f>e&&(this.highlightRange(o.cursor,Math.max(e,p.from+h),Math.min(i,f),s,n,u.tree.type),this.startSpan(f,a))}c&&t.parent()}else if(t.firstChild()){do{if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,s,n+1,r),this.startSpan(Math.min(i,t.to),a)}}while(t.nextSibling());t.parent()}}}function rK(t,e,i,s,n){let r=new nK(e,s,n);r.highlightRange(t.cursor(),e,i,"",0,t.type),r.flush(i)}function oK(t,e,i){if(t.length>i-1)return!1;for(let s=i-1,n=t.length-1;n>=0;n--,s--){let i=t[n];if(i&&i!=e[s])return!1}return!0}const hK=qY.define,lK=hK(),aK=hK(),cK=hK(aK),dK=hK(aK),uK=hK(),fK=hK(uK),pK=hK(uK),gK=hK(),mK=hK(gK),wK=hK(),vK=hK(),yK=hK(),bK=hK(yK),OK=hK(),SK={comment:lK,lineComment:hK(lK),blockComment:hK(lK),docComment:hK(lK),name:aK,variableName:hK(aK),typeName:cK,tagName:hK(cK),propertyName:dK,attributeName:hK(dK),className:hK(aK),labelName:hK(aK),namespace:hK(aK),macroName:hK(aK),literal:uK,string:fK,docString:hK(fK),character:hK(fK),attributeValue:hK(fK),number:pK,integer:hK(pK),float:hK(pK),bool:hK(uK),regexp:hK(uK),escape:hK(uK),color:hK(uK),url:hK(uK),keyword:wK,self:hK(wK),null:hK(wK),atom:hK(wK),unit:hK(wK),modifier:hK(wK),operatorKeyword:hK(wK),controlKeyword:hK(wK),definitionKeyword:hK(wK),moduleKeyword:hK(wK),operator:vK,derefOperator:hK(vK),arithmeticOperator:hK(vK),logicOperator:hK(vK),bitwiseOperator:hK(vK),compareOperator:hK(vK),updateOperator:hK(vK),definitionOperator:hK(vK),typeOperator:hK(vK),controlOperator:hK(vK),punctuation:yK,separator:hK(yK),bracket:bK,angleBracket:hK(bK),squareBracket:hK(bK),paren:hK(bK),brace:hK(bK),content:gK,heading:mK,heading1:hK(mK),heading2:hK(mK),heading3:hK(mK),heading4:hK(mK),heading5:hK(mK),heading6:hK(mK),contentSeparator:hK(gK),list:hK(gK),quote:hK(gK),emphasis:hK(gK),strong:hK(gK),link:hK(gK),monospace:hK(gK),strikethrough:hK(gK),inserted:hK(),deleted:hK(),changed:hK(),invalid:hK(),meta:OK,documentMeta:hK(OK),annotation:hK(OK),processingInstruction:hK(OK),definition:qY.defineModifier(),constant:qY.defineModifier(),function:qY.defineModifier(),standard:qY.defineModifier(),local:qY.defineModifier(),special:qY.defineModifier()},xK=tK.define([{tag:SK.link,textDecoration:"underline"},{tag:SK.heading,textDecoration:"underline",fontWeight:"bold"},{tag:SK.emphasis,fontStyle:"italic"},{tag:SK.strong,fontWeight:"bold"},{tag:SK.strikethrough,textDecoration:"line-through"},{tag:SK.keyword,color:"#708"},{tag:[SK.atom,SK.bool,SK.url,SK.contentSeparator,SK.labelName],color:"#219"},{tag:[SK.literal,SK.inserted],color:"#164"},{tag:[SK.string,SK.deleted],color:"#a11"},{tag:[SK.regexp,SK.escape,SK.special(SK.string)],color:"#e40"},{tag:SK.definition(SK.variableName),color:"#00f"},{tag:SK.local(SK.variableName),color:"#30a"},{tag:[SK.typeName,SK.namespace],color:"#085"},{tag:SK.className,color:"#167"},{tag:[SK.special(SK.variableName),SK.macroName],color:"#256"},{tag:SK.definition(SK.propertyName),color:"#00c"},{tag:SK.comment,color:"#940"},{tag:SK.meta,color:"#7a757a"},{tag:SK.invalid,color:"#f00"}]);SK.link,SK.heading,SK.emphasis,SK.strong,SK.keyword,SK.atom,SK.bool,SK.url,SK.labelName,SK.inserted,SK.deleted,SK.literal,SK.string,SK.number,SK.regexp,SK.escape,SK.string,SK.variableName,SK.variableName,SK.variableName,SK.variableName,SK.propertyName,SK.typeName,SK.namespace,SK.className,SK.macroName,SK.propertyName,SK.operator,SK.comment,SK.meta,SK.invalid,SK.punctuation;function kK(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function AK(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function MK(t,e){if(!e.anchorNode)return!1;try{return AK(t,e.anchorNode)}catch(t){return!1}}function CK(t){return 3==t.nodeType?QK(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function TK(t,e,i,s){return!!i&&(RK(t,e,i,s,-1)||RK(t,e,i,s,1))}function DK(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function RK(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:EK(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=DK(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?EK(t):0}}}function EK(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const BK={left:0,right:0,top:0,bottom:0};function PK(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function LK(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class VK{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let WK,NK=null;function HK(t){if(t.setActive)return t.setActive();if(NK)return t.focus(NK);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==NK?{get preventScroll(){return NK={preventScroll:!0},!0}}:void 0),!NK){NK=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function QK(t,e,i=e){let s=WK||(WK=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function IK(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function zK(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class FK{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new FK(t.parentNode,DK(t),e)}static after(t,e){return new FK(t.parentNode,DK(t)+1,e)}}const $K=[];class qK{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=qK.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=_K(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=_K(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==EK(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!qK.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=$K){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new GK(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function _K(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}qK.prototype.breakAfter=0;class GK{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function XK(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function jK(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,XK(t,a,c,h,l,s,0,n,r)}let UK="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},ZK="undefined"!=typeof document?document:{documentElement:{style:{}}};const YK=/Edge\/(\d+)/.exec(UK.userAgent),KK=/MSIE \d/.test(UK.userAgent),JK=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(UK.userAgent),tJ=!!(KK||JK||YK),eJ=!tJ&&/gecko\/(\d+)/i.test(UK.userAgent),iJ=!tJ&&/Chrome\/(\d+)/.exec(UK.userAgent),sJ="webkitFontSmoothing"in ZK.documentElement.style,nJ=!tJ&&/Apple Computer/.test(UK.vendor),rJ=nJ&&(/Mobile\/\w+/.test(UK.userAgent)||UK.maxTouchPoints>2);var oJ={mac:rJ||/Mac/.test(UK.platform),windows:/Win/.test(UK.platform),linux:/Linux|X11/.test(UK.platform),ie:tJ,ie_version:KK?ZK.documentMode||6:JK?+JK[1]:YK?+YK[1]:0,gecko:eJ,gecko_version:eJ?+(/Firefox\/(\d+)/.exec(UK.userAgent)||[0,0])[1]:0,chrome:!!iJ,chrome_version:iJ?+iJ[1]:0,ios:rJ,android:/Android\b/.test(UK.userAgent),webkit:sJ,safari:nJ,webkit_version:sJ?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=ZK.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class hJ extends qK{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof hJ&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new hJ(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new FK(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return aJ(this.dom,t,e)}}class lJ extends qK{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(zK(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof lJ&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(jK(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new lJ(this.mark,e,r)}domAtPos(t){return gJ(this.dom,this.children,t)}coordsAt(t,e){return wJ(this,t,e)}}function aJ(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?oJ.chrome||oJ.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=QK(t,n,r).getClientRects();if(!h.length)return BK;let l=h[(o?o<0:i>=0)?0:h.length-1];return oJ.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?PK(l,o<0):l||null}class cJ extends qK{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||cJ)(t,e,i)}split(t){let e=cJ.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof cJ&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof cJ&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?FK.before(this.dom):FK.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return BK;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:PK(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class dJ extends cJ{domAtPos(t){let{topView:e,text:i}=this.widget;return e?uJ(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new FK(i,Math.min(t,i.nodeValue.length)))):new FK(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?fJ(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?uJ(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>aJ(s,t,e))):aJ(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function uJ(t,e,i,s,n,r){if(i instanceof lJ){for(let o of i.children){let i=AK(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?uJ(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function fJ(t,e,i,s){if(i instanceof lJ)for(let n of i.children){let i=0,r=AK(n.dom,s);if(AK(n.dom,t))return i+(r?fJ(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class pJ extends qK{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof pJ&&t.side==this.side}split(){return new pJ(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return FK.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof hJ){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof lJ&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function gJ(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return FK.after(i)}return new FK(t,0)}function mJ(t,e,i){let s,{children:n}=t;i>0&&e instanceof lJ&&n.length&&(s=n[n.length-1])instanceof lJ&&s.mark.eq(e.mark)?mJ(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function wJ(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?PK(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=CK(s);return n[n.length-1]||null}function vJ(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function yJ(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function bJ(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}hJ.prototype.children=cJ.prototype.children=pJ.prototype.children=$K;class OJ{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var SJ=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(SJ||(SJ={}));class xJ extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new kJ(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new MJ(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=CJ(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new MJ(t,e,i,s,t.widget||null,!0)}static line(t){return new AJ(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}xJ.none=ee.empty;class kJ extends xJ{constructor(t){let{start:e,end:i}=CJ(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof kJ&&this.tagName==t.tagName&&this.class==t.class&&yJ(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}kJ.prototype.point=!1;class AJ extends xJ{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof AJ&&yJ(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}AJ.prototype.mapMode=z.TrackBefore,AJ.prototype.point=!0;class MJ extends xJ{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?SJ.WidgetRange:this.startSide<=0?SJ.WidgetBefore:SJ.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof MJ&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function CJ(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function TJ(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}MJ.prototype.point=!0;class DJ extends qK{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof DJ))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),jK(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new DJ;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){yJ(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){mJ(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=vJ(e,this.attrs||{})),i&&(this.attrs=vJ({class:i},this.attrs||{}))}domAtPos(t){return gJ(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(zK(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(bJ(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&qK.get(i)instanceof lJ;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=qK.get(i))||void 0===e?void 0:e.isEditable)||oJ.ios&&this.children.some((t=>t instanceof hJ))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof hJ))return null;let i=CK(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return wJ(this,t,e)}become(t){return!1}get type(){return SJ.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof DJ)return n;if(r>e)break}s=r+n.breakAfter}return null}}class RJ extends qK{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof RJ&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?FK.before(this.dom):FK.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new RJ(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return $K}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof RJ&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class EJ{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof RJ&&t.type==SJ.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new DJ),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(BJ(new pJ(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(BJ(new hJ(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof MJ)if(i.block){let{type:t}=i;t!=SJ.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new RJ(i.widget||new PJ("div"),r,t))}else{let o=cJ.create(i.widget||new PJ("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(BJ(new pJ(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(BJ(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof MJ){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new EJ(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function BJ(t,e){for(let i of e)t=new lJ(i,[t],t.length);return t}class PJ extends OJ{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const LJ=[],VJ=et.define(),WJ=et.define(),NJ=et.define(),HJ=et.define(),QJ=et.define(),IJ=et.define(),zJ=Et.define({map:(t,e)=>t.map(e)}),FJ=Et.define({map:(t,e)=>t.map(e)});class $J{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new $J(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const qJ=Et.define({map:(t,e)=>t.map(e)});function _J(t,e,i){let s=t.facet(HJ);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const GJ=et.define({combine:t=>!t.length||t[0]});class XJ{constructor(t,e){this.field=t,this.get=e}}class jJ{from(t){return new XJ(this,t)}static define(){return new jJ}}jJ.decorations=jJ.define(),jJ.atomicRanges=jJ.define(),jJ.scrollMargins=jJ.define();let UJ=0;const ZJ=et.define();class YJ{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=ZJ.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(KJ.from((t=>({plugin:t,handlers:i})))),n&&r.push(jJ.decorations.from(n)),new YJ(UJ++,t,r)}static fromClass(t,e){return YJ.define((e=>new t(e)),e)}}const KJ=jJ.define();class JJ{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(_J(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){_J(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){_J(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const t0=et.define(),e0=et.define(),i0=et.define(),s0=et.define();class n0{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new n0(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new n0(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new n0(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class r0{constructor(t,e,i=LJ){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new n0(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var o0=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(o0||(o0={}));const h0=o0.LTR,l0=o0.RTL;function a0(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const c0=a0("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),d0=a0("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),u0=Object.create(null),f0=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);u0[e]=i,u0[i]=-e}const p0=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class g0{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?l0:h0}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const m0=[];function w0(t,e){let i=t.length,s=e==h0?1:2,n=e==h0?2:1;if(!t||1==s&&!p0.test(t))return v0(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?c0[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?d0[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),m0[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=m0[t];if(128==s)t<i-1&&e==m0[t+1]&&24&e?s=m0[t]=e:m0[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==m0[s];)s++;let r=t&&8==e||s<i&&8==m0[s]?1==n?1:8:256;for(let e=t;e<s;e++)m0[e]=r;t=s-1}else 8==s&&1==n&&(m0[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=u0[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(f0[t+1]==-r){let e=f0[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(m0[h]=m0[f0[t]]=i),l=t;break}}else{if(189==f0.length)break;f0[l++]=h,f0[l++]=e,f0[l++]=a}else if(2==(o=m0[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=f0[e+2];if(2&i)break;if(t)f0[e+2]|=2;else{if(4&i)break;f0[e+2]|=4}}}for(let t=0;t<i;t++)if(256==m0[t]){let e=t+1;for(;e<i&&256==m0[e];)e++;let n=1==(t?m0[t-1]:s),r=n==(1==(e<i?m0[e]:s))?n?1:2:s;for(let i=t;i<e;i++)m0[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=m0[t++];for(;t<i&&s==(1!=m0[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=m0[--i];for(;i>e&&s==(2!=m0[i-1]);)i--;o.push(new g0(i,t,s?2:1))}else o.push(new g0(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==m0[t++];for(;t<i&&s==(2==m0[t]);)t++;o.push(new g0(e,t,s?1:2))}return o}function v0(t){return[new g0(0,t,0)]}let y0="";function b0(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=g0.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(y0=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class O0{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=qK.get(s),r=qK.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:S0(s))||S0(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=qK.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function S0(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class x0{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class k0 extends qK{constructor(t){super(),this.view=t,this.compositionDeco=xJ.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new DJ],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new n0(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=xJ.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=M0(t);if(!i)return xJ.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new O0([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return xJ.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return xJ.none;let d=qK.get(r);d instanceof dJ?d=d.widget.topView:d&&(d.parent=null);return xJ.set(xJ.replace({widget:new C0(r,o,d)}).range(h,l))}(this.view,t.changes)),(oJ.ie||oJ.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new D0;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=n0.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=oJ.chrome||oJ.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof RJ&&t.widget instanceof A0&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=EJ.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);XK(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||oJ.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(oJ.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new FK(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&TK(n.node,n.offset,h.anchorNode,h.anchorOffset)&&TK(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{oJ.android&&oJ.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=kK(this.root);if(s.empty){if(oJ.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=T0(n.node,n.offset,1==t?1:-1);e&&(n=new FK(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new FK(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new FK(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=kK(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=DJ.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(GJ)?this.root.activeElement==this.dom:MK(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=qK.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof DJ)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=SJ.WidgetBefore&&n.type!=SJ.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==SJ.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?CK(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==o0.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof DJ){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=CK(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new GK(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(xJ.replace({widget:new A0(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return xJ.set(t)}updateDeco(){let t=this.view.pluginField(jJ.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(i0),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(jJ.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=LK(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==o0.LTR)}}class A0 extends OJ{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function M0(t){let e=t.observer.selectionRange,i=e.focusNode&&T0(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof DJ){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!qK.get(e);)e=e.previousSibling;let n=e?qK.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof DJ)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class C0 extends OJ{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return dJ}}function T0(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=EK(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class D0{constructor(){this.changes=[]}compareRange(t,e){TJ(t,e,this.changes)}comparePoint(t,e){TJ(t,e,this.changes)}}function R0(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function E0(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function B0(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function P0(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function L0(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function V0(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=CK(d);for(let u=0;u<t.length;u++){let f=t[u];n&&B0(n,f)&&(f=P0(L0(f,n.bottom),n.top));let p=R0(e,f),g=E0(i,f);if(0==p&&0==g)return 3==d.nodeType?W0(d,e,i):V0(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&B0(a,f)?a=L0(a,f.bottom):c&&B0(c,f)&&(c=P0(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?W0(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:V0(s,d,i)}function W0(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=QK(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(oJ.chrome||oJ.gecko){QK(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function N0(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=SJ.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:H0(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:H0(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),oJ.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return QK(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=DJ.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=V0(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function H0(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function Q0(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=b0(n,r,t.textDirection,o,i),l=y0;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function I0(t,e,i){let s=t.pluginField(jJ.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class z0{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in G0){let i=G0[e];t.contentDOM.addEventListener(e,(s=>{_0(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),oJ.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(KJ);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{_0(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){_J(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){_J(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(oJ.android&&oJ.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!oJ.ios||!(i=F0.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,IK(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(oJ.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!oJ.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const F0=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],$0=[16,17,18,20,91,92,224,225];class q0{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(VJ);return i.length?i[0](e):oJ.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(WJ);return i.length?i[0](e):oJ.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=kK(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=r1(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function _0(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=qK.get(s))&&i.ignoreEvent(e))return!1;return!0}const G0=Object.create(null),X0=oJ.ie&&oJ.ie_version<15||oJ.ios&&oJ.webkit_version<604;function j0(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=h1&&s.selection.ranges.every((t=>t.empty))&&h1==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}G0.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():$0.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let U0=0;function Z0(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=DJ.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}G0.touchstart=(t,e)=>{U0=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},G0.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},G0.mousedown=(t,e)=>{if(t.observer.flush(),U0>Date.now()-2e3&&1==r1(e))return;let i=null;for(let s of t.state.facet(NJ))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=t1(t,e),s=r1(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=t1(t,e),o=e),!a||!i)return n;let c=Z0(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=Z0(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>HK(t.contentDOM))),t.inputState.startMouseSelection(new q0(t,e,i,s))}};let Y0=(t,e)=>t>=e.top&&t<=e.bottom,K0=(t,e,i)=>Y0(e,i)&&t>=i.left&&t<=i.right;function J0(t,e,i,s){let n=DJ.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&K0(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&K0(i,s,h)?1:o&&Y0(s,o)?-1:1}function t1(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:J0(t,i,e.clientX,e.clientY)}}const e1=oJ.ie&&oJ.ie_version<=11;let i1=null,s1=0,n1=0;function r1(t){if(!e1)return t.detail;let e=i1,i=n1;return i1=t,n1=Date.now(),s1=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(s1+1)%3:1}function o1(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}G0.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},G0.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&o1(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else o1(t,e,e.dataTransfer.getData("Text"),!0)},G0.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=X0?null:e.clipboardData;i?(j0(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),j0(t,i.value)}),50)}(t)};let h1=null;function l1(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}G0.copy=G0.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;h1=n?i:null;let r=X0?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},G0.focus=G0.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},G0.compositionstart=G0.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),l1(t,!0)))},G0.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&l1(t,!1)}),50)},G0.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},G0.beforeinput=(t,e)=>{var i;let s;if(oJ.chrome&&oJ.android&&(s=F0.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const a1=["pre-wrap","normal","pre-line","break-spaces"];class c1{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=o0.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return a1.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=a1.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class d1{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class u1{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new u1(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new u1(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var f1=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(f1||(f1={}));class p1{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return p1.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,f1.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,f1.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,f1.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=b1.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new m1(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new v1(p1.of(t.slice(0,e)),r,p1.of(t.slice(i)))}}p1.prototype.size=1;class g1 extends p1{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new u1(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class m1 extends g1{constructor(t,e){super(t,e,SJ.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof m1||s instanceof w1&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof w1?s=new m1(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):p1.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class w1 extends p1{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new u1(l,a,i+o*h,o,SJ.Text)}lineAt(t,e,i,s,n){if(e==f1.ByHeight)return this.blockAt(t,i,s,n);if(e==f1.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new u1(e,s-e,0,0,SJ.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new u1(h,l,s+o*(a-r),o,SJ.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new u1(e.from,e.length,s,h,SJ.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof w1?i[i.length-1]=new w1(t.length+s):i.push(null,new w1(s-1))}if(t>0){let e=i[0];e instanceof w1?i[0]=new w1(t+e.length):i.unshift(new w1(t-1),null)}return p1.of(i)}decomposeLeft(t,e){e.push(new w1(t-1),null)}decomposeRight(t,e){e.push(null,new w1(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new w1(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new m1(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new w1(n-r).updateHeight(t,r));let l=p1.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class v1 extends p1{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==f1.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==f1.ByPosNoHeight?f1.ByPosNoHeight:f1.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,f1.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&y1(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),y1(n,t)}return p1.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?p1.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function y1(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof w1&&(s=t[e+1])instanceof w1&&t.splice(e-1,3,new w1(i.length+1+s.length))}class b1{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof m1?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new m1(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new g1(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new m1(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new w1(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof m1)return t;let e=new m1(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=SJ.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=SJ.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof m1||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new m1(0,-1));let i=t;for(let t of this.nodes)t instanceof m1&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new b1(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class O1{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&TJ(t,e,this.changes,5)}}function S1(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function x1(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class k1{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return xJ.replace({widget:new A1(this.size,t)}).range(this.from,this.to)}}class A1 extends OJ{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class M1{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new c1,this.scaler=P1,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=p1.empty().applyChanges(t.facet(i0),E.empty,this.heightOracle.setDoc(t.doc),[new n0(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=xJ.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new C1(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?P1:new L1(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:V1(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(i0),n=t.changedRanges,r=n0.extendWithRanges(n,function(t,e,i){let s=new O1;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(i0),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?o0.RTL:o0.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?x1:S1)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new d1(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new C1(s.lineAt(r-1e3*i,f1.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),f1.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,f1.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new C1(s.lineAt(i-500,f1.ByHeight,n,0,0).from,s.lineAt(i+r+500,f1.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new C1(this.heightMap.lineAt(i,f1.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,f1.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,f1.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,f1.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new k1(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=o0.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=T1(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=D1(r,(this.visibleTop-i.top-t)/i.height),n=D1(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=D1(r,(this.pixelViewport.left-e)/t),n=D1(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&E1(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&E1(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(B1(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new k1(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=R1(s,i)-R1(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){k1.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=xJ.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(i0);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||V1(this.heightMap.lineAt(t,f1.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return V1(this.heightMap.lineAt(this.scaler.fromDOM(t),f1.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return V1(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class C1{constructor(t,e){this.from=t,this.to=e}}function T1(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(i0),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function D1({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function R1(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function E1(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function B1(t,e){for(let i of t)if(e(i))return i}const P1={toDOM:t=>t,fromDOM:t=>t,scale:1};class L1{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,f1.ByPos,t,0,0).top,o=e.lineAt(n,f1.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function V1(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new u1(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>V1(t,e))):t.type)}const W1=et.define({combine:t=>t.join(" ")}),N1=et.define({combine:t=>t.indexOf(!0)>-1}),H1=jt.newName(),Q1=jt.newName(),I1=jt.newName(),z1={"&light":"."+Q1,"&dark":"."+I1};function F1(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const $1=F1("."+H1,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},z1),q1={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},_1=oJ.ie&&oJ.ie_version<=11;class G1{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new VK,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(oJ.ie&&oJ.ie_version<=11||oJ.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),_1&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(GJ)?e.root.activeElement!=this.dom:!MK(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((oJ.ie&&oJ.ie_version<=11||oJ.android&&oJ.chrome)&&!e.state.selection.main.empty&&i.focusNode&&TK(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=kK(t),i=oJ.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);TK(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,q1),_1&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),_1&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;IK(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&MK(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=X1(e,t.previousSibling||t.target.previousSibling,-1),s=X1(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function X1(t,e,i){for(;e;){let s=qK.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function j1(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new x0(i,s)),n==i&&r==s||e.push(new x0(n,r)));return e}(t),c=new O0(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||oJ.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(oJ.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(GJ)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!AK(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!AK(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(oJ.ios&&t.inputState.flushIOSKey(t))return;if(oJ.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&IK(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&IK(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&IK(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(IJ).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=M0(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class U1{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new M1(t.state||$t.create()),this.plugins=this.state.facet(ZJ).map((t=>new JJ(t)));for(let t of this.plugins)t.update(this);this.observer=new G1(this,((t,e,i)=>{j1(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new z0(this),this.docView=new k0(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new r0(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new $J(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(zJ)?n=new $J(t.value):t.is(FJ)?n=new $J(t.value,"center"):t.is(qJ)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=J1.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(s0)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(W1)!=e.state.facet(W1)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(QJ))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new M1(t),this.plugins=t.facet(ZJ).map((t=>new JJ(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new k0(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ZJ),i=t.state.facet(ZJ);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new JJ(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return _J(this.state,t),K1}})),o=new r0(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=K1)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){_J(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(QJ))t(e)}get themeClasses(){return H1+" "+(this.state.facet(N1)?I1:Q1)+" "+this.state.facet(W1)}updateAttrs(){let t=t2(this,t0,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(GJ)?"true":"false",class:"cm-content",style:`${oJ.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),t2(this,e0,e),this.observer.ignore((()=>{bJ(this.contentDOM,this.contentAttrs,e),bJ(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(U1.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(s0),jt.mount(this.root,this.styleModules.concat($1).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Y1(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Y1(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Y1(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return I0(this,t,Q0(this,t,e,i))}moveByGroup(t,e){return I0(this,t,Q0(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==o0.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=DJ.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return I0(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=N0(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:zJ.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),N0(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return PK(i,n[g0.find(n,t-s.from,-1,e)].dir==o0.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Z1)return v0(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=w0(t.text,this.textDirection);return this.bidiCache.push(new J1(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||oJ.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{HK(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return qJ.of(new $J("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return YJ.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[W1.of(i),s0.of(F1(`.${i}`,t))];return e&&e.dark&&s.push(N1.of(!0)),s}static baseTheme(t){return pt.lowest(s0.of(F1("."+H1,t,z1)))}}U1.scrollTo=zJ,U1.centerOn=FJ,U1.styleModule=s0,U1.inputHandler=IJ,U1.exceptionSink=HJ,U1.updateListener=QJ,U1.editable=GJ,U1.mouseSelectionStyle=NJ,U1.dragMovesSelection=WJ,U1.clickAddsSelectionRange=VJ,U1.decorations=i0,U1.darkTheme=N1,U1.contentAttributes=e0,U1.editorAttributes=t0,U1.lineWrapping=U1.contentAttributes.of({class:"cm-lineWrapping"}),U1.announce=Et.define();const Z1=4096;function Y1(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const K1={};class J1{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:o0.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new J1(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function t2(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&vJ(r,i)}return i}const e2=!oJ.ios;const i2={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};e2&&(i2[".cm-line"].caretColor="transparent !important");class s2{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class n2{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let s=xJ.set(t.map((t=>t.from==t.to||t.from==t.to-1&&i.doc.lineAt(t.from).to==t.from?xJ.widget({widget:new v2(t),diagnostic:t}).range(t.from):xJ.mark({attributes:{class:"cm-lintRange cm-lintRange-"+t.severity},diagnostic:t}).range(t.from,t.to))),!0);return new n2(s,e,r2(s))}}function r2(t,e=null,i=0){let s=null;return t.between(i,1e9,((t,i,{spec:n})=>{if(!e||n.diagnostic==e)return s=new s2(t,i,n.diagnostic),!1})),s}function o2(t,e){return t.field(c2,!1)?e:e.concat(Et.appendConfig.of([c2,U1.decorations.compute([c2],(t=>{let{selected:e,panel:i}=t.field(c2);return e&&i&&e.from!=e.to?xJ.set([d2.range(e.from,e.to)]):xJ.none})),B$(u2),x2]))}const h2=Et.define(),l2=Et.define(),a2=Et.define(),c2=ht.define({create:()=>new n2(xJ.none,null,null),update(t,e){if(e.docChanged){let i=t.diagnostics.map(e.changes),s=null;if(t.selected){let n=e.changes.mapPos(t.selected.from,1);s=r2(i,t.selected.diagnostic,n)||r2(i,null,n)}t=new n2(i,t.panel,s)}for(let i of e.effects)i.is(h2)?t=n2.init(i.value,t.panel,e.state):i.is(l2)?t=new n2(t.diagnostics,i.value?b2.open:null,t.selected):i.is(a2)&&(t=new n2(t.diagnostics,t.panel,i.value));return t},provide:t=>[zH.from(t,(t=>t.panel)),U1.decorations.from(t,(t=>t.diagnostics))]});const d2=xJ.mark({class:"cm-lintRange cm-lintRange-active"});function u2(t,e,i){let{diagnostics:s}=t.state.field(c2),n=[],r=2e8,o=0;return s.between(e-(i<0?1:0),e+(i>0?1:0),((t,s,{spec:h})=>{e>=t&&e<=s&&(t==s||(e>t||i>0)&&(e<s||i<0))&&(n.push(h.diagnostic),r=Math.min(t,r),o=Math.max(s,o))})),n.length?{pos:r,end:o,above:t.state.doc.lineAt(r).to<o,create:()=>({dom:f2(t,n)})}:null}function f2(t,e){return FH("ul",{class:"cm-tooltip-lint"},e.map((e=>w2(t,e,!1))))}const p2=t=>{let e=t.state.field(c2,!1);return!(!e||!e.panel)&&(t.dispatch({effects:l2.of(!1)}),!0)},g2=[{key:"Mod-Shift-m",run:t=>{let e=t.state.field(c2,!1);e&&e.panel||t.dispatch({effects:o2(t.state,[l2.of(!0)])});let i=WH(t,b2.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0}},{key:"F8",run:t=>{let e=t.state.field(c2,!1);if(!e)return!1;let i=t.state.selection.main,s=e.diagnostics.iter(i.to+1);return!(!s.value&&(s=e.diagnostics.iter(0),!s.value||s.from==i.from&&s.to==i.to))&&(t.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0}),!0)}}];function m2(t){let e=[];if(t)t:for(let{name:i}of t){for(let t=0;t<i.length;t++){let s=i[t];if(/[a-zA-Z]/.test(s)&&!e.some((t=>t.toLowerCase()==s.toLowerCase()))){e.push(s);continue t}}e.push("")}return e}function w2(t,e,i){var s;let n=i?m2(e.actions):[];return FH("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},FH("span",{class:"cm-diagnosticText"},e.message),null===(s=e.actions)||void 0===s?void 0:s.map(((i,s)=>{let r=s=>{s.preventDefault();let n=r2(t.state.field(c2).diagnostics,e);n&&i.apply(t,n.from,n.to)},{name:o}=i,h=n[s]?o.indexOf(n[s]):-1,l=h<0?o:[o.slice(0,h),FH("u",o.slice(h,h+1)),o.slice(h+1)];return FH("button",{type:"button",class:"cm-diagnosticAction",onclick:r,onmousedown:r,"aria-label":` Action: ${o}${h<0?"":` (access key "${n[s]})"`}.`},l)})),e.source&&FH("div",{class:"cm-diagnosticSource"},e.source))}class v2 extends OJ{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return FH("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class y2{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=w2(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class b2{constructor(t){this.view=t,this.items=[];this.list=FH("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e=>{if(27==e.keyCode)p2(this.view),this.view.focus();else if(38==e.keyCode||33==e.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==e.keyCode||34==e.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==e.keyCode)this.moveSelection(0);else if(35==e.keyCode)this.moveSelection(this.items.length-1);else if(13==e.keyCode)this.view.focus();else{if(!(e.keyCode>=65&&e.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],s=m2(i.actions);for(let n=0;n<s.length;n++)if(s[n].toUpperCase().charCodeAt(0)==e.keyCode){let e=r2(this.view.state.field(c2).diagnostics,i);e&&i.actions[n].apply(t,e.from,e.to)}}}e.preventDefault()},onclick:t=>{for(let e=0;e<this.items.length;e++)this.items[e].dom.contains(t.target)&&this.moveSelection(e)}}),this.dom=FH("div",{class:"cm-panel-lint"},this.list,FH("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>p2(this.view)},"×")),this.update()}get selectedIndex(){let t=this.view.state.field(c2).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(c2),i=0,s=!1,n=null;for(t.between(0,this.view.state.doc.length,((t,r,{spec:o})=>{let h,l=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==o.diagnostic){l=t;break}l<0?(h=new y2(this.view,o.diagnostic),this.items.splice(i,0,h),s=!0):(h=this.items[l],l>i&&(this.items.splice(i,l-i),s=!0)),e&&h.diagnostic==e.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),n=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),i++}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)s=!0,this.items.pop();0==this.items.length&&(this.items.push(new y2(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),s=!0),n?(this.list.setAttribute("aria-activedescendant",n.id),this.view.requestMeasure({key:this,read:()=>({sel:n.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:t,panel:e})=>{t.top<e.top?this.list.scrollTop-=e.top-t.top:t.bottom>e.bottom&&(this.list.scrollTop+=t.bottom-e.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),s&&this.sync()}sync(){let t=this.list.firstChild;function e(){let e=t;t=e.nextSibling,e.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=r2(this.view.state.field(c2).diagnostics,this.items[t].diagnostic);e&&this.view.dispatch({selection:{anchor:e.from,head:e.to},scrollIntoView:!0,effects:a2.of(e)})}static open(t){return new b2(t)}}function O2(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function S2(t){return O2(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const x2=U1.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:S2("#d11")},".cm-lintRange-warning":{backgroundImage:S2("orange")},".cm-lintRange-info":{backgroundImage:S2("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});const k2=[hS(),dS(),Br(),ka(),TS(),ur(),kr(),$t.allowMultipleSelections.of(!0),nv(),xK.fallback,gM(),sE(),pq(),oj(),aj(),Wr(),nQ(),rr.of([...lE,...vC,...LQ,...Ia,...OS,...Oq,...gq,...g2])];class A2{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),C2.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),C2.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new R2(this),n=new R2(t);for(let t=e,r=e;;){if(s.next(t),n.next(t),t=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(r+=s.value.length,s.done||r>=i)return!0}}iter(t=1){return new R2(this,t)}iterRange(t,e=this.length){return new E2(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new B2(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new M2(t):C2.from(M2.split(t,[])):A2.empty}}class M2 extends A2{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((e?i:o)>=t)return new P2(s,o,i,r);s=o+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new M2(D2(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&s){let t=i.pop(),e=T2(n.text,t.text.slice(),0,n.length);if(e.length<=32)i.push(new M2(e,t.length+n.length));else{let t=e.length>>1;i.push(new M2(e.slice(0,t)),new M2(e.slice(t)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof M2))return super.replace(t,e,i);let s=T2(this.text,T2(i.text,D2(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new M2(s,n):C2.from(M2.split(s,[]),n)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<=e&&r<this.text.length;r++){let o=this.text[r],h=n+o.length;n>t&&r&&(s+=i),t<h&&e>n&&(s+=o.slice(Math.max(0,t-n),e-n)),n=h+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,32==i.length&&(e.push(new M2(i,s)),i=[],s=-1);return s>-1&&e.push(new M2(i,s)),e}}class C2 extends A2{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,h=i+r.lines-1;if((e?h:o)>=t)return r.lineInner(t,e,i,s);s=o+1,i=h+1}}decompose(t,e,i,s){for(let n=0,r=0;r<=e&&n<this.children.length;n++){let o=this.children[n],h=r+o.length;if(t<=h&&e>=r){let n=s&((r<=t?1:0)|(h>=e?2:0));r>=t&&h<=e&&!n?i.push(o):o.decompose(t-r,e-r,i,n)}r=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(t>=n&&e<=o){let h=r.replace(t-n,e-n,i),l=this.lines-r.lines+h.lines;if(h.lines<l>>4&&h.lines>l>>6){let n=this.children.slice();return n[s]=h,new C2(n,this.length-(e-t)+i.length)}return super.replace(n,o,h)}n=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=e;n++){let o=this.children[n],h=r+o.length;r>t&&n&&(s+=i),t<h&&e>r&&(s+=o.sliceString(t-r,e-r,i)),r=h+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof C2))return 0;let i=0,[s,n,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==r||n==o)return i;let h=this.children[s],l=t.children[n];if(h!=l)return i+h.scanIdentical(l,e);i+=h.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new M2(i,e)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],h=0,l=-1,a=[];function c(t){let e;if(t.lines>n&&t instanceof C2)for(let e of t.children)c(e);else t.lines>r&&(h>r||!h)?(d(),o.push(t)):t instanceof M2&&h&&(e=a[a.length-1])instanceof M2&&t.lines+e.lines<=32?(h+=t.lines,l+=t.length+1,a[a.length-1]=new M2(e.text.concat(t.text),e.length+1+t.length)):(h+t.lines>s&&d(),h+=t.lines,l+=t.length+1,a.push(t))}function d(){0!=h&&(o.push(1==a.length?a[0]:C2.from(a,l)),l=-1,h=a.length=0)}for(let e of t)c(e);return d(),1==o.length?o[0]:new C2(o,e)}}function T2(t,e,i=0,s=1e9){for(let n=0,r=0,o=!0;r<t.length&&n<=s;r++){let h=t[r],l=n+h.length;l>=i&&(l>s&&(h=h.slice(0,s-n)),n<i&&(h=h.slice(i-n)),o?(e[e.length-1]+=h,o=!1):e.push(h)),n=l+1}return e}function D2(t,e,i){return T2(t,[""],e,i)}A2.empty=new M2([""],0);class R2{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof M2?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof M2?s.text.length:s.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(s instanceof M2){let n=s.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,n.length>Math.max(0,t))return this.value=0==t?n:e>0?n.slice(t):n.slice(0,n.length-t),this;t-=n.length}else{let n=s.children[r+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof M2?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class E2{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new R2(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class B2{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(A2.prototype[Symbol.iterator]=function(){return this.iter()},R2.prototype[Symbol.iterator]=E2.prototype[Symbol.iterator]=B2.prototype[Symbol.iterator]=function(){return this});class P2{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}let L2="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let t=1;t<L2.length;t++)L2[t]+=L2[t-1];function V2(t){for(let e=1;e<L2.length;e+=2)if(L2[e]>t)return L2[e-1]<=t;return!1}function W2(t){return t>=127462&&t<=127487}function N2(t,e,i=!0,s=!0){return(i?H2:Q2)(t,e,s)}function H2(t,e,i){if(e==t.length)return e;e&&I2(t.charCodeAt(e))&&z2(t.charCodeAt(e-1))&&e--;let s=F2(t,e);for(e+=$2(s);e<t.length;){let n=F2(t,e);if(8205==s||8205==n||i&&V2(n))e+=$2(n),s=n;else{if(!W2(n))break;{let i=0,s=e-2;for(;s>=0&&W2(F2(t,s));)i++,s-=2;if(i%2==0)break;e+=2}}}return e}function Q2(t,e,i){for(;e>0;){let s=H2(t,e-2,i);if(s<e)return s;e--}return 0}function I2(t){return t>=56320&&t<57344}function z2(t){return t>=55296&&t<56320}function F2(t,e){let i=t.charCodeAt(e);if(!z2(i)||e+1==t.length)return i;let s=t.charCodeAt(e+1);return I2(s)?s-56320+(i-55296<<10)+65536:i}function $2(t){return t<65536?1:2}const q2=/\r\n?|\n/;var _2=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(_2||(_2={}));class G2{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?(t(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(t,e=!1){Z2(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new G2(t)}composeDesc(t){return this.empty?t:t.empty?this:K2(this,t)}mapDesc(t,e=!1){return t.empty?this:Y2(this,t,e)}mapPos(t,e=-1,i=_2.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],h=this.sections[r++],l=s+o;if(h<0){if(l>t)return n+(t-s);n+=o}else{if(i!=_2.Simple&&l>=t&&(i==_2.TrackDel&&s<t&&l>t||i==_2.TrackBefore&&s<t||i==_2.TrackAfter&&l>t))return null;if(l>t||l==t&&e<0&&!o)return t==s||e<0?n:n+h;n+=h}s=l}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&n>=t)return!(s<t&&n>e)||"cover";s=n}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new G2(t)}}class X2 extends G2{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Z2(this,((e,i,s,n,r)=>t=t.replace(s,s+(i-e),r)),!1),t}mapDesc(t,e=!1){return Y2(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let r=e[s],o=e[s+1];if(o>=0){e[s]=o,e[s+1]=r;let h=s>>1;for(;i.length<h;)i.push(A2.empty);i.push(r?t.slice(n,n+r):A2.empty)}n+=r}return new X2(e,i)}compose(t){return this.empty?t:t.empty?this:K2(this,t,!0)}map(t,e=!1){return t.empty?this:Y2(this,t,e,!0)}iterChanges(t,e=!1){Z2(this,t,e)}get desc(){return new G2(this.sections)}filter(t){let e=[],i=[],s=[],n=new J2(this);t:for(let r=0,o=0;;){let h=r==t.length?1e9:t[r++];for(;o<h||o==h&&0==n.len;){if(n.done)break t;let t=Math.min(n.len,h-o);j2(s,t,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;j2(e,t,r),r>0&&U2(i,e,n.text),n.forward(t),o+=t}let l=t[r++];for(;o<l;){if(n.done)break t;let t=Math.min(n.len,l-o);j2(e,t,-1),j2(s,t,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(t),o+=t}}return{changes:new X2(e,i),filtered:new G2(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],r=0,o=null;function h(t=!1){if(!t&&!s.length)return;r<e&&j2(s,e-r,-1);let i=new X2(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function t(l){if(Array.isArray(l))for(let e of l)t(e);else if(l instanceof X2){if(l.length!=e)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${e})`);h(),o=o?o.compose(l.map(o)):l}else{let{from:t,to:o=t,insert:a}=l;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=a?"string"==typeof a?A2.of(a.split(i||q2)):a:A2.empty,d=c.length;if(t==o&&0==d)return;t<r&&h(),t>r&&j2(s,t-r,-1),j2(s,o-t,d),U2(n,s,c),r=o}}(t),h(!o),o}static empty(t){return new X2(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if("number"==typeof n)e.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)e.push(n[0],0);else{for(;i.length<s;)i.push(A2.empty);i[s]=A2.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new X2(e,i)}}function j2(t,e,i,s=!1){if(0==e&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:0==e&&0==t[n]?t[n+1]+=i:s?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function U2(t,e,i){if(0==i.length)return;let s=e.length-2>>1;if(s<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<s;)t.push(A2.empty);t.push(i)}}function Z2(t,e,i){let s=t.inserted;for(let n=0,r=0,o=0;o<t.sections.length;){let h=t.sections[o++],l=t.sections[o++];if(l<0)n+=h,r+=h;else{let a=n,c=r,d=A2.empty;for(;a+=h,c+=l,l&&s&&(d=d.append(s[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)h=t.sections[o++],l=t.sections[o++];e(n,a,r,c,d),n=a,r=c}}}function Y2(t,e,i,s=!1){let n=[],r=s?[]:null,o=new J2(t),h=new J2(e);for(let t=0,e=0;;)if(-1==o.ins)t+=o.len,o.next();else if(-1==h.ins&&e<t){let i=Math.min(h.len,t-e);h.forward(i),j2(n,i,-1),e+=i}else if(h.ins>=0&&(o.done||e<t||e==t&&(h.len<o.len||h.len==o.len&&!i))){for(j2(n,h.ins,-1);t>e&&!o.done&&t+o.len<e+h.len;)t+=o.len,o.next();e+=h.len,h.next()}else{if(!(o.ins>=0)){if(o.done&&h.done)return r?new X2(n,r):new G2(n);throw new Error("Mismatched change set lengths")}{let i=0,s=t+o.len;for(;;)if(h.ins>=0&&e>t&&e+h.len<s)i+=h.ins,e+=h.len,h.next();else{if(!(-1==h.ins&&e<s))break;{let t=Math.min(h.len,s-e);i+=t,h.forward(t),e+=t}}j2(n,i,o.ins),r&&U2(r,n,o.text),t=s,o.next()}}}function K2(t,e,i=!1){let s=[],n=i?[]:null,r=new J2(t),o=new J2(e);for(let t=!1;;){if(r.done&&o.done)return n?new X2(s,n):new G2(s);if(0==r.ins)j2(s,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=s.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;j2(s,e,i,t),n&&i&&U2(n,s,o.text)}else-1==o.ins?(j2(s,r.off?0:r.len,e,t),n&&U2(n,s,r.textBit(e))):(j2(s,r.off?0:r.len,o.off?0:o.ins,t),n&&!o.off&&U2(n,s,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||s.length>i),r.forward2(e),o.forward(e)}}else j2(s,0,o.ins,t),n&&U2(n,s,o.text),o.next()}}class J2{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?A2.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?A2.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class t8{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new t8(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return e8.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return e8.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return e8.range(t.anchor,t.head)}}class e8{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:e8.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new e8([this.main])}addRange(t,e=!0){return e8.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,e8.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new e8(t.ranges.map((t=>t8.fromJSON(t))),t.main)}static single(t,e=t){return new e8([e8.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return i8(t.slice(),e);i=n.to}return new e8(t,e)}static cursor(t,e=0,i,s){return new t8(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(t,e,i){let s=(null!=i?i:33554431)<<5;return e<t?new t8(e,t,24|s):new t8(t,e,s|(e>t?4:0))}}function i8(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let s=t[i],n=t[i-1];if(s.empty?s.from<=n.to:s.from<n.to){let r=n.from,o=Math.max(s.to,n.to);i<=e&&e--,t.splice(--i,2,s.anchor>s.head?e8.range(o,r):e8.range(r,o))}}return new e8(t,e)}function s8(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let n8=0;class r8{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.extensions=n,this.id=n8++,this.default=t([])}static define(t={}){return new r8(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:o8),!!t.static,t.enables)}of(t){return new h8([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new h8(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new h8(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function o8(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class h8{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=n8++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,r=t[n]>>1,o=2==this.type,h=!1,l=!1,a=[];for(let i of this.dependencies)"doc"==i?h=!0:"selection"==i?l=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&a.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(h&&e.docChanged||l&&(e.docChanged||e.selection)||a8(t,a)){let e=i(t);if(o?!l8(e,t.values[r],s):!s(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure:(t,e)=>{let h=i(t),l=e.config.address[n];if(null!=l){let i=k8(e,l);if(this.dependencies.every((i=>i instanceof r8?e.facet(i)===t.facet(i):!(i instanceof u8)||e.field(i,!1)==t.field(i,!1)))||(o?l8(h,i,s):s(h,i)))return t.values[r]=i,0}return t.values[r]=h,1}}}}function l8(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function a8(t,e){let i=!1;for(let s of e)1&x8(t,s)&&(i=!0);return i}function c8(t,e,i){let s=i.map((e=>t[e.id])),n=i.map((t=>t.type)),r=s.filter((t=>!(1&t))),o=t[e.id]>>1;function h(t){let i=[];for(let e=0;e<s.length;e++){let r=k8(t,s[e]);if(2==n[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of s)x8(t,e);return t.values[o]=h(t),1},update(t,i){if(!a8(t,r))return 0;let s=h(t);return e.compare(s,t.values[o])?0:(t.values[o]=s,1)},reconfigure(t,n){let r=a8(t,s),l=n.config.facets[e.id],a=n.facet(e);if(l&&!r&&o8(i,l))return t.values[o]=a,0;let c=h(t);return e.compare(c,a)?(t.values[o]=a,0):(t.values[o]=c,1)}}}const d8=r8.define({static:!0});class u8{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new u8(n8++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(d8).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],n=this.updateF(s,i);return this.compareF(s,n)?0:(t.values[e]=n,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,d8.of({field:this,create:t})]}get extension(){return this}}const f8=4,p8=3,g8=2,m8=1;function w8(t){return e=>new y8(e,t)}const v8={highest:w8(0),high:w8(m8),default:w8(g8),low:w8(p8),lowest:w8(f8)};class y8{constructor(t,e){this.inner=t,this.prec=e}}class b8{of(t){return new O8(this,t)}reconfigure(t){return b8.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class O8{constructor(t,e){this.compartment=t,this.inner=e}}class S8{constructor(t,e,i,s,n,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),r=new Map;for(let i of function(t,e,i){let s=[[],[],[],[],[]],n=new Map;function r(t,o){let h=n.get(t);if(null!=h){if(h<=o)return;let e=s[h].indexOf(t);e>-1&&s[h].splice(e,1),t instanceof O8&&i.delete(t.compartment)}if(n.set(t,o),Array.isArray(t))for(let e of t)r(e,o);else if(t instanceof O8){if(i.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(t.compartment)||t.inner;i.set(t.compartment,s),r(s,o)}else if(t instanceof y8)r(t.inner,t.prec);else if(t instanceof u8)s[o].push(t),t.provides&&r(t.provides,o);else if(t instanceof h8)s[o].push(t),t.facet.extensions&&r(t.facet.extensions,o);else{let e=t.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(e,o)}}return r(t,g8),s.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof u8?s.push(i):(n[i.facet.id]||(n[i.facet.id]=[])).push(i);let o=Object.create(null),h=[],l=[];for(let t of s)o[t.id]=l.length<<1,l.push((e=>t.slot(e)));let a=null==i?void 0:i.config.facets;for(let t in n){let e=n[t],s=e[0].facet,r=a&&a[t]||[];if(e.every((t=>0==t.type)))if(o[s.id]=h.length<<1|1,o8(r,e))h.push(i.facet(s));else{let t=s.combine(e.map((t=>t.value)));h.push(i&&s.compare(t,i.facet(s))?i.facet(s):t)}else{for(let t of e)0==t.type?(o[t.id]=h.length<<1|1,h.push(t.value)):(o[t.id]=l.length<<1,l.push((e=>t.dynamicSlot(e))));o[s.id]=l.length<<1,l.push((t=>c8(t,s,e)))}}let c=l.map((t=>t(o)));return new S8(t,r,c,o,h,n)}}function x8(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function k8(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const A8=r8.define(),M8=r8.define({combine:t=>t.some((t=>t)),static:!0}),C8=r8.define({combine:t=>t.length?t[0]:void 0,static:!0}),T8=r8.define(),D8=r8.define(),R8=r8.define(),E8=r8.define({combine:t=>!!t.length&&t[0]});class B8{constructor(t,e){this.type=t,this.value=e}static define(){return new P8}}class P8{of(t){return new B8(this,t)}}class L8{constructor(t){this.map=t}of(t){return new V8(this,t)}}class V8{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new V8(this.type,e)}is(t){return this.type==t}static define(t={}){return new L8(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}V8.reconfigure=V8.define(),V8.appendConfig=V8.define();class W8{constructor(t,e,i,s,n,r){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&s8(i,e.newLength),n.some((t=>t.type==W8.time))||(this.annotations=n.concat(W8.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(W8.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function N8(t,e){let i=[];for(let s=0,n=0;;){let r,o;if(s<t.length&&(n==e.length||e[n]>=t[s]))r=t[s++],o=t[s++];else{if(!(n<e.length))return i;r=e[n++],o=e[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function H8(t,e,i){var s;let n,r,o;return i?(n=e.changes,r=X2.empty(e.changes.length),o=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):null===(s=t.selection)||void 0===s?void 0:s.map(n),effects:V8.mapEffects(t.effects,n).concat(V8.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Q8(t,e,i){let s=e.selection,n=F8(e.annotations);return e.userEvent&&(n=n.concat(W8.userEvent.of(e.userEvent))),{changes:e.changes instanceof X2?e.changes:X2.of(e.changes||[],i,t.facet(C8)),selection:s&&(s instanceof e8?s:e8.single(s.anchor,s.head)),effects:F8(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function I8(t,e,i){let s=Q8(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=H8(s,Q8(t,e[n],r?s.changes.newLength:t.doc.length),r)}let n=new W8(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(R8),s=t;for(let n=i.length-1;n>=0;n--){let r=i[n](t);r&&Object.keys(r).length&&(s=H8(t,Q8(e,r,t.changes.newLength),!0))}return s==t?t:new W8(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let s of e.facet(T8)){let e=s(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:N8(i,e))}if(!0!==i){let s,n;if(!1===i)n=t.changes.invertedDesc,s=X2.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,n=e.filtered.invertedDesc}t=new W8(e,s,t.selection&&t.selection.map(n),V8.mapEffects(t.effects,n),t.annotations,t.scrollIntoView)}let s=e.facet(D8);for(let i=s.length-1;i>=0;i--){let n=s[i](t);t=n instanceof W8?n:Array.isArray(n)&&1==n.length&&n[0]instanceof W8?n[0]:I8(e,F8(n),!1)}return t}(n):n)}W8.time=B8.define(),W8.userEvent=B8.define(),W8.addToHistory=B8.define(),W8.remote=B8.define();const z8=[];function F8(t){return null==t?z8:Array.isArray(t)?t:[t]}var $8=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}($8||($8={}));const q8=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let _8;try{_8=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function G8(t){return e=>{if(!/\S/.test(e))return $8.Space;if(function(t){if(_8)return _8.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||q8.test(i)))return!0}return!1}(e))return $8.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return $8.Word;return $8.Other}}class X8{constructor(t,e,i,s,n,r){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)x8(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return x8(this,i),k8(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return I8(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:n}=i;for(let e of t.effects)e.is(b8.reconfigure)?(i&&(n=new Map,i.compartments.forEach(((t,e)=>n.set(e,t))),i=null),n.set(e.value.compartment,e.value.extension)):e.is(V8.reconfigure)?(i=null,s=e.value):e.is(V8.appendConfig)&&(i=null,s=F8(s).concat(e.value));if(i)e=t.startState.values.slice();else{i=S8.resolve(s,n,this),e=new X8(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values}new X8(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:e8.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],r=F8(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),h=this.changes(o.changes),l=h.map(s);for(let t=0;t<i;t++)n[t]=n[t].map(l);let a=s.mapDesc(h,!0);n.push(o.range.map(a)),s=s.compose(l),r=V8.mapEffects(r,l).concat(V8.mapEffects(F8(o.effects),a))}return{changes:s,selection:e8.create(n,e.mainIndex),effects:r}}changes(t=[]){return t instanceof X2?t:X2.of(t,this.doc.length,this.facet(X8.lineSeparator))}toText(t){return A2.of(t.split(this.facet(X8.lineSeparator)||q2))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(x8(this,e),k8(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof u8&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let e in i){let n=i[e],r=t[e];s.push(n.init((t=>n.spec.fromJSON(r,t))))}return X8.create({doc:t.doc,selection:e8.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=S8.resolve(t.extensions||[],new Map),i=t.doc instanceof A2?t.doc:A2.of((t.doc||"").split(e.staticFacet(X8.lineSeparator)||q2)),s=t.selection?t.selection instanceof e8?t.selection:e8.single(t.selection.anchor,t.selection.head):e8.single(0);return s8(s,i.length),e.staticFacet(M8)||(s=s.asSingle()),new X8(e,i,s,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet(X8.tabSize)}get lineBreak(){return this.facet(X8.lineSeparator)||"\n"}get readOnly(){return this.facet(E8)}phrase(t){for(let e of this.facet(X8.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(A8))for(let r of n(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&s.push(r[t]);return s}charCategorizer(t){return G8(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),r=t-i,o=t-i;for(;r>0;){let t=N2(e,r,!1);if(n(e.slice(t,r))!=$8.Word)break;r=t}for(;o<s;){let t=N2(e,o);if(n(e.slice(o,t))!=$8.Word)break;o=t}return r==o?null:e8.range(r+i,o+i)}}X8.allowMultipleSelections=M8,X8.tabSize=r8.define({combine:t=>t.length?t[0]:4}),X8.lineSeparator=C8,X8.readOnly=E8,X8.phrases=r8.define({compare(t,e){let i=Object.keys(t),s=Object.keys(e);return i.length==s.length&&i.every((i=>t[i]==e[i]))}}),X8.languageData=A8,X8.changeFilter=T8,X8.transactionFilter=D8,X8.transactionExtender=R8,b8.reconfigure=V8.define();class j8{eq(t){return this==t}range(t,e=t){return new U8(t,e,this)}}j8.prototype.startSide=j8.prototype.endSide=0,j8.prototype.point=!1,j8.prototype.mapMode=_2.TrackDel;class U8{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function Z8(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class Y8{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,h=n[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==r)return h>=0?r:o;h>=0?o=s:r=s+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+t,this.to[n]+t,this.value[n]))return!1}map(t,e){let i=[],s=[],n=[],r=-1,o=-1;for(let h=0;h<this.value.length;h++){let l,a,c=this.value[h],d=this.from[h]+t,u=this.to[h]+t;if(d==u){let t=e.mapPos(d,c.startSide,c.mapMode);if(null==t)continue;if(l=a=t,c.startSide!=c.endSide&&(a=e.mapPos(d,c.endSide),a<l))continue}else if(l=e.mapPos(d,c.startSide),a=e.mapPos(u,c.endSide),l>a||l==a&&c.startSide>0&&c.endSide<=0)continue;(a-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,a-l)),i.push(c),s.push(l-r),n.push(a-r))}return{mapped:i.length?new Y8(s,n,i,o):null,pos:r}}}class K8{constructor(t,e,i=K8.empty,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(Z8)),this.isEmpty)return e.length?K8.of(e):this;let o=new e3(this,null,-1).goto(0),h=0,l=[],a=new J8;for(;o.value||h<e.length;)if(h<e.length&&(o.from-e[h].from||o.startSide-e[h].value.startSide)>=0){let t=e[h++];a.addInner(t.from,t.to,t.value)||l.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(o.chunkIndex)<e[h].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&a.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(a.addInner(o.from,o.to,o.value)||l.push(new U8(o.from,o.to,o.value))),o.next());return a.finishInner(this.nextLayer.isEmpty&&!l.length?K8.empty:this.nextLayer.update({add:l,filter:r,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n],h=t.touchesRange(r,r+o.length);if(!1===h)s=Math.max(s,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===h){let{mapped:n,pos:h}=o.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(h))}}let n=this.nextLayer.map(t);return 0==e.length?n:new K8(i,e,n,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(e>=n&&t<=n+r.length&&!1===r.between(n,t-n,e-n,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return i3.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return i3.from(t).goto(e)}static compare(t,e,i,s,n=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),h=t3(r,o,i),l=new n3(r,h,n),a=new n3(o,h,n);i.iterGaps(((t,e,i)=>r3(l,t,a,e,i,s))),i.empty&&0==i.length&&r3(l,0,a,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=1e9);let n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(n.length!=r.length)return!1;if(!n.length)return!0;let o=t3(n,r),h=new n3(n,o,0).goto(i),l=new n3(r,o,0).goto(i);for(;;){if(h.to!=l.to||!o3(h.active,l.active)||h.point&&(!l.point||!h.point.eq(l.point)))return!1;if(h.to>s)return!0;h.next(),l.next()}}static spans(t,e,i,s,n=-1){let r=new n3(t,null,n).goto(e),o=e,h=r.openStart;for(;;){let t=Math.min(r.to,i);if(r.point?(s.point(o,t,r.point,r.activeForPoint(r.to),h,r.pointRank),h=r.openEnd(t)+(r.to>t?1:0)):t>o&&(s.span(o,t,r.active,h),h=r.openEnd(t)),r.to>i)break;o=r.to,r.next()}return h}static of(t,e=!1){let i=new J8;for(let s of t instanceof U8?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(Z8(e,s)>0)return t.slice().sort(Z8);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}}K8.empty=new K8([],[],null,-1),K8.empty.nextLayer=K8.empty;class J8{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Y8(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new J8)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(K8.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=new K8(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function t3(t,e,i){let s=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&s.set(e.chunk[t],e.chunkPos[t]);let n=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=s.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||n.add(t.chunk[e])}return n}class e3{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class i3{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let r=t[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new e3(r,e,i,n));return 1==s.length?s[0]:new i3(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)s3(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)s3(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),s3(this.heap,0)}}}function s3(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let n=t[s];if(s+1<t.length&&n.compare(t[s+1])>=0&&(n=t[s+1],s++),i.compare(n)<0)break;t[s]=i,t[e]=n,e=s}}class n3{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=i3.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){h3(this.active,t),h3(this.activeTo,t),h3(this.activeRank,t),this.minActive=a3(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;l3(this.active,e,i),l3(this.activeTo,e,s),l3(this.activeRank,e,n),t&&l3(t,e,this.cursor.from),this.minActive=a3(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>t){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&h3(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let n=this.cursor.value;if(n.point){if(!(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.from<t&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let e=0;for(;e<i.length&&i[e]<t;)e++;this.openStart=e+s}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function r3(t,e,i,s,n,r){t.goto(e),i.goto(s);let o=s+n,h=s,l=s-e;for(;;){let e=t.to+l-i.to||t.endSide-i.endSide,s=e<0?t.to+l:i.to,n=Math.min(s,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&o3(t.activeForPoint(t.to+l),i.activeForPoint(i.to))||r.comparePoint(h,n,t.point,i.point):n>h&&!o3(t.active,i.active)&&r.compareRange(h,n,t.active,i.active),s>o)break;h=s,e<=0&&t.next(),e>=0&&i.next()}}function o3(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function h3(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function l3(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function a3(t,e){let i=-1,s=1e9;for(let n=0;n<e.length;n++)(e[n]-s||t[n].endSide-t[i].endSide)<0&&(i=n,s=e[n]);return i}function c3(t,e,i,s){for(let s=0,n=0;;){if(n>=e)return s;if(s==t.length)break;n+=9==t.charCodeAt(s)?i-n%i:1,s=N2(t,s)}return!0===s?-1:t.length}function d3(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function u3(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function f3(t,e){if(!e.anchorNode)return!1;try{return u3(t,e.anchorNode)}catch(t){return!1}}function p3(t){return 3==t.nodeType?M3(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function g3(t,e,i,s){return!!i&&(w3(t,e,i,s,-1)||w3(t,e,i,s,1))}function m3(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function w3(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:v3(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=m3(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?v3(t):0}}}function v3(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const y3={left:0,right:0,top:0,bottom:0};function b3(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function O3(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class S3{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let x3,k3=null;function A3(t){if(t.setActive)return t.setActive();if(k3)return t.focus(k3);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==k3?{get preventScroll(){return k3={preventScroll:!0},!0}}:void 0),!k3){k3=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function M3(t,e,i=e){let s=x3||(x3=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function C3(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function T3(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class D3{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new D3(t.parentNode,m3(t),e)}static after(t,e){return new D3(t.parentNode,m3(t)+1,e)}}const R3=[];class E3{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=E3.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=B3(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=B3(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==v3(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!E3.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=R3){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new P3(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function B3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}E3.prototype.breakAfter=0;class P3{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function L3(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function V3(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,L3(t,a,c,h,l,s,0,n,r)}let W3="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},N3="undefined"!=typeof document?document:{documentElement:{style:{}}};const H3=/Edge\/(\d+)/.exec(W3.userAgent),Q3=/MSIE \d/.test(W3.userAgent),I3=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W3.userAgent),z3=!!(Q3||I3||H3),F3=!z3&&/gecko\/(\d+)/i.test(W3.userAgent),$3=!z3&&/Chrome\/(\d+)/.exec(W3.userAgent),q3="webkitFontSmoothing"in N3.documentElement.style,_3=!z3&&/Apple Computer/.test(W3.vendor),G3=_3&&(/Mobile\/\w+/.test(W3.userAgent)||W3.maxTouchPoints>2);var X3={mac:G3||/Mac/.test(W3.platform),windows:/Win/.test(W3.platform),linux:/Linux|X11/.test(W3.platform),ie:z3,ie_version:Q3?N3.documentMode||6:I3?+I3[1]:H3?+H3[1]:0,gecko:F3,gecko_version:F3?+(/Firefox\/(\d+)/.exec(W3.userAgent)||[0,0])[1]:0,chrome:!!$3,chrome_version:$3?+$3[1]:0,ios:G3,android:/Android\b/.test(W3.userAgent),webkit:q3,safari:_3,webkit_version:q3?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=N3.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class j3 extends E3{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof j3&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new j3(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new D3(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Z3(this.dom,t,e)}}class U3 extends E3{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(T3(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof U3&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(V3(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new U3(this.mark,e,r)}domAtPos(t){return i9(this.dom,this.children,t)}coordsAt(t,e){return n9(this,t,e)}}function Z3(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?X3.chrome||X3.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=M3(t,n,r).getClientRects();if(!h.length)return y3;let l=h[(o?o<0:i>=0)?0:h.length-1];return X3.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?b3(l,o<0):l||null}class Y3 extends E3{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Y3)(t,e,i)}split(t){let e=Y3.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Y3&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Y3&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return A2.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):A2.empty}domAtPos(t){return 0==t?D3.before(this.dom):D3.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return y3;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:b3(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class K3 extends Y3{domAtPos(t){let{topView:e,text:i}=this.widget;return e?J3(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new D3(i,Math.min(t,i.nodeValue.length)))):new D3(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?t9(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?J3(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Z3(s,t,e))):Z3(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function J3(t,e,i,s,n,r){if(i instanceof U3){for(let o of i.children){let i=u3(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?J3(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function t9(t,e,i,s){if(i instanceof U3)for(let n of i.children){let i=0,r=u3(n.dom,s);if(u3(n.dom,t))return i+(r?t9(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class e9 extends E3{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof e9&&t.side==this.side}split(){return new e9(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return D3.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof j3){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof U3&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return A2.empty}}function i9(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return D3.after(i)}return new D3(t,0)}function s9(t,e,i){let s,{children:n}=t;i>0&&e instanceof U3&&n.length&&(s=n[n.length-1])instanceof U3&&s.mark.eq(e.mark)?s9(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function n9(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?b3(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=p3(s);return n[n.length-1]||null}function r9(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function o9(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function h9(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}j3.prototype.children=Y3.prototype.children=e9.prototype.children=R3;class l9{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var a9=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(a9||(a9={}));class c9 extends j8{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new d9(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new f9(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=p9(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new f9(t,e,i,s,t.widget||null,!0)}static line(t){return new u9(t)}static set(t,e=!1){return K8.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}c9.none=K8.empty;class d9 extends c9{constructor(t){let{start:e,end:i}=p9(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof d9&&this.tagName==t.tagName&&this.class==t.class&&o9(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}d9.prototype.point=!1;class u9 extends c9{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof u9&&o9(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}u9.prototype.mapMode=_2.TrackBefore,u9.prototype.point=!0;class f9 extends c9{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?_2.TrackBefore:_2.TrackAfter:_2.TrackDel}get type(){return this.startSide<this.endSide?a9.WidgetRange:this.startSide<=0?a9.WidgetBefore:a9.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof f9&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function p9(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function g9(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}f9.prototype.point=!0;class m9 extends E3{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof m9))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),V3(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new m9;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){o9(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){s9(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=r9(e,this.attrs||{})),i&&(this.attrs=r9({class:i},this.attrs||{}))}domAtPos(t){return i9(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(T3(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(h9(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&E3.get(i)instanceof U3;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=E3.get(i))||void 0===e?void 0:e.isEditable)||X3.ios&&this.children.some((t=>t instanceof j3))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof j3))return null;let i=p3(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return n9(this,t,e)}become(t){return!1}get type(){return a9.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof m9)return n;if(r>e)break}s=r+n.breakAfter}return null}}class w9 extends E3{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof w9&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?D3.before(this.dom):D3.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new w9(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return R3}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):A2.empty}domBoundsAround(){return null}become(t){return t instanceof w9&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class v9{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof w9&&t.type==a9.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new m9),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(y9(new e9(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(y9(new j3(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n,r){if(this.disallowBlockEffectsFor[r]&&i instanceof f9){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=e-t;if(i instanceof f9)if(i.block){let{type:t}=i;t!=a9.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new w9(i.widget||new b9("div"),o,t))}else{let r=Y3.create(i.widget||new b9("span"),o,i.startSide),h=this.atCursorPos&&!r.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!r.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(y9(new e9(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(y9(r,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}static build(t,e,i,s,n){let r=new v9(t,e,i,n);return r.openEnd=K8.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function y9(t,e){for(let i of e)t=new U3(i,[t],t.length);return t}class b9 extends l9{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const O9=[],S9=r8.define(),x9=r8.define(),k9=r8.define(),A9=r8.define(),M9=r8.define(),C9=r8.define(),T9=r8.define({combine:t=>t.some((t=>t))});class D9{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new D9(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const R9=V8.define({map:(t,e)=>t.map(e)});function E9(t,e,i){let s=t.facet(A9);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const B9=r8.define({combine:t=>!t.length||t[0]});let P9=0;const L9=r8.define();class V9{constructor(t,e,i,s){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=s(this)}static define(t,e){const{eventHandlers:i,provide:s,decorations:n}=e||{};return new V9(P9++,t,i,(t=>{let e=[L9.of(t)];return n&&e.push(Q9.of((e=>{let i=e.plugin(t);return i?n(i):c9.none}))),s&&e.push(s(t)),e}))}static fromClass(t,e){return V9.define((e=>new t(e)),e)}}class W9{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(E9(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){E9(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){E9(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const N9=r8.define(),H9=r8.define(),Q9=r8.define(),I9=r8.define(),z9=r8.define(),F9=r8.define();class $9{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new $9(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new $9(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new $9(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class q9{constructor(t,e,i=O9){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=X2.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new $9(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var _9=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(_9||(_9={}));const G9=_9.LTR,X9=_9.RTL;function j9(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const U9=j9("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Z9=j9("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Y9=Object.create(null),K9=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Y9[e]=i,Y9[i]=-e}const J9=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class t5{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?X9:G9}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const e5=[];function i5(t,e){let i=t.length,s=e==G9?1:2,n=e==G9?2:1;if(!t||1==s&&!J9.test(t))return s5(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?U9[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Z9[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),e5[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=e5[t];if(128==s)t<i-1&&e==e5[t+1]&&24&e?s=e5[t]=e:e5[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==e5[s];)s++;let r=t&&8==e||s<i&&8==e5[s]?1==n?1:8:256;for(let e=t;e<s;e++)e5[e]=r;t=s-1}else 8==s&&1==n&&(e5[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Y9[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(K9[t+1]==-r){let e=K9[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(e5[h]=e5[K9[t]]=i),l=t;break}}else{if(189==K9.length)break;K9[l++]=h,K9[l++]=e,K9[l++]=a}else if(2==(o=e5[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=K9[e+2];if(2&i)break;if(t)K9[e+2]|=2;else{if(4&i)break;K9[e+2]|=4}}}for(let t=0;t<i;t++)if(256==e5[t]){let e=t+1;for(;e<i&&256==e5[e];)e++;let n=1==(t?e5[t-1]:s),r=n==(1==(e<i?e5[e]:s))?n?1:2:s;for(let i=t;i<e;i++)e5[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=e5[t++];for(;t<i&&s==(1!=e5[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=e5[--i];for(;i>e&&s==(2!=e5[i-1]);)i--;o.push(new t5(i,t,s?2:1))}else o.push(new t5(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==e5[t++];for(;t<i&&s==(2==e5[t]);)t++;o.push(new t5(e,t,s?1:2))}return o}function s5(t){return[new t5(0,t,0)]}let n5="";function r5(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=t5.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=N2(t.text,o,a);if(n5=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return e8.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?e8.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):e8.cursor(c+t.from,n?-1:1,l.level):e8.cursor(n?t.to:t.from,n?-1:1,i)}class o5{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(X8.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=E3.get(s),r=E3.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:h5(s))||h5(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=E3.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function h5(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class l5{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class a5 extends E3{constructor(t){super(),this.view=t,this.compositionDeco=c9.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new m9],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new $9(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=c9.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=d5(t);if(!i)return c9.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new o5([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return c9.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return c9.none;let d=E3.get(r);d instanceof K3?d=d.widget.topView:d&&(d.parent=null);return c9.set(c9.replace({widget:new u5(r,o,d)}).range(h,l))}(this.view,t.changes)),(X3.ie||X3.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new p5;return K8.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=$9.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=X3.chrome||X3.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof w9&&t.widget instanceof c5&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=v9.build(this.view.state.doc,o,h,this.decorations,this.dynamicDecorationMap),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);L3(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||X3.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(X3.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new D3(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&g3(n.node,n.offset,h.anchorNode,h.anchorOffset)&&g3(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{X3.android&&X3.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=d3(this.root);if(s.empty){if(X3.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=f5(n.node,n.offset,1==t?1:-1);e&&(n=new D3(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new D3(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new D3(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=d3(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=m9.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(B9)?this.root.activeElement==this.dom:f3(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=E3.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof m9)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=a9.WidgetBefore&&n.type!=a9.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==a9.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(t){let e=[],{from:i,to:s}=t,n=this.view.contentDOM.clientWidth,r=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,h=this.view.textDirection==_9.LTR;for(let t=0,l=0;l<this.children.length;l++){let a=this.children[l],c=t+a.length;if(c>s)break;if(t>=i){let i=a.dom.getBoundingClientRect();if(e.push(i.height),r){let e=a.dom.lastChild,s=e?p3(e):[];if(s.length){let e=s[s.length-1],r=h?e.right-i.left:i.right-e.left;r>o&&(o=r,this.minWidth=n,this.minWidthFrom=t,this.minWidthTo=c)}}}t=c+a.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return"rtl"==getComputedStyle(this.children[e].dom).direction?_9.RTL:_9.LTR}measureTextSize(){for(let t of this.children)if(t instanceof m9){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=p3(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new P3(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(c9.replace({widget:new c5(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return c9.set(t)}updateDeco(){let t=this.view.state.facet(Q9).map(((t,e)=>(this.dynamicDecorationMap[e]="function"==typeof t)?t(this.view):t));for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.state.facet(z9).map((t=>t(this.view))))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=O3(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==_9.LTR)}}class c5 extends l9{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function d5(t){let e=t.observer.selectionRange,i=e.focusNode&&f5(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof m9){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!E3.get(e);)e=e.previousSibling;let n=e?E3.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof m9)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class u5 extends l9{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return K3}}function f5(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=v3(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class p5{constructor(){this.changes=[]}compareRange(t,e){g9(t,e,this.changes)}comparePoint(t,e){g9(t,e,this.changes)}}function g5(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function m5(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function w5(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function v5(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function y5(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function b5(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=p3(d);for(let u=0;u<t.length;u++){let f=t[u];n&&w5(n,f)&&(f=v5(y5(f,n.bottom),n.top));let p=g5(e,f),g=m5(i,f);if(0==p&&0==g)return 3==d.nodeType?O5(d,e,i):b5(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&w5(a,f)?a=y5(a,f.bottom):c&&w5(c,f)&&(c=v5(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?O5(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:b5(s,d,i)}function O5(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=M3(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(X3.chrome||X3.gecko){M3(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function S5(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=a9.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:x5(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:x5(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),X3.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return M3(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=m9.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=b5(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function x5(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+c3(o,r,t.state.tabSize)}function k5(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n),o=t.textDirectionAt(n.from);for(let h=e,l=null;;){let e=r5(n,r,o,h,i),a=n5;if(!e){if(n.number==(i?t.state.doc.lines:1))return h;a="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=e8.cursor(i?n.from:n.to)}if(l){if(!l(a))return h}else{if(!s)return e;l=s(a)}h=e}}function A5(t,e,i){let s=t.state.facet(I9).map((e=>e(t)));for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?e8.cursor(s,1):e8.cursor(n,-1),t=!0)}));if(!t)return i}}class M5{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in E5){let i=E5[e];t.contentDOM.addEventListener(e,(s=>{R5(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,X3.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let s;for(let n of e)if(s=null===(i=n.update(t).spec)||void 0===i?void 0:i.domEventHandlers){this.customHandlers.push({plugin:n.value,handlers:s});for(let e in s)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{R5(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){E9(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){E9(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(X3.android&&X3.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!X3.ios||!(i=C5.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,C3(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(X3.safari&&Date.now()-this.compositionEndedAt<100)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!X3.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const C5=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],T5=[16,17,18,20,91,92,224,225];class D5{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(X8.allowMultipleSelections)&&function(t,e){let i=t.state.facet(S9);return i.length?i[0](e):X3.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(x9);return i.length?i[0](e):X3.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=d3(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=q5(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function R5(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=E3.get(s))&&i.ignoreEvent(e))return!1;return!0}const E5=Object.create(null),B5=X3.ie&&X3.ie_version<15||X3.ios&&X3.webkit_version<604;function P5(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=G5&&s.selection.ranges.every((t=>t.empty))&&G5==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:e8.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:e8.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}E5.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():T5.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let L5=0;function V5(t,e,i,s){if(1==s)return e8.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return e8.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=N2(n.text,r,!1):h=N2(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=N2(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=N2(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return e8.range(o+n.from,h+n.from)}(t.state,e,i);{let i=m9.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,e8.range(n,r)}}E5.touchstart=(t,e)=>{L5=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},E5.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},E5.mousedown=(t,e)=>{if(t.observer.flush(),L5>Date.now()-2e3&&1==q5(e))return;let i=null;for(let s of t.state.facet(k9))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Q5(t,e),s=q5(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Q5(t,e),o=e),!a||!i)return n;let c=V5(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=V5(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?e8.range(n,r):e8.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):e8.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>A3(t.contentDOM))),t.inputState.startMouseSelection(new D5(t,e,i,s))}};let W5=(t,e)=>t>=e.top&&t<=e.bottom,N5=(t,e,i)=>W5(e,i)&&t>=i.left&&t<=i.right;function H5(t,e,i,s){let n=m9.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&N5(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&N5(i,s,h)?1:o&&W5(s,o)?-1:1}function Q5(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:H5(t,i,e.clientX,e.clientY)}}const I5=X3.ie&&X3.ie_version<=11;let z5=null,F5=0,$5=0;function q5(t){if(!I5)return t.detail;let e=z5,i=$5;return z5=t,$5=Date.now(),F5=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(F5+1)%3:1}function _5(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}E5.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},E5.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&_5(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else _5(t,e,e.dataTransfer.getData("Text"),!0)},E5.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=B5?null:e.clipboardData;i?(P5(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),P5(t,i.value)}),50)}(t)};let G5=null;function X5(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}E5.copy=E5.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;G5=n?i:null;let r=B5?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},E5.focus=E5.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},E5.compositionstart=E5.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),X5(t,!0)))},E5.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&X5(t,!1)}),50)},E5.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},E5.beforeinput=(t,e)=>{var i;let s;if(X3.chrome&&X3.android&&(s=C5.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const j5=["pre-wrap","normal","pre-line","break-spaces"];class U5{constructor(){this.doc=A2.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return j5.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n){let r=j5.indexOf(t)>-1,o=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=r;if(this.lineWrapping=r,this.lineHeight=e,this.charWidth=i,this.lineLength=s,o){this.heightSamples={};for(let t=0;t<n.length;t++){let e=n[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return o}}class Z5{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Y5{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Y5(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var K5=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(K5||(K5={}));class J5{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return J5.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,K5.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,K5.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,K5.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=r4.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new e4(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new s4(J5.of(t.slice(0,e)),r,J5.of(t.slice(i)))}}J5.prototype.size=1;class t4 extends J5{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new Y5(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){t<=n+this.length&&e>=n&&r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class e4 extends t4{constructor(t,e){super(t,e,a9.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof e4||s instanceof i4&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof i4?s=new e4(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):J5.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class i4 extends J5{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new Y5(l,a,i+o*h,o,a9.Text)}lineAt(t,e,i,s,n){if(e==K5.ByHeight)return this.blockAt(t,i,s,n);if(e==K5.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new Y5(e,s-e,0,0,a9.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new Y5(h,l,s+o*(a-r),o,a9.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new Y5(e.from,e.length,s,h,a9.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof i4?i[i.length-1]=new i4(t.length+s):i.push(null,new i4(s-1))}if(t>0){let e=i[0];e instanceof i4?i[0]=new i4(t+e.length):i.unshift(new i4(t-1),null)}return J5.of(i)}decomposeLeft(t,e){e.push(new i4(t-1),null)}decomposeRight(t,e){e.push(null,new i4(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new i4(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new e4(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new i4(n-r).updateHeight(t,r));let l=J5.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class s4 extends J5{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==K5.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==K5.ByPosNoHeight?K5.ByPosNoHeight:K5.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,K5.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&n4(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),n4(n,t)}return J5.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?J5.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function n4(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof i4&&(s=t[e+1])instanceof i4&&t.splice(e-1,3,new i4(i.length+1+s.length))}class r4{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof e4?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new e4(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new t4(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new e4(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new i4(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof e4)return t;let e=new e4(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=a9.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=a9.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof e4||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new e4(0,-1));let i=t;for(let t of this.nodes)t instanceof e4&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new r4(i,t);return K8.spans(e,i,s,n,0),n.finish(i)}}class o4{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&g9(t,e,this.changes,5)}}function h4(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function l4(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class a4{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return c9.replace({widget:new c4(this.size,t)}).range(this.from,this.to)}}class c4 extends l9{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class d4{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new U5,this.scaler=v4,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=_9.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Q9).filter((t=>"function"!=typeof t)),this.heightMap=J5.empty().applyChanges(this.stateDeco,A2.empty,this.heightOracle.setDoc(t.doc),[new $9(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=c9.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new u4(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?v4:new y4(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:b4(t,this.scaler))}))}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Q9).filter((t=>"function"!=typeof t));let s=t.changedRanges,n=$9.extendWithRanges(s,function(t,e,i){let s=new o4;return K8.compare(t,e,i,s,0),s.changes}(i,this.stateDeco,t?t.changes:X2.empty(this.state.doc.length))),r=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),n),this.heightMap.height!=r&&(t.flags|=2);let o=n.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<o.from||e.range.head>o.to)||!this.viewportIsAppropriate(o))&&(o=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||o.from!=this.viewport.from||o.to!=this.viewport.to;this.viewport=o,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?_9.RTL:_9.LTR;let r=this.heightOracle.mustRefreshForWrapping(n),o=r||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,l=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(o=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),o){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(h|=8,this.paddingTop=t,this.paddingBottom=s)}let a=(this.printing?l4:h4)(e,this.paddingTop),c=a.top-this.pixelViewport.top,d=a.bottom-this.pixelViewport.bottom;this.pixelViewport=a;let u=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(u!=this.inView&&(this.inView=u,u&&(o=!0)),!this.inView)return 0;let f=e.clientWidth;if(this.contentDOMWidth==f&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=f,this.editorHeight=t.scrollDOM.clientHeight,h|=8),o){let e=t.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(e)&&(r=!0),r||s.lineWrapping&&Math.abs(f-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:o}=t.docView.measureTextSize();r=s.refresh(n,i,o,f/o,e),r&&(t.docView.minWidth=0,h|=8)}c>0&&d>0?l=Math.max(c,d):c<0&&d<0&&(l=Math.min(c,d)),s.heightChanged=!1;for(let i of this.viewports){let n=i.from==this.viewport.from?e:t.docView.measureVisibleLineHeights(i);this.heightMap=this.heightMap.updateHeight(s,0,r,new Z5(i.from,n))}s.heightChanged&&(h|=2)}let p=!this.viewportIsAppropriate(this.viewport,l)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return p&&(this.viewport=this.getViewport(l,this.scrollTarget)),this.updateForViewport(),(2&h||p)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new u4(s.lineAt(r-1e3*i,K5.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),K5.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,K5.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new u4(s.lineAt(i-500,K5.ByHeight,n,0,0).from,s.lineAt(i+r+500,K5.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new u4(this.heightMap.lineAt(i,K5.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,K5.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,K5.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,K5.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new a4(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=_9.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=f4(i.from,i.to,this.stateDeco);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=p4(r,(this.visibleTop-i.top-t)/i.height),n=p4(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=p4(r,(this.pixelViewport.left-e)/t),n=p4(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&m4(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&m4(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(w4(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new a4(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=g4(s,i)-g4(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){a4.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=c9.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];K8.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||b4(this.heightMap.lineAt(t,K5.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return b4(this.heightMap.lineAt(this.scaler.fromDOM(t),K5.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return b4(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class u4{constructor(t,e){this.from=t,this.to=e}}function f4(t,e,i){let s=[],n=t,r=0;return K8.spans(i,t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function p4({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function g4(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function m4(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function w4(t,e){for(let i of t)if(e(i))return i}const v4={toDOM:t=>t,fromDOM:t=>t,scale:1};class y4{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,K5.ByPos,t,0,0).top,o=e.lineAt(n,K5.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function b4(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new Y5(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>b4(t,e))):t.type)}const O4=r8.define({combine:t=>t.join(" ")}),S4=r8.define({combine:t=>t.indexOf(!0)>-1}),x4=jt.newName(),k4=jt.newName(),A4=jt.newName(),M4={"&light":"."+k4,"&dark":"."+A4};function C4(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const T4=C4("."+x4,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},M4),D4={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},R4=X3.ie&&X3.ie_version<=11;class E4{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new S3,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(X3.ie&&X3.ie_version<=11||X3.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),R4&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(B9)?e.root.activeElement!=this.dom:!f3(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((X3.ie&&X3.ie_version<=11||X3.android&&X3.chrome)&&!e.state.selection.main.empty&&i.focusNode&&g3(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=d3(t),i=X3.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);g3(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,D4),R4&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),R4&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;C3(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&f3(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=B4(e,t.previousSibling||t.target.previousSibling,-1),s=B4(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function B4(t,e,i){for(;e;){let s=E3.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function P4(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new l5(i,s)),n==i&&r==s||e.push(new l5(n,r)));return e}(t),c=new o5(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||X3.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(X3.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:A2.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?e8.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(B9)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!u3(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!u3(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=e8.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(X3.ios&&t.inputState.flushIOSKey(t))return;if(X3.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&C3(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&C3(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&C3(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(C9).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=d5(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?e8.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class L4{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new d4(t.state||X8.create()),this.plugins=this.state.facet(L9).map((t=>new W9(t)));for(let t of this.plugins)t.update(this);this.observer=new E4(this,((t,e,i)=>{P4(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new M5(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new a5(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof W8?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet(X8.phrases)!=this.state.facet(X8.phrases))return this.setState(s);e=new q9(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new D9(t.empty?t:e8.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(R9)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=N4.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(F9)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(O4)!=e.state.facet(O4)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(M9))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new d4(t),this.plugins=t.facet(L9).map((t=>new W9(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new a5(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(L9),i=t.state.facet(L9);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new W9(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return E9(this.state,t),W4}})),o=new q9(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=W4)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){E9(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(M9))t(e)}get themeClasses(){return x4+" "+(this.state.facet(S4)?A4:k4)+" "+this.state.facet(O4)}updateAttrs(){let t=H4(this,N9,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(B9)?"true":"false",class:"cm-content",style:`${X3.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),H4(this,H9,e),this.observer.ignore((()=>{h9(this.contentDOM,this.contentAttrs,e),h9(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(L4.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(F9),jt.mount(this.root,this.styleModules.concat(T4).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return A5(this,t,k5(this,t,e,i))}moveByGroup(t,e){return A5(this,t,k5(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==$8.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.textDirectionAt(n.from),o=t.posAtCoords({x:i==(s==_9.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=o)return e8.cursor(o,i?-1:1)}let o=m9.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return e8.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return A5(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return e8.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=S5(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return e8.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),S5(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return b3(i,n[t5.find(n,t-s.from,-1,e)].dir==_9.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(T9)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>V4)return s5(t.length);let e=this.textDirectionAt(t.from);for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=i5(t.text,e);return this.bidiCache.push(new N4(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||X3.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{A3(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return R9.of(new D9("number"==typeof t?e8.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return V9.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[O4.of(i),F9.of(C4(`.${i}`,t))];return e&&e.dark&&s.push(S4.of(!0)),s}static baseTheme(t){return v8.lowest(F9.of(C4("."+x4,t,M4)))}}L4.styleModule=F9,L4.inputHandler=C9,L4.perLineTextDirection=T9,L4.exceptionSink=A9,L4.updateListener=M9,L4.editable=B9,L4.mouseSelectionStyle=k9,L4.dragMovesSelection=x9,L4.clickAddsSelectionRange=S9,L4.decorations=Q9,L4.atomicRanges=I9,L4.scrollMargins=z9,L4.darkTheme=S4,L4.contentAttributes=H9,L4.editorAttributes=N9,L4.lineWrapping=L4.contentAttributes.of({class:"cm-lineWrapping"}),L4.announce=V8.define();const V4=4096,W4={};class N4{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:_9.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new N4(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function H4(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&r9(r,i)}return i}const Q4=X3.mac?"mac":X3.windows?"win":X3.linux?"linux":"key";function I4(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const z4=r8.define({enables:L4.domEventHandlers({keydown:(t,e)=>_4($4(e.state),t,e,"editor")})}),F4=new WeakMap;function $4(t){let e=t.facet(z4),i=F4.get(e);return i||F4.set(e,i=function(t,e=Q4){let i=Object.create(null),s=Object.create(null),n=(t,e)=>{let i=s[t];if(null==i)s[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,s,r,o)=>{let h=i[t]||(i[t]=Object.create(null)),l=s.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let s,n,r,o,h=i[i.length-1];"Space"==h&&(h=" ");for(let t=0;t<i.length-1;++t){const h=i[t];if(/^(cmd|meta|m)$/i.test(h))o=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))r=!0;else{if(!/^mod$/i.test(h))throw new Error("Unrecognized modifier name: "+h);"mac"==e?o=!0:n=!0}}return s&&(h="Alt-"+h),n&&(h="Ctrl-"+h),o&&(h="Meta-"+h),r&&(h="Shift-"+h),h}(t,e)));for(let e=1;e<l.length;e++){let i=l.slice(0,e).join(" ");n(i,!0),h[i]||(h[i]={preventDefault:!0,commands:[e=>{let s=q4={view:e,prefix:i,scope:t};return setTimeout((()=>{q4==s&&(q4=null)}),4e3),!0}]})}let a=l.join(" ");n(a,!1);let c=h[a]||(h[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let q4=null;function _4(t,e,i,s){let n=xe(e),r=1==n.length&&" "!=n,o="",h=!1;q4&&q4.view==i&&q4.scope==s&&(o=q4.prefix+" ",(h=T5.indexOf(e.keyCode)<0)&&(q4=null));let l,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(h=!0)}return!1},c=t[s];if(c){if(a(c[o+I4(n,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(l=fe[e.keyCode])&&l!=n){if(a(c[o+I4(l,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+I4(n,e,!0)]))return!0}return h}const G4=!X3.ios;const X4={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};G4&&(X4[".cm-line"].caretColor="transparent !important");class j4{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter((t=>t)),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter((t=>t));if(e===this.input){for(let e of this.tooltipViews)e.update&&e.update(t);return!1}let s=[];for(let e=0;e<i.length;e++){let n=i[e],r=-1;if(n){for(let t=0;t<this.tooltips.length;t++){let e=this.tooltips[t];e&&e.create==n.create&&(r=t)}if(r<0)s[e]=this.createTooltipView(n);else{let i=s[e]=this.tooltipViews[r];i.update&&i.update(t)}}}for(let t of this.tooltipViews)s.indexOf(t)<0&&t.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=s,!0}}function U4(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Z4=r8.define({combine:t=>{var e,i,s;return{position:X3.ios?"absolute":(null===(e=t.find((t=>t.position)))||void 0===e?void 0:e.position)||"fixed",parent:(null===(i=t.find((t=>t.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(s=t.find((t=>t.tooltipSpace)))||void 0===s?void 0:s.tooltipSpace)||U4}}}),Y4=V9.fromClass(class{constructor(t){var e;this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let i=t.state.facet(Z4);this.position=i.position,this.parent=i.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new j4(t,J4,(t=>this.createTooltip(t))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),null===(e=t.dom.ownerDocument.defaultView)||void 0===e||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let i=e||t.geometryChanged,s=t.state.facet(Z4);if(s.position!=this.position){this.position=s.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;i=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top="-10000px",this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;null===(t=this.view.dom.ownerDocument.defaultView)||void 0===t||t.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();null===(e=this.intersectionObserver)||void 0===e||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map(((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((({dom:t})=>t.getBoundingClientRect())),space:this.view.state.facet(Z4).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:i}=t,s=[];for(let n=0;n<this.manager.tooltips.length;n++){let r=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:h}=o,l=t.pos[n],a=t.size[n];if(!l||l.bottom<=Math.max(e.top,i.top)||l.top>=Math.min(e.bottom,i.bottom)||l.right<Math.max(e.left,i.left)-.1||l.left>Math.min(e.right,i.right)+.1){h.style.top="-10000px";continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,d=c?7:0,u=a.right-a.left,f=a.bottom-a.top,p=o.offset||K4,g=this.view.textDirection==_9.LTR,m=a.width>i.right-i.left?g?i.left:i.right-a.width:g?Math.min(l.left-(c?14:0)+p.x,i.right-u):Math.max(i.left,l.left-u+(c?14:0)-p.x),w=!!r.above;!r.strictSide&&(w?l.top-(a.bottom-a.top)-p.y<i.top:l.bottom+(a.bottom-a.top)+p.y>i.bottom)&&w==i.bottom-l.bottom>l.top-i.top&&(w=!w);let v=w?l.top-f-d-p.y:l.bottom+d+p.y,y=m+u;if(!0!==o.overlap)for(let t of s)t.left<y&&t.right>m&&t.top<v+f&&t.bottom>v&&(v=w?t.top-f-2-d:t.bottom+d+2);"absolute"==this.position?(h.style.top=v-t.parent.top+"px",h.style.left=m-t.parent.left+"px"):(h.style.top=v+"px",h.style.left=m+"px"),c&&(c.style.left=l.left+(g?p.x:-p.x)-(m+14-7)+"px"),!0!==o.overlap&&s.push({left:m,top:v,right:y,bottom:v+f}),h.classList.toggle("cm-tooltip-above",w),h.classList.toggle("cm-tooltip-below",!w),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top="-10000px"}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),K4={x:0,y:0},J4=r8.define({enables:[Y4,L4.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}})]});class t6 extends j8{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}t6.prototype.elementClass="",t6.prototype.toDOM=void 0,t6.prototype.mapMode=_2.TrackBefore,t6.prototype.startSide=t6.prototype.endSide=-1,t6.prototype.point=!0;var e6,i6,s6,n6=e6={};function r6(){throw new Error("setTimeout has not been defined")}function o6(){throw new Error("clearTimeout has not been defined")}function h6(t){if(i6===setTimeout)return setTimeout(t,0);if((i6===r6||!i6)&&setTimeout)return i6=setTimeout,setTimeout(t,0);try{return i6(t,0)}catch(e){try{return i6.call(null,t,0)}catch(e){return i6.call(this,t,0)}}}!function(){try{i6="function"==typeof setTimeout?setTimeout:r6}catch(t){i6=r6}try{s6="function"==typeof clearTimeout?clearTimeout:o6}catch(t){s6=o6}}();var l6,a6,c6,d6=[],u6=!1,f6=-1;function p6(){u6&&l6&&(u6=!1,l6.length?d6=l6.concat(d6):f6=-1,d6.length&&g6())}function g6(){if(!u6){var t=h6(p6);u6=!0;for(var e=d6.length;e;){for(l6=d6,d6=[];++f6<e;)l6&&l6[f6].run();f6=-1,e=d6.length}l6=null,u6=!1,function(t){if(s6===clearTimeout)return clearTimeout(t);if((s6===o6||!s6)&&clearTimeout)return s6=clearTimeout,clearTimeout(t);try{s6(t)}catch(e){try{return s6.call(null,t)}catch(e){return s6.call(this,t)}}}(t)}}function m6(t,e){this.fun=t,this.array=e}function w6(){}n6.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d6.push(new m6(t,e)),1!==d6.length||u6||h6(g6)},m6.prototype.run=function(){this.fun.apply(null,this.array)},n6.title="browser",n6.browser=!0,n6.env={},n6.argv=[],n6.version="",n6.versions={},n6.on=w6,n6.addListener=w6,n6.once=w6,n6.off=w6,n6.removeListener=w6,n6.removeAllListeners=w6,n6.emit=w6,n6.prependListener=w6,n6.prependOnceListener=w6,n6.listeners=function(t){return[]},n6.binding=function(t){throw new Error("process.binding is not supported")},n6.cwd=function(){return"/"},n6.chdir=function(t){throw new Error("process.chdir is not supported")},n6.umask=function(){return 0};class v6{constructor(t,e,i,s,n,r,o,h,l,a=0,c){this.p=t,this.stack=e,this.state=i,this.reducePos=s,this.pos=n,this.score=r,this.buffer=o,this.bufferBase=h,this.curContext=l,this.lookAhead=a,this.parent=c}toString(){return`[${this.stack.filter(((t,e)=>e%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let s=t.parser.context;return new v6(t,[],e,i,i,0,[],0,s?new y6(s,s.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){let e=t>>19,i=65535&t,{parser:s}=this.p,n=s.dynamicPrecedence(i);if(n&&(this.score+=n),0==e)return this.pushState(s.getGoto(this.state,i,!0),this.reducePos),i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),void this.reduceContext(i,this.reducePos);let r=this.stack.length-3*(e-1)-(262144&t?6:0),o=this.stack[r-2],h=this.stack[r-1],l=this.bufferBase+this.buffer.length-h;if(i<s.minRepeatTerm||131072&t){let t=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,o,t,l+4,!0)}if(262144&t)this.state=this.stack[r];else{let t=this.stack[r-3];this.state=s.getGoto(t,i,!0)}for(;this.stack.length>r;)this.stack.pop();this.reduceContext(i,o)}storeNode(t,e,i,s=4,n=!1){if(0==t){let t=this,s=this.buffer.length;if(0==s&&t.parent&&(s=t.bufferBase-t.parent.bufferBase,t=t.parent),s>0&&0==t.buffer[s-4]&&t.buffer[s-1]>-1){if(e==i)return;if(t.buffer[s-2]>=e)return void(t.buffer[s-2]=i)}}if(n&&this.pos!=i){let n=this.buffer.length;if(n>0&&0!=this.buffer[n-4])for(;n>0&&this.buffer[n-2]>i;)this.buffer[n]=this.buffer[n-4],this.buffer[n+1]=this.buffer[n-3],this.buffer[n+2]=this.buffer[n-2],this.buffer[n+3]=this.buffer[n-1],n-=4,s>4&&(s-=4);this.buffer[n]=t,this.buffer[n+1]=e,this.buffer[n+2]=i,this.buffer[n+3]=s}else this.buffer.push(t,e,i,s)}shift(t,e,i){let s=this.pos;if(131072&t)this.pushState(65535&t,this.pos);else if(0==(262144&t)){let n=t,{parser:r}=this.p;(i>this.pos||e<=r.maxNode)&&(this.pos=i,r.stateFlag(n,1)||(this.reducePos=i)),this.pushState(n,s),this.shiftContext(e,s),e<=r.maxNode&&this.buffer.push(e,s,i,4)}else this.pos=i,this.shiftContext(e,s),e<=this.p.parser.maxNode&&this.buffer.push(e,s,i,4)}apply(t,e,i){65536&t?this.reduce(t):this.shift(t,e,i)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let s=this.pos;this.reducePos=this.pos=s+t.length,this.pushState(e,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),s=t.bufferBase+e;for(;t&&s==t.bufferBase;)t=t.parent;return new v6(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(t){for(let e=new b6(this);;){let i=this.p.parser.stateSlot(e.state,4)||this.p.parser.hasAction(e.state,t);if(0==(65536&i))return!0;if(0==i)return!1;e.reduce(i)}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let i=[];for(let s,n=0;n<e.length;n+=2)(s=e[n+1])!=this.state&&this.p.parser.hasAction(s,t)&&i.push(e[n],s);if(this.stack.length<120)for(let t=0;i.length<8&&t<e.length;t+=2){let s=e[t+1];i.some(((t,e)=>1&e&&t==s))||i.push(e[t],s)}e=i}let i=[];for(let t=0;t<e.length&&i.length<4;t+=2){let s=e[t+1];if(s==this.state)continue;let n=this.split();n.storeNode(0,n.pos,n.pos,4,!0),n.pushState(s,this.pos),n.shiftContext(e[t],this.pos),n.score-=200,i.push(n)}return i}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);if(0==(65536&t))return!1;let{parser:e}=this.p;if(!e.validAction(this.state,t)){let i=t>>19,s=65535&t,n=this.stack.length-3*i;if(n<0||e.getGoto(this.stack[n],s,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reduce(t),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:t}=this.p;return 65535==t.data[t.stateSlot(this.state,1)]&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){let t=this.buffer.length-1;(t<0||-3!=this.buffer[t])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||-4!=this.buffer[t])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(t){if(t!=this.curContext.context){let e=new y6(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class y6{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}(c6=a6||(a6={}))[c6.Insert=200]="Insert",c6[c6.Delete=190]="Delete",c6[c6.Reduce=100]="Reduce",c6[c6.MaxNext=4]="MaxNext",c6[c6.MaxInsertStackDepth=300]="MaxInsertStackDepth",c6[c6.DampenInsertStackDepth=120]="DampenInsertStackDepth";class b6{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let e=65535&t,i=t>>19;0==i?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(i-1);let s=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=s}}class O6{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,0==this.index&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new O6(t,e,e-t.bufferBase)}maybeNext(){let t=this.stack.parent;null!=t&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new O6(this.stack,this.pos,this.index)}}class S6{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const x6=new S6;class k6{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=x6,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let i=this.range,s=this.rangeIndex,n=this.pos+t;for(;n<i.from;){if(!s)return null;let t=this.ranges[--s];n-=i.from-t.to,i=t}for(;e<0?n>i.to:n>=i.to;){if(s==this.ranges.length-1)return null;let t=this.ranges[++s];n+=t.from-i.to,i=t}return n}peek(t){let e,i,s=this.chunkOff+t;if(s>=0&&s<this.chunk.length)e=this.pos+t,i=this.chunk.charCodeAt(s);else{let s=this.resolveOffset(t,1);if(null==s)return-1;if(e=s,e>=this.chunk2Pos&&e<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(e-this.chunk2Pos);else{let t=this.rangeIndex,s=this.range;for(;s.to<=e;)s=this.ranges[++t];this.chunk2=this.input.chunk(this.chunk2Pos=e),e+this.chunk2.length>s.to&&(this.chunk2=this.chunk2.slice(0,s.to-e)),i=this.chunk2.charCodeAt(0)}}return e>=this.token.lookAhead&&(this.token.lookAhead=e+1),i}acceptToken(t,e=0){let i=e?this.resolveOffset(e,-1):this.pos;if(null==i||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=i}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?(this.token=e,e.start=t,e.lookAhead=t+1,e.value=e.extended=-1):this.token=x6,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.chunk2Pos&&e<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,e-this.chunk2Pos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let i="";for(let s of this.ranges){if(s.from>=e)break;s.to>t&&(i+=this.input.read(Math.max(s.from,t),Math.min(s.to,e)))}return i}}class A6{constructor(t,e){this.data=t,this.id=e}token(t,e){!function(t,e,i,s){let n=0,r=1<<s,{parser:o}=i.p,{dialect:h}=o;t:for(;0!=(r&t[n]);){let i=t[n+1];for(let s=n+3;s<i;s+=2)if((t[s+1]&r)>0){let i=t[s];if(h.allows(i)&&(-1==e.token.value||e.token.value==i||o.overrides(i,e.token.value))){e.acceptToken(i);break}}for(let s=e.next,r=0,o=t[n+2];r<o;){let h=r+o>>1,l=i+h+(h<<1),a=t[l],c=t[l+1];if(s<a)o=h;else{if(!(s>=c)){n=t[l+2],e.advance();continue t}r=h+1}}break}}(this.data,t,e,this.id)}}A6.prototype.contextual=A6.prototype.fallback=A6.prototype.extend=!1;class M6{constructor(t,e={}){this.token=t,this.contextual=!!e.contextual,this.fallback=!!e.fallback,this.extend=!!e.extend}}function C6(t,e=Uint16Array){if("string"!=typeof t)return t;let i=null;for(let s=0,n=0;s<t.length;){let r=0;for(;;){let e=t.charCodeAt(s++),i=!1;if(126==e){r=65535;break}e>=92&&e--,e>=34&&e--;let n=e-32;if(n>=46&&(n-=46,i=!0),r+=n,i)break;r*=46}i?i[n++]=r:i=new e(r)}return i}const T6=void 0!==e6&&/\bparse\b/.test(void 0);let D6=null;var R6,E6,B6,P6;function L6(t,e,i){let s=t.fullCursor();for(s.moveTo(e);;)if(!(i<0?s.childBefore(e):s.childAfter(e)))for(;;){if((i<0?s.to<e:s.from>e)&&!s.type.isError)return i<0?Math.max(0,Math.min(s.to-1,e-25)):Math.min(t.length,Math.max(s.from+1,e+25));if(i<0?s.prevSibling():s.nextSibling())break;if(!s.parent())return i<0?0:t.length}}(E6=R6||(R6={}))[E6.Margin=25]="Margin";class V6{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?L6(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?L6(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],s=this.index[e];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let n=i.children[s],r=this.start[e]+i.positions[s];if(r>t)return this.nextStart=r,null;if(n instanceof Rf){if(r==t){if(r<this.safeFrom)return null;let t=r+n.length;if(t<=this.safeTo){let e=n.prop(kf.lookAhead);if(!e||t+e<this.fragment.to)return n}}this.index[e]++,r+n.length>=Math.max(this.safeFrom,t)&&(this.trees.push(n),this.start.push(r),this.index.push(0))}else this.index[e]++,this.nextStart=r+n.length}}}class W6{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map((t=>new S6))}getActions(t){let e=0,i=null,{parser:s}=t.p,{tokenizers:n}=s,r=s.stateSlot(t.state,3),o=t.curContext?t.curContext.hash:0,h=0;for(let s=0;s<n.length;s++){if(0==(1<<s&r))continue;let l=n[s],a=this.tokens[s];if((!i||l.fallback)&&((l.contextual||a.start!=t.pos||a.mask!=r||a.context!=o)&&(this.updateCachedToken(a,l,t),a.mask=r,a.context=o),a.lookAhead>a.end+25&&(h=Math.max(a.lookAhead,h)),0!=a.value)){let s=e;if(a.extended>-1&&(e=this.addActions(t,a.extended,a.end,e)),e=this.addActions(t,a.value,a.end,e),!l.extend&&(i=a,e>s))break}}for(;this.actions.length>e;)this.actions.pop();return h&&t.setLookAhead(h),i||t.pos!=this.stream.end||(i=new S6,i.value=t.p.parser.eofTerm,i.start=i.end=t.pos,e=this.addActions(t,i.value,i.end,e)),this.mainToken=i,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let e=new S6,{pos:i,p:s}=t;return e.start=i,e.end=Math.min(i+1,s.stream.end),e.value=i==s.stream.end?s.parser.eofTerm:0,e}updateCachedToken(t,e,i){if(e.token(this.stream.reset(i.pos,t),i),t.value>-1){let{parser:e}=i.p;for(let s=0;s<e.specialized.length;s++)if(e.specialized[s]==t.value){let n=e.specializers[s](this.stream.read(t.start,t.end),i);if(n>=0&&i.p.parser.dialect.allows(n>>1)){0==(1&n)?t.value=n>>1:t.extended=n>>1;break}}}else t.value=0,t.end=Math.min(i.p.stream.end,i.pos+1)}putAction(t,e,i,s){for(let e=0;e<s;e+=3)if(this.actions[e]==t)return s;return this.actions[s++]=t,this.actions[s++]=e,this.actions[s++]=i,s}addActions(t,e,i,s){let{state:n}=t,{parser:r}=t.p,{data:o}=r;for(let t=0;t<2;t++)for(let h=r.stateSlot(n,t?2:1);;h+=3){if(65535==o[h]){if(1!=o[h+1]){0==s&&2==o[h+1]&&(s=this.putAction(F6(o,h+2),e,i,s));break}h=F6(o,h+2)}o[h]==e&&(s=this.putAction(F6(o,h+1),e,i,s))}return s}}(P6=B6||(B6={}))[P6.Distance=5]="Distance",P6[P6.MaxRemainingPerStep=3]="MaxRemainingPerStep",P6[P6.MinBufferLengthPrune=500]="MinBufferLengthPrune",P6[P6.ForceReduceLimit=10]="ForceReduceLimit",P6[P6.CutDepth=15e3]="CutDepth",P6[P6.CutTo=9e3]="CutTo";class N6{constructor(t,e,i,s){this.parser=t,this.input=e,this.ranges=s,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new k6(e,s),this.tokens=new W6(t,this.stream),this.topTerm=t.top[1];let{from:n}=s[0];this.stacks=[v6.start(this,t.top[0],n)],this.fragments=i.length&&this.stream.end-n>4*t.bufferLength?new V6(i,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t,e,i=this.stacks,s=this.minStackPos,n=this.stacks=[];for(let r=0;r<i.length;r++){let o=i[r];for(;;){if(this.tokens.mainToken=null,o.pos>s)n.push(o);else{if(this.advanceStack(o,n,i))continue;{t||(t=[],e=[]),t.push(o);let i=this.tokens.getMainToken(o);e.push(i.value,i.end)}}break}}if(!n.length){let e=t&&function(t){let e=null;for(let i of t){let t=i.p.stoppedAt;(i.pos==i.p.stream.end||null!=t&&i.pos>t)&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i)}return e}(t);if(e)return this.stackToTree(e);if(this.parser.strict)throw T6&&t&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+s);this.recovering||(this.recovering=5)}if(this.recovering&&t){let i=null!=this.stoppedAt&&t[0].pos>this.stoppedAt?t[0]:this.runRecovery(t,e,n);if(i)return this.stackToTree(i.forceAll())}if(this.recovering){let t=1==this.recovering?1:3*this.recovering;if(n.length>t)for(n.sort(((t,e)=>e.score-t.score));n.length>t;)n.pop();n.some((t=>t.reducePos>s))&&this.recovering--}else if(n.length>1)t:for(let t=0;t<n.length-1;t++){let e=n[t];for(let i=t+1;i<n.length;i++){let s=n[i];if(e.sameState(s)||e.buffer.length>500&&s.buffer.length>500){if(!((e.score-s.score||e.buffer.length-s.buffer.length)>0)){n.splice(t--,1);continue t}n.splice(i--,1)}}}this.minStackPos=n[0].pos;for(let t=1;t<n.length;t++)n[t].pos<this.minStackPos&&(this.minStackPos=n[t].pos);return null}stopAt(t){if(null!=this.stoppedAt&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,e,i){let s=t.pos,{parser:n}=this,r=T6?this.stackID(t)+" -> ":"";if(null!=this.stoppedAt&&s>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let e=t.curContext&&t.curContext.tracker.strict,i=e?t.curContext.hash:0;for(let o=this.fragments.nodeAt(s);o;){let s=this.parser.nodeSet.types[o.type.id]==o.type?n.getGoto(t.state,o.type.id):-1;if(s>-1&&o.length&&(!e||(o.prop(kf.contextHash)||0)==i))return t.useNode(o,s),T6&&console.log(r+this.stackID(t)+` (via reuse of ${n.getName(o.type.id)})`),!0;if(!(o instanceof Rf)||0==o.children.length||o.positions[0]>0)break;let h=o.children[0];if(!(h instanceof Rf&&0==o.positions[0]))break;o=h}}let o=n.stateSlot(t.state,4);if(o>0)return t.reduce(o),T6&&console.log(r+this.stackID(t)+` (via always-reduce ${n.getName(65535&o)})`),!0;if(t.stack.length>=15e3)for(;t.stack.length>9e3&&t.forceReduce(););let h=this.tokens.getActions(t);for(let o=0;o<h.length;){let l=h[o++],a=h[o++],c=h[o++],d=o==h.length||!i,u=d?t:t.split();if(u.apply(l,a,c),T6&&console.log(r+this.stackID(u)+` (via ${0==(65536&l)?"shift":`reduce of ${n.getName(65535&l)}`} for ${n.getName(a)} @ ${s}${u==t?"":", split"})`),d)return!0;u.pos>s?e.push(u):i.push(u)}return!1}advanceFully(t,e){let i=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return H6(t,e),!0}}runRecovery(t,e,i){let s=null,n=!1;for(let r=0;r<t.length;r++){let o=t[r],h=e[r<<1],l=e[1+(r<<1)],a=T6?this.stackID(o)+" -> ":"";if(o.deadEnd){if(n)continue;if(n=!0,o.restart(),T6&&console.log(a+this.stackID(o)+" (restarted)"),this.advanceFully(o,i))continue}let c=o.split(),d=a;for(let t=0;c.forceReduce()&&t<10;t++){if(T6&&console.log(d+this.stackID(c)+" (via force-reduce)"),this.advanceFully(c,i))break;T6&&(d=this.stackID(c)+" -> ")}for(let t of o.recoverByInsert(h))T6&&console.log(a+this.stackID(t)+" (via recover-insert)"),this.advanceFully(t,i);this.stream.end>o.pos?(l==o.pos&&(l++,h=0),o.recoverByDelete(h,l),T6&&console.log(a+this.stackID(o)+` (via recover-delete ${this.parser.getName(h)})`),H6(o,i)):(!s||s.score<o.score)&&(s=o)}return s}stackToTree(t){return t.close(),Rf.build({buffer:O6.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(D6||(D6=new WeakMap)).get(t);return e||D6.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function H6(t,e){for(let i=0;i<e.length;i++){let s=e[i];if(s.pos==t.pos&&s.sameState(t))return void(e[i].score<t.score&&(e[i]=t))}e.push(t)}class Q6{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||0==this.disabled[t]}}const I6=t=>t;class z6 extends Gf{constructor(t){if(super(),this.wrappers=[],13!=t.version)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (13)`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let i=0;i<t.repeatNodeCount;i++)e.push("");let i=Object.keys(t.topRules).map((e=>t.topRules[e][1])),s=[];for(let t=0;t<e.length;t++)s.push([]);function n(t,e,i){s[t].push([e,e.deserialize(String(i))])}if(t.nodeProps)for(let e of t.nodeProps){let t=e[0];for(let i=1;i<e.length;){let s=e[i++];if(s>=0)n(s,t,e[i++]);else{let r=e[i+-s];for(let o=-s;o>0;o--)n(e[i++],t,r);i++}}}this.nodeSet=new Cf(e.map(((e,n)=>Mf.define({name:n>=this.minRepeatTerm?void 0:e,id:n,props:s[n],top:i.indexOf(n)>-1,error:0==n,skipped:t.skippedNodes&&t.skippedNodes.indexOf(n)>-1})))),this.strict=!1,this.bufferLength=Of;let r=C6(t.tokenData);if(this.context=t.context,this.specialized=new Uint16Array(t.specialized?t.specialized.length:0),this.specializers=[],t.specialized)for(let e=0;e<t.specialized.length;e++)this.specialized[e]=t.specialized[e].term,this.specializers[e]=t.specialized[e].get;this.states=C6(t.states,Uint32Array),this.data=C6(t.stateData),this.goto=C6(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map((t=>"number"==typeof t?new A6(r,t):t)),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,i){let s=new N6(this,t,e,i);for(let n of this.wrappers)s=n(s,t,e,i);return s}getGoto(t,e,i=!1){let s=this.goto;if(e>=s[0])return-1;for(let n=s[e+1];;){let e=s[n++],r=1&e,o=s[n++];if(r&&i)return o;for(let i=n+(e>>1);n<i;n++)if(s[n]==t)return o;if(r)return-1}}hasAction(t,e){let i=this.data;for(let s=0;s<2;s++)for(let n,r=this.stateSlot(t,s?2:1);;r+=3){if(65535==(n=i[r])){if(1!=i[r+1]){if(2==i[r+1])return F6(i,r+2);break}n=i[r=F6(i,r+2)]}if(n==e||0==n)return F6(i,r+1)}return 0}stateSlot(t,e){return this.states[6*t+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}validAction(t,e){if(e==this.stateSlot(t,4))return!0;for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])return!1;i=F6(this.data,i+2)}if(e==F6(this.data,i+1))return!0}}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=F6(this.data,i+2)}if(0==(1&this.data[i+2])){let t=this.data[i+1];e.some(((e,i)=>1&i&&e==t))||e.push(this.data[i],t)}}return e}overrides(t,e){let i=$6(this.data,this.tokenPrecTable,e);return i<0||$6(this.data,this.tokenPrecTable,t)<i}configure(t){let e=Object.assign(Object.create(z6.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map((e=>{let i=t.tokenizers.find((t=>t.from==e));return i?i.to:e}))),t.contextTracker&&(e.context=t.contextTracker),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),null!=t.strict&&(e.strict=t.strict),t.wrap&&(e.wrappers=e.wrappers.concat(t.wrap)),null!=t.bufferLength&&(e.bufferLength=t.bufferLength),e}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return null==e?0:e[t]||0}parseDialect(t){let e=Object.keys(this.dialects),i=e.map((()=>!1));if(t)for(let s of t.split(" ")){let t=e.indexOf(s);t>=0&&(i[t]=!0)}let s=null;for(let t=0;t<e.length;t++)if(!i[t])for(let i,n=this.dialects[e[t]];65535!=(i=this.data[n++]);)(s||(s=new Uint8Array(this.maxTerm+1)))[i]=1;return new Q6(t,i,s)}static deserialize(t){return new z6(t)}}function F6(t,e){return t[e]|t[e+1]<<16}function $6(t,e,i){for(let s,n=e;65535!=(s=t[n]);n++)if(s==i)return n-e;return-1}const q6=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],_6=new class{constructor(t){this.start=t.start,this.shift=t.shift||I6,this.reduce=t.reduce||I6,this.reuse=t.reuse||I6,this.hash=t.hash||(()=>0),this.strict=!1!==t.strict}}({start:!1,shift:(t,e)=>5==e||6==e||284==e?t:285==e,strict:!1}),G6=new M6(((t,e)=>{let{next:i}=t;(125==i||-1==i||e.context)&&e.canShift(282)&&t.acceptToken(282)}),{contextual:!0,fallback:!0}),X6=new M6(((t,e)=>{let i,{next:s}=t;q6.indexOf(s)>-1||(47!=s||47!=(i=t.peek(1))&&42!=i)&&125!=s&&59!=s&&-1!=s&&!e.context&&e.canShift(279)&&t.acceptToken(279)}),{contextual:!0}),j6=new M6(((t,e)=>{let{next:i}=t;if((43==i||45==i)&&(t.advance(),i==t.next)){t.advance();let i=!e.context&&e.canShift(1);t.acceptToken(i?1:2)}}),{contextual:!0}),U6=new M6((t=>{for(let e=!1,i=0;;i++){let{next:s}=t;if(s<0){i&&t.acceptToken(280);break}if(96==s){i?t.acceptToken(280):t.acceptToken(281,1);break}if(123==s&&e){1==i?t.acceptToken(3,1):t.acceptToken(280,-1);break}if(10==s&&i){t.advance(),t.acceptToken(280);break}92==s&&t.advance(),e=36==s,t.advance()}}));const Z6={__proto__:null,export:18,as:23,from:29,default:32,async:37,function:38,this:48,true:56,false:56,void:66,typeof:70,null:86,super:88,new:122,await:139,yield:141,delete:142,class:152,extends:154,public:197,private:197,protected:197,readonly:199,instanceof:220,in:222,const:224,import:256,keyof:307,unique:311,infer:317,is:351,abstract:371,implements:373,type:375,let:378,var:380,interface:387,enum:391,namespace:397,module:399,declare:403,global:407,for:428,of:437,while:440,with:444,do:448,if:452,else:454,switch:458,case:464,try:470,catch:472,finally:474,return:478,throw:482,break:486,continue:490,debugger:494},Y6={__proto__:null,async:109,get:111,set:113,public:161,private:161,protected:161,static:163,abstract:165,override:167,readonly:173,new:355},K6={__proto__:null,"<":129},J6=z6.deserialize({version:13,states:"$1jO`QYOOO'QQ!LdO'#ChO'XOSO'#DVO)dQYO'#D]O)tQYO'#DhO){QYO'#DrO-xQYO'#DxOOQO'#E]'#E]O.]QWO'#E[O.bQWO'#E[OOQ!LS'#Ef'#EfO0aQ!LdO'#IrO2wQ!LdO'#IsO3eQWO'#EzO3jQpO'#FaOOQ!LS'#FS'#FSO3rO!bO'#FSO4QQWO'#FhO5_QWO'#FgOOQ!LS'#Is'#IsOOQ!LQ'#Ir'#IrOOQQ'#J['#J[O5dQWO'#HnO5iQ!LYO'#HoOOQQ'#If'#IfOOQQ'#Hp'#HpQ`QYOOO){QYO'#DjO5qQWO'#G[O5vQ#tO'#CmO6UQWO'#EZO6aQWO'#EgO6fQ#tO'#FRO7QQWO'#G[O7VQWO'#G`O7bQWO'#G`O7pQWO'#GcO7pQWO'#GdO7pQWO'#GfO5qQWO'#GiO8aQWO'#GlO9oQWO'#CdO:PQWO'#GyO:XQWO'#HPO:XQWO'#HRO`QYO'#HTO:XQWO'#HVO:XQWO'#HYO:^QWO'#H`O:cQ!LZO'#HdO){QYO'#HfO:nQ!LZO'#HhO:yQ!LZO'#HjO5iQ!LYO'#HlO){QYO'#DWOOOS'#Hr'#HrO;UOSO,59qOOQ!LS,59q,59qO=gQbO'#ChO=qQYO'#HsO>UQWO'#ItO@TQbO'#ItO'dQYO'#ItO@[QWO,59wO@rQ&jO'#DbOAkQWO'#E]OAxQWO'#JPOBTQWO'#JOOBTQWO'#JOOB]QWO,5:yOBbQWO'#I}OBiQWO'#DyO5vQ#tO'#EZOBwQWO'#EZOCSQ`O'#FROOQ!LS,5:S,5:SOC[QYO,5:SOEYQ!LdO,5:^OEvQWO,5:dOFaQ!LYO'#I|O7VQWO'#I{OFhQWO'#I{OFpQWO,5:xOFuQWO'#I{OGTQYO,5:vOITQWO'#EWOJ_QWO,5:vOKnQWO'#DlOKuQYO'#DqOLPQ&jO,5;PO){QYO,5;POOQQ'#Er'#ErOOQQ'#Et'#EtO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;RO){QYO,5;ROOQQ'#Ex'#ExOLXQYO,5;cOOQ!LS,5;h,5;hOOQ!LS,5;i,5;iONXQWO,5;iOOQ!LS,5;j,5;jO){QYO'#H}ON^Q!LYO,5<TONxQWO,5;RO){QYO,5;fO! bQpO'#JTO! PQpO'#JTO! iQpO'#JTO! zQpO,5;qOOOO,5;{,5;{O!!YQYO'#FcOOOO'#H|'#H|O3rO!bO,5;nO!!aQpO'#FeOOQ!LS,5;n,5;nO!!}Q,UO'#CrOOQ!LS'#Cu'#CuO!#bQWO'#CuO!#gOSO'#CyO!$TQ#tO,5<QO!$[QWO,5<SO!%hQWO'#FrO!%uQWO'#FsO!%zQWO'#FwO!&|Q&jO'#F{O!'oQ,UO'#IoOOQ!LS'#Io'#IoO!'yQWO'#InO!(XQWO'#ImOOQ!LS'#Cs'#CsOOQ!LS'#C|'#C|O!(aQWO'#DOOJdQWO'#FjOJdQWO'#FlO!(fQWO'#FnO!(kQWO'#FoO!(pQWO'#FuOJdQWO'#FzO!(uQWO'#E^O!)^QWO,5<RO`QYO,5>YOOQQ'#Ii'#IiOOQQ,5>Z,5>ZOOQQ-E;n-E;nO!+YQ!LdO,5:UOOQ!LQ'#Cp'#CpO!+yQ#tO,5<vOOQO'#Cf'#CfO!,[QWO'#CqO!,dQ!LYO'#IjO5_QWO'#IjO:^QWO,59XO!,rQpO,59XO!,zQ#tO,59XO5vQ#tO,59XO!-VQWO,5:vO!-_QWO'#GxO!-mQWO'#J`O){QYO,5;kO!-uQ&jO,5;mO!-zQWO,5=cO!.PQWO,5=cO!.UQWO,5=cO5iQ!LYO,5=cO5qQWO,5<vO!.dQWO'#E_O!.xQ&jO'#E`OOQ!LQ'#I}'#I}O!/ZQ!LYO'#J]O5iQ!LYO,5<zO7pQWO,5=QOOQO'#Cr'#CrO!/fQpO,5<}O!/nQ#tO,5=OO!/yQWO,5=QO!0OQ`O,5=TO:^QWO'#GnO5qQWO'#GpO!0WQWO'#GpO5vQ#tO'#GsO!0]QWO'#GsOOQQ,5=W,5=WO!0bQWO'#GtO!0jQWO'#CmO!0oQWO,59OO!0yQWO,59OO!2{QYO,59OOOQQ,59O,59OO!3YQ!LYO,59OO){QYO,59OO!3eQYO'#G{OOQQ'#G|'#G|OOQQ'#G}'#G}O`QYO,5=eO!3uQWO,5=eO){QYO'#DxO`QYO,5=kO`QYO,5=mO!3zQWO,5=oO`QYO,5=qO!4PQWO,5=tO!4UQYO,5=zOOQQ,5>O,5>OO){QYO,5>OO5iQ!LYO,5>QOOQQ,5>S,5>SO!8VQWO,5>SOOQQ,5>U,5>UO!8VQWO,5>UOOQQ,5>W,5>WO!8[Q`O,59rOOOS-E;p-E;pOOQ!LS1G/]1G/]O!8aQbO,5>_O'dQYO,5>_OOQO,5>d,5>dO!8kQYO'#HsOOQO-E;q-E;qO!8xQWO,5?`O!9QQbO,5?`O!9XQWO,5?jOOQ!LS1G/c1G/cO!9aQpO'#DTOOQO'#Iv'#IvO){QYO'#IvO!:OQpO'#IvO!:mQpO'#DcO!;OQ&jO'#DcO!=ZQYO'#DcO!=bQWO'#IuO!=jQWO,59|O!=oQWO'#EaO!=}QWO'#JQO!>VQWO,5:zO!>mQ&jO'#DcO){QYO,5?kO!>wQWO'#HxOOQO-E;v-E;vO!9XQWO,5?jOOQ!LQ1G0e1G0eO!@TQ&jO'#D|OOQ!LS,5:e,5:eO){QYO,5:eOITQWO,5:eO!@[QWO,5:eO:^QWO,5:uO!,rQpO,5:uO!,zQ#tO,5:uO5vQ#tO,5:uOOQ!LS1G/n1G/nOOQ!LS1G0O1G0OOOQ!LQ'#EV'#EVO){QYO,5?hO!@gQ!LYO,5?hO!@xQ!LYO,5?hO!APQWO,5?gO!AXQWO'#HzO!APQWO,5?gOOQ!LQ1G0d1G0dO7VQWO,5?gOOQ!LS1G0b1G0bO!AsQ!LdO1G0bO!BdQ!LbO,5:rOOQ!LS'#Fq'#FqO!CQQ!LdO'#IoOGTQYO1G0bO!EPQ#tO'#IwO!EZQWO,5:WO!E`QbO'#IxO){QYO'#IxO!EjQWO,5:]OOQ!LS'#DT'#DTOOQ!LS1G0k1G0kO!EoQWO1G0kO!HQQ!LdO1G0mO!HXQ!LdO1G0mO!JlQ!LdO1G0mO!JsQ!LdO1G0mO!LzQ!LdO1G0mO!M_Q!LdO1G0mO#!OQ!LdO1G0mO#!VQ!LdO1G0mO#$jQ!LdO1G0mO#$qQ!LdO1G0mO#&fQ!LdO1G0mO#)`Q7^O'#ChO#+ZQ7^O1G0}O#-UQ7^O'#IsOOQ!LS1G1T1G1TO#-iQ!LdO,5>iOOQ!LQ-E;{-E;{O#.YQ!LdO1G0mOOQ!LS1G0m1G0mO#0[Q!LdO1G1QO#0{QpO,5;sO#1QQpO,5;tO#1VQpO'#F[O#1kQWO'#FZOOQO'#JU'#JUOOQO'#H{'#H{O#1pQpO1G1]OOQ!LS1G1]1G1]OOOO1G1f1G1fO#2OQ7^O'#IrO#2YQWO,5;}OLXQYO,5;}OOOO-E;z-E;zOOQ!LS1G1Y1G1YOOQ!LS,5<P,5<PO#2_QpO,5<POOQ!LS,59a,59aOITQWO'#C{OOOS'#Hq'#HqO#2dOSO,59eOOQ!LS,59e,59eO){QYO1G1lO!(kQWO'#IPO#2oQWO,5<eOOQ!LS,5<b,5<bOOQO'#GV'#GVOJdQWO,5<pOOQO'#GX'#GXOJdQWO,5<rOJdQWO,5<tOOQO1G1n1G1nO#2zQ`O'#CpO#3_Q`O,5<^O#3fQWO'#JXO5qQWO'#JXO#3tQWO,5<`OJdQWO,5<_O#3yQ`O'#FqO#4WQ`O'#JYO#4bQWO'#JYOITQWO'#JYO#4gQWO,5<cOOQ!LQ'#Dg'#DgO#4lQWO'#FtO#4wQpO'#F|O!&wQ&jO'#F|O!&wQ&jO'#GOO#5YQWO'#GPO!(pQWO'#GSOOQO'#IR'#IRO#5_Q&jO,5<gOOQ!LS,5<g,5<gO#5fQ&jO'#F|O#5tQ&jO'#F}O#5|Q&jO'#F}OOQ!LS,5<u,5<uOJdQWO,5?YOJdQWO,5?YO#6RQWO'#ISO#6^QWO,5?XOOQ!LS'#Ch'#ChO#7QQ#tO,59jOOQ!LS,59j,59jO#7sQ#tO,5<UO#8fQ#tO,5<WO#8pQWO,5<YOOQ!LS,5<Z,5<ZO#8uQWO,5<aO#8zQ#tO,5<fOGTQYO1G1mO#9[QWO1G1mOOQQ1G3t1G3tOOQ!LS1G/p1G/pONXQWO1G/pOOQQ1G2b1G2bOITQWO1G2bO){QYO1G2bOITQWO1G2bO#9aQWO1G2bO#9oQWO,59]O#:xQWO'#EWOOQ!LQ,5?U,5?UO#;SQ!LYO,5?UOOQQ1G.s1G.sO:^QWO1G.sO!,rQpO1G.sO!,zQ#tO1G.sO#;bQWO1G0bO#;gQWO'#ChO#;rQWO'#JaO#;zQWO,5=dO#<PQWO'#JaO#<UQWO'#JaO#<^QWO'#I[O#<lQWO,5?zO#<tQbO1G1VOOQ!LS1G1X1G1XO5qQWO1G2}O#<{QWO1G2}O#=QQWO1G2}O#=VQWO1G2}OOQQ1G2}1G2}O#=[Q#tO1G2bO7VQWO'#JOO7VQWO'#EaO7VQWO'#IUO#=mQ!LYO,5?wOOQQ1G2f1G2fO!/yQWO1G2lOITQWO1G2iO#=xQWO1G2iOOQQ1G2j1G2jOITQWO1G2jO#=}QWO1G2jO#>VQ&jO'#GhOOQQ1G2l1G2lO!&wQ&jO'#IWO!0OQ`O1G2oOOQQ1G2o1G2oOOQQ,5=Y,5=YO#>_Q#tO,5=[O5qQWO,5=[O#5YQWO,5=_O5_QWO,5=_O!,rQpO,5=_O!,zQ#tO,5=_O5vQ#tO,5=_O#>pQWO'#J_O#>{QWO,5=`OOQQ1G.j1G.jO#?QQ!LYO1G.jO#?]QWO1G.jO#?bQWO1G.jO5iQ!LYO1G.jO#?jQbO,5?|O#?tQWO,5?|O#@PQYO,5=gO#@WQWO,5=gO7VQWO,5?|OOQQ1G3P1G3PO`QYO1G3POOQQ1G3V1G3VOOQQ1G3X1G3XO:XQWO1G3ZO#@]QYO1G3]O#DWQYO'#H[OOQQ1G3`1G3`O:^QWO1G3fO#DeQWO1G3fO5iQ!LYO1G3jOOQQ1G3l1G3lOOQ!LQ'#Fx'#FxO5iQ!LYO1G3nO5iQ!LYO1G3pOOOS1G/^1G/^O#DmQ`O,5<TO#DuQbO1G3yOOQO1G4O1G4OO){QYO,5>_O#EPQWO1G4zO#EXQWO1G5UO#EaQWO,5?bOLXQYO,5:{O7VQWO,5:{O:^QWO,59}OLXQYO,59}O!,rQpO,59}O#EfQ7^O,59}OOQO,5:{,5:{O#EpQ&jO'#HtO#FWQWO,5?aOOQ!LS1G/h1G/hO#F`Q&jO'#HyO#FtQWO,5?lOOQ!LQ1G0f1G0fO!;OQ&jO,59}O#F|QbO1G5VO7VQWO,5>dOOQ!LQ'#ES'#ESO#GWQ!LrO'#ETO!?{Q&jO'#D}OOQO'#Hw'#HwO#GrQ&jO,5:hOOQ!LS,5:h,5:hO#GyQ&jO'#D}O#H[Q&jO'#D}O#HcQ&jO'#EYO#HfQ&jO'#ETO#HsQ&jO'#ETO!?{Q&jO'#ETO#IWQWO1G0PO#I]Q`O1G0POOQ!LS1G0P1G0PO){QYO1G0POITQWO1G0POOQ!LS1G0a1G0aO:^QWO1G0aO!,rQpO1G0aO!,zQ#tO1G0aO#IdQ!LdO1G5SO){QYO1G5SO#ItQ!LYO1G5SO#JVQWO1G5RO7VQWO,5>fOOQO,5>f,5>fO#J_QWO,5>fOOQO-E;x-E;xO#JVQWO1G5RO#JmQ!LdO,59jO#LlQ!LdO,5<UO#NnQ!LdO,5<WO$!pQ!LdO,5<fOOQ!LS7+%|7+%|O$$xQ!LdO7+%|O$%iQWO'#HuO$%sQWO,5?cOOQ!LS1G/r1G/rO$%{QYO'#HvO$&YQWO,5?dO$&bQbO,5?dOOQ!LS1G/w1G/wOOQ!LS7+&V7+&VO$&lQ7^O,5:^O){QYO7+&iO$&vQ7^O,5:UOOQO1G1_1G1_OOQO1G1`1G1`O$'TQMhO,5;vOLXQYO,5;uOOQO-E;y-E;yOOQ!LS7+&w7+&wOOOO7+'Q7+'QOOOO1G1i1G1iO$'`QWO1G1iOOQ!LS1G1k1G1kO$'eQ`O,59gOOOS-E;o-E;oOOQ!LS1G/P1G/PO$'lQ!LdO7+'WOOQ!LS,5>k,5>kO$(]QWO,5>kOOQ!LS1G2P1G2PP$(bQWO'#IPPOQ!LS-E;}-E;}O$)RQ#tO1G2[O$)tQ#tO1G2^O$*OQ#tO1G2`OOQ!LS1G1x1G1xO$*VQWO'#IOO$*eQWO,5?sO$*eQWO,5?sO$*mQWO,5?sO$*xQWO,5?sOOQO1G1z1G1zO$+WQ#tO1G1yO$+hQWO'#IQO$+xQWO,5?tOITQWO,5?tO$,QQ`O,5?tOOQ!LS1G1}1G1}O5iQ!LYO,5<hO5iQ!LYO,5<iO$,[QWO,5<iO#5TQWO,5<iO!,rQpO,5<hO$,aQWO,5<jO5iQ!LYO,5<kO$,[QWO,5<nOOQO-E<P-E<POOQ!LS1G2R1G2RO!&wQ&jO,5<hO$,iQWO,5<iO!&wQ&jO,5<jO!&wQ&jO,5<iO$,tQ#tO1G4tO$-OQ#tO1G4tOOQO,5>n,5>nOOQO-E<Q-E<QO!-uQ&jO,59lO){QYO,59lO$-]QWO1G1tOJdQWO1G1{O$-bQ!LdO7+'XOOQ!LS7+'X7+'XOGTQYO7+'XOOQ!LS7+%[7+%[O$.RQ`O'#JZO#IWQWO7+'|O$.]QWO7+'|O$.eQ`O7+'|OOQQ7+'|7+'|OITQWO7+'|O){QYO7+'|OITQWO7+'|OOQO1G.w1G.wO$.oQ!LbO'#ChO$/PQ!LbO,5<lO$/nQWO,5<lOOQ!LQ1G4p1G4pOOQQ7+$_7+$_O:^QWO7+$_O!,rQpO7+$_OGTQYO7+%|O$/sQWO'#IZO$0UQWO,5?{OOQO1G3O1G3OO5qQWO,5?{O$0UQWO,5?{O$0^QWO,5?{OOQO,5>v,5>vOOQO-E<Y-E<YOOQ!LS7+&q7+&qO$0cQWO7+(iO5iQ!LYO7+(iO5qQWO7+(iO$0hQWO7+(iO$0mQWO7+'|OOQ!LQ,5>p,5>pOOQ!LQ-E<S-E<SOOQQ7+(W7+(WO$0{Q!LbO7+(TOITQWO7+(TO$1VQ`O7+(UOOQQ7+(U7+(UOITQWO7+(UO$1^QWO'#J^O$1iQWO,5=SOOQO,5>r,5>rOOQO-E<U-E<UOOQQ7+(Z7+(ZO$2cQ&jO'#GqOOQQ1G2v1G2vOITQWO1G2vO){QYO1G2vOITQWO1G2vO$2jQWO1G2vO$2xQ#tO1G2vO5iQ!LYO1G2yO#5YQWO1G2yO5_QWO1G2yO!,rQpO1G2yO!,zQ#tO1G2yO$3ZQWO'#IYO$3fQWO,5?yO$3nQ&jO,5?yOOQ!LQ1G2z1G2zOOQQ7+$U7+$UO$3vQWO7+$UO5iQ!LYO7+$UO$3{QWO7+$UO){QYO1G5hO){QYO1G5iO$4QQYO1G3RO$4XQWO1G3RO$4^QYO1G3RO$4eQ!LYO1G5hOOQQ7+(k7+(kO5iQ!LYO7+(uO`QYO7+(wOOQQ'#Jd'#JdOOQQ'#I]'#I]O$4oQYO,5=vOOQQ,5=v,5=vO){QYO'#H]O$4|QWO'#H_OOQQ7+)Q7+)QO$5RQYO7+)QO7VQWO7+)QOOQQ7+)U7+)UOOQQ7+)Y7+)YOOQQ7+)[7+)[OOQO1G4|1G4|O$9PQ7^O1G0gO$9ZQWO1G0gOOQO1G/i1G/iO$9fQ7^O1G/iO:^QWO1G/iOLXQYO'#DcOOQO,5>`,5>`OOQO-E;r-E;rOOQO,5>e,5>eOOQO-E;w-E;wO!,rQpO1G/iO:^QWO,5:iOOQO,5:o,5:oO){QYO,5:oO$9pQ!LYO,5:oO$9{Q!LYO,5:oO!,rQpO,5:iOOQO-E;u-E;uOOQ!LS1G0S1G0SO!?{Q&jO,5:iO$:ZQ&jO,5:iO$:lQ!LrO,5:oO$;WQ&jO,5:iO!?{Q&jO,5:oOOQO,5:t,5:tO$;_Q&jO,5:oO$;lQ!LYO,5:oOOQ!LS7+%k7+%kO#IWQWO7+%kO#I]Q`O7+%kOOQ!LS7+%{7+%{O:^QWO7+%{O!,rQpO7+%{O$<QQ!LdO7+*nO){QYO7+*nOOQO1G4Q1G4QO7VQWO1G4QO$<bQWO7+*mO$<jQ!LdO1G2[O$>lQ!LdO1G2^O$@nQ!LdO1G1yO$BvQ#tO,5>aOOQO-E;s-E;sO$CQQbO,5>bO){QYO,5>bOOQO-E;t-E;tO$C[QWO1G5OO$CdQ7^O1G0bO$EkQ7^O1G0mO$ErQ7^O1G0mO$GsQ7^O1G0mO$GzQ7^O1G0mO$IoQ7^O1G0mO$JSQ7^O1G0mO$LaQ7^O1G0mO$LhQ7^O1G0mO$NiQ7^O1G0mO$NpQ7^O1G0mO%!eQ7^O1G0mO%!xQ!LdO<<JTO%#iQ7^O1G0mO%%XQ7^O'#IoO%'UQ7^O1G1QOLXQYO'#F^OOQO'#JV'#JVOOQO1G1b1G1bO%'cQWO1G1aO%'hQ7^O,5>iOOOO7+'T7+'TOOOS1G/R1G/ROOQ!LS1G4V1G4VOJdQWO7+'zO%'rQWO,5>jO5qQWO,5>jOOQO-E;|-E;|O%(QQWO1G5_O%(QQWO1G5_O%(YQWO1G5_O%(eQ`O,5>lO%(oQWO,5>lOITQWO,5>lOOQO-E<O-E<OO%(tQ`O1G5`O%)OQWO1G5`OOQO1G2S1G2SOOQO1G2T1G2TO5iQ!LYO1G2TO$,[QWO1G2TO5iQ!LYO1G2SO%)WQWO1G2UOITQWO1G2UOOQO1G2V1G2VO5iQ!LYO1G2YO!,rQpO1G2SO#5TQWO1G2TO%)]QWO1G2UO%)eQWO1G2TOJdQWO7+*`OOQ!LS1G/W1G/WO%)pQWO1G/WOOQ!LS7+'`7+'`O%)uQ#tO7+'gO%*VQ!LdO<<JsOOQ!LS<<Js<<JsOITQWO'#ITO%*vQWO,5?uOOQQ<<Kh<<KhOITQWO<<KhO#IWQWO<<KhO%+OQWO<<KhO%+WQ`O<<KhOITQWO1G2WOOQQ<<Gy<<GyO:^QWO<<GyO%+bQ!LdO<<IhOOQ!LS<<Ih<<IhOOQO,5>u,5>uO%,RQWO,5>uO%,WQWO,5>uOOQO-E<X-E<XO%,`QWO1G5gO%,`QWO1G5gO5qQWO1G5gO%,hQWO<<LTOOQQ<<LT<<LTO%,mQWO<<LTO5iQ!LYO<<LTO){QYO<<KhOITQWO<<KhOOQQ<<Ko<<KoO$0{Q!LbO<<KoOOQQ<<Kp<<KpO$1VQ`O<<KpO%,rQ&jO'#IVO%,}QWO,5?xOLXQYO,5?xOOQQ1G2n1G2nO#GWQ!LrO'#ETO!?{Q&jO'#GrOOQO'#IX'#IXO%-VQ&jO,5=]OOQQ,5=],5=]O%-^Q&jO'#ETO%-iQ&jO'#ETO%.QQ&jO'#ETO%.[Q&jO'#GrO%.mQWO7+(bO%.rQWO7+(bO%.zQ`O7+(bOOQQ7+(b7+(bOITQWO7+(bO){QYO7+(bOITQWO7+(bO%/UQWO7+(bOOQQ7+(e7+(eO5iQ!LYO7+(eO#5YQWO7+(eO5_QWO7+(eO!,rQpO7+(eO%/dQWO,5>tOOQO-E<W-E<WOOQO'#Gu'#GuO%/oQWO1G5eO5iQ!LYO<<GpOOQQ<<Gp<<GpO%/wQWO<<GpO%/|QWO7++SO%0RQWO7++TOOQQ7+(m7+(mO%0WQWO7+(mO%0]QYO7+(mO%0dQWO7+(mO){QYO7++SO){QYO7++TOOQQ<<La<<LaOOQQ<<Lc<<LcOOQQ-E<Z-E<ZOOQQ1G3b1G3bO%0iQWO,5=wOOQQ,5=y,5=yO:^QWO<<LlO%0nQWO<<LlOLXQYO7+&ROOQO7+%T7+%TO%0sQ7^O1G5VO:^QWO7+%TOOQO1G0T1G0TO%0}Q!LdO1G0ZOOQO1G0Z1G0ZO){QYO1G0ZO%1XQ!LYO1G0ZO:^QWO1G0TO!,rQpO1G0TO!?{Q&jO1G0TO%1dQ!LYO1G0ZO%1rQ&jO1G0TO%2TQ!LYO1G0ZO%2iQ!LrO1G0ZO%2sQ&jO1G0TO!?{Q&jO1G0ZOOQ!LS<<IV<<IVOOQ!LS<<Ig<<IgO:^QWO<<IgO%2zQ!LdO<<NYOOQO7+)l7+)lO%3[Q!LdO7+'gO%5dQbO1G3|O%5nQ7^O7+%|O%5{Q7^O,59jO%7xQ7^O,5<UO%9uQ7^O,5<WO%;rQ7^O,5<fO%=bQ7^O7+'WO%=oQ7^O7+'XO%=|QWO,5;xOOQO7+&{7+&{O%>RQ#tO<<KfOOQO1G4U1G4UO%>cQWO1G4UO%>nQWO1G4UO%>|QWO7+*yO%>|QWO7+*yOITQWO1G4WO%?UQ`O1G4WO%?`QWO7+*zOOQO7+'o7+'oO5iQ!LYO7+'oOOQO7+'n7+'nO$,[QWO7+'pO%?hQ`O7+'pOOQO7+'t7+'tO5iQ!LYO7+'nO$,[QWO7+'oO%?oQWO7+'pOITQWO7+'pO#5TQWO7+'oO%?tQ#tO<<MzOOQ!LS7+$r7+$rO%@OQ`O,5>oOOQO-E<R-E<RO#IWQWOANASOOQQANASANASOITQWOANASO%@YQ!LbO7+'rOOQQAN=eAN=eO5qQWO1G4aOOQO1G4a1G4aO%@gQWO1G4aO%@lQWO7++RO%@lQWO7++RO5iQ!LYOANAoO%@tQWOANAoOOQQANAoANAoO%@yQWOANASO%ARQ`OANASOOQQANAZANAZOOQQANA[ANA[O%A]QWO,5>qOOQO-E<T-E<TO%AhQ7^O1G5dO#5YQWO,5=^O5_QWO,5=^O!,rQpO,5=^OOQO-E<V-E<VOOQQ1G2w1G2wO$:lQ!LrO,5:oO!?{Q&jO,5=^O%ArQ&jO,5=^O%BTQ&jO,5:oOOQQ<<K|<<K|OITQWO<<K|O%.mQWO<<K|O%B_QWO<<K|O%BgQ`O<<K|O){QYO<<K|OITQWO<<K|OOQQ<<LP<<LPO5iQ!LYO<<LPO#5YQWO<<LPO5_QWO<<LPO%BqQ&jO1G4`O%ByQWO7++POOQQAN=[AN=[O5iQ!LYOAN=[OOQQ<<Nn<<NnOOQQ<<No<<NoOOQQ<<LX<<LXO%CRQWO<<LXO%CWQYO<<LXO%C_QWO<<NnO%CdQWO<<NoOOQQ1G3c1G3cOOQQANBWANBWO:^QWOANBWO%CiQ7^O<<ImOOQO<<Ho<<HoOOQO7+%u7+%uO%0}Q!LdO7+%uO){QYO7+%uOOQO7+%o7+%oO:^QWO7+%oO!,rQpO7+%oO%CsQ!LYO7+%uO!?{Q&jO7+%oO%DOQ!LYO7+%uO%D^Q&jO7+%oO%DoQ!LYO7+%uOOQ!LSAN?RAN?RO%ETQ!LdO<<KfO%G]Q7^O<<JTO%GjQ7^O1G1yO%IYQ7^O1G2[O%KVQ7^O1G2^O%MSQ7^O<<JsO%MaQ7^O<<IhOOQO1G1d1G1dOOQO7+)p7+)pO%MnQWO7+)pO%MyQWO<<NeO%NRQ`O7+)rOOQO<<KZ<<KZO5iQ!LYO<<K[O$,[QWO<<K[OOQO<<KY<<KYO5iQ!LYO<<KZO%N]Q`O<<K[O$,[QWO<<KZOOQQG26nG26nO#IWQWOG26nOOQO7+){7+){O5qQWO7+){O%NdQWO<<NmOOQQG27ZG27ZO5iQ!LYOG27ZOITQWOG26nOLXQYO1G4]O%NlQWO7++OO5iQ!LYO1G2xO#5YQWO1G2xO5_QWO1G2xO!,rQpO1G2xO!?{Q&jO1G2xO%2iQ!LrO1G0ZO%NtQ&jO1G2xO%.mQWOANAhOOQQANAhANAhOITQWOANAhO& VQWOANAhO& _Q`OANAhOOQQANAkANAkO5iQ!LYOANAkO#5YQWOANAkOOQO'#Gv'#GvOOQO7+)z7+)zOOQQG22vG22vOOQQANAsANAsO& iQWOANAsOOQQANDYANDYOOQQANDZANDZO& nQYOG27rOOQO<<Ia<<IaO%0}Q!LdO<<IaOOQO<<IZ<<IZO:^QWO<<IZO){QYO<<IaO!,rQpO<<IZO&%lQ!LYO<<IaO!?{Q&jO<<IZO&%wQ!LYO<<IaO&&VQ7^O7+'gOOQO<<M[<<M[OOQOAN@vAN@vO5iQ!LYOAN@vOOQOAN@uAN@uO$,[QWOAN@vO5iQ!LYOAN@uOOQQLD,YLD,YOOQO<<Mg<<MgOOQQLD,uLD,uO#IWQWOLD,YO&'uQ7^O7+)wOOQO7+(d7+(dO5iQ!LYO7+(dO#5YQWO7+(dO5_QWO7+(dO!,rQpO7+(dO!?{Q&jO7+(dOOQQG27SG27SO%.mQWOG27SOITQWOG27SOOQQG27VG27VO5iQ!LYOG27VOOQQG27_G27_O:^QWOLD-^OOQOAN>{AN>{OOQOAN>uAN>uO%0}Q!LdOAN>{O:^QWOAN>uO){QYOAN>{O!,rQpOAN>uO&(PQ!LYOAN>{O&([Q7^O<<KfOOQOG26bG26bO5iQ!LYOG26bOOQOG26aG26aOOQQ!$( t!$( tOOQO<<LO<<LOO5iQ!LYO<<LOO#5YQWO<<LOO5_QWO<<LOO!,rQpO<<LOOOQQLD,nLD,nO%.mQWOLD,nOOQQLD,qLD,qOOQQ!$(!x!$(!xOOQOG24gG24gOOQOG24aG24aO%0}Q!LdOG24gO:^QWOG24aO){QYOG24gOOQOLD+|LD+|OOQOANAjANAjO5iQ!LYOANAjO#5YQWOANAjO5_QWOANAjOOQQ!$(!Y!$(!YOOQOLD*RLD*ROOQOLD){LD){O%0}Q!LdOLD*ROOQOG27UG27UO5iQ!LYOG27UO#5YQWOG27UOOQO!$'Mm!$'MmOOQOLD,pLD,pO5iQ!LYOLD,pOOQO!$(![!$(![OLXQYO'#DrO&)zQbO'#IrOLXQYO'#DjO&*RQ!LdO'#ChO&*lQbO'#ChO&*|QYO,5:vOLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO,5;ROLXQYO'#H}O&,|QWO,5<TO&.`QWO,5;ROLXQYO,5;fO!(aQWO'#DOO!(aQWO'#DOOITQWO'#FjO&-UQWO'#FjOITQWO'#FlO&-UQWO'#FlOITQWO'#FzO&-UQWO'#FzOLXQYO,5?kO&*|QYO1G0bO&.gQ7^O'#ChOLXQYO1G1lOITQWO,5<pO&-UQWO,5<pOITQWO,5<rO&-UQWO,5<rOITQWO,5<_O&-UQWO,5<_O&*|QYO1G1mOLXQYO7+&iOITQWO1G1{O&-UQWO1G1{O&*|QYO7+'XO&*|QYO7+%|OITQWO7+'zO&-UQWO7+'zO&.qQWO'#E[O&.vQWO'#E[O&/OQWO'#EzO&/TQWO'#EgO&/YQWO'#JPO&/eQWO'#I}O&/pQWO,5:vO&/uQ#tO,5<QO&/|QWO'#FsO&0RQWO'#FsO&0WQWO,5<RO&0`QWO,5:vO&0hQ7^O1G0}O&0oQWO,5<aO&0tQWO,5<aO&0yQWO1G1mO&1OQWO1G0bO&1TQ#tO1G2`O&1[Q#tO1G2`O4QQWO'#FhO5_QWO'#FgOBwQWO'#EZOLXQYO,5;cO!(pQWO'#FuO!(pQWO'#FuOJdQWO,5<tOJdQWO,5<t",stateData:"&2X~O'WOS'XOSTOSUOS~OPTOQTOXyO]cO_hObnOcmOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!TSO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!nlO#dsO#tpO#x^O%PqO%RtO%TrO%UrO%XuO%ZvO%^wO%_wO%axO%nzO%t{O%v|O%x}O%z!OO%}!PO&T!QO&X!RO&Z!SO&]!TO&_!UO&a!VO'ZPO'dQO'mYO'zaO~OP[XZ[X_[Xj[Xu[Xv[Xx[X!R[X!a[X!b[X!d[X!j[X!{[X#WdX#[[X#][X#^[X#_[X#`[X#a[X#b[X#c[X#e[X#g[X#i[X#j[X#o[X'U[X'd[X'n[X'u[X'v[X~O!]$lX~P$zOR!WO'S!XO'T!ZO~OPTOQTO]cOb!kOc!jOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!T!bO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!n!iO#t!lO#x^O'Z![O'dQO'mYO'zaO~O!Q!`O!R!]O!O'hP!O'rP~P'dO!S!mO~P`OPTOQTO]cOb!kOc!jOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!T!bO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!n!iO#t!lO#x^O'Z9YO'dQO'mYO'zaO~OPTOQTO]cOb!kOc!jOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!T!bO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!n!iO#t!lO#x^O'dQO'mYO'zaO~O!Q!rO#U!uO#V!rO'Z9ZO!c'oP~P+{O#W!vO~O!]!wO#W!vO~OP#^OZ#dOj#ROu!{Ov!{Ox!|O!R#bO!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO#g#WO#i#YO#j#ZO'dQO'n#[O'u!}O'v#OO~O_'fX'U'fX!c'fX!O'fX!T'fX%Q'fX!]'fX~P.jO!{#eO#o#eOP'gXZ'gX_'gXj'gXu'gXv'gXx'gX!R'gX!a'gX!b'gX!d'gX!j'gX#['gX#]'gX#^'gX#_'gX#`'gX#a'gX#b'gX#e'gX#g'gX#i'gX#j'gX'd'gX'n'gX'u'gX'v'gX~O#c'gX'U'gX!O'gX!c'gXn'gX!T'gX%Q'gX!]'gX~P0zO!{#eO~O#z#fO$R#jO~O!T#kO#x^O$U#lO$W#nO~O]#qOh$OOj#rOk#qOl#qOq$POs$QOx#xO!T#yO!_$VO!d#vO#V$WO#t$TO$_$RO$a$SO$d$UO'Z#pO'd#sO'_'aP~O!d$XO~O!]$ZO~O_$[O'U$[O~O'Z$`O~O!d$XO'Z$`O'[$bO'`$cO~Oc$iO!d$XO'Z$`O~O#c#TO~O]$rOu$nO!T$kO!d$mO%R$qO'Z$`O'[$bO^(SP~O!n$sO~Ox$tO!T$uO'Z$`O~Ox$tO!T$uO%Z$yO'Z$`O~O'Z$zO~O#dsO%RtO%TrO%UrO%XuO%ZvO%^wO%_wO~Ob%TOc%SO!n%QO%P%RO%c%PO~P7uOb%WOcmO!T%VO!nlO#dsO%PqO%TrO%UrO%XuO%ZvO%^wO%_wO%axO~O`%ZO!{%^O%R%XO'[$bO~P8tO!d%_O!g%cO~O!d%dO~O!TSO~O_$[O'R%lO'U$[O~O_$[O'R%oO'U$[O~O_$[O'R%qO'U$[O~OR!WO'S!XO'T%uO~OP[XZ[Xj[Xu[Xv[Xx[X!R[X!RdX!a[X!b[X!d[X!j[X!{[X!{dX#WdX#[[X#][X#^[X#_[X#`[X#a[X#b[X#c[X#e[X#g[X#i[X#j[X#o[X'd[X'n[X'u[X'v[X~O!O[X!OdX~P;aO!Q%wO!O&gX!O&lX!R&gX!R&lX~P'dO!R%yO!O'hX~OP#^OZ#dOj#ROu!{Ov!{Ox!|O!R%yO!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO#g#WO#i#YO#j#ZO'dQO'n#[O'u!}O'v#OO~O!O'hX~P>^O!O&OO~Ox&RO!W&]O!X&UO!Y&UO'[$bO~O]&SOk&SO!Q&VO'e&PO!S'iP!S'tP~P@aO!O'qX!R'qX!]'qX!c'qX'n'qX~O!{'qX#W#PX!S'qX~PAYO!{&^O!O'sX!R'sX~O!R&_O!O'rX~O!O&bO~O!{#eO~PAYOS&fO!T&cO!o&eO'Z$`O~Oc&kO!d$XO'Z$`O~Ou$nO!d$mO~O!S&lO~P`Ou!{Ov!{Ox!|O!b!yO!d!zO'dQOP!faZ!faj!fa!R!fa!a!fa!j!fa#[!fa#]!fa#^!fa#_!fa#`!fa#a!fa#b!fa#c!fa#e!fa#g!fa#i!fa#j!fa'n!fa'u!fa'v!fa~O_!fa'U!fa!O!fa!c!fan!fa!T!fa%Q!fa!]!fa~PCcO!c&mO~O!]!wO!{&oO'n&nO!R'pX_'pX'U'pX~O!c'pX~PE{O!R&sO!c'oX~O!c&uO~Ox$tO!T$uO#V&vO'Z$`O~OPTOQTO]cOb!kOc!jOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!TSO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!n!iO#t!lO#x^O'Z9YO'dQO'mYO'zaO~O]#qOh$OOj#rOk#qOl#qOq$POs9lOx#xO!T#yO!_:oO!d#vO#V9rO#t$TO$_9nO$a9pO$d$UO'Z&zO'd#sO~O#W&|O~O]#qOh$OOj#rOk#qOl#qOq$POs$QOx#xO!T#yO!_$VO!d#vO#V$WO#t$TO$_$RO$a$SO$d$UO'Z&zO'd#sO~O'_'kP~PJdO!Q'QO!c'lP~P){O'e'SO'mYO~OP9VOQ9VO]cOb:mOc!jOhcOj9VOkcOlcOq9VOs9VOxRO{cO|cO}cO!T!bO!_9XO!dUO!g9VO!h9VO!i9VO!j9VO!k9VO!n!iO#t!lO#x^O'Z'bO'dQO'mYO'z:kO~O!d!zO~O!R#bO_$]a'U$]a!c$]a!O$]a!T$]a%Q$]a!]$]a~O#d'iO~PITO!]'kO!T'wX#w'wX#z'wX$R'wX~Ou'lO~P! POu'lO!T'wX#w'wX#z'wX$R'wX~O!T'nO#w'rO#z'mO$R'sO~O!Q'vO~PLXO#z#fO$R'yO~Ou$eXx$eX!b$eX'n$eX'u$eX'v$eX~OSfX!RfX!{fX'_fX'_$eX~P!!iOk'{O~OR'|O'S'}O'T(PO~Ou(ROx(SO'n#[O'u(UO'v(WO~O'_(QO~P!#rO'_(ZO~O]#qOh$OOj#rOk#qOl#qOq$POs9lOx#xO!T#yO!_:oO!d#vO#V9rO#t$TO$_9nO$a9pO$d$UO'd#sO~O!Q(_O'Z([O!c'{P~P!$aO#W(aO~O!Q(eO'Z(bO!O'|P~P!$aO_(nOj(sOx(kO!W(qO!X(jO!Y(jO!d(hO!x(rO$w(mO'[$bO'e(gO~O!S(pO~P!&XO!b!yOu'cXx'cX'n'cX'u'cX'v'cX!R'cX!{'cX~O'_'cX#m'cX~P!'TOS(vO!{(uO!R'bX'_'bX~O!R(wO'_'aX~O'Z(yO~O!d)OO~O'Z&zO~O!d(hO~Ox$tO!Q!rO!T$uO#U!uO#V!rO'Z$`O!c'oP~O!]!wO#W)SO~OP#^OZ#dOj#ROu!{Ov!{Ox!|O!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO#g#WO#i#YO#j#ZO'dQO'n#[O'u!}O'v#OO~O_!^a!R!^a'U!^a!O!^a!c!^an!^a!T!^a%Q!^a!]!^a~P!)fOS)[O!T&cO!o)ZO%Q)YO'`$cO~O'Z$zO'_'aP~O!])_O!T'^X_'^X'U'^X~O!d$XO'`$cO~O!d$XO'Z$`O'`$cO~O!]!wO#W&|O~O])jO%R)kO'Z)gO!S(TP~O!R)lO^(SX~O'e'SO~OZ)pO~O^)qO~O!T$kO'Z$`O'[$bO^(SP~Ox$tO!Q)vO!R&_O!T$uO'Z$`O!O'rP~O]&YOk&YO!Q)wO'e'SO!S'tP~O!R)xO_(PX'U(PX~O!{)|O'`$cO~OS*PO!T#yO'`$cO~O!T*RO~Ou*TO!TSO~O!n*YO~Oc*_O~O'Z(yO!S(RP~Oc$iO~O%RtO'Z$zO~P8tOZ*eO^*dO~OPTOQTO]cObnOcmOhcOjTOkcOlcOqTOsTOxRO{cO|cO}cO!_kO!dUO!gTO!hTO!iTO!jTO!kTO!nlO#x^O%PqO'dQO'mYO'zaO~O!T!bO#t!lO'Z9YO~P!1RO^*dO_$[O'U$[O~O_*iO#d*kO%T*kO%U*kO~P){O!d%_O~O%t*pO~O!T*rO~O&U*uO&V*tOP&SaQ&SaX&Sa]&Sa_&Sab&Sac&Sah&Saj&Sak&Sal&Saq&Sas&Sax&Sa{&Sa|&Sa}&Sa!T&Sa!_&Sa!d&Sa!g&Sa!h&Sa!i&Sa!j&Sa!k&Sa!n&Sa#d&Sa#t&Sa#x&Sa%P&Sa%R&Sa%T&Sa%U&Sa%X&Sa%Z&Sa%^&Sa%_&Sa%a&Sa%n&Sa%t&Sa%v&Sa%x&Sa%z&Sa%}&Sa&T&Sa&X&Sa&Z&Sa&]&Sa&_&Sa&a&Sa'Q&Sa'Z&Sa'd&Sa'm&Sa'z&Sa!S&Sa%{&Sa`&Sa&Q&Sa~O'Z*xO~On*{O~O!O&ga!R&ga~P!)fO!Q+PO!O&gX!R&gX~P){O!R%yO!O'ha~O!O'ha~P>^O!R&_O!O'ra~O!RwX!R!ZX!SwX!S!ZX!]wX!]!ZX!d!ZX!{wX'`!ZX~O!]+UO!{+TO!R#TX!R'jX!S#TX!S'jX!]'jX!d'jX'`'jX~O!]+WO!d$XO'`$cO!R!VX!S!VX~O]&QOk&QOx&RO'e(gO~OP9VOQ9VO]cOb:mOc!jOhcOj9VOkcOlcOq9VOs9VOxRO{cO|cO}cO!T!bO!_9XO!dUO!g9VO!h9VO!i9VO!j9VO!k9VO!n!iO#t!lO#x^O'dQO'mYO'z:kO~O'Z9vO~P!;^O!R+[O!S'iX~O!S+^O~O!]+UO!{+TO!R#TX!S#TX~O!R+_O!S'tX~O!S+aO~O]&QOk&QOx&RO'[$bO'e(gO~O!X+bO!Y+bO~P!>[Ox$tO!Q+dO!T$uO'Z$`O!O&lX!R&lX~O_+hO!W+kO!X+gO!Y+gO!r+oO!s+mO!t+nO!u+lO!x+pO'[$bO'e(gO'm+eO~O!S+jO~P!?]OS+uO!T&cO!o+tO~O!{+{O!R'pa!c'pa_'pa'U'pa~O!]!wO~P!@gO!R&sO!c'oa~Ox$tO!Q,OO!T$uO#U,QO#V,OO'Z$`O!R&nX!c&nX~O_#Oi!R#Oi'U#Oi!O#Oi!c#Oin#Oi!T#Oi%Q#Oi!]#Oi~P!)fO#W!za!R!za!c!za!{!za!T!za_!za'U!za!O!za~P!#rO#W'cXP'cXZ'cX_'cXj'cXv'cX!a'cX!d'cX!j'cX#['cX#]'cX#^'cX#_'cX#`'cX#a'cX#b'cX#c'cX#e'cX#g'cX#i'cX#j'cX'U'cX'd'cX!c'cX!O'cX!T'cXn'cX%Q'cX!]'cX~P!'TO!R,ZO'_'kX~P!#rO'_,]O~O!R,^O!c'lX~P!)fO!c,aO~O!O,bO~OP#^Ou!{Ov!{Ox!|O!b!yO!d!zO!j#^O'dQOZ#Zi_#Zij#Zi!R#Zi!a#Zi#]#Zi#^#Zi#_#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi'U#Zi'n#Zi'u#Zi'v#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~O#[#Zi~P!EtO#[#PO~P!EtOP#^Ou!{Ov!{Ox!|O!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO'dQOZ#Zi_#Zi!R#Zi!a#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi'U#Zi'n#Zi'u#Zi'v#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~Oj#Zi~P!H`Oj#RO~P!H`OP#^Oj#ROu!{Ov!{Ox!|O!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO'dQO_#Zi!R#Zi#e#Zi#g#Zi#i#Zi#j#Zi'U#Zi'n#Zi'u#Zi'v#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~OZ#Zi!a#Zi#a#Zi#b#Zi#c#Zi~P!JzOZ#dO!a#TO#a#TO#b#TO#c#TO~P!JzOP#^OZ#dOj#ROu!{Ov!{Ox!|O!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO'dQO_#Zi!R#Zi#g#Zi#i#Zi#j#Zi'U#Zi'n#Zi'v#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~O'u#Zi~P!MrO'u!}O~P!MrOP#^OZ#dOj#ROu!{Ov!{Ox!|O!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO#g#WO'dQO'u!}O_#Zi!R#Zi#i#Zi#j#Zi'U#Zi'n#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~O'v#Zi~P#!^O'v#OO~P#!^OP#^OZ#dOj#ROu!{Ov!{Ox!|O!a#TO!b!yO!d!zO!j#^O#[#PO#]#QO#^#QO#_#QO#`#SO#a#TO#b#TO#c#TO#e#UO#g#WO#i#YO'dQO'u!}O'v#OO~O_#Zi!R#Zi#j#Zi'U#Zi'n#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~P#$xOP[XZ[Xj[Xu[Xv[Xx[X!a[X!b[X!d[X!j[X!{[X#WdX#[[X#][X#^[X#_[X#`[X#a[X#b[X#c[X#e[X#g[X#i[X#j[X#o[X'd[X'n[X'u[X'v[X!R[X!S[X~O#m[X~P#']OP#^OZ9jOj9_Ou!{Ov!{Ox!|O!a9aO!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O#`9`O#a9aO#b9aO#c9aO#e9bO#g9dO#i9fO#j9gO'dQO'n#[O'u!}O'v#OO~O#m,dO~P#)gOP'gXZ'gXj'gXu'gXv'gXx'gX!a'gX!b'gX!d'gX!j'gX#['gX#]'gX#^'gX#_'gX#`'gX#a'gX#b'gX#e'gX#g'gX#i'gX#j'gX'd'gX'n'gX'u'gX'v'gX!R'gX~O!{9kO#o9kO#c'gX#m'gX!S'gX~P#+bO_&qa!R&qa'U&qa!c&qan&qa!O&qa!T&qa%Q&qa!]&qa~P!)fOP#ZiZ#Zi_#Zij#Ziv#Zi!R#Zi!a#Zi!b#Zi!d#Zi!j#Zi#[#Zi#]#Zi#^#Zi#_#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi'U#Zi'd#Zi!O#Zi!c#Zin#Zi!T#Zi%Q#Zi!]#Zi~P!#rO_#ni!R#ni'U#ni!O#ni!c#nin#ni!T#ni%Q#ni!]#ni~P!)fO#z,fO~O#z,gO~O!]'kO!{,hO!T$OX#w$OX#z$OX$R$OX~O!Q,iO~O!T'nO#w,kO#z'mO$R,lO~O!R9hO!S'fX~P#)gO!S,mO~O$R,oO~OR'|O'S'}O'T,rO~O],uOk,uO!O,vO~O!RdX!]dX!cdX!c$eX'ndX~P!!iO!c,|O~P!#rO!R,}O!]!wO'n&nO!c'{X~O!c-SO~O!O$eX!R$eX!]$lX~P!!iO!R-UO!O'|X~P!#rO!]-WO~O!O-YO~O!Q(_O'Z$`O!c'{P~Oj-^O!]!wO!d$XO'`$cO'n&nO~O!])_O~O!S-dO~P!&XO!X-eO!Y-eO'[$bO'e(gO~Ox-gO'e(gO~O!x-hO~O'Z$zO!R&vX'_&vX~O!R(wO'_'aa~Ou-mOv-mOx-nO'nra'ura'vra!Rra!{ra~O'_ra#mra~P#6fOu(ROx(SO'n$^a'u$^a'v$^a!R$^a!{$^a~O'_$^a#m$^a~P#7[Ou(ROx(SO'n$`a'u$`a'v$`a!R$`a!{$`a~O'_$`a#m$`a~P#7}O]-oO~O#W-pO~O'_$na!R$na#m$na!{$na~P!#rO#W-sO~OS-|O!T&cO!o-{O%Q-zO~O'_-}O~O]#qOj#rOk#qOl#qOq$POs9lOx#xO!T#yO!_:oO!d#vO#V9rO#t$TO$_9nO$a9pO$d$UO'd#sO~Oh.PO'Z.OO~P#9tO!])_O!T'^a_'^a'U'^a~O#W.VO~OZ[X!RdX!SdX~O!R.WO!S(TX~O!S.YO~OZ.ZO~O].]O'Z)gO~O!T$kO'Z$`O^'OX!R'OX~O!R)lO^(Sa~O!c.`O~P!)fO].bO~OZ.cO~O^.dO~OS-|O!T&cO!o-{O%Q-zO'`$cO~O!R)xO_(Pa'U(Pa~O!{.jO~OS.mO!T#yO~O'e'SO!S(QP~OS.wO!T.sO!o.vO%Q.uO'`$cO~OZ/RO!R/PO!S(RX~O!S/SO~O^/UO_$[O'U$[O~O]/VO~O]/WO'Z(yO~O#c/XO%r/YO~P0zO!{#eO#c/XO%r/YO~O_/ZO~P){O_/]O~O%{/aOP%yiQ%yiX%yi]%yi_%yib%yic%yih%yij%yik%yil%yiq%yis%yix%yi{%yi|%yi}%yi!T%yi!_%yi!d%yi!g%yi!h%yi!i%yi!j%yi!k%yi!n%yi#d%yi#t%yi#x%yi%P%yi%R%yi%T%yi%U%yi%X%yi%Z%yi%^%yi%_%yi%a%yi%n%yi%t%yi%v%yi%x%yi%z%yi%}%yi&T%yi&X%yi&Z%yi&]%yi&_%yi&a%yi'Q%yi'Z%yi'd%yi'm%yi'z%yi!S%yi`%yi&Q%yi~O`/gO!S/eO&Q/fO~P`O!TSO!d/jO~O!R#bOn$]a~O!O&gi!R&gi~P!)fO!R%yO!O'hi~O!R&_O!O'ri~O!O/nO~O!R!Va!S!Va~P#)gO]&QOk&QO!Q/tO'e(gO!R&hX!S&hX~P@aO!R+[O!S'ia~O]&YOk&YO!Q)wO'e'SO!R&mX!S&mX~O!R+_O!S'ta~O!O'si!R'si~P!)fO_$[O!]!wO!d$XO!j0OO!{/|O'U$[O'`$cO'n&nO~O!S0RO~P!?]O!X0SO!Y0SO'[$bO'e(gO'm+eO~O!W0TO~P#GyO!TSO!W0TO!u0VO!x0WO~P#GyO!W0TO!s0YO!t0YO!u0VO!x0WO~P#GyO!T&cO~O!T&cO~P!#rO!R'pi!c'pi_'pi'U'pi~P!)fO!{0cO!R'pi!c'pi_'pi'U'pi~O!R&sO!c'oi~Ox$tO!T$uO#V0eO'Z$`O~O#WraPraZra_rajra!ara!bra!dra!jra#[ra#]ra#^ra#_ra#`ra#ara#bra#cra#era#gra#ira#jra'Ura'dra!cra!Ora!Tranra%Qra!]ra~P#6fO#W$^aP$^aZ$^a_$^aj$^av$^a!a$^a!b$^a!d$^a!j$^a#[$^a#]$^a#^$^a#_$^a#`$^a#a$^a#b$^a#c$^a#e$^a#g$^a#i$^a#j$^a'U$^a'd$^a!c$^a!O$^a!T$^an$^a%Q$^a!]$^a~P#7[O#W$`aP$`aZ$`a_$`aj$`av$`a!a$`a!b$`a!d$`a!j$`a#[$`a#]$`a#^$`a#_$`a#`$`a#a$`a#b$`a#c$`a#e$`a#g$`a#i$`a#j$`a'U$`a'd$`a!c$`a!O$`a!T$`an$`a%Q$`a!]$`a~P#7}O#W$naP$naZ$na_$naj$nav$na!R$na!a$na!b$na!d$na!j$na#[$na#]$na#^$na#_$na#`$na#a$na#b$na#c$na#e$na#g$na#i$na#j$na'U$na'd$na!c$na!O$na!T$na!{$nan$na%Q$na!]$na~P!#rO_#Oq!R#Oq'U#Oq!O#Oq!c#Oqn#Oq!T#Oq%Q#Oq!]#Oq~P!)fO!R&iX'_&iX~PJdO!R,ZO'_'ka~O!Q0mO!R&jX!c&jX~P){O!R,^O!c'la~O!R,^O!c'la~P!)fO#m!fa!S!fa~PCcO#m!^a!R!^a!S!^a~P#)gO!T1QO#x^O$P1RO~O!S1VO~On1WO~P!#rO_$Yq!R$Yq'U$Yq!O$Yq!c$Yqn$Yq!T$Yq%Q$Yq!]$Yq~P!)fO!O1XO~O],uOk,uO~Ou(ROx(SO'v(WO'n$xi'u$xi!R$xi!{$xi~O'_$xi#m$xi~P$(jOu(ROx(SO'n$zi'u$zi'v$zi!R$zi!{$zi~O'_$zi#m$zi~P$)]O#m1YO~P!#rO!Q1[O'Z$`O!R&rX!c&rX~O!R,}O!c'{a~O!R,}O!]!wO!c'{a~O!R,}O!]!wO'n&nO!c'{a~O'_$gi!R$gi#m$gi!{$gi~P!#rO!Q1cO'Z(bO!O&tX!R&tX~P!$aO!R-UO!O'|a~O!R-UO!O'|a~P!#rO!]!wO~O!]!wO#c1mO~Oj1qO!]!wO'n&nO~O!R'bi'_'bi~P!#rO!{1tO!R'bi'_'bi~P!#rO!c1wO~O_$Zq!R$Zq'U$Zq!O$Zq!c$Zqn$Zq!T$Zq%Q$Zq!]$Zq~P!)fO!R1{O!T'}X~P!#rO!T&cO%Q2OO~O!T&cO%Q2OO~P!#rO!T$eX$u[X_$eX'U$eX~P!!iO$u2SOugXxgX!TgX'ngX'ugX'vgX_gX'UgX~O$u2SO~O]2YO%R2ZO'Z)gO!R&}X!S&}X~O!R.WO!S(Ta~OZ2_O~O^2`O~O]2cO~OS2eO!T&cO!o2dO%Q2OO~O_$[O'U$[O~P!#rO!T#yO~P!#rO!R2jO!{2lO!S(QX~O!S2mO~Ox(kO!W2vO!X2oO!Y2oO!r2uO!s2tO!t2tO!x2sO'[$bO'e(gO'm+eO~O!S2rO~P$1nOS2}O!T.sO!o2|O%Q2{O~OS2}O!T.sO!o2|O%Q2{O'`$cO~O'Z(yO!R&|X!S&|X~O!R/PO!S(Ra~O]3XO'e3WO~O]3YO~O^3[O~O!c3_O~P){O_3aO~O_3aO~P){O#c3cO%r3dO~PE{O`/gO!S3hO&Q/fO~P`O!]3jO~O&V3kOP&SqQ&SqX&Sq]&Sq_&Sqb&Sqc&Sqh&Sqj&Sqk&Sql&Sqq&Sqs&Sqx&Sq{&Sq|&Sq}&Sq!T&Sq!_&Sq!d&Sq!g&Sq!h&Sq!i&Sq!j&Sq!k&Sq!n&Sq#d&Sq#t&Sq#x&Sq%P&Sq%R&Sq%T&Sq%U&Sq%X&Sq%Z&Sq%^&Sq%_&Sq%a&Sq%n&Sq%t&Sq%v&Sq%x&Sq%z&Sq%}&Sq&T&Sq&X&Sq&Z&Sq&]&Sq&_&Sq&a&Sq'Q&Sq'Z&Sq'd&Sq'm&Sq'z&Sq!S&Sq%{&Sq`&Sq&Q&Sq~O!R#Ti!S#Ti~P#)gO!{3mO!R#Ti!S#Ti~O!R!Vi!S!Vi~P#)gO_$[O!{3tO'U$[O~O_$[O!]!wO!{3tO'U$[O~O!X3xO!Y3xO'[$bO'e(gO'm+eO~O_$[O!]!wO!d$XO!j3yO!{3tO'U$[O'`$cO'n&nO~O!W3zO~P$:ZO!W3zO!u3}O!x4OO~P$:ZO_$[O!]!wO!j3yO!{3tO'U$[O'n&nO~O!R'pq!c'pq_'pq'U'pq~P!)fO!R&sO!c'oq~O#W$xiP$xiZ$xi_$xij$xiv$xi!a$xi!b$xi!d$xi!j$xi#[$xi#]$xi#^$xi#_$xi#`$xi#a$xi#b$xi#c$xi#e$xi#g$xi#i$xi#j$xi'U$xi'd$xi!c$xi!O$xi!T$xin$xi%Q$xi!]$xi~P$(jO#W$ziP$ziZ$zi_$zij$ziv$zi!a$zi!b$zi!d$zi!j$zi#[$zi#]$zi#^$zi#_$zi#`$zi#a$zi#b$zi#c$zi#e$zi#g$zi#i$zi#j$zi'U$zi'd$zi!c$zi!O$zi!T$zin$zi%Q$zi!]$zi~P$)]O#W$giP$giZ$gi_$gij$giv$gi!R$gi!a$gi!b$gi!d$gi!j$gi#[$gi#]$gi#^$gi#_$gi#`$gi#a$gi#b$gi#c$gi#e$gi#g$gi#i$gi#j$gi'U$gi'd$gi!c$gi!O$gi!T$gi!{$gin$gi%Q$gi!]$gi~P!#rO!R&ia'_&ia~P!#rO!R&ja!c&ja~P!)fO!R,^O!c'li~O#m#Oi!R#Oi!S#Oi~P#)gOP#^Ou!{Ov!{Ox!|O!b!yO!d!zO!j#^O'dQOZ#Zij#Zi!a#Zi#]#Zi#^#Zi#_#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi#m#Zi'n#Zi'u#Zi'v#Zi!R#Zi!S#Zi~O#[#Zi~P$CqO#[9]O~P$CqOP#^Ou!{Ov!{Ox!|O!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O'dQOZ#Zi!a#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi#m#Zi'n#Zi'u#Zi'v#Zi!R#Zi!S#Zi~Oj#Zi~P$EyOj9_O~P$EyOP#^Oj9_Ou!{Ov!{Ox!|O!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O#`9`O'dQO#e#Zi#g#Zi#i#Zi#j#Zi#m#Zi'n#Zi'u#Zi'v#Zi!R#Zi!S#Zi~OZ#Zi!a#Zi#a#Zi#b#Zi#c#Zi~P$HROZ9jO!a9aO#a9aO#b9aO#c9aO~P$HROP#^OZ9jOj9_Ou!{Ov!{Ox!|O!a9aO!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O#`9`O#a9aO#b9aO#c9aO#e9bO'dQO#g#Zi#i#Zi#j#Zi#m#Zi'n#Zi'v#Zi!R#Zi!S#Zi~O'u#Zi~P$JgO'u!}O~P$JgOP#^OZ9jOj9_Ou!{Ov!{Ox!|O!a9aO!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O#`9`O#a9aO#b9aO#c9aO#e9bO#g9dO'dQO'u!}O#i#Zi#j#Zi#m#Zi'n#Zi!R#Zi!S#Zi~O'v#Zi~P$LoO'v#OO~P$LoOP#^OZ9jOj9_Ou!{Ov!{Ox!|O!a9aO!b!yO!d!zO!j#^O#[9]O#]9^O#^9^O#_9^O#`9`O#a9aO#b9aO#c9aO#e9bO#g9dO#i9fO'dQO'u!}O'v#OO~O#j#Zi#m#Zi'n#Zi!R#Zi!S#Zi~P$NwO_#ky!R#ky'U#ky!O#ky!c#kyn#ky!T#ky%Q#ky!]#ky~P!)fOP#ZiZ#Zij#Ziv#Zi!a#Zi!b#Zi!d#Zi!j#Zi#[#Zi#]#Zi#^#Zi#_#Zi#`#Zi#a#Zi#b#Zi#c#Zi#e#Zi#g#Zi#i#Zi#j#Zi#m#Zi'd#Zi!R#Zi!S#Zi~P!#rO!b!yOP'cXZ'cXj'cXu'cXv'cXx'cX!a'cX!d'cX!j'cX#['cX#]'cX#^'cX#_'cX#`'cX#a'cX#b'cX#c'cX#e'cX#g'cX#i'cX#j'cX#m'cX'd'cX'n'cX'u'cX'v'cX!R'cX!S'cX~O#m#ni!R#ni!S#ni~P#)gO!S4`O~O!R&qa!S&qa~P#)gO!]!wO'n&nO!R&ra!c&ra~O!R,}O!c'{i~O!R,}O!]!wO!c'{i~O!O&ta!R&ta~P!#rO!]4gO~O!R-UO!O'|i~P!#rO!R-UO!O'|i~O!O4mO~O!]!wO#c4sO~Oj4tO!]!wO'n&nO~O!O4vO~O'_$iq!R$iq#m$iq!{$iq~P!#rO_$Zy!R$Zy'U$Zy!O$Zy!c$Zyn$Zy!T$Zy%Q$Zy!]$Zy~P!)fO!R1{O!T'}a~O!T&cO%Q4{O~O!T&cO%Q4{O~P!#rO_#Oy!R#Oy'U#Oy!O#Oy!c#Oyn#Oy!T#Oy%Q#Oy!]#Oy~P!)fOZ5OO~O]5QO'Z)gO~O!R.WO!S(Ti~O]5TO~O^5UO~O'e'SO!R&yX!S&yX~O!R2jO!S(Qa~O!S5cO~P$1nOx-gO'e(gO'm+eO~O!W5fO!X5eO!Y5eO!x0WO'[$bO'e(gO'm+eO~O!s5gO!t5gO~P%-iO!X5eO!Y5eO'[$bO'e(gO'm+eO~O!T.sO~O!T.sO%Q5iO~O!T.sO%Q5iO~P!#rOS5nO!T.sO!o5mO%Q5iO~OZ5sO!R&|a!S&|a~O!R/PO!S(Ri~O]5vO~O!c5wO~O!c5xO~O!c5yO~O!c5yO~P){O_5{O~O!]6OO~O!c6QO~O!R'si!S'si~P#)gO_$[O'U$[O~P!)fO_$[O!{6VO'U$[O~O_$[O!]!wO!{6VO'U$[O~O!X6[O!Y6[O'[$bO'e(gO'm+eO~O_$[O!]!wO!j6]O!{6VO'U$[O'n&nO~O!d$XO'`$cO~P%2TO!W6^O~P%1rO!R'py!c'py_'py'U'py~P!)fO#W$iqP$iqZ$iq_$iqj$iqv$iq!R$iq!a$iq!b$iq!d$iq!j$iq#[$iq#]$iq#^$iq#_$iq#`$iq#a$iq#b$iq#c$iq#e$iq#g$iq#i$iq#j$iq'U$iq'd$iq!c$iq!O$iq!T$iq!{$iqn$iq%Q$iq!]$iq~P!#rO!R&ji!c&ji~P!)fO#m#Oq!R#Oq!S#Oq~P#)gOu-mOv-mOx-nOPraZrajra!ara!bra!dra!jra#[ra#]ra#^ra#_ra#`ra#ara#bra#cra#era#gra#ira#jra#mra'dra'nra'ura'vra!Rra!Sra~Ou(ROx(SOP$^aZ$^aj$^av$^a!a$^a!b$^a!d$^a!j$^a#[$^a#]$^a#^$^a#_$^a#`$^a#a$^a#b$^a#c$^a#e$^a#g$^a#i$^a#j$^a#m$^a'd$^a'n$^a'u$^a'v$^a!R$^a!S$^a~Ou(ROx(SOP$`aZ$`aj$`av$`a!a$`a!b$`a!d$`a!j$`a#[$`a#]$`a#^$`a#_$`a#`$`a#a$`a#b$`a#c$`a#e$`a#g$`a#i$`a#j$`a#m$`a'd$`a'n$`a'u$`a'v$`a!R$`a!S$`a~OP$naZ$naj$nav$na!a$na!b$na!d$na!j$na#[$na#]$na#^$na#_$na#`$na#a$na#b$na#c$na#e$na#g$na#i$na#j$na#m$na'd$na!R$na!S$na~P!#rO#m$Yq!R$Yq!S$Yq~P#)gO#m$Zq!R$Zq!S$Zq~P#)gO!S6hO~O'_$|y!R$|y#m$|y!{$|y~P!#rO!]!wO!R&ri!c&ri~O!]!wO'n&nO!R&ri!c&ri~O!R,}O!c'{q~O!O&ti!R&ti~P!#rO!R-UO!O'|q~O!O6oO~P!#rO!O6oO~O!R'by'_'by~P!#rO!R&wa!T&wa~P!#rO!T$tq_$tq'U$tq~P!#rOZ6wO~O!R.WO!S(Tq~O]6zO~O!T&cO%Q6{O~O!T&cO%Q6{O~P!#rO!{6|O!R&ya!S&ya~O!R2jO!S(Qi~P#)gO!X7SO!Y7SO'[$bO'e(gO'm+eO~O!W7UO!x4OO~P%ArO!T.sO%Q7XO~O!T.sO%Q7XO~P!#rO]7`O'e7_O~O!R/PO!S(Rq~O!c7bO~O!c7bO~P){O!c7dO~O!c7eO~O!R#Ty!S#Ty~P#)gO_$[O!{7kO'U$[O~O_$[O!]!wO!{7kO'U$[O~O!X7nO!Y7nO'[$bO'e(gO'm+eO~O_$[O!]!wO!j7oO!{7kO'U$[O'n&nO~O#W$|yP$|yZ$|y_$|yj$|yv$|y!R$|y!a$|y!b$|y!d$|y!j$|y#[$|y#]$|y#^$|y#_$|y#`$|y#a$|y#b$|y#c$|y#e$|y#g$|y#i$|y#j$|y'U$|y'd$|y!c$|y!O$|y!T$|y!{$|yn$|y%Q$|y!]$|y~P!#rO#m#ky!R#ky!S#ky~P#)gOP$giZ$gij$giv$gi!a$gi!b$gi!d$gi!j$gi#[$gi#]$gi#^$gi#_$gi#`$gi#a$gi#b$gi#c$gi#e$gi#g$gi#i$gi#j$gi#m$gi'd$gi!R$gi!S$gi~P!#rOu(ROx(SO'v(WOP$xiZ$xij$xiv$xi!a$xi!b$xi!d$xi!j$xi#[$xi#]$xi#^$xi#_$xi#`$xi#a$xi#b$xi#c$xi#e$xi#g$xi#i$xi#j$xi#m$xi'd$xi'n$xi'u$xi!R$xi!S$xi~Ou(ROx(SOP$ziZ$zij$ziv$zi!a$zi!b$zi!d$zi!j$zi#[$zi#]$zi#^$zi#_$zi#`$zi#a$zi#b$zi#c$zi#e$zi#g$zi#i$zi#j$zi#m$zi'd$zi'n$zi'u$zi'v$zi!R$zi!S$zi~O#m$Zy!R$Zy!S$Zy~P#)gO#m#Oy!R#Oy!S#Oy~P#)gO!]!wO!R&rq!c&rq~O!R,}O!c'{y~O!O&tq!R&tq~P!#rO!O7uO~P!#rO!R.WO!S(Ty~O!R2jO!S(Qq~O!X8RO!Y8RO'[$bO'e(gO'm+eO~O!T.sO%Q8UO~O!T.sO%Q8UO~P!#rO!c8XO~O&V8YOP&S!ZQ&S!ZX&S!Z]&S!Z_&S!Zb&S!Zc&S!Zh&S!Zj&S!Zk&S!Zl&S!Zq&S!Zs&S!Zx&S!Z{&S!Z|&S!Z}&S!Z!T&S!Z!_&S!Z!d&S!Z!g&S!Z!h&S!Z!i&S!Z!j&S!Z!k&S!Z!n&S!Z#d&S!Z#t&S!Z#x&S!Z%P&S!Z%R&S!Z%T&S!Z%U&S!Z%X&S!Z%Z&S!Z%^&S!Z%_&S!Z%a&S!Z%n&S!Z%t&S!Z%v&S!Z%x&S!Z%z&S!Z%}&S!Z&T&S!Z&X&S!Z&Z&S!Z&]&S!Z&_&S!Z&a&S!Z'Q&S!Z'Z&S!Z'd&S!Z'm&S!Z'z&S!Z!S&S!Z%{&S!Z`&S!Z&Q&S!Z~O_$[O!{8_O'U$[O~O_$[O!]!wO!{8_O'U$[O~OP$iqZ$iqj$iqv$iq!a$iq!b$iq!d$iq!j$iq#[$iq#]$iq#^$iq#_$iq#`$iq#a$iq#b$iq#c$iq#e$iq#g$iq#i$iq#j$iq#m$iq'd$iq!R$iq!S$iq~P!#rO!R&yq!S&yq~P#)gO_$[O!{8tO'U$[O~OP$|yZ$|yj$|yv$|y!a$|y!b$|y!d$|y!j$|y#[$|y#]$|y#^$|y#_$|y#`$|y#a$|y#b$|y#c$|y#e$|y#g$|y#i$|y#j$|y#m$|y'd$|y!R$|y!S$|y~P!#rOn'fX~P.jOn[X!O[X!c[X%r[X!T[X%Q[X!][X~P$zO!]dX!c[X!cdX'ndX~P;aOP9VOQ9VO]cOb:mOc!jOhcOj9VOkcOlcOq9VOs9VOxRO{cO|cO}cO!TSO!_9XO!dUO!g9VO!h9VO!i9VO!j9VO!k9VO!n!iO#t!lO#x^O'Z'bO'dQO'mYO'z:kO~O!R9hO!S$]a~O]#qOh$OOj#rOk#qOl#qOq$POs9mOx#xO!T#yO!_:pO!d#vO#V9sO#t$TO$_9oO$a9qO$d$UO'Z&zO'd#sO~O#d'iO~P&-UO!S[X!SdX~P;aO#W9[O~O!]!wO#W9[O~O!{9kO~O#c9aO~O!{9tO!R'sX!S'sX~O!{9kO!R'qX!S'qX~O#W9uO~O'_9wO~P!#rO#W9|O~O#W9}O~O!]!wO#W:OO~O!]!wO#W9uO~O#m:PO~P#)gO#W:QO~O#W:RO~O#W:SO~O#W:TO~O#m:UO~P!#rO#m:VO~P!#rO#x~!b!r!t!u#U#V'z$_$a$d$u%P%Q%R%X%Z%^%_%a%c~UT#x'z#]}'W'X#z'W'Z'e~",goto:"#Ed(XPPPPPPPP(YP(jP*^PPPP-uPP.[3n5b5uP5uPPP5uP7c5uP5uP7gPP7lP8Q<cPPPP<gPPPP<g?XPPP?_AjP<gPDTPPPPE{<gPPPPPGt<gPPJuKrPPPPKvM`PMhNiPKr<g<g!#p!&k!+^!+^!.mPPP!.t!1j<gPPPPPPPPPP!4aP!5rPP<g!7PP<gP<g<g<g<gP<g!9dPP!<]P!?Q!?Y!?^!?^P!<YP!?b!?bP!BVP!BZ<g<g!Ba!ET5uP5uP5u5uP!FW5u5u!HO5u!JQ5u!Kr5u5u!L`!NY!NY!N^!NY!NfP!NYP5u# b5u#!l5u5u-uPPP##yPP#$c#$cP#$cP#$x#$cPP#%OP#$uP#$u#%bMd#$u#&P#&V#&Y(Y#&](YP#&d#&d#&dP(YP(YP(YP(YPP(YP#&j#&mP#&m(YPPP(YP(YP(YP(YP(YP(Y(Y#&q#&{#'R#'X#'g#'m#'s#'}#(T#(d#(j#(x#)O#)U#)d#)y#+]#+k#+q#+w#+}#,T#,_#,e#,k#,u#-X#-_PPPPPPPP#-ePP#.X#2VPP#3m#3t#3|PP#8Y#:m#@i#@l#@o#@z#@}PP#AQ#AU#As#Bj#Bn#CSPP#CW#C^#CbP#Ce#Ci#Cl#D[#Dr#Dw#Dz#D}#ET#EW#E[#E`mhOSj}!n$Z%b%e%f%h*m*r/a/dQ$hmQ$opQ%YyS&U!b+[Q&j!jS(j#y(oQ)e$iQ)r$qQ*^%SQ+b&]S+g&c+iQ+y&kQ-e(qQ/O*_Y0S+k+l+m+n+oS2o.s2qU3x0T0V0YU5e2t2u2vS6[3z3}S7S5f5gQ7n6^R8R7U$p[ORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8t!j'd#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nQ(z$QQ)j$kQ*`%VQ*g%_Q,T9lQ.Q)_Q.])kQ/W*eQ2Y.WQ3U/PQ4X9mR5Q2ZpeOSjy}!n$Z%X%b%e%f%h*m*r/a/dR*b%Z&WVOSTjkn}!S!W!k!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k$Z$m%Z%^%_%b%d%e%f%h%l%y&R&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:m:n[!cRU!]!`%w&VQ$alQ$gmS$lp$qv$vrs!r!u$X$t&_&s&v)v)w)x*k+U+d,O,Q/j0eQ%OwQ&g!iQ&i!jS(^#v(hS)d$h$iQ)h$kQ)u$sQ*X%QQ*]%SS+x&j&kQ-R(_Q.U)eQ.[)kQ.^)lQ.a)pQ.y*YS.}*^*_Q0a+yQ1Z,}Q2X.WQ2].ZQ2b.cQ3T/OQ4d1[Q5P2ZQ5S2_Q6v5OR7x6w!Y$em!j$g$h$i&T&i&j&k(i)d)e+X+f+x+y-_.U/y0P0U0a1p3w3|6Y7l8`Q)]$aQ)}${Q*Q$|Q*[%SQ.e)uQ.x*XU.|*]*^*_Q3O.yS3S.}/OQ5`2nQ5r3TS7Q5a5dS8P7R7TQ8j8QR8y8kW#|a$c(w:kS${t%XQ$|uQ$}vR){$y$V#{a!w!y#d#v#x$R$S$W&f'|(V(X(Y(a(e(u(v)Y)[)_)|*P+u,Z-U-W-p-z-|.j.m.u.w1Y1c1m1t1{2O2S2e2{2}4g4s4{5i5n6{7X8U9j9n9o9p9q9r9s9x9y9z9{9|9}:Q:R:U:V:k:q:rT'}#s(OV({$Q9l9mU&Y!b$u+_Q'T!{Q)o$nQ.n*RQ1u-mR5[2j&^cORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:n$]#aZ!_!o$_%v%|&x'P'V'W'X'Y'Z'[']'^'_'`'a'c'f'j't)n*}+Y+c+z,Y,`,c,e,s-q/o/r0b0l0p0q0r0s0t0u0v0w0x0y0z0{0|1P1U1y2V3o3r4S4V4W4]4^5^6R6U6b6f6g7h7{8]8r8}9W:dT!XQ!Y&_cORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nQ&W!bR/u+[Y&Q!b&U&]+[+bS(i#y(oS+f&c+iS-_(j(qQ-`(kQ-f(rQ.p*TU0P+g+k+lU0U+m+n+oS0Z+p2sQ1p-eQ1r-gQ1s-hS2n.s2qU3w0S0T0VQ3{0WQ3|0YS5a2o2vS5d2t2uU6Y3x3z3}Q6_4OS7R5e5fQ7T5gS7l6[6^S8Q7S7UQ8`7nR8k8RlhOSj}!n$Z%b%e%f%h*m*r/a/dQ%j!QS&w!v9[Q)b$fQ*V%OQ*W%PQ+v&hS,X&|9uS-r)S:OQ.S)cQ.r*UQ/h*tQ/i*uQ/q+VQ0X+mQ0_+wS1z-s:SQ2T.TS2W.V:TQ3n/sQ3q/zQ4Q0`Q4}2UQ6P3kQ6S3pQ6W3vQ6`4RQ7f6QQ7i6XQ8[7jQ8o8YQ8q8^R8|8s$W#`Z!_!o%v%|&x'P'V'W'X'Y'Z'[']'^'_'`'a'c'f'j't)n*}+Y+c+z,Y,`,c,s-q/o/r0b0l0p0q0r0s0t0u0v0w0x0y0z0{0|1P1U1y2V3o3r4S4V4W4]4^5^6R6U6b6f6g7h7{8]8r8}9W:dU(t#z&{1OT)W$_,e$W#_Z!_!o%v%|&x'P'V'W'X'Y'Z'[']'^'_'`'a'c'f'j't)n*}+Y+c+z,Y,`,c,s-q/o/r0b0l0p0q0r0s0t0u0v0w0x0y0z0{0|1P1U1y2V3o3r4S4V4W4]4^5^6R6U6b6f6g7h7{8]8r8}9W:dQ'e#`S)V$_,eR-t)W&^cORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nQ%e{Q%f|Q%h!OQ%i!PR/`*pQ&d!iQ)X$aQ+s&gS-y)])uS0[+q+rW1}-v-w-x.eS4P0]0^U4z2P2Q2RU6t4y5W5XQ7w6uR8f7zT+h&c+iS+f&c+iU0P+g+k+lU0U+m+n+oS0Z+p2sS2n.s2qU3w0S0T0VQ3{0WQ3|0YS5a2o2vS5d2t2uU6Y3x3z3}Q6_4OS7R5e5fQ7T5gS7l6[6^S8Q7S7UQ8`7nR8k8RS+h&c+iT2p.s2qS&q!q/^Q-Q(^Q-](iS0O+f2nQ1`-RS1j-^-fU3y0U0Z5dQ4c1ZS4q1q1sU6]3{3|7TQ6j4dQ6s4tR7o6_Q!xXS&p!q/^Q)T$YQ)`$dQ)f$jQ+|&qQ-P(^Q-[(iQ-a(lQ.R)aQ.z*ZS/}+f2nS1_-Q-RS1i-]-fQ1l-`Q1o-bQ3Q.{W3u0O0U0Z5dQ4b1ZQ4f1`S4k1j1sQ4r1rQ5p3RW6Z3y3{3|7TS6i4c4dQ6n4mQ6q4qQ7O5_Q7]5qS7m6]6_Q7q6jQ7s6oQ7v6sQ7}7PQ8W7^Q8a7oQ8d7uQ8h8OQ8w8iQ9P8xQ9T9QQ:^:XQ:g:bR:h:c$rWORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8tS!xn!k!j:W#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nR:^:m$rXORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8tQ$Yb!Y$dm!j$g$h$i&T&i&j&k(i)d)e+X+f+x+y-_.U/y0P0U0a1p3w3|6Y7l8`S$jn!kQ)a$eQ*Z%SW.{*[*]*^*_U3R.|.}/OQ5_2nS5q3S3TU7P5`5a5dQ7^5rU8O7Q7R7TS8i8P8QS8x8j8kQ9Q8y!j:X#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nQ:b:lR:c:m$f]OSTjk}!S!W!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%b%d%e%f%h%l%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8tY!hRU!]!`%wv$vrs!r!u$X$t&_&s&v)v)w)x*k+U+d,O,Q/j0eQ*h%_!h:Y#]#k'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nR:]&VS&Z!b$uR/w+_$p[ORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8t!j'd#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nR*g%_$roORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8tQ'T!{!k:Z#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:n!h#VZ!_$_%v%|&x'P'^'_'`'a'f'j)n*}+c+z,Y,`,s-q0b0l0|1y2V3r4S4V6U7h8]8r8}9W!R9c'c't+Y,e/o/r0p0x0y0z0{1P1U3o4W4]4^5^6R6b6f6g7{:d!d#XZ!_$_%v%|&x'P'`'a'f'j)n*}+c+z,Y,`,s-q0b0l0|1y2V3r4S4V6U7h8]8r8}9W}9e'c't+Y,e/o/r0p0z0{1P1U3o4W4]4^5^6R6b6f6g7{:d!`#]Z!_$_%v%|&x'P'f'j)n*}+c+z,Y,`,s-q0b0l0|1y2V3r4S4V6U7h8]8r8}9Wl(Y#t&})R,{-T-i-j0j1x4a4u:_:i:jx:n'c't+Y,e/o/r0p1P1U3o4W4]4^5^6R6b6f6g7{:d!`:q&y'h(](c+r,W,p-X-u-x.i.k0^0i1a1e2R2g2i2y4U4h4n4w4|5X5l6a6l6r7ZZ:r0}4[6c7p8b&^cORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nS#l`#mR1R,h&e_ORSTU`jk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k#m$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,h,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nS#g^#nT'm#i'qT#h^#nT'o#i'q&e`ORSTU`jk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#]#b#e#k#m$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&V&^&e&o&|'Q'v(Q)S)Z*i*m*r+P+T+W+t+{,^,d,h,i-n-s-{.V.v/X/Y/Z/]/a/d/f/t/|0c0m1Q2d2l2|3a3c3d3m3t5m5{6V6|7k8_8t9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:nT#l`#mQ#o`R'x#m$rbORSTUjk}!S!W!]!`!n!v!z!|#P#Q#R#S#T#U#V#W#X#Y#Z#b#e$Z$m%Z%^%_%b%d%e%f%h%l%w%y&R&^&e&o&|'Q(Q)S)Z*i*m*r+P+t+{,^,d-n-s-{.V.v/X/Y/Z/]/a/d/f/|0c0m2d2|3a3c3d3t5m5{6V7k8_8t!k:l#]#k&V'v+T+W,i/t1Q2l3m6|9V9X9[9]9^9_9`9a9b9c9d9e9f9g9h9k9t9u9w:O:P:S:T:n#RdOSUj}!S!W!n!|#k$Z%Z%^%_%b%d%e%f%h%l&R&e'v)Z*i*m*r+t,i-n-{.v/X/Y/Z/]/a/d/f1Q2d2|3a3c3d5m5{t#za!y$R$S$W(V(X(Y(a(u(v,Z-p1Y1t:k:q:r!|&{!w#d#v#x&f'|(e)Y)[)_)|*P+u-U-W-z-|.j.m.u.w1c1m1{2O2S2e2{2}4g4s4{5i5n6{7X8U9n9p9r9x9z9|:Q:UQ)P$UQ,t(Rc1O9j9o9q9s9y9{9}:R:Vt#wa!y$R$S$W(V(X(Y(a(u(v,Z-p1Y1t:k:q:rS(l#y(oQ)Q$VQ-b(m!|:`!w#d#v#x&f'|(e)Y)[)_)|*P+u-U-W-z-|.j.m.u.w1c1m1{2O2S2e2{2}4g4s4{5i5n6{7X8U9n9p9r9x9z9|:Q:Ub:a9j9o9q9s9y9{9}:R:VQ:e:oR:f:pt#za!y$R$S$W(V(X(Y(a(u(v,Z-p1Y1t:k:q:r!|&{!w#d#v#x&f'|(e)Y)[)_)|*P+u-U-W-z-|.j.m.u.w1c1m1{2O2S2e2{2}4g4s4{5i5n6{7X8U9n9p9r9x9z9|:Q:Uc1O9j9o9q9s9y9{9}:R:VlfOSj}!n$Z%b%e%f%h*m*r/a/dQ(d#xQ*y%oQ*z%qR1b-U$U#{a!w!y#d#v#x$R$S$W&f'|(V(X(Y(a(e(u(v)Y)[)_)|*P+u,Z-U-W-p-z-|.j.m.u.w1Y1c1m1t1{2O2S2e2{2}4g4s4{5i5n6{7X8U9j9n9o9p9q9r9s9x9y9z9{9|9}:Q:R:U:V:k:q:rQ*O$|Q.l*QQ2h.kR5Z2iT(n#y(oS(n#y(oT2p.s2qQ)`$dQ-a(lQ.R)aQ.z*ZQ3Q.{Q5p3RQ7O5_Q7]5qQ7}7PQ8W7^Q8h8OQ8w8iQ9P8xR9T9Ql(V#t&})R,{-T-i-j0j1x4a4u:_:i:j!`9x&y'h(](c+r,W,p-X-u-x.i.k0^0i1a1e2R2g2i2y4U4h4n4w4|5X5l6a6l6r7ZZ9y0}4[6c7p8bn(X#t&})R,y,{-T-i-j0j1x4a4u:_:i:j!b9z&y'h(](c+r,W,p-X-u-x.i.k0^0g0i1a1e2R2g2i2y4U4h4n4w4|5X5l6a6l6r7Z]9{0}4[6c6d7p8bpeOSjy}!n$Z%X%b%e%f%h*m*r/a/dQ%UxR*i%_peOSjy}!n$Z%X%b%e%f%h*m*r/a/dR%UxQ*S$}R.h){qeOSjy}!n$Z%X%b%e%f%h*m*r/a/dQ.t*XS2z.x.yW5h2w2x2y3OU7W5j5k5lU8S7V7Y7ZQ8l8TR8z8mQ%]yR*c%XR3X/RR7`5sS$lp$qR.^)lQ%bzR*m%cR*s%iT/b*r/dQjOQ!nST$^j!nQ(O#sR,q(OQ!YQR%t!YQ!^RU%z!^%{+QQ%{!_R+Q%|Q+]&WR/v+]Q,[&}R0k,[Q,_'PS0n,_0oR0o,`Q+i&cR0Q+iS!eR$tU&`!e&a+RQ&a!fR+R%}Q+`&ZR/x+`Q&t!sQ+}&rU,R&t+}0fR0f,SQ'q#iR,j'qQ#m`R'w#mQ#cZU'g#c*|9iQ*|9WR9i'tQ-O(^W1]-O1^4e6kU1^-P-Q-RS4e1_1`R6k4f#q(T#t&y&}'h(](c(|(})R+r,U,V,W,p,y,z,{-T-X-i-j-u-x.i.k0^0g0h0i0j0}1a1e1x2R2g2i2y4U4Y4Z4[4a4h4n4u4w4|5X5l6a6c6d6e6l6r7Z7p8b:_:i:jQ-V(cU1d-V1f4iQ1f-XR4i1eQ(o#yR-c(oQ(x#}R-l(xQ1|-uR4x1|Q)y$wR.g)yQ2k.nS5]2k6}R6}5^Q*U%OR.q*UQ2q.sR5b2qQ/Q*`S3V/Q5tR5t3XQ.X)hW2[.X2^5R6xQ2^.[Q5R2]R6x5SQ)m$lR._)mQ/d*rR3g/dWiOSj!nQ%g}Q)U$ZQ*l%bQ*n%eQ*o%fQ*q%hQ/_*mS/b*r/dR3f/aQ$]gQ%k!RQ%n!TQ%p!UQ%r!VQ)t$rQ)z$xQ*b%]Q*w%mS/T*c*fQ/k*vQ/l*yQ/m*zS/{+f2nQ1g-ZQ1h-[Q1n-aQ2a.bQ2f.iQ3P.zQ3Z/VQ3e/`Y3s/}0O0U0Z5dQ4j1iQ4l1kQ4o1oQ5V2cQ5Y2gQ5o3QQ5u3Y[6T3r3u3y3{3|7TQ6m4kQ6p4pQ6y5TQ7[5pQ7a5vW7g6U6Z6]6_Q7r6nQ7t6qQ7y6zQ7|7OQ8V7]U8Z7h7m7oQ8c7sQ8e7vQ8g7}Q8n8WS8p8]8aQ8u8dQ8v8hQ8{8rQ9O8wQ9R8}Q9S9PR9U9TQ$fmQ&h!jU)c$g$h$iQ+V&TU+w&i&j&kQ-Z(iS.T)d)eQ/s+XQ/z+fS0`+x+yQ1k-_Q2U.UQ3p/yS3v0P0UQ4R0aQ4p1pS6X3w3|Q7j6YQ8^7lR8s8`S#ua:kR)^$cU#}a$c:kR-k(wQ#taS&y!w)_Q&}!yQ'h#dQ(]#vQ(c#xQ(|$RQ(}$SQ)R$WQ+r&fQ,U9nQ,V9pQ,W9rQ,p'|Q,y(VQ,z(XQ,{(YQ-T(aQ-X(eQ-i(uQ-j(vd-u)Y-z.u2O2{4{5i6{7X8UQ-x)[Q.i)|Q.k*PQ0^+uQ0g9xQ0h9zQ0i9|Q0j,ZQ0}9jQ1a-UQ1e-WQ1x-pQ2R-|Q2g.jQ2i.mQ2y.wQ4U:QQ4Y9oQ4Z9qQ4[9sQ4a1YQ4h1cQ4n1mQ4u1tQ4w1{Q4|2SQ5X2eQ5l2}Q6a:UQ6c9}Q6d9yQ6e9{Q6l4gQ6r4sQ7Z5nQ7p:RQ8b:VQ:_:kQ:i:qR:j:rlgOSj}!n$Z%b%e%f%h*m*r/a/dS!pU%dQ%m!SQ%s!WQ'U!|Q'u#kS*f%Z%^Q*j%_Q*v%lQ+S&RQ+q&eQ,n'vQ-w)ZQ/[*iQ0]+tQ1T,iQ1v-nQ2Q-{Q2x.vQ3]/XQ3^/YQ3`/ZQ3b/]Q3i/fQ4_1QQ5W2dQ5k2|Q5z3aQ5|3cQ5}3dQ7Y5mR7c5{!vZOSUj}!S!n!|$Z%Z%^%_%b%d%e%f%h%l&R&e)Z*i*m*r+t-n-{.v/X/Y/Z/]/a/d/f2d2|3a3c3d5m5{Q!_RQ!oTQ$_kS%v!]%yQ%|!`Q&x!vQ'P!zQ'V#PQ'W#QQ'X#RQ'Y#SQ'Z#TQ'[#UQ']#VQ'^#WQ'_#XQ'`#YQ'a#ZQ'c#]Q'f#bQ'j#eW't#k'v,i1QQ)n$mS*}%w+PS+Y&V/tQ+c&^Q+z&oQ,Y&|Q,`'QQ,c9VQ,e9XQ,s(QQ-q)SQ/o+TQ/r+WQ0b+{Q0l,^Q0p9[Q0q9]Q0r9^Q0s9_Q0t9`Q0u9aQ0v9bQ0w9cQ0x9dQ0y9eQ0z9fQ0{9gQ0|,dQ1P9kQ1U9hQ1y-sQ2V.VQ3o9tQ3r/|Q4S0cQ4V0mQ4W9uQ4]9wQ4^:OQ5^2lQ6R3mQ6U3tQ6b:PQ6f:SQ6g:TQ7h6VQ7{6|Q8]7kQ8r8_Q8}8tQ9W!WR:d:nR!aRR&X!bS&T!b+[S+X&U&]R/y+bR'O!yR'R!zT!tU$XS!sU$XU$wrs*kS&r!r!uQ,P&sQ,S&vQ.f)xS0d,O,QR4T0e`!dR!]!`$t%w&_)v+dh!qUrs!r!u$X&s&v)x,O,Q0eQ/^*kQ/p+UQ3l/jT:[&V)wT!gR$tS!fR$tS%x!]&_S%}!`)vS+O%w+dT+Z&V)wT&[!b$uQ#i^R'z#nT'p#i'qR1S,hT(`#v(hR(f#xQ-v)YQ2P-zQ2w.uQ4y2OQ5j2{Q6u4{Q7V5iQ7z6{Q8T7XR8m8UlhOSj}!n$Z%b%e%f%h*m*r/a/dQ%[yR*b%XV$xrs*kR.o*RR*a%VQ$ppR)s$qR)i$kT%`z%cT%az%cT/c*r/d",nodeNames:"⚠ ArithOp ArithOp InterpolationStart extends LineComment BlockComment Script ExportDeclaration export Star as VariableName String from ; default FunctionDeclaration async function VariableDefinition TypeParamList TypeDefinition ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation VoidType void TypeofType typeof MemberExpression . ?. PropertyName [ TemplateString Interpolation null super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewExpression new TypeArgList CompareOp < ) ( ArgList UnaryExpression await yield delete LogicOp BitOp ParenthesizedExpression ClassExpression class extends ClassBody MethodDeclaration Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression PrivatePropertyName BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof in const CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXStartTag JSXSelfClosingTag JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast ArrowFunction TypeParamList SequenceExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature CallSignature TypePredicate is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody MethodDeclaration AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try catch finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement",maxTerm:330,context:_6,nodeProps:[[kf.closedBy,3,"InterpolationEnd",40,"]",51,"}",66,")",132,"JSXSelfCloseEndTag JSXEndTag",146,"JSXEndTag"],[kf.group,-26,8,15,17,58,184,188,191,192,194,197,200,211,213,219,221,223,225,228,234,238,240,242,244,246,248,249,"Statement",-30,12,13,24,27,28,41,43,44,45,47,52,60,68,74,75,91,92,101,103,119,122,124,125,126,127,129,130,148,149,151,"Expression",-22,23,25,29,32,34,152,154,156,157,159,160,161,163,164,165,167,168,169,178,180,182,183,"Type",-3,79,85,90,"ClassItem"],[kf.openedBy,30,"InterpolationStart",46,"[",50,"{",65,"(",131,"JSXStartTag",141,"JSXStartTag JSXStartCloseTag"]],skippedNodes:[0,5,6],repeatNodeCount:28,tokenData:"!C}~R!`OX%TXY%cYZ'RZ[%c[]%T]^'R^p%Tpq%cqr'crs(kst0htu2`uv4pvw5ewx6cxy<yyz=Zz{=k{|>k|}?O}!O>k!O!P?`!P!QCl!Q!R!0[!R![!1q![!]!7s!]!^!8V!^!_!8g!_!`!9d!`!a!:[!a!b!<R!b!c%T!c!}2`!}#O!=d#O#P%T#P#Q!=t#Q#R!>U#R#S2`#S#T!>i#T#o2`#o#p!>y#p#q!?O#q#r!?f#r#s!?x#s$f%T$f$g%c$g#BY2`#BY#BZ!@Y#BZ$IS2`$IS$I_!@Y$I_$I|2`$I|$I}!Bq$I}$JO!Bq$JO$JT2`$JT$JU!@Y$JU$KV2`$KV$KW!@Y$KW&FU2`&FU&FV!@Y&FV?HT2`?HT?HU!@Y?HU~2`W%YR$UWO!^%T!_#o%T#p~%T,T%jg$UW'W+{OX%TXY%cYZ%TZ[%c[p%Tpq%cq!^%T!_#o%T#p$f%T$f$g%c$g#BY%T#BY#BZ%c#BZ$IS%T$IS$I_%c$I_$JT%T$JT$JU%c$JU$KV%T$KV$KW%c$KW&FU%T&FU&FV%c&FV?HT%T?HT?HU%c?HU~%T,T'YR$UW'X+{O!^%T!_#o%T#p~%T$T'jS$UW!j#{O!^%T!_!`'v!`#o%T#p~%T$O'}S#e#v$UWO!^%T!_!`(Z!`#o%T#p~%T$O(bR#e#v$UWO!^%T!_#o%T#p~%T'u(rZ$UW]!ROY(kYZ)eZr(krs*rs!^(k!^!_+U!_#O(k#O#P-b#P#o(k#o#p+U#p~(k&r)jV$UWOr)ers*Ps!^)e!^!_*a!_#o)e#o#p*a#p~)e&r*WR$P&j$UWO!^%T!_#o%T#p~%T&j*dROr*ars*ms~*a&j*rO$P&j'u*{R$P&j$UW]!RO!^%T!_#o%T#p~%T'm+ZV]!ROY+UYZ*aZr+Urs+ps#O+U#O#P+w#P~+U'm+wO$P&j]!R'm+zROr+Urs,Ts~+U'm,[U$P&j]!ROY,nZr,nrs-Vs#O,n#O#P-[#P~,n!R,sU]!ROY,nZr,nrs-Vs#O,n#O#P-[#P~,n!R-[O]!R!R-_PO~,n'u-gV$UWOr(krs-|s!^(k!^!_+U!_#o(k#o#p+U#p~(k'u.VZ$P&j$UW]!ROY.xYZ%TZr.xrs/rs!^.x!^!_,n!_#O.x#O#P0S#P#o.x#o#p,n#p~.x!Z/PZ$UW]!ROY.xYZ%TZr.xrs/rs!^.x!^!_,n!_#O.x#O#P0S#P#o.x#o#p,n#p~.x!Z/yR$UW]!RO!^%T!_#o%T#p~%T!Z0XT$UWO!^.x!^!_,n!_#o.x#o#p,n#p~.xy0mZ$UWOt%Ttu1`u!^%T!_!c%T!c!}1`!}#R%T#R#S1`#S#T%T#T#o1`#p$g%T$g~1`y1g]$UW'mqOt%Ttu1`u!Q%T!Q![1`![!^%T!_!c%T!c!}1`!}#R%T#R#S1`#S#T%T#T#o1`#p$g%T$g~1`&i2k_$UW#zS'Z%k'epOt%Ttu2`u}%T}!O3j!O!Q%T!Q![2`![!^%T!_!c%T!c!}2`!}#R%T#R#S2`#S#T%T#T#o2`#p$g%T$g~2`[3q_$UW#zSOt%Ttu3ju}%T}!O3j!O!Q%T!Q![3j![!^%T!_!c%T!c!}3j!}#R%T#R#S3j#S#T%T#T#o3j#p$g%T$g~3j$O4wS#^#v$UWO!^%T!_!`5T!`#o%T#p~%T$O5[R$UW#o#vO!^%T!_#o%T#p~%T%r5lU'v%j$UWOv%Tvw6Ow!^%T!_!`5T!`#o%T#p~%T$O6VS$UW#i#vO!^%T!_!`5T!`#o%T#p~%T'u6jZ$UW]!ROY6cYZ7]Zw6cwx*rx!^6c!^!_8T!_#O6c#O#P:T#P#o6c#o#p8T#p~6c&r7bV$UWOw7]wx*Px!^7]!^!_7w!_#o7]#o#p7w#p~7]&j7zROw7wwx*mx~7w'm8YV]!ROY8TYZ7wZw8Twx+px#O8T#O#P8o#P~8T'm8rROw8Twx8{x~8T'm9SU$P&j]!ROY9fZw9fwx-Vx#O9f#O#P9}#P~9f!R9kU]!ROY9fZw9fwx-Vx#O9f#O#P9}#P~9f!R:QPO~9f'u:YV$UWOw6cwx:ox!^6c!^!_8T!_#o6c#o#p8T#p~6c'u:xZ$P&j$UW]!ROY;kYZ%TZw;kwx/rx!^;k!^!_9f!_#O;k#O#P<e#P#o;k#o#p9f#p~;k!Z;rZ$UW]!ROY;kYZ%TZw;kwx/rx!^;k!^!_9f!_#O;k#O#P<e#P#o;k#o#p9f#p~;k!Z<jT$UWO!^;k!^!_9f!_#o;k#o#p9f#p~;k%V=QR!d$}$UWO!^%T!_#o%T#p~%TZ=bR!cR$UWO!^%T!_#o%T#p~%T%R=tU'[!R#_#v$UWOz%Tz{>W{!^%T!_!`5T!`#o%T#p~%T$O>_S#[#v$UWO!^%T!_!`5T!`#o%T#p~%T$u>rSj$m$UWO!^%T!_!`5T!`#o%T#p~%T&i?VR!R&a$UWO!^%T!_#o%T#p~%T&i?gVu%n$UWO!O%T!O!P?|!P!Q%T!Q![@r![!^%T!_#o%T#p~%Ty@RT$UWO!O%T!O!P@b!P!^%T!_#o%T#p~%Ty@iR!Qq$UWO!^%T!_#o%T#p~%Ty@yZ$UWkqO!Q%T!Q![@r![!^%T!_!g%T!g!hAl!h#R%T#R#S@r#S#X%T#X#YAl#Y#o%T#p~%TyAqZ$UWO{%T{|Bd|}%T}!OBd!O!Q%T!Q![CO![!^%T!_#R%T#R#SCO#S#o%T#p~%TyBiV$UWO!Q%T!Q![CO![!^%T!_#R%T#R#SCO#S#o%T#p~%TyCVV$UWkqO!Q%T!Q![CO![!^%T!_#R%T#R#SCO#S#o%T#p~%T,TCs`$UW#]#vOYDuYZ%TZzDuz{Jl{!PDu!P!Q!-e!Q!^Du!^!_Fx!_!`!.^!`!a!/]!a!}Du!}#OHq#O#PJQ#P#oDu#o#pFx#p~DuXD|[$UW}POYDuYZ%TZ!PDu!P!QEr!Q!^Du!^!_Fx!_!}Du!}#OHq#O#PJQ#P#oDu#o#pFx#p~DuXEy_$UW}PO!^%T!_#Z%T#Z#[Er#[#]%T#]#^Er#^#a%T#a#bEr#b#g%T#g#hEr#h#i%T#i#jEr#j#m%T#m#nEr#n#o%T#p~%TPF}V}POYFxZ!PFx!P!QGd!Q!}Fx!}#OG{#O#PHh#P~FxPGiU}P#Z#[Gd#]#^Gd#a#bGd#g#hGd#i#jGd#m#nGdPHOTOYG{Z#OG{#O#PH_#P#QFx#Q~G{PHbQOYG{Z~G{PHkQOYFxZ~FxXHvY$UWOYHqYZ%TZ!^Hq!^!_G{!_#OHq#O#PIf#P#QDu#Q#oHq#o#pG{#p~HqXIkV$UWOYHqYZ%TZ!^Hq!^!_G{!_#oHq#o#pG{#p~HqXJVV$UWOYDuYZ%TZ!^Du!^!_Fx!_#oDu#o#pFx#p~Du,TJs^$UW}POYJlYZKoZzJlz{NQ{!PJl!P!Q!,R!Q!^Jl!^!_!!]!_!}Jl!}#O!'|#O#P!+a#P#oJl#o#p!!]#p~Jl,TKtV$UWOzKoz{LZ{!^Ko!^!_M]!_#oKo#o#pM]#p~Ko,TL`X$UWOzKoz{LZ{!PKo!P!QL{!Q!^Ko!^!_M]!_#oKo#o#pM]#p~Ko,TMSR$UWU+{O!^%T!_#o%T#p~%T+{M`ROzM]z{Mi{~M]+{MlTOzM]z{Mi{!PM]!P!QM{!Q~M]+{NQOU+{,TNX^$UW}POYJlYZKoZzJlz{NQ{!PJl!P!Q! T!Q!^Jl!^!_!!]!_!}Jl!}#O!'|#O#P!+a#P#oJl#o#p!!]#p~Jl,T! ^_$UWU+{}PO!^%T!_#Z%T#Z#[Er#[#]%T#]#^Er#^#a%T#a#bEr#b#g%T#g#hEr#h#i%T#i#jEr#j#m%T#m#nEr#n#o%T#p~%T+{!!bY}POY!!]YZM]Zz!!]z{!#Q{!P!!]!P!Q!&x!Q!}!!]!}#O!$`#O#P!&f#P~!!]+{!#VY}POY!!]YZM]Zz!!]z{!#Q{!P!!]!P!Q!#u!Q!}!!]!}#O!$`#O#P!&f#P~!!]+{!#|UU+{}P#Z#[Gd#]#^Gd#a#bGd#g#hGd#i#jGd#m#nGd+{!$cWOY!$`YZM]Zz!$`z{!${{#O!$`#O#P!&S#P#Q!!]#Q~!$`+{!%OYOY!$`YZM]Zz!$`z{!${{!P!$`!P!Q!%n!Q#O!$`#O#P!&S#P#Q!!]#Q~!$`+{!%sTU+{OYG{Z#OG{#O#PH_#P#QFx#Q~G{+{!&VTOY!$`YZM]Zz!$`z{!${{~!$`+{!&iTOY!!]YZM]Zz!!]z{!#Q{~!!]+{!&}_}POzM]z{Mi{#ZM]#Z#[!&x#[#]M]#]#^!&x#^#aM]#a#b!&x#b#gM]#g#h!&x#h#iM]#i#j!&x#j#mM]#m#n!&x#n~M],T!(R[$UWOY!'|YZKoZz!'|z{!(w{!^!'|!^!_!$`!_#O!'|#O#P!*o#P#QJl#Q#o!'|#o#p!$`#p~!'|,T!(|^$UWOY!'|YZKoZz!'|z{!(w{!P!'|!P!Q!)x!Q!^!'|!^!_!$`!_#O!'|#O#P!*o#P#QJl#Q#o!'|#o#p!$`#p~!'|,T!*PY$UWU+{OYHqYZ%TZ!^Hq!^!_G{!_#OHq#O#PIf#P#QDu#Q#oHq#o#pG{#p~Hq,T!*tX$UWOY!'|YZKoZz!'|z{!(w{!^!'|!^!_!$`!_#o!'|#o#p!$`#p~!'|,T!+fX$UWOYJlYZKoZzJlz{NQ{!^Jl!^!_!!]!_#oJl#o#p!!]#p~Jl,T!,Yc$UW}POzKoz{LZ{!^Ko!^!_M]!_#ZKo#Z#[!,R#[#]Ko#]#^!,R#^#aKo#a#b!,R#b#gKo#g#h!,R#h#iKo#i#j!,R#j#mKo#m#n!,R#n#oKo#o#pM]#p~Ko,T!-lV$UWT+{OY!-eYZ%TZ!^!-e!^!_!.R!_#o!-e#o#p!.R#p~!-e+{!.WQT+{OY!.RZ~!.R$P!.g[$UW#o#v}POYDuYZ%TZ!PDu!P!QEr!Q!^Du!^!_Fx!_!}Du!}#OHq#O#PJQ#P#oDu#o#pFx#p~Du]!/f[#wS$UW}POYDuYZ%TZ!PDu!P!QEr!Q!^Du!^!_Fx!_!}Du!}#OHq#O#PJQ#P#oDu#o#pFx#p~Duy!0cd$UWkqO!O%T!O!P@r!P!Q%T!Q![!1q![!^%T!_!g%T!g!hAl!h#R%T#R#S!1q#S#U%T#U#V!3X#V#X%T#X#YAl#Y#b%T#b#c!2w#c#d!4m#d#l%T#l#m!5{#m#o%T#p~%Ty!1x_$UWkqO!O%T!O!P@r!P!Q%T!Q![!1q![!^%T!_!g%T!g!hAl!h#R%T#R#S!1q#S#X%T#X#YAl#Y#b%T#b#c!2w#c#o%T#p~%Ty!3OR$UWkqO!^%T!_#o%T#p~%Ty!3^W$UWO!Q%T!Q!R!3v!R!S!3v!S!^%T!_#R%T#R#S!3v#S#o%T#p~%Ty!3}Y$UWkqO!Q%T!Q!R!3v!R!S!3v!S!^%T!_#R%T#R#S!3v#S#b%T#b#c!2w#c#o%T#p~%Ty!4rV$UWO!Q%T!Q!Y!5X!Y!^%T!_#R%T#R#S!5X#S#o%T#p~%Ty!5`X$UWkqO!Q%T!Q!Y!5X!Y!^%T!_#R%T#R#S!5X#S#b%T#b#c!2w#c#o%T#p~%Ty!6QZ$UWO!Q%T!Q![!6s![!^%T!_!c%T!c!i!6s!i#R%T#R#S!6s#S#T%T#T#Z!6s#Z#o%T#p~%Ty!6z]$UWkqO!Q%T!Q![!6s![!^%T!_!c%T!c!i!6s!i#R%T#R#S!6s#S#T%T#T#Z!6s#Z#b%T#b#c!2w#c#o%T#p~%T%w!7|R!]V$UW#m%hO!^%T!_#o%T#p~%T!P!8^R_w$UWO!^%T!_#o%T#p~%T+c!8rR'`d!a%Y#x&s'zP!P!Q!8{!^!_!9Q!_!`!9_W!9QO$WW#v!9VP#`#v!_!`!9Y#v!9_O#o#v#v!9dO#a#v%w!9kT!{%o$UWO!^%T!_!`'v!`!a!9z!a#o%T#p~%T$P!:RR#W#w$UWO!^%T!_#o%T#p~%T%w!:gT'_!s#a#v$RS$UWO!^%T!_!`!:v!`!a!;W!a#o%T#p~%T$O!:}R#a#v$UWO!^%T!_#o%T#p~%T$O!;_T#`#v$UWO!^%T!_!`5T!`!a!;n!a#o%T#p~%T$O!;uS#`#v$UWO!^%T!_!`5T!`#o%T#p~%T%w!<YV'n%o$UWO!O%T!O!P!<o!P!^%T!_!a%T!a!b!=P!b#o%T#p~%T$`!<vRv$W$UWO!^%T!_#o%T#p~%T$O!=WS$UW#j#vO!^%T!_!`5T!`#o%T#p~%T&e!=kRx&]$UWO!^%T!_#o%T#p~%TZ!={R!OR$UWO!^%T!_#o%T#p~%T$O!>]S#g#v$UWO!^%T!_!`5T!`#o%T#p~%T$P!>pR$UW'd#wO!^%T!_#o%T#p~%T~!?OO!T~%r!?VT'u%j$UWO!^%T!_!`5T!`#o%T#p#q!=P#q~%T$u!?oR!S$knQ$UWO!^%T!_#o%T#p~%TX!@PR!kP$UWO!^%T!_#o%T#p~%T,T!@gr$UW'W+{#zS'Z%k'epOX%TXY%cYZ%TZ[%c[p%Tpq%cqt%Ttu2`u}%T}!O3j!O!Q%T!Q![2`![!^%T!_!c%T!c!}2`!}#R%T#R#S2`#S#T%T#T#o2`#p$f%T$f$g%c$g#BY2`#BY#BZ!@Y#BZ$IS2`$IS$I_!@Y$I_$JT2`$JT$JU!@Y$JU$KV2`$KV$KW!@Y$KW&FU2`&FU&FV!@Y&FV?HT2`?HT?HU!@Y?HU~2`,T!CO_$UW'X+{#zS'Z%k'epOt%Ttu2`u}%T}!O3j!O!Q%T!Q![2`![!^%T!_!c%T!c!}2`!}#R%T#R#S2`#S#T%T#T#o2`#p$g%T$g~2`",tokenizers:[X6,j6,U6,0,1,2,3,4,5,6,7,8,G6],topRules:{Script:[0,7]},dialects:{jsx:11335,ts:11337},dynamicPrecedences:{149:1,176:1},specialized:[{term:287,get:(t,e)=>function(t,e){return"extends"==t&&e.dialectEnabled(1)?4:-1}(t,e)<<1},{term:287,get:t=>Z6[t]||-1},{term:297,get:t=>Y6[t]||-1},{term:63,get:t=>K6[t]||-1}],tokenPrec:11358});function t7(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function e7(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function i7(t,e){if(!e.anchorNode)return!1;try{return e7(t,e.anchorNode)}catch(t){return!1}}function s7(t){return 3==t.nodeType?g7(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function n7(t,e,i,s){return!!i&&(o7(t,e,i,s,-1)||o7(t,e,i,s,1))}function r7(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function o7(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:h7(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=r7(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?h7(t):0}}}function h7(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const l7={left:0,right:0,top:0,bottom:0};function a7(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function c7(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class d7{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let u7,f7=null;function p7(t){if(t.setActive)return t.setActive();if(f7)return t.focus(f7);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==f7?{get preventScroll(){return f7={preventScroll:!0},!0}}:void 0),!f7){f7=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function g7(t,e,i=e){let s=u7||(u7=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function m7(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function w7(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class v7{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new v7(t.parentNode,r7(t),e)}static after(t,e){return new v7(t.parentNode,r7(t)+1,e)}}const y7=[];class b7{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=b7.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=O7(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=O7(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==h7(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!b7.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=y7){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new S7(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function O7(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}b7.prototype.breakAfter=0;class S7{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function x7(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function k7(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,x7(t,a,c,h,l,s,0,n,r)}let A7="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},M7="undefined"!=typeof document?document:{documentElement:{style:{}}};const C7=/Edge\/(\d+)/.exec(A7.userAgent),T7=/MSIE \d/.test(A7.userAgent),D7=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(A7.userAgent),R7=!!(T7||D7||C7),E7=!R7&&/gecko\/(\d+)/i.test(A7.userAgent),B7=!R7&&/Chrome\/(\d+)/.exec(A7.userAgent),P7="webkitFontSmoothing"in M7.documentElement.style,L7=!R7&&/Apple Computer/.test(A7.vendor),V7=L7&&(/Mobile\/\w+/.test(A7.userAgent)||A7.maxTouchPoints>2);var W7={mac:V7||/Mac/.test(A7.platform),windows:/Win/.test(A7.platform),linux:/Linux|X11/.test(A7.platform),ie:R7,ie_version:T7?M7.documentMode||6:D7?+D7[1]:C7?+C7[1]:0,gecko:E7,gecko_version:E7?+(/Firefox\/(\d+)/.exec(A7.userAgent)||[0,0])[1]:0,chrome:!!B7,chrome_version:B7?+B7[1]:0,ios:V7,android:/Android\b/.test(A7.userAgent),webkit:P7,safari:L7,webkit_version:P7?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=M7.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class N7 extends b7{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof N7&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new N7(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new v7(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Q7(this.dom,t,e)}}class H7 extends b7{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(w7(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof H7&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&(k7(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new H7(this.mark,e,r)}domAtPos(t){return _7(this.dom,this.children,t)}coordsAt(t,e){return X7(this,t,e)}}function Q7(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?W7.chrome||W7.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=g7(t,n,r).getClientRects();if(!h.length)return l7;let l=h[(o?o<0:i>=0)?0:h.length-1];return W7.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?a7(l,o<0):l||null}class I7 extends b7{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||I7)(t,e,i)}split(t){let e=I7.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof I7&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof I7&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?v7.before(this.dom):v7.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return l7;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:a7(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class z7 extends I7{domAtPos(t){let{topView:e,text:i}=this.widget;return e?F7(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new v7(i,Math.min(t,i.nodeValue.length)))):new v7(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?$7(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?F7(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Q7(s,t,e))):Q7(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function F7(t,e,i,s,n,r){if(i instanceof H7){for(let o of i.children){let i=e7(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?F7(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function $7(t,e,i,s){if(i instanceof H7)for(let n of i.children){let i=0,r=e7(n.dom,s);if(e7(n.dom,t))return i+(r?$7(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class q7 extends b7{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof q7&&t.side==this.side}split(){return new q7(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return v7.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof N7){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof H7&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function _7(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return v7.after(i)}return new v7(t,0)}function G7(t,e,i){let s,{children:n}=t;i>0&&e instanceof H7&&n.length&&(s=n[n.length-1])instanceof H7&&s.mark.eq(e.mark)?G7(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function X7(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?a7(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=s7(s);return n[n.length-1]||null}function j7(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function U7(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function Z7(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}N7.prototype.children=I7.prototype.children=q7.prototype.children=y7;class Y7{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var K7=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(K7||(K7={}));class J7 extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new ttt(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new itt(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=stt(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new itt(t,e,i,s,t.widget||null,!0)}static line(t){return new ett(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}J7.none=ee.empty;class ttt extends J7{constructor(t){let{start:e,end:i}=stt(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof ttt&&this.tagName==t.tagName&&this.class==t.class&&U7(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}ttt.prototype.point=!1;class ett extends J7{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof ett&&U7(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}ett.prototype.mapMode=z.TrackBefore,ett.prototype.point=!0;class itt extends J7{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?K7.WidgetRange:this.startSide<=0?K7.WidgetBefore:K7.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof itt&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function stt(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function ntt(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}itt.prototype.point=!0;class rtt extends b7{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof rtt))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),k7(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new rtt;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){U7(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){G7(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=j7(e,this.attrs||{})),i&&(this.attrs=j7({class:i},this.attrs||{}))}domAtPos(t){return _7(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(w7(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Z7(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&b7.get(i)instanceof H7;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=b7.get(i))||void 0===e?void 0:e.isEditable)||W7.ios&&this.children.some((t=>t instanceof N7))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof N7))return null;let i=s7(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return X7(this,t,e)}become(t){return!1}get type(){return K7.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof rtt)return n;if(r>e)break}s=r+n.breakAfter}return null}}class ott extends b7{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof ott&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?v7.before(this.dom):v7.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new ott(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return y7}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof ott&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class htt{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof ott&&t.type==K7.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new rtt),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(ltt(new q7(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(ltt(new N7(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof itt)if(i.block){let{type:t}=i;t!=K7.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new ott(i.widget||new att("div"),r,t))}else{let o=I7.create(i.widget||new att("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(ltt(new q7(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(ltt(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof itt){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new htt(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function ltt(t,e){for(let i of e)t=new H7(i,[t],t.length);return t}class att extends Y7{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const ctt=[],dtt=et.define(),utt=et.define(),ftt=et.define(),ptt=et.define(),gtt=et.define(),mtt=et.define(),wtt=Et.define({map:(t,e)=>t.map(e)}),vtt=Et.define({map:(t,e)=>t.map(e)});class ytt{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new ytt(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const btt=Et.define({map:(t,e)=>t.map(e)});function Ott(t,e,i){let s=t.facet(ptt);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Stt=et.define({combine:t=>!t.length||t[0]});class xtt{constructor(t,e){this.field=t,this.get=e}}class ktt{from(t){return new xtt(this,t)}static define(){return new ktt}}ktt.decorations=ktt.define(),ktt.atomicRanges=ktt.define(),ktt.scrollMargins=ktt.define();let Att=0;const Mtt=et.define();class Ctt{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Mtt.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(Ttt.from((t=>({plugin:t,handlers:i})))),n&&r.push(ktt.decorations.from(n)),new Ctt(Att++,t,r)}static fromClass(t,e){return Ctt.define((e=>new t(e)),e)}}const Ttt=ktt.define();class Dtt{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Ott(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Ott(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Ott(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Rtt=et.define(),Ett=et.define(),Btt=et.define(),Ptt=et.define();class Ltt{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Ltt(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new Ltt(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new Ltt(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class Vtt{constructor(t,e,i=ctt){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Ltt(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Wtt=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Wtt||(Wtt={}));const Ntt=Wtt.LTR,Htt=Wtt.RTL;function Qtt(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Itt=Qtt("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ztt=Qtt("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Ftt=Object.create(null),$tt=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Ftt[e]=i,Ftt[i]=-e}const qtt=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class _tt{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Htt:Ntt}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Gtt=[];function Xtt(t,e){let i=t.length,s=e==Ntt?1:2,n=e==Ntt?2:1;if(!t||1==s&&!qtt.test(t))return jtt(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?Itt[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ztt[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),Gtt[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=Gtt[t];if(128==s)t<i-1&&e==Gtt[t+1]&&24&e?s=Gtt[t]=e:Gtt[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==Gtt[s];)s++;let r=t&&8==e||s<i&&8==Gtt[s]?1==n?1:8:256;for(let e=t;e<s;e++)Gtt[e]=r;t=s-1}else 8==s&&1==n&&(Gtt[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=Ftt[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if($tt[t+1]==-r){let e=$tt[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(Gtt[h]=Gtt[$tt[t]]=i),l=t;break}}else{if(189==$tt.length)break;$tt[l++]=h,$tt[l++]=e,$tt[l++]=a}else if(2==(o=Gtt[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=$tt[e+2];if(2&i)break;if(t)$tt[e+2]|=2;else{if(4&i)break;$tt[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Gtt[t]){let e=t+1;for(;e<i&&256==Gtt[e];)e++;let n=1==(t?Gtt[t-1]:s),r=n==(1==(e<i?Gtt[e]:s))?n?1:2:s;for(let i=t;i<e;i++)Gtt[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=Gtt[t++];for(;t<i&&s==(1!=Gtt[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=Gtt[--i];for(;i>e&&s==(2!=Gtt[i-1]);)i--;o.push(new _tt(i,t,s?2:1))}else o.push(new _tt(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==Gtt[t++];for(;t<i&&s==(2==Gtt[t]);)t++;o.push(new _tt(e,t,s?1:2))}return o}function jtt(t){return[new _tt(0,t,0)]}let Utt="";function Ztt(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=_tt.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(Utt=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class Ytt{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=b7.get(s),r=b7.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:Ktt(s))||Ktt(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=b7.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Ktt(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Jtt{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class tet extends b7{constructor(t){super(),this.view=t,this.compositionDeco=J7.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new rtt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Ltt(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=J7.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=iet(t);if(!i)return J7.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Ytt([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return J7.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return J7.none;let d=b7.get(r);d instanceof z7?d=d.widget.topView:d&&(d.parent=null);return J7.set(J7.replace({widget:new set(r,o,d)}).range(h,l))}(this.view,t.changes)),(W7.ie||W7.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new ret;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Ltt.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=W7.chrome||W7.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof ott&&t.widget instanceof eet&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=htt.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);x7(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||W7.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(W7.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new v7(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&n7(n.node,n.offset,h.anchorNode,h.anchorOffset)&&n7(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{W7.android&&W7.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=t7(this.root);if(s.empty){if(W7.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=net(n.node,n.offset,1==t?1:-1);e&&(n=new v7(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new v7(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new v7(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=t7(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=rtt.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Stt)?this.root.activeElement==this.dom:i7(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=b7.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof rtt)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=K7.WidgetBefore&&n.type!=K7.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==K7.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?s7(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==Wtt.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof rtt){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=s7(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new S7(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(J7.replace({widget:new eet(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return J7.set(t)}updateDeco(){let t=this.view.pluginField(ktt.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Btt),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField(ktt.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=c7(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Wtt.LTR)}}class eet extends Y7{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function iet(t){let e=t.observer.selectionRange,i=e.focusNode&&net(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof rtt){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!b7.get(e);)e=e.previousSibling;let n=e?b7.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof rtt)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class set extends Y7{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return z7}}function net(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=h7(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class ret{constructor(){this.changes=[]}compareRange(t,e){ntt(t,e,this.changes)}comparePoint(t,e){ntt(t,e,this.changes)}}function oet(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function het(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function aet(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function cet(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function det(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function uet(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=s7(d);for(let u=0;u<t.length;u++){let f=t[u];n&&aet(n,f)&&(f=cet(det(f,n.bottom),n.top));let p=oet(e,f),g=het(i,f);if(0==p&&0==g)return 3==d.nodeType?fet(d,e,i):uet(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&aet(a,f)?a=det(a,f.bottom):c&&aet(c,f)&&(c=cet(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?fet(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:uet(s,d,i)}function fet(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=g7(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(W7.chrome||W7.gecko){g7(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function pet(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=K7.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:get(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:get(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),W7.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return g7(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=rtt.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=uet(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function get(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function met(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=Ztt(n,r,t.textDirection,o,i),l=Utt;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function wet(t,e,i){let s=t.pluginField(ktt.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class vet{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in ket){let i=ket[e];t.contentDOM.addEventListener(e,(s=>{xet(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),W7.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Ttt);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{xet(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Ott(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){Ott(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(W7.android&&W7.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!W7.ios||!(i=yet.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,m7(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(W7.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!W7.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const yet=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],bet=[16,17,18,20,91,92,224,225];class Oet{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(dtt);return i.length?i[0](e):W7.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(utt);return i.length?i[0](e):W7.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=t7(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Net(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function xet(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=b7.get(s))&&i.ignoreEvent(e))return!1;return!0}const ket=Object.create(null),Aet=W7.ie&&W7.ie_version<15||W7.ios&&W7.webkit_version<604;function Met(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=Qet&&s.selection.ranges.every((t=>t.empty))&&Qet==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ket.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():bet.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let Cet=0;function Tet(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=rtt.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}ket.touchstart=(t,e)=>{Cet=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},ket.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},ket.mousedown=(t,e)=>{if(t.observer.flush(),Cet>Date.now()-2e3&&1==Net(e))return;let i=null;for(let s of t.state.facet(ftt))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Bet(t,e),s=Net(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Bet(t,e),o=e),!a||!i)return n;let c=Tet(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=Tet(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>p7(t.contentDOM))),t.inputState.startMouseSelection(new Oet(t,e,i,s))}};let Det=(t,e)=>t>=e.top&&t<=e.bottom,Ret=(t,e,i)=>Det(e,i)&&t>=i.left&&t<=i.right;function Eet(t,e,i,s){let n=rtt.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Ret(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&Ret(i,s,h)?1:o&&Det(s,o)?-1:1}function Bet(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Eet(t,i,e.clientX,e.clientY)}}const Pet=W7.ie&&W7.ie_version<=11;let Let=null,Vet=0,Wet=0;function Net(t){if(!Pet)return t.detail;let e=Let,i=Wet;return Let=t,Wet=Date.now(),Vet=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Vet+1)%3:1}function Het(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ket.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},ket.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&Het(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else Het(t,e,e.dataTransfer.getData("Text"),!0)},ket.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Aet?null:e.clipboardData;i?(Met(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Met(t,i.value)}),50)}(t)};let Qet=null;function Iet(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}ket.copy=ket.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;Qet=n?i:null;let r=Aet?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},ket.focus=ket.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},ket.compositionstart=ket.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Iet(t,!0)))},ket.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&Iet(t,!1)}),50)},ket.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},ket.beforeinput=(t,e)=>{var i;let s;if(W7.chrome&&W7.android&&(s=yet.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const zet=["pre-wrap","normal","pre-line","break-spaces"];class Fet{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=Wtt.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return zet.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=zet.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class $et{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class qet{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new qet(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new qet(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var _et=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(_et||(_et={}));class Get{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Get.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,_et.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,_et.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,_et.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=Ket.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new jet(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Zet(Get.of(t.slice(0,e)),r,Get.of(t.slice(i)))}}Get.prototype.size=1;class Xet extends Get{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new qet(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class jet extends Xet{constructor(t,e){super(t,e,K7.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof jet||s instanceof Uet&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof Uet?s=new jet(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Get.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Uet extends Get{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new qet(l,a,i+o*h,o,K7.Text)}lineAt(t,e,i,s,n){if(e==_et.ByHeight)return this.blockAt(t,i,s,n);if(e==_et.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new qet(e,s-e,0,0,K7.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new qet(h,l,s+o*(a-r),o,K7.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new qet(e.from,e.length,s,h,K7.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof Uet?i[i.length-1]=new Uet(t.length+s):i.push(null,new Uet(s-1))}if(t>0){let e=i[0];e instanceof Uet?i[0]=new Uet(t+e.length):i.unshift(new Uet(t-1),null)}return Get.of(i)}decomposeLeft(t,e){e.push(new Uet(t-1),null)}decomposeRight(t,e){e.push(null,new Uet(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new Uet(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new jet(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new Uet(n-r).updateHeight(t,r));let l=Get.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Zet extends Get{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==_et.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==_et.ByPosNoHeight?_et.ByPosNoHeight:_et.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,_et.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&Yet(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),Yet(n,t)}return Get.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Get.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Yet(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof Uet&&(s=t[e+1])instanceof Uet&&t.splice(e-1,3,new Uet(i.length+1+s.length))}class Ket{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof jet?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new jet(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new Xet(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new jet(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Uet(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof jet)return t;let e=new jet(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=K7.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=K7.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof jet||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new jet(0,-1));let i=t;for(let t of this.nodes)t instanceof jet&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new Ket(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class Jet{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&ntt(t,e,this.changes,5)}}function tit(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function eit(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class iit{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return J7.replace({widget:new sit(this.size,t)}).range(this.from,this.to)}}class sit extends Y7{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class nit{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Fet,this.scaler=dit,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Get.empty().applyChanges(t.facet(Btt),E.empty,this.heightOracle.setDoc(t.doc),[new Ltt(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=J7.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new rit(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?dit:new uit(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:fit(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(Btt),n=t.changedRanges,r=Ltt.extendWithRanges(n,function(t,e,i){let s=new Jet;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(Btt),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?Wtt.RTL:Wtt.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?eit:tit)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new $et(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new rit(s.lineAt(r-1e3*i,_et.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),_et.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,_et.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new rit(s.lineAt(i-500,_et.ByHeight,n,0,0).from,s.lineAt(i+r+500,_et.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new rit(this.heightMap.lineAt(i,_et.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,_et.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,_et.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,_et.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new iit(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=Wtt.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=oit(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=hit(r,(this.visibleTop-i.top-t)/i.height),n=hit(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=hit(r,(this.pixelViewport.left-e)/t),n=hit(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&ait(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&ait(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(cit(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new iit(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=lit(s,i)-lit(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){iit.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=J7.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Btt);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||fit(this.heightMap.lineAt(t,_et.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return fit(this.heightMap.lineAt(this.scaler.fromDOM(t),_et.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return fit(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class rit{constructor(t,e){this.from=t,this.to=e}}function oit(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(Btt),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function hit({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function lit(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function ait(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function cit(t,e){for(let i of t)if(e(i))return i}const dit={toDOM:t=>t,fromDOM:t=>t,scale:1};class uit{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,_et.ByPos,t,0,0).top,o=e.lineAt(n,_et.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function fit(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new qet(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>fit(t,e))):t.type)}const pit=et.define({combine:t=>t.join(" ")}),git=et.define({combine:t=>t.indexOf(!0)>-1}),mit=jt.newName(),wit=jt.newName(),vit=jt.newName(),yit={"&light":"."+wit,"&dark":"."+vit};function bit(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const Oit=bit("."+mit,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},yit),Sit={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},xit=W7.ie&&W7.ie_version<=11;class kit{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new d7,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(W7.ie&&W7.ie_version<=11||W7.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),xit&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Stt)?e.root.activeElement!=this.dom:!i7(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((W7.ie&&W7.ie_version<=11||W7.android&&W7.chrome)&&!e.state.selection.main.empty&&i.focusNode&&n7(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=t7(t),i=W7.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);n7(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Sit),xit&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),xit&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;m7(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&i7(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Ait(e,t.previousSibling||t.target.previousSibling,-1),s=Ait(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Ait(t,e,i){for(;e;){let s=b7.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function Mit(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Jtt(i,s)),n==i&&r==s||e.push(new Jtt(n,r)));return e}(t),c=new Ytt(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||W7.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(W7.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(Stt)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!e7(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!e7(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(W7.ios&&t.inputState.flushIOSKey(t))return;if(W7.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&m7(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&m7(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&m7(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(mtt).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=iet(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class Cit{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new nit(t.state||$t.create()),this.plugins=this.state.facet(Mtt).map((t=>new Dtt(t)));for(let t of this.plugins)t.update(this);this.observer=new kit(this,((t,e,i)=>{Mit(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new vet(this),this.docView=new tet(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new Vtt(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new ytt(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(wtt)?n=new ytt(t.value):t.is(vtt)?n=new ytt(t.value,"center"):t.is(btt)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=Eit.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Ptt)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(pit)!=e.state.facet(pit)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(gtt))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new nit(t),this.plugins=t.facet(Mtt).map((t=>new Dtt(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new tet(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Mtt),i=t.state.facet(Mtt);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new Dtt(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return Ott(this.state,t),Rit}})),o=new Vtt(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=Rit)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){Ott(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(gtt))t(e)}get themeClasses(){return mit+" "+(this.state.facet(git)?vit:wit)+" "+this.state.facet(pit)}updateAttrs(){let t=Bit(this,Rtt,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Stt)?"true":"false",class:"cm-content",style:`${W7.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Bit(this,Ett,e),this.observer.ignore((()=>{Z7(this.contentDOM,this.contentAttrs,e),Z7(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(Cit.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Ptt),jt.mount(this.root,this.styleModules.concat(Oit).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Dit(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Dit(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Dit(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return wet(this,t,met(this,t,e,i))}moveByGroup(t,e){return wet(this,t,met(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==Wtt.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=rtt.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return wet(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=pet(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:wtt.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),pet(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return a7(i,n[_tt.find(n,t-s.from,-1,e)].dir==Wtt.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Tit)return jtt(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Xtt(t.text,this.textDirection);return this.bidiCache.push(new Eit(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||W7.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{p7(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return btt.of(new ytt("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Ctt.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[pit.of(i),Ptt.of(bit(`.${i}`,t))];return e&&e.dark&&s.push(git.of(!0)),s}static baseTheme(t){return pt.lowest(Ptt.of(bit("."+mit,t,yit)))}}Cit.scrollTo=wtt,Cit.centerOn=vtt,Cit.styleModule=Ptt,Cit.inputHandler=mtt,Cit.exceptionSink=ptt,Cit.updateListener=gtt,Cit.editable=Stt,Cit.mouseSelectionStyle=ftt,Cit.dragMovesSelection=utt,Cit.clickAddsSelectionRange=dtt,Cit.decorations=Btt,Cit.darkTheme=git,Cit.contentAttributes=Ett,Cit.editorAttributes=Rtt,Cit.lineWrapping=Cit.contentAttributes.of({class:"cm-lineWrapping"}),Cit.announce=Et.define();const Tit=4096;function Dit(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Rit={};class Eit{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:Wtt.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new Eit(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Bit(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&j7(r,i)}return i}const Pit=W7.mac?"mac":W7.windows?"win":W7.linux?"linux":"key";function Lit(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const Vit=Cit.domEventHandlers({keydown:(t,e)=>Iit(Hit(e.state),t,e,"editor")}),Wit=et.define({enables:Vit}),Nit=new WeakMap;function Hit(t){let e=t.facet(Wit),i=Nit.get(e);return i||Nit.set(e,i=function(t,e=Pit){let i=Object.create(null),s=Object.create(null),n=(t,e)=>{let i=s[t];if(null==i)s[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,s,r,o)=>{let h=i[t]||(i[t]=Object.create(null)),l=s.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let s,n,r,o,h=i[i.length-1];"Space"==h&&(h=" ");for(let t=0;t<i.length-1;++t){const h=i[t];if(/^(cmd|meta|m)$/i.test(h))o=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))r=!0;else{if(!/^mod$/i.test(h))throw new Error("Unrecognized modifier name: "+h);"mac"==e?o=!0:n=!0}}return s&&(h="Alt-"+h),n&&(h="Ctrl-"+h),o&&(h="Meta-"+h),r&&(h="Shift-"+h),h}(t,e)));for(let e=1;e<l.length;e++){let i=l.slice(0,e).join(" ");n(i,!0),h[i]||(h[i]={preventDefault:!0,commands:[e=>{let s=Qit={view:e,prefix:i,scope:t};return setTimeout((()=>{Qit==s&&(Qit=null)}),4e3),!0}]})}let a=l.join(" ");n(a,!1);let c=h[a]||(h[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let Qit=null;function Iit(t,e,i,s){let n=xe(e),r=1==n.length&&" "!=n,o="",h=!1;Qit&&Qit.view==i&&Qit.scope==s&&(o=Qit.prefix+" ",(h=bet.indexOf(e.keyCode)<0)&&(Qit=null));let l,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(h=!0)}return!1},c=t[s];if(c){if(a(c[o+Lit(n,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(l=fe[e.keyCode])&&l!=n){if(a(c[o+Lit(l,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+Lit(n,e,!0)]))return!0}return h}const zit=!W7.ios;const Fit={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};zit&&(Fit[".cm-line"].caretColor="transparent !important");function $it(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function qit(t){let e=t.map((t=>"string"==typeof t?{label:t}:t)),[i,s]=e.every((t=>/^\w+$/.test(t.label)))?[/\w*$/,/\w+$/]:function(t){let e=Object.create(null),i=Object.create(null);for(let{label:s}of t){e[s[0]]=!0;for(let t=1;t<s.length;t++)i[s[t]]=!0}let s=$it(e)+$it(i)+"*$";return[new RegExp("^"+s),new RegExp(s)]}(e);return t=>{let n=t.matchBefore(s);return n||t.explicit?{from:n?n.from:t.pos,options:e,span:i}:null}}const _it=Cit.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Git{constructor(t,e,i,s){this.field=t,this.line=e,this.from=i,this.to=s}}class Xit{constructor(t,e,i){this.field=t,this.from=e,this.to=i}map(t){let e=t.mapPos(this.from,-1,z.TrackDel),i=t.mapPos(this.to,1,z.TrackDel);return null==e||null==i?null:new Xit(this.field,e,i)}}class jit{constructor(t,e){this.lines=t,this.fieldPositions=e}instantiate(t,e){let i=[],s=[e],n=t.doc.lineAt(e),r=/^\s*/.exec(n.text)[0];for(let n of this.lines){if(i.length){let i=r,o=/^\t*/.exec(n)[0].length;for(let e=0;e<o;e++)i+=t.facet(qw);s.push(e+i.length-o),n=i+n.slice(o)}i.push(n),e+=n.length+1}return{text:i,ranges:this.fieldPositions.map((t=>new Xit(t.field,s[t.line]+t.from,s[t.line]+t.to)))}}static parse(t){let e,i=[],s=[],n=[];for(let r of t.split(/\r\n?|\n/)){for(;e=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(r);){let t=e[1]?+e[1]:null,o=e[2]||e[3]||"",h=-1;for(let e=0;e<i.length;e++)(null!=t?i[e].seq==t:o&&i[e].name==o)&&(h=e);if(h<0){let e=0;for(;e<i.length&&(null==t||null!=i[e].seq&&i[e].seq<t);)e++;i.splice(e,0,{seq:t,name:o}),h=e;for(let t of n)t.field>=h&&t.field++}n.push(new Git(h,s.length,e.index,e.index+o.length)),r=r.slice(0,e.index)+o+r.slice(e.index+e[0].length)}s.push(r)}return new jit(s,n)}}let Uit=J7.widget({widget:new class extends Y7{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),Zit=J7.mark({class:"cm-snippetField"});class Yit{constructor(t,e){this.ranges=t,this.active=e,this.deco=J7.set(t.map((t=>(t.from==t.to?Uit:Zit).range(t.from,t.to))))}map(t){let e=[];for(let i of this.ranges){let s=i.map(t);if(!s)return null;e.push(s)}return new Yit(e,this.active)}selectionInsideField(t){return t.ranges.every((t=>this.ranges.some((e=>e.field==this.active&&e.from<=t.from&&e.to>=t.to))))}}const Kit=Et.define({map:(t,e)=>t&&t.map(e)}),Jit=Et.define(),tst=ht.define({create:()=>null,update(t,e){for(let i of e.effects){if(i.is(Kit))return i.value;if(i.is(Jit)&&t)return new Yit(t.ranges,i.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>Cit.decorations.from(t,(t=>t?t.deco:J7.none))});function est(t,e){return Y.create(t.filter((t=>t.field==e)).map((t=>Y.range(t.from,t.to))))}function ist(t){let e=jit.parse(t);return(t,i,s,n)=>{let{text:r,ranges:o}=e.instantiate(t.state,s),h={changes:{from:s,to:n,insert:E.of(r)}};if(o.length&&(h.selection=est(o,0)),o.length>1){let e=new Yit(o,0),i=h.effects=[Kit.of(e)];void 0===t.state.field(tst,!1)&&i.push(Et.appendConfig.of([tst,ost,lst,_it]))}t.dispatch(t.state.update(h))}}function sst(t){return({state:e,dispatch:i})=>{let s=e.field(tst,!1);if(!s||t<0&&0==s.active)return!1;let n=s.active+t,r=t>0&&!s.ranges.some((e=>e.field==n+t));return i(e.update({selection:est(s.ranges,n),effects:Kit.of(r?null:new Yit(s.ranges,n))})),!0}}const nst=[{key:"Tab",run:sst(1),shift:sst(-1)},{key:"Escape",run:({state:t,dispatch:e})=>!!t.field(tst,!1)&&(e(t.update({effects:Kit.of(null)})),!0)}],rst=et.define({combine:t=>t.length?t[0]:nst}),ost=pt.highest(Wit.compute([rst],(t=>t.facet(rst))));function hst(t,e){return Object.assign(Object.assign({},e),{apply:ist(t)})}const lst=Cit.domEventHandlers({mousedown(t,e){let i,s=e.state.field(tst,!1);if(!s||null==(i=e.posAtCoords({x:t.clientX,y:t.clientY})))return!1;let n=s.ranges.find((t=>t.from<=i&&t.to>=i));return!(!n||n.field==s.active)&&(e.dispatch({selection:est(s.ranges,n.field),effects:Kit.of(s.ranges.some((t=>t.field>n.field))?new Yit(s.ranges,n.field):null)}),!0)}});const ast=[hst("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),hst("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),hst("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),hst("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"block",type:"keyword"}),hst("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),hst('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),hst('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],cst=Ew.define({parser:J6.configure({props:[Uw.add({IfStatement:sv({except:/^\s*({|else\b)/}),TryStatement:sv({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:t=>t.baseIndent,SwitchBody:t=>{let e=t.textAfter,i=/^\s*\}/.test(e),s=/^\s*(case|default)\b/.test(e);return t.baseIndent+(i?0:s?1:2)*t.unit},Block:ev({closing:"}"}),ArrowFunction:t=>t.baseIndent+t.unit,"TemplateString BlockComment":()=>-1,"Statement Property":sv({except:/^{/}),JSXElement(t){let e=/^\s*<\//.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},JSXEscape(t){let e=/\s*\}/.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},"JSXOpenTag JSXSelfClosingTag":t=>t.column(t.node.from)+t.unit}),ov.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression":function(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null},BlockComment:t=>({from:t.from+2,to:t.to-2})}),jY({"get set async static":SK.modifier,"for while do if else switch try catch finally return throw break continue default case":SK.controlKeyword,"in of await yield void typeof delete instanceof":SK.operatorKeyword,"let var const function class extends":SK.definitionKeyword,"import export from":SK.moduleKeyword,"with debugger as new":SK.keyword,TemplateString:SK.special(SK.string),Super:SK.atom,BooleanLiteral:SK.bool,this:SK.self,null:SK.null,Star:SK.modifier,VariableName:SK.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":SK.function(SK.variableName),VariableDefinition:SK.definition(SK.variableName),Label:SK.labelName,PropertyName:SK.propertyName,PrivatePropertyName:SK.special(SK.propertyName),"CallExpression/MemberExpression/PropertyName":SK.function(SK.propertyName),"FunctionDeclaration/VariableDefinition":SK.function(SK.definition(SK.variableName)),"ClassDeclaration/VariableDefinition":SK.definition(SK.className),PropertyDefinition:SK.definition(SK.propertyName),PrivatePropertyDefinition:SK.definition(SK.special(SK.propertyName)),UpdateOp:SK.updateOperator,LineComment:SK.lineComment,BlockComment:SK.blockComment,Number:SK.number,String:SK.string,ArithOp:SK.arithmeticOperator,LogicOp:SK.logicOperator,BitOp:SK.bitwiseOperator,CompareOp:SK.compareOperator,RegExp:SK.regexp,Equals:SK.definitionOperator,"Arrow : Spread":SK.punctuation,"( )":SK.paren,"[ ]":SK.squareBracket,"{ }":SK.brace,"InterpolationStart InterpolationEnd":SK.special(SK.brace),".":SK.derefOperator,", ;":SK.separator,TypeName:SK.typeName,TypeDefinition:SK.definition(SK.typeName),"type enum interface implements namespace module declare":SK.definitionKeyword,"abstract global Privacy readonly override":SK.modifier,"is keyof unique infer":SK.operatorKeyword,JSXAttributeValue:SK.attributeValue,JSXText:SK.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":SK.angleBracket,"JSXIdentifier JSXNameSpacedName":SK.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":SK.attributeName})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),dst=cst.configure({dialect:"ts"}),ust=cst.configure({dialect:"jsx"}),fst=cst.configure({dialect:"jsx ts"});class pst{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),mst.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),mst.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new yst(this),n=new yst(t);for(let t=e,r=e;;){if(s.next(t),n.next(t),t=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(r+=s.value.length,s.done||r>=i)return!0}}iter(t=1){return new yst(this,t)}iterRange(t,e=this.length){return new bst(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new Ost(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new gst(t):mst.from(gst.split(t,[])):pst.empty}}class gst extends pst{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((e?i:o)>=t)return new Sst(s,o,i,r);s=o+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new gst(vst(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&s){let t=i.pop(),e=wst(n.text,t.text.slice(),0,n.length);if(e.length<=32)i.push(new gst(e,t.length+n.length));else{let t=e.length>>1;i.push(new gst(e.slice(0,t)),new gst(e.slice(t)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof gst))return super.replace(t,e,i);let s=wst(this.text,wst(i.text,vst(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new gst(s,n):mst.from(gst.split(s,[]),n)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<=e&&r<this.text.length;r++){let o=this.text[r],h=n+o.length;n>t&&r&&(s+=i),t<h&&e>n&&(s+=o.slice(Math.max(0,t-n),e-n)),n=h+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,32==i.length&&(e.push(new gst(i,s)),i=[],s=-1);return s>-1&&e.push(new gst(i,s)),e}}class mst extends pst{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,h=i+r.lines-1;if((e?h:o)>=t)return r.lineInner(t,e,i,s);s=o+1,i=h+1}}decompose(t,e,i,s){for(let n=0,r=0;r<=e&&n<this.children.length;n++){let o=this.children[n],h=r+o.length;if(t<=h&&e>=r){let n=s&((r<=t?1:0)|(h>=e?2:0));r>=t&&h<=e&&!n?i.push(o):o.decompose(t-r,e-r,i,n)}r=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(t>=n&&e<=o){let h=r.replace(t-n,e-n,i),l=this.lines-r.lines+h.lines;if(h.lines<l>>4&&h.lines>l>>6){let n=this.children.slice();return n[s]=h,new mst(n,this.length-(e-t)+i.length)}return super.replace(n,o,h)}n=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=e;n++){let o=this.children[n],h=r+o.length;r>t&&n&&(s+=i),t<h&&e>r&&(s+=o.sliceString(t-r,e-r,i)),r=h+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof mst))return 0;let i=0,[s,n,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==r||n==o)return i;let h=this.children[s],l=t.children[n];if(h!=l)return i+h.scanIdentical(l,e);i+=h.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new gst(i,e)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],h=0,l=-1,a=[];function c(t){let e;if(t.lines>n&&t instanceof mst)for(let e of t.children)c(e);else t.lines>r&&(h>r||!h)?(d(),o.push(t)):t instanceof gst&&h&&(e=a[a.length-1])instanceof gst&&t.lines+e.lines<=32?(h+=t.lines,l+=t.length+1,a[a.length-1]=new gst(e.text.concat(t.text),e.length+1+t.length)):(h+t.lines>s&&d(),h+=t.lines,l+=t.length+1,a.push(t))}function d(){0!=h&&(o.push(1==a.length?a[0]:mst.from(a,l)),l=-1,h=a.length=0)}for(let e of t)c(e);return d(),1==o.length?o[0]:new mst(o,e)}}function wst(t,e,i=0,s=1e9){for(let n=0,r=0,o=!0;r<t.length&&n<=s;r++){let h=t[r],l=n+h.length;l>=i&&(l>s&&(h=h.slice(0,s-n)),n<i&&(h=h.slice(i-n)),o?(e[e.length-1]+=h,o=!1):e.push(h)),n=l+1}return e}function vst(t,e,i){return wst(t,[""],e,i)}pst.empty=new gst([""],0);class yst{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof gst?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof gst?s.text.length:s.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(s instanceof gst){let n=s.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,n.length>Math.max(0,t))return this.value=0==t?n:e>0?n.slice(t):n.slice(0,n.length-t),this;t-=n.length}else{let n=s.children[r+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof gst?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class bst{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new yst(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class Ost{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(pst.prototype[Symbol.iterator]=function(){return this.iter()},yst.prototype[Symbol.iterator]=bst.prototype[Symbol.iterator]=Ost.prototype[Symbol.iterator]=function(){return this});class Sst{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}let xst="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let t=1;t<xst.length;t++)xst[t]+=xst[t-1];function kst(t){for(let e=1;e<xst.length;e+=2)if(xst[e]>t)return xst[e-1]<=t;return!1}function Ast(t){return t>=127462&&t<=127487}function Mst(t,e,i=!0,s=!0){return(i?Cst:Tst)(t,e,s)}function Cst(t,e,i){if(e==t.length)return e;e&&Dst(t.charCodeAt(e))&&Rst(t.charCodeAt(e-1))&&e--;let s=Est(t,e);for(e+=Pst(s);e<t.length;){let n=Est(t,e);if(8205==s||8205==n||i&&kst(n))e+=Pst(n),s=n;else{if(!Ast(n))break;{let i=0,s=e-2;for(;s>=0&&Ast(Est(t,s));)i++,s-=2;if(i%2==0)break;e+=2}}}return e}function Tst(t,e,i){for(;e>0;){let s=Cst(t,e-2,i);if(s<e)return s;e--}return 0}function Dst(t){return t>=56320&&t<57344}function Rst(t){return t>=55296&&t<56320}function Est(t,e){let i=t.charCodeAt(e);if(!Rst(i)||e+1==t.length)return i;let s=t.charCodeAt(e+1);return Dst(s)?s-56320+(i-55296<<10)+65536:i}function Bst(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function Pst(t){return t<65536?1:2}const Lst=/\r\n?|\n/;var Vst=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(Vst||(Vst={}));class Wst{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?(t(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(t,e=!1){Ist(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new Wst(t)}composeDesc(t){return this.empty?t:t.empty?this:Fst(this,t)}mapDesc(t,e=!1){return t.empty?this:zst(this,t,e)}mapPos(t,e=-1,i=Vst.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],h=this.sections[r++],l=s+o;if(h<0){if(l>t)return n+(t-s);n+=o}else{if(i!=Vst.Simple&&l>=t&&(i==Vst.TrackDel&&s<t&&l>t||i==Vst.TrackBefore&&s<t||i==Vst.TrackAfter&&l>t))return null;if(l>t||l==t&&e<0&&!o)return t==s||e<0?n:n+h;n+=h}s=l}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&n>=t)return!(s<t&&n>e)||"cover";s=n}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Wst(t)}}class Nst extends Wst{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Ist(this,((e,i,s,n,r)=>t=t.replace(s,s+(i-e),r)),!1),t}mapDesc(t,e=!1){return zst(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let r=e[s],o=e[s+1];if(o>=0){e[s]=o,e[s+1]=r;let h=s>>1;for(;i.length<h;)i.push(pst.empty);i.push(r?t.slice(n,n+r):pst.empty)}n+=r}return new Nst(e,i)}compose(t){return this.empty?t:t.empty?this:Fst(this,t,!0)}map(t,e=!1){return t.empty?this:zst(this,t,e,!0)}iterChanges(t,e=!1){Ist(this,t,e)}get desc(){return new Wst(this.sections)}filter(t){let e=[],i=[],s=[],n=new $st(this);t:for(let r=0,o=0;;){let h=r==t.length?1e9:t[r++];for(;o<h||o==h&&0==n.len;){if(n.done)break t;let t=Math.min(n.len,h-o);Hst(s,t,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;Hst(e,t,r),r>0&&Qst(i,e,n.text),n.forward(t),o+=t}let l=t[r++];for(;o<l;){if(n.done)break t;let t=Math.min(n.len,l-o);Hst(e,t,-1),Hst(s,t,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(t),o+=t}}return{changes:new Nst(e,i),filtered:new Wst(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],r=0,o=null;function h(t=!1){if(!t&&!s.length)return;r<e&&Hst(s,e-r,-1);let i=new Nst(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function t(l){if(Array.isArray(l))for(let e of l)t(e);else if(l instanceof Nst){if(l.length!=e)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${e})`);h(),o=o?o.compose(l.map(o)):l}else{let{from:t,to:o=t,insert:a}=l;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=a?"string"==typeof a?pst.of(a.split(i||Lst)):a:pst.empty,d=c.length;if(t==o&&0==d)return;t<r&&h(),t>r&&Hst(s,t-r,-1),Hst(s,o-t,d),Qst(n,s,c),r=o}}(t),h(!o),o}static empty(t){return new Nst(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if("number"==typeof n)e.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)e.push(n[0],0);else{for(;i.length<s;)i.push(pst.empty);i[s]=pst.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new Nst(e,i)}}function Hst(t,e,i,s=!1){if(0==e&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:0==e&&0==t[n]?t[n+1]+=i:s?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function Qst(t,e,i){if(0==i.length)return;let s=e.length-2>>1;if(s<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<s;)t.push(pst.empty);t.push(i)}}function Ist(t,e,i){let s=t.inserted;for(let n=0,r=0,o=0;o<t.sections.length;){let h=t.sections[o++],l=t.sections[o++];if(l<0)n+=h,r+=h;else{let a=n,c=r,d=pst.empty;for(;a+=h,c+=l,l&&s&&(d=d.append(s[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)h=t.sections[o++],l=t.sections[o++];e(n,a,r,c,d),n=a,r=c}}}function zst(t,e,i,s=!1){let n=[],r=s?[]:null,o=new $st(t),h=new $st(e);for(let t=0,e=0;;)if(-1==o.ins)t+=o.len,o.next();else if(-1==h.ins&&e<t){let i=Math.min(h.len,t-e);h.forward(i),Hst(n,i,-1),e+=i}else if(h.ins>=0&&(o.done||e<t||e==t&&(h.len<o.len||h.len==o.len&&!i))){for(Hst(n,h.ins,-1);t>e&&!o.done&&t+o.len<e+h.len;)t+=o.len,o.next();e+=h.len,h.next()}else{if(!(o.ins>=0)){if(o.done&&h.done)return r?new Nst(n,r):new Wst(n);throw new Error("Mismatched change set lengths")}{let i=0,s=t+o.len;for(;;)if(h.ins>=0&&e>t&&e+h.len<s)i+=h.ins,e+=h.len,h.next();else{if(!(-1==h.ins&&e<s))break;{let t=Math.min(h.len,s-e);i+=t,h.forward(t),e+=t}}Hst(n,i,o.ins),r&&Qst(r,n,o.text),t=s,o.next()}}}function Fst(t,e,i=!1){let s=[],n=i?[]:null,r=new $st(t),o=new $st(e);for(let t=!1;;){if(r.done&&o.done)return n?new Nst(s,n):new Wst(s);if(0==r.ins)Hst(s,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=s.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;Hst(s,e,i,t),n&&i&&Qst(n,s,o.text)}else-1==o.ins?(Hst(s,r.off?0:r.len,e,t),n&&Qst(n,s,r.textBit(e))):(Hst(s,r.off?0:r.len,o.off?0:o.ins,t),n&&!o.off&&Qst(n,s,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||s.length>i),r.forward2(e),o.forward(e)}}else Hst(s,0,o.ins,t),n&&Qst(n,s,o.text),o.next()}}class $st{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?pst.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?pst.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class qst{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new qst(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return _st.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return _st.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return _st.range(t.anchor,t.head)}}class _st{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:_st.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new _st([this.main])}addRange(t,e=!0){return _st.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,_st.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new _st(t.ranges.map((t=>qst.fromJSON(t))),t.main)}static single(t,e=t){return new _st([_st.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return Gst(t.slice(),e);i=n.to}return new _st(t,e)}static cursor(t,e=0,i,s){return new qst(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(t,e,i){let s=(null!=i?i:33554431)<<5;return e<t?new qst(e,t,24|s):new qst(t,e,s|(e>t?4:0))}}function Gst(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let s=t[i],n=t[i-1];if(s.empty?s.from<=n.to:s.from<n.to){let r=n.from,o=Math.max(s.to,n.to);i<=e&&e--,t.splice(--i,2,s.anchor>s.head?_st.range(o,r):_st.range(r,o))}}return new _st(t,e)}function Xst(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let jst=0;class Ust{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.extensions=n,this.id=jst++,this.default=t([])}static define(t={}){return new Ust(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:Zst),!!t.static,t.enables)}of(t){return new Yst([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Yst(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Yst(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function Zst(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class Yst{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=jst++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,r=t[n]>>1,o=2==this.type,h=!1,l=!1,a=[];for(let i of this.dependencies)"doc"==i?h=!0:"selection"==i?l=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&a.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(h&&e.docChanged||l&&(e.docChanged||e.selection)||Jst(t,a)){let e=i(t);if(o?!Kst(e,t.values[r],s):!s(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure:(t,e)=>{let h=i(t),l=e.config.address[n];if(null!=l){let i=dnt(e,l);if(this.dependencies.every((i=>i instanceof Ust?e.facet(i)===t.facet(i):!(i instanceof int)||e.field(i,!1)==t.field(i,!1)))||(o?Kst(h,i,s):s(h,i)))return t.values[r]=i,0}return t.values[r]=h,1}}}}function Kst(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function Jst(t,e){let i=!1;for(let s of e)1&cnt(t,s)&&(i=!0);return i}function tnt(t,e,i){let s=i.map((e=>t[e.id])),n=i.map((t=>t.type)),r=s.filter((t=>!(1&t))),o=t[e.id]>>1;function h(t){let i=[];for(let e=0;e<s.length;e++){let r=dnt(t,s[e]);if(2==n[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of s)cnt(t,e);return t.values[o]=h(t),1},update(t,i){if(!Jst(t,r))return 0;let s=h(t);return e.compare(s,t.values[o])?0:(t.values[o]=s,1)},reconfigure(t,n){let r=Jst(t,s),l=n.config.facets[e.id],a=n.facet(e);if(l&&!r&&Zst(i,l))return t.values[o]=a,0;let c=h(t);return e.compare(c,a)?(t.values[o]=a,0):(t.values[o]=c,1)}}}const ent=Ust.define({static:!0});class int{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new int(jst++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(ent).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],n=this.updateF(s,i);return this.compareF(s,n)?0:(t.values[e]=n,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,ent.of({field:this,create:t})]}get extension(){return this}}const snt=2;function nnt(t){return e=>new ont(e,t)}const rnt=nnt(0);class ont{constructor(t,e){this.inner=t,this.prec=e}}class hnt{of(t){return new lnt(this,t)}reconfigure(t){return hnt.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class lnt{constructor(t,e){this.compartment=t,this.inner=e}}class ant{constructor(t,e,i,s,n,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),r=new Map;for(let i of function(t,e,i){let s=[[],[],[],[],[]],n=new Map;function r(t,o){let h=n.get(t);if(null!=h){if(h<=o)return;let e=s[h].indexOf(t);e>-1&&s[h].splice(e,1),t instanceof lnt&&i.delete(t.compartment)}if(n.set(t,o),Array.isArray(t))for(let e of t)r(e,o);else if(t instanceof lnt){if(i.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(t.compartment)||t.inner;i.set(t.compartment,s),r(s,o)}else if(t instanceof ont)r(t.inner,t.prec);else if(t instanceof int)s[o].push(t),t.provides&&r(t.provides,o);else if(t instanceof Yst)s[o].push(t),t.facet.extensions&&r(t.facet.extensions,o);else{let e=t.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(e,o)}}return r(t,snt),s.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof int?s.push(i):(n[i.facet.id]||(n[i.facet.id]=[])).push(i);let o=Object.create(null),h=[],l=[];for(let t of s)o[t.id]=l.length<<1,l.push((e=>t.slot(e)));let a=null==i?void 0:i.config.facets;for(let t in n){let e=n[t],s=e[0].facet,r=a&&a[t]||[];if(e.every((t=>0==t.type)))if(o[s.id]=h.length<<1|1,Zst(r,e))h.push(i.facet(s));else{let t=s.combine(e.map((t=>t.value)));h.push(i&&s.compare(t,i.facet(s))?i.facet(s):t)}else{for(let t of e)0==t.type?(o[t.id]=h.length<<1|1,h.push(t.value)):(o[t.id]=l.length<<1,l.push((e=>t.dynamicSlot(e))));o[s.id]=l.length<<1,l.push((t=>tnt(t,s,e)))}}let c=l.map((t=>t(o)));return new ant(t,r,c,o,h,n)}}function cnt(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function dnt(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const unt=Ust.define(),fnt=Ust.define({combine:t=>t.some((t=>t)),static:!0}),pnt=Ust.define({combine:t=>t.length?t[0]:void 0,static:!0}),gnt=Ust.define(),mnt=Ust.define(),wnt=Ust.define(),vnt=Ust.define({combine:t=>!!t.length&&t[0]});class ynt{constructor(t,e){this.type=t,this.value=e}static define(){return new bnt}}class bnt{of(t){return new ynt(this,t)}}class Ont{constructor(t){this.map=t}of(t){return new Snt(this,t)}}class Snt{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new Snt(this.type,e)}is(t){return this.type==t}static define(t={}){return new Ont(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}Snt.reconfigure=Snt.define(),Snt.appendConfig=Snt.define();class xnt{constructor(t,e,i,s,n,r){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&Xst(i,e.newLength),n.some((t=>t.type==xnt.time))||(this.annotations=n.concat(xnt.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(xnt.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function knt(t,e){let i=[];for(let s=0,n=0;;){let r,o;if(s<t.length&&(n==e.length||e[n]>=t[s]))r=t[s++],o=t[s++];else{if(!(n<e.length))return i;r=e[n++],o=e[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function Ant(t,e,i){var s;let n,r,o;return i?(n=e.changes,r=Nst.empty(e.changes.length),o=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):null===(s=t.selection)||void 0===s?void 0:s.map(n),effects:Snt.mapEffects(t.effects,n).concat(Snt.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Mnt(t,e,i){let s=e.selection,n=Dnt(e.annotations);return e.userEvent&&(n=n.concat(xnt.userEvent.of(e.userEvent))),{changes:e.changes instanceof Nst?e.changes:Nst.of(e.changes||[],i,t.facet(pnt)),selection:s&&(s instanceof _st?s:_st.single(s.anchor,s.head)),effects:Dnt(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function Cnt(t,e,i){let s=Mnt(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=Ant(s,Mnt(t,e[n],r?s.changes.newLength:t.doc.length),r)}let n=new xnt(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(wnt),s=t;for(let n=i.length-1;n>=0;n--){let r=i[n](t);r&&Object.keys(r).length&&(s=Ant(t,Mnt(e,r,t.changes.newLength),!0))}return s==t?t:new xnt(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let s of e.facet(gnt)){let e=s(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:knt(i,e))}if(!0!==i){let s,n;if(!1===i)n=t.changes.invertedDesc,s=Nst.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,n=e.filtered.invertedDesc}t=new xnt(e,s,t.selection&&t.selection.map(n),Snt.mapEffects(t.effects,n),t.annotations,t.scrollIntoView)}let s=e.facet(mnt);for(let i=s.length-1;i>=0;i--){let n=s[i](t);t=n instanceof xnt?n:Array.isArray(n)&&1==n.length&&n[0]instanceof xnt?n[0]:Cnt(e,Dnt(n),!1)}return t}(n):n)}xnt.time=ynt.define(),xnt.userEvent=ynt.define(),xnt.addToHistory=ynt.define(),xnt.remote=ynt.define();const Tnt=[];function Dnt(t){return null==t?Tnt:Array.isArray(t)?t:[t]}var Rnt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Rnt||(Rnt={}));const Ent=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Bnt;try{Bnt=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function Pnt(t){return e=>{if(!/\S/.test(e))return Rnt.Space;if(function(t){if(Bnt)return Bnt.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Ent.test(i)))return!0}return!1}(e))return Rnt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return Rnt.Word;return Rnt.Other}}class Lnt{constructor(t,e,i,s,n,r){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)cnt(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return cnt(this,i),dnt(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return Cnt(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:n}=i;for(let e of t.effects)e.is(hnt.reconfigure)?(i&&(n=new Map,i.compartments.forEach(((t,e)=>n.set(e,t))),i=null),n.set(e.value.compartment,e.value.extension)):e.is(Snt.reconfigure)?(i=null,s=e.value):e.is(Snt.appendConfig)&&(i=null,s=Dnt(s).concat(e.value));if(i)e=t.startState.values.slice();else{i=ant.resolve(s,n,this),e=new Lnt(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values}new Lnt(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:_st.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],r=Dnt(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),h=this.changes(o.changes),l=h.map(s);for(let t=0;t<i;t++)n[t]=n[t].map(l);let a=s.mapDesc(h,!0);n.push(o.range.map(a)),s=s.compose(l),r=Snt.mapEffects(r,l).concat(Snt.mapEffects(Dnt(o.effects),a))}return{changes:s,selection:_st.create(n,e.mainIndex),effects:r}}changes(t=[]){return t instanceof Nst?t:Nst.of(t,this.doc.length,this.facet(Lnt.lineSeparator))}toText(t){return pst.of(t.split(this.facet(Lnt.lineSeparator)||Lst))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(cnt(this,e),dnt(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof int&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let e in i){let n=i[e],r=t[e];s.push(n.init((t=>n.spec.fromJSON(r,t))))}return Lnt.create({doc:t.doc,selection:_st.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=ant.resolve(t.extensions||[],new Map),i=t.doc instanceof pst?t.doc:pst.of((t.doc||"").split(e.staticFacet(Lnt.lineSeparator)||Lst)),s=t.selection?t.selection instanceof _st?t.selection:_st.single(t.selection.anchor,t.selection.head):_st.single(0);return Xst(s,i.length),e.staticFacet(fnt)||(s=s.asSingle()),new Lnt(e,i,s,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet(Lnt.tabSize)}get lineBreak(){return this.facet(Lnt.lineSeparator)||"\n"}get readOnly(){return this.facet(vnt)}phrase(t){for(let e of this.facet(Lnt.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(unt))for(let r of n(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&s.push(r[t]);return s}charCategorizer(t){return Pnt(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),r=t-i,o=t-i;for(;r>0;){let t=Mst(e,r,!1);if(n(e.slice(t,r))!=Rnt.Word)break;r=t}for(;o<s;){let t=Mst(e,o);if(n(e.slice(o,t))!=Rnt.Word)break;o=t}return r==o?null:_st.range(r+i,o+i)}}function Vnt(t,e,i={}){let s={};for(let e of t)for(let t of Object.keys(e)){let n=e[t],r=s[t];if(void 0===r)s[t]=n;else if(r===n||void 0===n);else{if(!Object.hasOwnProperty.call(i,t))throw new Error("Config merge conflict for field "+t);s[t]=i[t](r,n)}}for(let t in e)void 0===s[t]&&(s[t]=e[t]);return s}Lnt.allowMultipleSelections=fnt,Lnt.tabSize=Ust.define({combine:t=>t.length?t[0]:4}),Lnt.lineSeparator=pnt,Lnt.readOnly=vnt,Lnt.phrases=Ust.define({compare(t,e){let i=Object.keys(t),s=Object.keys(e);return i.length==s.length&&i.every((i=>t[i]==e[i]))}}),Lnt.languageData=unt,Lnt.changeFilter=gnt,Lnt.transactionFilter=mnt,Lnt.transactionExtender=wnt,hnt.reconfigure=Snt.define();class Wnt{eq(t){return this==t}range(t,e=t){return new Nnt(t,e,this)}}Wnt.prototype.startSide=Wnt.prototype.endSide=0,Wnt.prototype.point=!1,Wnt.prototype.mapMode=Vst.TrackDel;class Nnt{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function Hnt(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class Qnt{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,h=n[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==r)return h>=0?r:o;h>=0?o=s:r=s+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+t,this.to[n]+t,this.value[n]))return!1}map(t,e){let i=[],s=[],n=[],r=-1,o=-1;for(let h=0;h<this.value.length;h++){let l,a,c=this.value[h],d=this.from[h]+t,u=this.to[h]+t;if(d==u){let t=e.mapPos(d,c.startSide,c.mapMode);if(null==t)continue;if(l=a=t,c.startSide!=c.endSide&&(a=e.mapPos(d,c.endSide),a<l))continue}else if(l=e.mapPos(d,c.startSide),a=e.mapPos(u,c.endSide),l>a||l==a&&c.startSide>0&&c.endSide<=0)continue;(a-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,a-l)),i.push(c),s.push(l-r),n.push(a-r))}return{mapped:i.length?new Qnt(s,n,i,o):null,pos:r}}}class Int{constructor(t,e,i=Int.empty,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(Hnt)),this.isEmpty)return e.length?Int.of(e):this;let o=new $nt(this,null,-1).goto(0),h=0,l=[],a=new znt;for(;o.value||h<e.length;)if(h<e.length&&(o.from-e[h].from||o.startSide-e[h].value.startSide)>=0){let t=e[h++];a.addInner(t.from,t.to,t.value)||l.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(o.chunkIndex)<e[h].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&a.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(a.addInner(o.from,o.to,o.value)||l.push(new Nnt(o.from,o.to,o.value))),o.next());return a.finishInner(this.nextLayer.isEmpty&&!l.length?Int.empty:this.nextLayer.update({add:l,filter:r,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n],h=t.touchesRange(r,r+o.length);if(!1===h)s=Math.max(s,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===h){let{mapped:n,pos:h}=o.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(h))}}let n=this.nextLayer.map(t);return 0==e.length?n:new Int(i,e,n,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(e>=n&&t<=n+r.length&&!1===r.between(n,t-n,e-n,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return qnt.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return qnt.from(t).goto(e)}static compare(t,e,i,s,n=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),h=Fnt(r,o,i),l=new Gnt(r,h,n),a=new Gnt(o,h,n);i.iterGaps(((t,e,i)=>Xnt(l,t,a,e,i,s))),i.empty&&0==i.length&&Xnt(l,0,a,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=1e9);let n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(n.length!=r.length)return!1;if(!n.length)return!0;let o=Fnt(n,r),h=new Gnt(n,o,0).goto(i),l=new Gnt(r,o,0).goto(i);for(;;){if(h.to!=l.to||!jnt(h.active,l.active)||h.point&&(!l.point||!h.point.eq(l.point)))return!1;if(h.to>s)return!0;h.next(),l.next()}}static spans(t,e,i,s,n=-1){let r=new Gnt(t,null,n).goto(e),o=e,h=r.openStart;for(;;){let t=Math.min(r.to,i);if(r.point?(s.point(o,t,r.point,r.activeForPoint(r.to),h,r.pointRank),h=r.openEnd(t)+(r.to>t?1:0)):t>o&&(s.span(o,t,r.active,h),h=r.openEnd(t)),r.to>i)break;o=r.to,r.next()}return h}static of(t,e=!1){let i=new znt;for(let s of t instanceof Nnt?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(Hnt(e,s)>0)return t.slice().sort(Hnt);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}}Int.empty=new Int([],[],null,-1),Int.empty.nextLayer=Int.empty;class znt{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Qnt(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new znt)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Int.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=new Int(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Fnt(t,e,i){let s=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&s.set(e.chunk[t],e.chunkPos[t]);let n=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=s.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||n.add(t.chunk[e])}return n}class $nt{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class qnt{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let r=t[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new $nt(r,e,i,n));return 1==s.length?s[0]:new qnt(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)_nt(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)_nt(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),_nt(this.heap,0)}}}function _nt(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let n=t[s];if(s+1<t.length&&n.compare(t[s+1])>=0&&(n=t[s+1],s++),i.compare(n)<0)break;t[s]=i,t[e]=n,e=s}}class Gnt{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=qnt.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Unt(this.active,t),Unt(this.activeTo,t),Unt(this.activeRank,t),this.minActive=Ynt(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;Znt(this.active,e,i),Znt(this.activeTo,e,s),Znt(this.activeRank,e,n),t&&Znt(t,e,this.cursor.from),this.minActive=Ynt(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>t){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&Unt(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let n=this.cursor.value;if(n.point){if(!(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.from<t&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let e=0;for(;e<i.length&&i[e]<t;)e++;this.openStart=e+s}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Xnt(t,e,i,s,n,r){t.goto(e),i.goto(s);let o=s+n,h=s,l=s-e;for(;;){let e=t.to+l-i.to||t.endSide-i.endSide,s=e<0?t.to+l:i.to,n=Math.min(s,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&jnt(t.activeForPoint(t.to+l),i.activeForPoint(i.to))||r.comparePoint(h,n,t.point,i.point):n>h&&!jnt(t.active,i.active)&&r.compareRange(h,n,t.active,i.active),s>o)break;h=s,e<=0&&t.next(),e>=0&&i.next()}}function jnt(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function Unt(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function Znt(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function Ynt(t,e){let i=-1,s=1e9;for(let n=0;n<e.length;n++)(e[n]-s||t[n].endSide-t[i].endSide)<0&&(i=n,s=e[n]);return i}const Knt=1024;let Jnt=0;class trt{constructor(t,e){this.from=t,this.to=e}}class ert{constructor(t={}){this.id=Jnt++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=srt.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}ert.closedBy=new ert({deserialize:t=>t.split(" ")}),ert.openedBy=new ert({deserialize:t=>t.split(" ")}),ert.group=new ert({deserialize:t=>t.split(" ")}),ert.contextHash=new ert({perNode:!0}),ert.lookAhead=new ert({perNode:!0}),ert.mounted=new ert({perNode:!0});const irt=Object.create(null);class srt{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):irt,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new srt(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(ert.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(ert.group),s=-1;s<(i?i.length:0);s++){let n=e[s<0?t.name:i[s]];if(n)return n}}}}srt.none=new srt("",Object.create(null),0,8);const nrt=new WeakMap,rrt=new WeakMap;var ort;!function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"}(ort||(ort={}));class hrt{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[t,e]of n)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(ert.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new vrt(this.topNode,t)}cursorAt(t,e=0,i=0){let s=nrt.get(this)||this.topNode,n=new vrt(s);return n.moveTo(t,e),nrt.set(this,n._tree),n}get topNode(){return new frt(this,0,0,null)}resolve(t,e=0){let i=urt(nrt.get(this)||this.topNode,t,e,!1);return nrt.set(this,i),i}resolveInner(t,e=0){let i=urt(rrt.get(this)||this.topNode,t,e,!0);return rrt.set(this,i),i}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t;for(let r=this.cursor((t.mode||0)|ort.IncludeAnonymous);;){let t=!1;if(r.from<=n&&r.to>=s&&(r.type.isAnonymous||!1!==e(r))){if(r.firstChild())continue;t=!0}for(;t&&i&&!r.type.isAnonymous&&i(r),!r.nextSibling();){if(!r.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Srt(srt.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new hrt(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new hrt(srt.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,maxBufferLength:n=Knt,reused:r=[],minRepeatType:o=s.types.length}=t,h=Array.isArray(i)?new lrt(i,i.length):i,l=s.types,a=0,c=0;function d(t,e,i,w,v){let{id:y,start:b,end:O,size:S}=h,x=c;for(;S<0;){if(h.next(),-1==S){let e=r[y];return i.push(e),void w.push(b-t)}if(-3==S)return void(a=y);if(-4==S)return void(c=y);throw new RangeError(`Unrecognized record size: ${S}`)}let k,A,M=l[y],C=b-t;if(O-b<=n&&(A=g(h.pos-e,v))){let e=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=e.length;for(;h.pos>i;)n=m(A.start,e,n);k=new art(e,O-A.start,s),C=A.start-t}else{let t=h.pos-S;h.next();let e=[],i=[],s=y>=o?y:-1,r=0,l=O;for(;h.pos>t;)s>=0&&h.id==s&&h.size>=0?(h.end<=l-n&&(f(e,i,b,r,h.end,l,s,x),r=e.length,l=h.end),h.next()):d(b,t,e,i,s);if(s>=0&&r>0&&r<e.length&&f(e,i,b,r,b,l,s,x),e.reverse(),i.reverse(),s>-1&&r>0){let t=u(M);k=Srt(M,e,i,0,e.length,0,O-b,t,t)}else k=p(M,e,i,O-b,x-O)}i.push(k),w.push(C)}function u(t){return(e,i,s)=>{let n,r,o=0,h=e.length-1;if(h>=0&&(n=e[h])instanceof hrt){if(!h&&n.type==t&&n.length==s)return n;(r=n.prop(ert.lookAhead))&&(o=i[h]+n.length+r)}return p(t,e,i,s,o)}}function f(t,e,i,n,r,o,h,l){let a=[],c=[];for(;t.length>n;)a.push(t.pop()),c.push(e.pop()+i-r);t.push(p(s.types[h],a,c,o-r,l-o)),e.push(r-i)}function p(t,e,i,s,n=0,r){if(a){let t=[ert.contextHash,a];r=r?[t].concat(r):[t]}if(n>25){let t=[ert.lookAhead,n];r=r?[t].concat(r):[t]}return new hrt(t,e,i,s,r)}function g(t,e){let i=h.fork(),s=0,r=0,l=0,a=i.end-n,c={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){let t=i.size;if(i.id==e&&t>=0){c.size=s,c.start=r,c.skip=l,l+=4,s+=4,i.next();continue}let h=i.pos-t;if(t<0||h<n||i.start<a)break;let d=i.id>=o?4:0,u=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break t;d+=4}else i.id>=o&&(d+=4);i.next()}r=u,s+=t,l+=d}return(e<0||s==t)&&(c.size=s,c.start=r,c.skip=l),c.size>4?c:void 0}function m(t,e,i){let{id:s,start:n,end:r,size:l}=h;if(h.next(),l>=0&&s<o){let o=i;if(l>4){let s=h.pos-(l-4);for(;h.pos>s;)i=m(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=n-t,e[--i]=s}else-3==l?a=s:-4==l&&(c=s);return i}let w=[],v=[];for(;h.pos>0;)d(t.start||0,t.bufferStart||0,w,v,-1);let y=null!==(e=t.length)&&void 0!==e?e:w.length?v[0]+w[0].length:0;return new hrt(l[t.topID],w.reverse(),v.reverse(),y)}(t)}}hrt.empty=new hrt(srt.none,[],[],0);class lrt{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new lrt(this.buffer,this.index)}}class art{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return srt.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(t+=4))return n;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return n+"("+r.join(",")+")"}findChild(t,e,i,s,n){let{buffer:r}=this,o=-1;for(let h=t;h!=e&&!(crt(n,s,r[h+1],r[h+2])&&(o=h,i>0));h=r[h+3]);return o}slice(t,e,i,s){let n=this.buffer,r=new Uint16Array(e-t);for(let s=t,o=0;s<e;)r[o++]=n[s++],r[o++]=n[s++]-i,r[o++]=n[s++]-i,r[o++]=n[s++]-t;return new art(r,s-i,this.set)}}function crt(t,e,i,s){switch(t){case-2:return i<e;case-1:return s>=e&&i<e;case 0:return i<e&&s>e;case 1:return i<=e&&s>e;case 2:return s>e;case 4:return!0}}function drt(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function urt(t,e,i,s){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!s&&t instanceof frt&&t.index<0?null:t.parent;if(!e)return t;t=e}let r=s?0:ort.IgnoreOverlays;if(s)for(let s=t,o=s.parent;o;s=o,o=s.parent)s instanceof frt&&s.index<0&&(null===(n=o.enter(e,i,r))||void 0===n?void 0:n.from)!=s.from&&(t=o);for(;;){let s=t.enter(e,i,r);if(!s)return t;t=s}}class frt{constructor(t,e,i,s){this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let r=this;;){for(let{children:o,positions:h}=r._tree,l=e>0?o.length:-1;t!=l;t+=e){let l=o[t],a=h[t]+r.from;if(crt(s,i,a,a+l.length))if(l instanceof art){if(n&ort.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,e,i-a,s);if(o>-1)return new wrt(new mrt(r,l,t,a),null,o)}else if(n&ort.IncludeAnonymous||!l.type.isAnonymous||yrt(l)){let o;if(!(n&ort.IgnoreMounts)&&l.props&&(o=l.prop(ert.mounted))&&!o.overlay)return new frt(o.tree,a,t,r);let h=new frt(l,a,t,r);return n&ort.IncludeAnonymous||!h.type.isAnonymous?h:h.nextChild(e<0?l.children.length-1:0,e,i,s)}}if(n&ort.IncludeAnonymous||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent._tree.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let s;if(!(i&ort.IgnoreOverlays)&&(s=this._tree.prop(ert.mounted))&&s.overlay){let i=t-this.from;for(let{from:t,to:n}of s.overlay)if((e>0?t<=i:t<i)&&(e<0?n>=i:n>i))return new frt(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new vrt(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return urt(this,t,e,!1)}resolveInner(t,e=0){return urt(this,t,e,!0)}enterUnfinishedNodesBefore(t){return drt(this,t)}getChild(t,e=null,i=null){let s=prt(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return prt(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return grt(this,t)}}function prt(t,e,i,s){let n=t.cursor(),r=[];if(!n.firstChild())return r;if(null!=i)for(;!n.type.is(i);)if(!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}function grt(t,e,i=e.length-1){for(let s=t.parent;i>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}class mrt{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class wrt{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new wrt(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&ort.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new wrt(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new wrt(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new wrt(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new vrt(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];t.push(i.slice(s,n,r,o)),e.push(0)}return new hrt(this.type,t,e,this.to-this.from)}resolve(t,e=0){return urt(this,t,e,!1)}resolveInner(t,e=0){return urt(this,t,e,!0)}enterUnfinishedNodesBefore(t){return drt(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=prt(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return prt(this,t,e,i)}get node(){return this}matchContext(t){return grt(this,t)}}class vrt{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof frt)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof frt?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?!(i&ort.ExcludeBuffers)&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ort.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&ort.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let s=e+t,n=t<0?-1:i._tree.children.length;s!=n;s+=t){let t=i._tree.children[s];if(this.mode&ort.IncludeAnonymous||t instanceof art||!t.type.isAnonymous||yrt(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=t;r;r=r._parent)if(r.index==s){if(s==this.index)return r;e=r,i=n+1;break t}s=this.stack[--n]}for(let t=i;t<this.stack.length;t++)e=new wrt(this.buffer,e,this.stack[t]);return this.bufferNode=new wrt(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||!1!==t(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;s&&e&&e(this),s=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return grt(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return grt(this.node,t,s);let r=i[e.buffer[this.stack[n]]];if(!r.isAnonymous){if(t[s]&&t[s]!=r.name)return!1;s--}}return!0}}function yrt(t){return t.children.some((t=>t instanceof art||!t.type.isAnonymous||yrt(t)))}const brt=new WeakMap;function Ort(t,e){if(!t.isAnonymous||e instanceof art||e.type!=t)return 1;let i=brt.get(e);if(null==i){i=1;for(let s of e.children){if(s.type!=t||!(s instanceof hrt)){i=1;break}i+=Ort(t,s)}brt.set(e,i)}return i}function Srt(t,e,i,s,n,r,o,h,l){let a=0;for(let i=s;i<n;i++)a+=Ort(t,e[i]);let c=Math.ceil(1.5*a/8),d=[],u=[];return function e(i,s,n,o,h){for(let a=n;a<o;){let n=a,f=s[a],p=Ort(t,i[a]);for(a++;a<o;a++){let e=Ort(t,i[a]);if(p+e>=c)break;p+=e}if(a==n+1){if(p>c){let t=i[n];e(t.children,t.positions,0,t.children.length,s[n]+h);continue}d.push(i[n])}else{let e=s[a-1]+i[a-1].length-f;d.push(Srt(t,i,s,n,a,f,e,null,l))}u.push(f+h-r)}}(e,i,s,n,0),(h||l)(d,u,o)}class xrt{constructor(t,e,i,s,n=!1,r=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(t,e=[],i=!1){let s=[new xrt(0,t.length,t,0,!1,i)];for(let i of e)i.to>t.length&&s.push(i);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,r=t.length?t[0]:null;for(let o=0,h=0,l=0;;o++){let a=o<e.length?e[o]:null,c=a?a.fromA:1e9;if(c-h>=i)for(;r&&r.from<c;){let e=r;if(h>=e.from||c<=e.to||l){let t=Math.max(e.from,h)-l,i=Math.min(e.to,c)-l;e=t>=i?null:new xrt(t,i,e.tree,e.offset+l,o>0,!!a)}if(e&&s.push(e),r.to>c)break;r=n<t.length?t[n++]:null}if(!a)break;h=a.toA,l=a.toA-a.toB}return s}}class krt{startParse(t,e,i){return"string"==typeof t&&(t=new Art(t)),i=i?i.length?i.map((t=>new trt(t.from,t.to))):[new trt(0,0)]:[new trt(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let t=s.advance();if(t)return t}}}class Art{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new ert({perNode:!0});const Mrt=1024;let Crt=0;class Trt{constructor(t={}){this.id=Crt++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=Rrt.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}Trt.closedBy=new Trt({deserialize:t=>t.split(" ")}),Trt.openedBy=new Trt({deserialize:t=>t.split(" ")}),Trt.group=new Trt({deserialize:t=>t.split(" ")}),Trt.contextHash=new Trt({perNode:!0}),Trt.lookAhead=new Trt({perNode:!0}),Trt.mounted=new Trt({perNode:!0});const Drt=Object.create(null);class Rrt{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):Drt,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new Rrt(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(Trt.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(Trt.group),s=-1;s<(i?i.length:0);s++){let n=e[s<0?t.name:i[s]];if(n)return n}}}}Rrt.none=new Rrt("",Object.create(null),0,8);const Ert=new WeakMap,Brt=new WeakMap;var Prt;!function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"}(Prt||(Prt={}));class Lrt{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[t,e]of n)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(Trt.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new _rt(this.topNode,t)}cursorAt(t,e=0,i=0){let s=Ert.get(this)||this.topNode,n=new _rt(s);return n.moveTo(t,e),Ert.set(this,n._tree),n}get topNode(){return new Irt(this,0,0,null)}resolve(t,e=0){let i=Qrt(Ert.get(this)||this.topNode,t,e,!1);return Ert.set(this,i),i}resolveInner(t,e=0){let i=Qrt(Brt.get(this)||this.topNode,t,e,!0);return Brt.set(this,i),i}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t;for(let r=this.cursor((t.mode||0)|Prt.IncludeAnonymous);;){let t=!1;if(r.from<=n&&r.to>=s&&(r.type.isAnonymous||!1!==e(r))){if(r.firstChild())continue;t=!0}for(;t&&i&&!r.type.isAnonymous&&i(r),!r.nextSibling();){if(!r.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Urt(Rrt.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new Lrt(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new Lrt(Rrt.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,maxBufferLength:n=Mrt,reused:r=[],minRepeatType:o=s.types.length}=t,h=Array.isArray(i)?new Vrt(i,i.length):i,l=s.types,a=0,c=0;function d(t,e,i,w,v){let{id:y,start:b,end:O,size:S}=h,x=c;for(;S<0;){if(h.next(),-1==S){let e=r[y];return i.push(e),void w.push(b-t)}if(-3==S)return void(a=y);if(-4==S)return void(c=y);throw new RangeError(`Unrecognized record size: ${S}`)}let k,A,M=l[y],C=b-t;if(O-b<=n&&(A=g(h.pos-e,v))){let e=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=e.length;for(;h.pos>i;)n=m(A.start,e,n);k=new Wrt(e,O-A.start,s),C=A.start-t}else{let t=h.pos-S;h.next();let e=[],i=[],s=y>=o?y:-1,r=0,l=O;for(;h.pos>t;)s>=0&&h.id==s&&h.size>=0?(h.end<=l-n&&(f(e,i,b,r,h.end,l,s,x),r=e.length,l=h.end),h.next()):d(b,t,e,i,s);if(s>=0&&r>0&&r<e.length&&f(e,i,b,r,b,l,s,x),e.reverse(),i.reverse(),s>-1&&r>0){let t=u(M);k=Urt(M,e,i,0,e.length,0,O-b,t,t)}else k=p(M,e,i,O-b,x-O)}i.push(k),w.push(C)}function u(t){return(e,i,s)=>{let n,r,o=0,h=e.length-1;if(h>=0&&(n=e[h])instanceof Lrt){if(!h&&n.type==t&&n.length==s)return n;(r=n.prop(Trt.lookAhead))&&(o=i[h]+n.length+r)}return p(t,e,i,s,o)}}function f(t,e,i,n,r,o,h,l){let a=[],c=[];for(;t.length>n;)a.push(t.pop()),c.push(e.pop()+i-r);t.push(p(s.types[h],a,c,o-r,l-o)),e.push(r-i)}function p(t,e,i,s,n=0,r){if(a){let t=[Trt.contextHash,a];r=r?[t].concat(r):[t]}if(n>25){let t=[Trt.lookAhead,n];r=r?[t].concat(r):[t]}return new Lrt(t,e,i,s,r)}function g(t,e){let i=h.fork(),s=0,r=0,l=0,a=i.end-n,c={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){let t=i.size;if(i.id==e&&t>=0){c.size=s,c.start=r,c.skip=l,l+=4,s+=4,i.next();continue}let h=i.pos-t;if(t<0||h<n||i.start<a)break;let d=i.id>=o?4:0,u=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break t;d+=4}else i.id>=o&&(d+=4);i.next()}r=u,s+=t,l+=d}return(e<0||s==t)&&(c.size=s,c.start=r,c.skip=l),c.size>4?c:void 0}function m(t,e,i){let{id:s,start:n,end:r,size:l}=h;if(h.next(),l>=0&&s<o){let o=i;if(l>4){let s=h.pos-(l-4);for(;h.pos>s;)i=m(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=n-t,e[--i]=s}else-3==l?a=s:-4==l&&(c=s);return i}let w=[],v=[];for(;h.pos>0;)d(t.start||0,t.bufferStart||0,w,v,-1);let y=null!==(e=t.length)&&void 0!==e?e:w.length?v[0]+w[0].length:0;return new Lrt(l[t.topID],w.reverse(),v.reverse(),y)}(t)}}Lrt.empty=new Lrt(Rrt.none,[],[],0);class Vrt{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Vrt(this.buffer,this.index)}}class Wrt{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return Rrt.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(t+=4))return n;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return n+"("+r.join(",")+")"}findChild(t,e,i,s,n){let{buffer:r}=this,o=-1;for(let h=t;h!=e&&!(Nrt(n,s,r[h+1],r[h+2])&&(o=h,i>0));h=r[h+3]);return o}slice(t,e,i,s){let n=this.buffer,r=new Uint16Array(e-t);for(let s=t,o=0;s<e;)r[o++]=n[s++],r[o++]=n[s++]-i,r[o++]=n[s++]-i,r[o++]=n[s++]-t;return new Wrt(r,s-i,this.set)}}function Nrt(t,e,i,s){switch(t){case-2:return i<e;case-1:return s>=e&&i<e;case 0:return i<e&&s>e;case 1:return i<=e&&s>e;case 2:return s>e;case 4:return!0}}function Hrt(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function Qrt(t,e,i,s){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!s&&t instanceof Irt&&t.index<0?null:t.parent;if(!e)return t;t=e}let r=s?0:Prt.IgnoreOverlays;if(s)for(let s=t,o=s.parent;o;s=o,o=s.parent)s instanceof Irt&&s.index<0&&(null===(n=o.enter(e,i,r))||void 0===n?void 0:n.from)!=s.from&&(t=o);for(;;){let s=t.enter(e,i,r);if(!s)return t;t=s}}class Irt{constructor(t,e,i,s){this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let r=this;;){for(let{children:o,positions:h}=r._tree,l=e>0?o.length:-1;t!=l;t+=e){let l=o[t],a=h[t]+r.from;if(Nrt(s,i,a,a+l.length))if(l instanceof Wrt){if(n&Prt.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,e,i-a,s);if(o>-1)return new qrt(new $rt(r,l,t,a),null,o)}else if(n&Prt.IncludeAnonymous||!l.type.isAnonymous||Grt(l)){let o;if(!(n&Prt.IgnoreMounts)&&l.props&&(o=l.prop(Trt.mounted))&&!o.overlay)return new Irt(o.tree,a,t,r);let h=new Irt(l,a,t,r);return n&Prt.IncludeAnonymous||!h.type.isAnonymous?h:h.nextChild(e<0?l.children.length-1:0,e,i,s)}}if(n&Prt.IncludeAnonymous||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent._tree.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let s;if(!(i&Prt.IgnoreOverlays)&&(s=this._tree.prop(Trt.mounted))&&s.overlay){let i=t-this.from;for(let{from:t,to:n}of s.overlay)if((e>0?t<=i:t<i)&&(e<0?n>=i:n>i))return new Irt(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new _rt(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return Qrt(this,t,e,!1)}resolveInner(t,e=0){return Qrt(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Hrt(this,t)}getChild(t,e=null,i=null){let s=zrt(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return zrt(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return Frt(this,t)}}function zrt(t,e,i,s){let n=t.cursor(),r=[];if(!n.firstChild())return r;if(null!=i)for(;!n.type.is(i);)if(!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}function Frt(t,e,i=e.length-1){for(let s=t.parent;i>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}class $rt{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class qrt{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new qrt(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&Prt.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new qrt(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new qrt(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new qrt(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new _rt(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];t.push(i.slice(s,n,r,o)),e.push(0)}return new Lrt(this.type,t,e,this.to-this.from)}resolve(t,e=0){return Qrt(this,t,e,!1)}resolveInner(t,e=0){return Qrt(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Hrt(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=zrt(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return zrt(this,t,e,i)}get node(){return this}matchContext(t){return Frt(this,t)}}class _rt{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof Irt)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof Irt?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?!(i&Prt.ExcludeBuffers)&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Prt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&Prt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let s=e+t,n=t<0?-1:i._tree.children.length;s!=n;s+=t){let t=i._tree.children[s];if(this.mode&Prt.IncludeAnonymous||t instanceof Wrt||!t.type.isAnonymous||Grt(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=t;r;r=r._parent)if(r.index==s){if(s==this.index)return r;e=r,i=n+1;break t}s=this.stack[--n]}for(let t=i;t<this.stack.length;t++)e=new qrt(this.buffer,e,this.stack[t]);return this.bufferNode=new qrt(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||!1!==t(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;s&&e&&e(this),s=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return Frt(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return Frt(this.node,t,s);let r=i[e.buffer[this.stack[n]]];if(!r.isAnonymous){if(t[s]&&t[s]!=r.name)return!1;s--}}return!0}}function Grt(t){return t.children.some((t=>t instanceof Wrt||!t.type.isAnonymous||Grt(t)))}const Xrt=new WeakMap;function jrt(t,e){if(!t.isAnonymous||e instanceof Wrt||e.type!=t)return 1;let i=Xrt.get(e);if(null==i){i=1;for(let s of e.children){if(s.type!=t||!(s instanceof Lrt)){i=1;break}i+=jrt(t,s)}Xrt.set(e,i)}return i}function Urt(t,e,i,s,n,r,o,h,l){let a=0;for(let i=s;i<n;i++)a+=jrt(t,e[i]);let c=Math.ceil(1.5*a/8),d=[],u=[];return function e(i,s,n,o,h){for(let a=n;a<o;){let n=a,f=s[a],p=jrt(t,i[a]);for(a++;a<o;a++){let e=jrt(t,i[a]);if(p+e>=c)break;p+=e}if(a==n+1){if(p>c){let t=i[n];e(t.children,t.positions,0,t.children.length,s[n]+h);continue}d.push(i[n])}else{let e=s[a-1]+i[a-1].length-f;d.push(Urt(t,i,s,n,a,f,e,null,l))}u.push(f+h-r)}}(e,i,s,n,0),(h||l)(d,u,o)}new Trt({perNode:!0});let Zrt=0;class Yrt{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=Zrt++}static define(t){if(null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let e=new Yrt([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new Jrt;return e=>e.modified.indexOf(t)>-1?e:Jrt.get(e.base||e,e.modified.concat(t).sort(((t,e)=>t.id-e.id)))}}let Krt=0;class Jrt{constructor(){this.instances=[],this.id=Krt++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find((i=>{return i.base==t&&(s=e,n=i.modified,s.length==n.length&&s.every(((t,e)=>t==n[e])));var s,n}));if(i)return i;let s=[],n=new Yrt(s,t,e);for(let t of e)t.instances.push(n);let r=tot(e);for(let e of t.set)for(let t of r)s.push(Jrt.get(e,t));return n}}function tot(t){let e=[t];for(let i=0;i<t.length;i++)for(let s of tot(t.slice(0,i).concat(t.slice(i+1))))e.push(s);return e}function eot(t){let e=Object.create(null);for(let i in t){let s=t[i];Array.isArray(s)||(s=[s]);for(let t of i.split(" "))if(t){let i=[],n=2,r=t;for(let e=0;;){if("..."==r&&e>0&&e+3==t.length){n=1;break}let s=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!s)throw new RangeError("Invalid path: "+t);if(i.push("*"==s[0]?"":'"'==s[0][0]?JSON.parse(s[0]):s[0]),e+=s[0].length,e==t.length)break;let o=t[e++];if(e==t.length&&"!"==o){n=0;break}if("/"!=o)throw new RangeError("Invalid path: "+t);r=t.slice(e)}let o=i.length-1,h=i[o];if(!h)throw new RangeError("Invalid path: "+t);let l=new sot(s,n,o>0?i.slice(0,o):null);e[h]=l.sort(e[h])}}return iot.add(e)}const iot=new Trt;class sot{constructor(t,e,i,s){this.tags=t,this.mode=e,this.context=i,this.next=s}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function not(t,e){let i=Object.create(null);for(let e of t)if(Array.isArray(e.tag))for(let t of e.tag)i[t.id]=e.class;else i[e.tag.id]=e.class;let{scope:s,all:n=null}=e||{};return{style:t=>{let e=n;for(let s of t)for(let t of s.set){let s=i[t.id];if(s){e=e?e+" "+s:s;break}}return e},scope:s}}const rot=Yrt.define,oot=rot(),hot=rot(),lot=rot(hot),aot=rot(hot),cot=rot(),dot=rot(cot),uot=rot(cot),fot=rot(),pot=rot(fot),got=rot(),mot=rot(),wot=rot(),vot=rot(wot),yot=rot(),bot={comment:oot,lineComment:rot(oot),blockComment:rot(oot),docComment:rot(oot),name:hot,variableName:rot(hot),typeName:lot,tagName:rot(lot),propertyName:aot,attributeName:rot(aot),className:rot(hot),labelName:rot(hot),namespace:rot(hot),macroName:rot(hot),literal:cot,string:dot,docString:rot(dot),character:rot(dot),attributeValue:rot(dot),number:uot,integer:rot(uot),float:rot(uot),bool:rot(cot),regexp:rot(cot),escape:rot(cot),color:rot(cot),url:rot(cot),keyword:got,self:rot(got),null:rot(got),atom:rot(got),unit:rot(got),modifier:rot(got),operatorKeyword:rot(got),controlKeyword:rot(got),definitionKeyword:rot(got),moduleKeyword:rot(got),operator:mot,derefOperator:rot(mot),arithmeticOperator:rot(mot),logicOperator:rot(mot),bitwiseOperator:rot(mot),compareOperator:rot(mot),updateOperator:rot(mot),definitionOperator:rot(mot),typeOperator:rot(mot),controlOperator:rot(mot),punctuation:wot,separator:rot(wot),bracket:vot,angleBracket:rot(vot),squareBracket:rot(vot),paren:rot(vot),brace:rot(vot),content:fot,heading:pot,heading1:rot(pot),heading2:rot(pot),heading3:rot(pot),heading4:rot(pot),heading5:rot(pot),heading6:rot(pot),contentSeparator:rot(fot),list:rot(fot),quote:rot(fot),emphasis:rot(fot),strong:rot(fot),link:rot(fot),monospace:rot(fot),strikethrough:rot(fot),inserted:rot(),deleted:rot(),changed:rot(),invalid:rot(),meta:yot,documentMeta:rot(yot),annotation:rot(yot),processingInstruction:rot(yot),definition:Yrt.defineModifier(),constant:Yrt.defineModifier(),function:Yrt.defineModifier(),standard:Yrt.defineModifier(),local:Yrt.defineModifier(),special:Yrt.defineModifier()};not([{tag:bot.link,class:"tok-link"},{tag:bot.heading,class:"tok-heading"},{tag:bot.emphasis,class:"tok-emphasis"},{tag:bot.strong,class:"tok-strong"},{tag:bot.keyword,class:"tok-keyword"},{tag:bot.atom,class:"tok-atom"},{tag:bot.bool,class:"tok-bool"},{tag:bot.url,class:"tok-url"},{tag:bot.labelName,class:"tok-labelName"},{tag:bot.inserted,class:"tok-inserted"},{tag:bot.deleted,class:"tok-deleted"},{tag:bot.literal,class:"tok-literal"},{tag:bot.string,class:"tok-string"},{tag:bot.number,class:"tok-number"},{tag:[bot.regexp,bot.escape,bot.special(bot.string)],class:"tok-string2"},{tag:bot.variableName,class:"tok-variableName"},{tag:bot.local(bot.variableName),class:"tok-variableName tok-local"},{tag:bot.definition(bot.variableName),class:"tok-variableName tok-definition"},{tag:bot.special(bot.variableName),class:"tok-variableName2"},{tag:bot.definition(bot.propertyName),class:"tok-propertyName tok-definition"},{tag:bot.typeName,class:"tok-typeName"},{tag:bot.namespace,class:"tok-namespace"},{tag:bot.className,class:"tok-className"},{tag:bot.macroName,class:"tok-macroName"},{tag:bot.propertyName,class:"tok-propertyName"},{tag:bot.operator,class:"tok-operator"},{tag:bot.comment,class:"tok-comment"},{tag:bot.meta,class:"tok-meta"},{tag:bot.invalid,class:"tok-invalid"},{tag:bot.punctuation,class:"tok-punctuation"}]);var Oot;const Sot=new ert;class xot{constructor(t,e,i=[]){this.data=t,Lnt.prototype.hasOwnProperty("tree")||Object.defineProperty(Lnt.prototype,"tree",{get(){return Aot(this)}}),this.parser=e,this.extension=[Lot.of(this),Lnt.languageData.of(((t,e,i)=>t.facet(kot(t,e,i))))].concat(i)}isActiveAt(t,e,i=-1){return kot(t,e,i)==this.data}findRegions(t){let e=t.facet(Lot);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(t,e)=>{if(t.prop(Sot)==this.data)return void i.push({from:e,to:e+t.length});let n=t.prop(ert.mounted);if(n){if(n.tree.prop(Sot)==this.data){if(n.overlay)for(let t of n.overlay)i.push({from:t.from+e,to:t.to+e});else i.push({from:e,to:e+t.length});return}if(n.overlay){let t=i.length;if(s(n.tree,n.overlay[0].from+e),i.length>t)return}}for(let i=0;i<t.children.length;i++){let n=t.children[i];n instanceof hrt&&s(n,t.positions[i]+e)}};return s(Aot(t),0),i}get allowsNesting(){return!0}}function kot(t,e,i){let s=t.facet(Lot);if(!s)return null;let n=s.data;if(s.allowsNesting)for(let s=Aot(t).topNode;s;s=s.enter(e,i,ort.ExcludeBuffers))n=s.type.prop(Sot)||n;return n}xot.setState=Snt.define();function Aot(t){let e=t.field(xot.state,!1);return e?e.tree:hrt.empty}class Mot{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Cot=null;class Tot{constructor(t,e,i=[],s,n,r,o,h){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=r,this.skipped=o,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new Mot(this.state.doc),this.fragments)}work(t,e){return null!=e&&e>=this.state.doc.length&&(e=void 0),this.tree!=hrt.empty&&this.isDone(null!=e?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof t){let e=Date.now()+t;t=()=>Date.now()>e}for(this.parse||(this.parse=this.startParse()),null!=e&&(null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(xrt.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=e?e:this.state.doc.length)))return!0;this.parse=this.startParse()}if(t())return!1}}))}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext((()=>{for(;!(e=this.parse.advance()););})),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(xrt.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Cot;Cot=this;try{return t()}finally{Cot=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Dot(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:r,skipped:o}=this;if(this.takeTree(),!t.empty){let e=[];if(t.iterChangedRanges(((t,i,s,n)=>e.push({fromA:t,toA:i,fromB:s,toB:n}))),i=xrt.applyChanges(i,e),s=hrt.empty,n=0,r={from:t.mapPos(r.from,-1),to:t.mapPos(r.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),s=t.mapPos(e.to,-1);i<s&&o.push({from:i,to:s})}}}return new Tot(this.parser,e,i,s,n,r,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:i,to:s}=this.skipped[e];i<t.to&&s>t.from&&(this.fragments=Dot(this.fragments,i,s),this.skipped.splice(e--,1))}return!(this.skipped.length>=e)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends krt{createParse(e,i,s){let n=s[0].from,r=s[s.length-1].to;return{parsedPos:n,advance(){let e=Cot;if(e){for(let t of s)e.tempSkipped.push(t);t&&(e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t)}return this.parsedPos=r,new hrt(srt.none,[],[],r-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return Cot}}function Dot(t,e,i){return xrt.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class Rot{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new Rot(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=new Tot(t.facet(Lot).parser,t,[],hrt.empty,0,{from:0,to:e},[],null);return i.work(20,e)||i.takeTree(),new Rot(i)}}xot.state=int.define({create:Rot.init,update(t,e){for(let t of e.effects)if(t.is(xot.setState))return t.value;return e.startState.facet(Lot)!=e.state.facet(Lot)?Rot.init(e.state):t.apply(e)}});let Eot=t=>{let e=setTimeout((()=>t()),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(Eot=t=>{let e=-1,i=setTimeout((()=>{e=requestIdleCallback(t,{timeout:400})}),100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const Bot="undefined"!=typeof navigator&&(null===(Oot=navigator.scheduling)||void 0===Oot?void 0:Oot.isInputPending)?()=>navigator.scheduling.isInputPending():null,Pot=V9.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(xot.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(xot.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=Eot(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(xot.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,t&&!Bot?Math.max(25,t.timeRemaining()-5):1e9),o=n.context.treeLen<s&&i.doc.length>s+1e3,h=n.context.work((()=>Bot&&Bot()||Date.now()>r),s+(o?0:1e5));this.chunkBudget-=Date.now()-e,(h||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:xot.setState.of(new Rot(n.context))})),this.chunkBudget>0&&(!h||o)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then((()=>this.scheduleWork())).catch((t=>E9(this.view.state,t))).then((()=>this.workScheduled--)),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Lot=Ust.define({combine:t=>t.length?t[0]:null,enables:[xot.state,Pot]});class Vot{constructor(t,e){let i;function s(t){let e=jt.newName();return(i||(i=Object.create(null)))["."+e]=t,e}const n=e.scope;this.scope=n instanceof xot?t=>t.prop(Sot)==n.data:n?t=>t==n:void 0,this.style=not(t.map((t=>({tag:t.tag,class:t.class||s(Object.assign({},t,{tag:null}))}))),{all:"string"==typeof e.all?e.all:e.all?s(e.all):void 0}).style,this.module=i?new jt(i):null,this.themeType=e.themeType}static define(t,e){return new Vot(t,e||{})}}bot.meta,bot.link,bot.heading,bot.emphasis,bot.strong,bot.strikethrough,bot.keyword,bot.atom,bot.bool,bot.url,bot.contentSeparator,bot.labelName,bot.literal,bot.inserted,bot.string,bot.deleted,bot.regexp,bot.escape,bot.string,bot.variableName,bot.variableName,bot.typeName,bot.namespace,bot.className,bot.variableName,bot.macroName,bot.propertyName,bot.comment,bot.invalid;const Wot=Object.create(null),Not=[srt.none],Hot=[],Qot=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Qot[t]=zot(Wot,e);function Iot(t,e){Hot.indexOf(t)>-1||(Hot.push(t),console.warn(e))}function zot(t,e){let i=null;for(let s of e.split(".")){let e=t[s]||bot[s];e?"function"==typeof e?i?i=e(i):Iot(s,`Modifier ${s} used at start of tag`):i?Iot(s,`Tag ${s} used as modifier`):i=e:Iot(s,`Unknown highlighting tag ${s}`)}if(!i)return 0;let s=e.replace(/ /g,"_"),n=srt.define({id:Not.length,name:s,props:[eot({[s]:i})]});return Not.push(n),n.id}class Fot{constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=Aot(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),s=e.text.slice(i-e.from,this.pos-e.from),n=s.search(Xot(t,!1));return n<0?null:{from:i+n,to:this.pos,text:s.slice(n)}}get aborted(){return null==this.abortListeners}addEventListener(t,e){"abort"==t&&this.abortListeners&&this.abortListeners.push(e)}}function $ot(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function qot(t){let e=t.map((t=>"string"==typeof t?{label:t}:t)),[i,s]=e.every((t=>/^\w+$/.test(t.label)))?[/\w*$/,/\w+$/]:function(t){let e=Object.create(null),i=Object.create(null);for(let{label:s}of t){e[s[0]]=!0;for(let t=1;t<s.length;t++)i[s[t]]=!0}let s=$ot(e)+$ot(i)+"*$";return[new RegExp("^"+s),new RegExp(s)]}(e);return t=>{let n=t.matchBefore(s);return n||t.explicit?{from:n?n.from:t.pos,options:e,validFor:i}:null}}class _ot{constructor(t,e,i){this.completion=t,this.source=e,this.match=i}}function Got(t){return t.selection.main.head}function Xot(t,e){var i;let{source:s}=t,n=e&&"^"!=s[0],r="$"!=s[s.length-1];return n||r?new RegExp(`${n?"^":""}(?:${s})${r?"$":""}`,null!==(i=t.flags)&&void 0!==i?i:t.ignoreCase?"i":""):t}const jot=ynt.define();function Uot(t,e){const i=e.completion.apply||e.completion.label;let s=e.source;"string"==typeof i?t.dispatch(t.state.changeByRange((e=>{if(e==t.state.selection.main)return{changes:{from:s.from,to:s.to,insert:i},range:_st.cursor(s.from+i.length)};let n=s.to-s.from;return!e.empty||n&&t.state.sliceDoc(e.from-n,e.from)!=t.state.sliceDoc(s.from,s.to)?{range:e}:{changes:{from:e.from-n,to:e.from,insert:i},range:_st.cursor(e.from-n+i.length)}})),{userEvent:"input.complete",annotations:jot.of(e.completion)}):i(t,e.completion,s.from,s.to)}const Zot=new WeakMap;function Yot(t){if(!Array.isArray(t))return t;let e=Zot.get(t);return e||Zot.set(t,e=qot(t)),e}class Kot{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let e=0;e<t.length;){let i=Est(t,e),s=Pst(i);this.chars.push(i);let n=t.slice(e,e+s),r=n.toUpperCase();this.folded.push(Est(r==n?n.toLowerCase():r,0)),e+=s}this.astral=t.length!=this.chars.length}match(t){if(0==this.pattern.length)return[0];if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:s,precise:n,byWord:r}=this;if(1==e.length){let s=Est(t,0);return s==e[0]?[0,0,Pst(s)]:s==i[0]?[-200,0,Pst(s)]:null}let o=t.indexOf(this.pattern);if(0==o)return[0,0,this.pattern.length];let h=e.length,l=0;if(o<0){for(let n=0,r=Math.min(t.length,200);n<r&&l<h;){let r=Est(t,n);r!=e[l]&&r!=i[l]||(s[l++]=n),n+=Pst(r)}if(l<h)return null}let a=0,c=0,d=!1,u=0,f=-1,p=-1,g=/[a-z]/.test(t),m=!0;for(let s=0,l=Math.min(t.length,200),w=0;s<l&&c<h;){let l=Est(t,s);o<0&&(a<h&&l==e[a]&&(n[a++]=s),u<h&&(l==e[u]||l==i[u]?(0==u&&(f=s),p=s+1,u++):u=0));let v,y=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(v=Bst(l))!=v.toLowerCase()?1:v!=v.toUpperCase()?2:0;(!s||1==y&&g||0==w&&0!=y)&&(e[c]==l||i[c]==l&&(d=!0)?r[c++]=s:r.length&&(m=!1)),w=y,s+=Pst(l)}return c==h&&0==r[0]&&m?this.result((d?-200:0)-100,r,t):u==h&&0==f?[-200-t.length,0,p]:o>-1?[-700-t.length,o,o+this.pattern.length]:u==h?[-900-t.length,f,p]:c==h?this.result((d?-200:0)-100-700+(m?0:-1100),r,t):2==e.length?null:this.result((s[0]?-700:0)-200-1100,s,t)}result(t,e,i){let s=[t-i.length],n=1;for(let t of e){let e=t+(this.astral?Pst(Est(i,t)):1);n>1&&s[n-1]==t?s[n-1]=e:(s[n++]=t,s[n++]=e)}return s}}const Jot=Ust.define({combine:t=>Vnt(t,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(t,e)=>t&&e,icons:(t,e)=>t&&e,optionClass:(t,e)=>i=>function(t,e){return t?e?t+" "+e:t:e}(t(i),e(i)),addToOptions:(t,e)=>t.concat(e)})});function tht(t,e,i){if(t<=i)return{from:0,to:t};if(e<=t>>1){let t=Math.floor(e/i);return{from:t*i,to:(t+1)*i}}let s=Math.floor((t-e)/i);return{from:t-(s+1)*i,to:t-s*i}}class eht{constructor(t,e){this.view=t,this.stateField=e,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:t=>this.positionInfo(t),key:this};let i=t.state.field(e),{options:s,selected:n}=i.open,r=t.state.facet(Jot);this.optionContent=function(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(t){let e=document.createElement("div");return e.classList.add("cm-completionIcon"),t.type&&e.classList.add(...t.type.split(/\s+/g).map((t=>"cm-completionIcon-"+t))),e.setAttribute("aria-hidden","true"),e},position:20}),e.push({render(t,e,i){let s=document.createElement("span");s.className="cm-completionLabel";let{label:n}=t,r=0;for(let t=1;t<i.length;){let e=i[t++],o=i[t++];e>r&&s.appendChild(document.createTextNode(n.slice(r,e)));let h=s.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(n.slice(e,o))),h.className="cm-completionMatchedText",r=o}return r<n.length&&s.appendChild(document.createTextNode(n.slice(r))),s},position:50},{render(t){if(!t.detail)return null;let e=document.createElement("span");return e.className="cm-completionDetail",e.textContent=t.detail,e},position:80}),e.sort(((t,e)=>t.position-e.position)).map((t=>t.render))}(r),this.optionClass=r.optionClass,this.range=tht(s.length,n,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(e=>{for(let i,n=e.target;n&&n!=this.dom;n=n.parentNode)if("LI"==n.nodeName&&(i=/-(\d+)$/.exec(n.id))&&+i[1]<s.length)return Uot(t,s[+i[1]]),void e.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(s,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(t){t.state.field(this.stateField)!=t.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=tht(e.options.length,e.selected,this.view.state.facet(Jot).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e.options,t.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(e.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=e.options[e.selected],{info:s}=i;if(!s)return;let n="string"==typeof s?document.createTextNode(s):s(i);if(!n)return;"then"in n?n.then((e=>{e&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(e)})).catch((t=>E9(this.view.state,t,"completion info"))):this.addInfoPane(n)}}addInfoPane(t){let e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo",e.appendChild(t),this.dom.appendChild(e),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,s=this.range.from;i;i=i.nextSibling,s++)s==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return e&&function(t,e){let i=t.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<i.top?t.scrollTop-=i.top-s.top:s.bottom>i.bottom&&(t.scrollTop+=s.bottom-i.bottom)}(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),s=t.getBoundingClientRect();if(s.top>Math.min(innerHeight,e.bottom)-10||s.bottom<Math.max(0,e.top)+10)return null;let n=Math.max(0,Math.min(s.top,innerHeight-i.height))-e.top,r=this.view.textDirection==_9.RTL,o=e.left,h=innerWidth-e.right;return r&&o<Math.min(i.width,h)?r=!1:!r&&h<Math.min(i.width,o)&&(r=!0),{top:n,left:r}}positionInfo(t){this.info&&(this.info.style.top=(t?t.top:-1e6)+"px",t&&(this.info.classList.toggle("cm-completionInfo-left",t.left),this.info.classList.toggle("cm-completionInfo-right",!t.left)))}createListBox(t,e,i){const s=document.createElement("ul");s.id=e,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true");for(let n=i.from;n<i.to;n++){let{completion:i,match:r}=t[n];const o=s.appendChild(document.createElement("li"));o.id=e+"-"+n,o.setAttribute("role","option");let h=this.optionClass(i);h&&(o.className=h);for(let t of this.optionContent){let e=t(i,this.view.state,r);e&&o.appendChild(e)}}return i.from&&s.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&s.classList.add("cm-completionListIncompleteBottom"),s}}function iht(t){return 100*(t.boost||0)+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}class sht{constructor(t,e,i,s,n){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=s,this.selected=n}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new sht(this.options,oht(e,t),this.tooltip,this.timestamp,t)}static build(t,e,i,s,n){let r=function(t,e){let i=[],s=0;for(let n of t)if(n.hasResult())if(!1===n.result.filter)for(let t of n.result.options)i.push(new _ot(t,n,[1e9-s++]));else{let t,s=new Kot(e.sliceDoc(n.from,n.to));for(let e of n.result.options)(t=s.match(e.label))&&(null!=e.boost&&(t[0]+=e.boost),i.push(new _ot(e,n,t)))}let n=[],r=null;for(let t of i.sort(lht))!r||r.label!=t.completion.label||r.detail!=t.completion.detail||null!=r.type&&null!=t.completion.type&&r.type!=t.completion.type||r.apply!=t.completion.apply?n.push(t):iht(t.completion)>iht(r)&&(n[n.length-1]=t),r=t.completion;return n}(t,e);if(!r.length)return null;let o=0;if(s&&s.selected){let t=s.options[s.selected].completion;for(let e=0;e<r.length;e++)if(r[e].completion==t){o=e;break}}return new sht(r,oht(i,o),{pos:t.reduce(((t,e)=>e.hasResult()?Math.min(t,e.from):t),1e8),create:(h=mht,t=>new eht(t,h)),above:n.aboveCursor},s?s.timestamp:Date.now(),o);var h}map(t){return new sht(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class nht{constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new nht(hht,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(t){let{state:e}=t,i=e.facet(Jot),s=(i.override||e.languageDataAt("autocomplete",Got(e)).map(Yot)).map((e=>(this.active.find((t=>t.source==e))||new cht(e,this.active.some((t=>0!=t.state))?1:0)).update(t,i)));s.length==this.active.length&&s.every(((t,e)=>t==this.active[e]))&&(s=this.active);let n=t.selection||s.some((e=>e.hasResult()&&t.changes.touchesRange(e.from,e.to)))||!function(t,e){if(t==e)return!0;for(let i=0,s=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;s<e.length&&!e[s].hasResult;)s++;let n=i==t.length,r=s==e.length;if(n||r)return n==r;if(t[i++].result!=e[s++].result)return!1}}(s,this.active)?sht.build(s,e,this.id,this.open,i):this.open&&t.docChanged?this.open.map(t.changes):this.open;!n&&s.every((t=>1!=t.state))&&s.some((t=>t.hasResult()))&&(s=s.map((t=>t.hasResult()?new cht(t.source,0):t)));for(let e of t.effects)e.is(ght)&&(n=n&&n.setSelected(e.value,this.id));return s==this.active&&n==this.open?this:new nht(s,this.id,n)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:rht}}const rht={"aria-autocomplete":"list"};function oht(t,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":t+"-"+e,"aria-controls":t}}const hht=[];function lht(t,e){let i=e.match[0]-t.match[0];return i||t.completion.label.localeCompare(e.completion.label)}function aht(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class cht{constructor(t,e,i=-1){this.source=t,this.state=e,this.explicitPos=i}hasResult(){return!1}update(t,e){let i=aht(t),s=this;i?s=s.handleUserEvent(t,i,e):t.docChanged?s=s.handleChange(t):t.selection&&0!=s.state&&(s=new cht(s.source,0));for(let e of t.effects)if(e.is(uht))s=new cht(s.source,1,e.value?Got(t.state):-1);else if(e.is(fht))s=new cht(s.source,0);else if(e.is(pht))for(let t of e.value)t.source==s.source&&(s=t);return s}handleUserEvent(t,e,i){return"delete"!=e&&i.activateOnTyping?new cht(this.source,1):this.map(t.changes)}handleChange(t){return t.changes.touchesRange(Got(t.startState))?new cht(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new cht(this.source,this.state,t.mapPos(this.explicitPos))}}class dht extends cht{constructor(t,e,i,s,n){super(t,2,e),this.result=i,this.from=s,this.to=n}hasResult(){return!0}handleUserEvent(t,e,i){var s;let n=t.changes.mapPos(this.from),r=t.changes.mapPos(this.to,1),o=Got(t.state);if((this.explicitPos<0?o<=n:o<this.from)||o>r||"delete"==e&&Got(t.startState)==this.from)return new cht(this.source,"input"==e&&i.activateOnTyping?1:0);let h,l=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return function(t,e,i,s){if(!t)return!1;let n=e.sliceDoc(i,s);return"function"==typeof t?t(n,i,s,e):Xot(t,!0).test(n)}(this.result.validFor,t.state,n,r)?new dht(this.source,l,this.result,n,r):this.result.update&&(h=this.result.update(this.result,n,r,new Fot(t.state,o,l>=0)))?new dht(this.source,l,h,h.from,null!==(s=h.to)&&void 0!==s?s:Got(t.state)):new cht(this.source,1,l)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new cht(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new dht(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1))}}const uht=Snt.define(),fht=Snt.define(),pht=Snt.define({map:(t,e)=>t.map((t=>t.map(e)))}),ght=Snt.define(),mht=int.define({create:()=>nht.start(),update:(t,e)=>t.update(e),provide:t=>[J4.from(t,(t=>t.tooltip)),L4.contentAttributes.from(t,(t=>t.attrs))]});function wht(t,e="option"){return i=>{let s=i.state.field(mht,!1);if(!s||!s.open||Date.now()-s.open.timestamp<75)return!1;let n,r=1;"page"==e&&(n=function(t,e){let i=t.plugin(Y4);if(!i)return null;let s=i.manager.tooltips.indexOf(e);return s<0?null:i.manager.tooltipViews[s]}(i,s.open.tooltip))&&(r=Math.max(2,Math.floor(n.dom.offsetHeight/n.dom.querySelector("li").offsetHeight)-1));let o=s.open.selected+r*(t?1:-1),{length:h}=s.open.options;return o<0?o="page"==e?0:h-1:o>=h&&(o="page"==e?h-1:0),i.dispatch({effects:ght.of(o)}),!0}}class vht{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const yht=V9.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(mht).active)1==e.state&&this.startQuery(e)}update(t){let e=t.state.field(mht);if(!t.selectionSet&&!t.docChanged&&t.startState.field(mht)==e)return;let i=t.transactions.some((t=>(t.selection||t.docChanged)&&!aht(t)));for(let e=0;e<this.running.length;e++){let s=this.running[e];if(i||s.updates.length+t.transactions.length>50&&Date.now()-s.time>1e3){for(let t of s.context.abortListeners)try{t()}catch(t){E9(this.view.state,t)}s.context.abortListeners=null,this.running.splice(e--,1)}else s.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some((t=>1==t.state&&!this.running.some((e=>e.active.source==t.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let e of t.transactions)"input"==aht(e)?this.composing=2:2==this.composing&&e.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(mht);for(let t of e.active)1!=t.state||this.running.some((e=>e.active.source==t.source))||this.startQuery(t)}startQuery(t){let{state:e}=this.view,i=Got(e),s=new Fot(e,i,t.explicitPos==i),n=new vht(t,s);this.running.push(n),Promise.resolve(t.source(s)).then((t=>{n.context.aborted||(n.done=t||null,this.scheduleAccept())}),(t=>{this.view.dispatch({effects:fht.of(null)}),E9(this.view.state,t)}))}scheduleAccept(){this.running.every((t=>void 0!==t.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(Jot);for(let s=0;s<this.running.length;s++){let n=this.running[s];if(void 0===n.done)continue;if(this.running.splice(s--,1),n.done){let s=new dht(n.active.source,n.active.explicitPos,n.done,n.done.from,null!==(t=n.done.to)&&void 0!==t?t:Got(n.updates.length?n.updates[0].startState:this.view.state));for(let t of n.updates)s=s.update(t,i);if(s.hasResult()){e.push(s);continue}}let r=this.view.state.field(mht).active.find((t=>t.source==n.active.source));if(r&&1==r.state)if(null==n.done){let t=new cht(n.active.source,0);for(let e of n.updates)t=t.update(e,i);1!=t.state&&e.push(t)}else this.startQuery(r)}e.length&&this.view.dispatch({effects:pht.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:uht.of(!1)})),20),this.composing=0}}}),bht=L4.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});const Oht=new class extends Wnt{};Oht.startSide=1,Oht.endSide=-1;"object"==typeof navigator&&navigator.userAgent;const Sht=[{key:"Ctrl-Space",run:t=>!!t.state.field(mht,!1)&&(t.dispatch({effects:uht.of(!0)}),!0)},{key:"Escape",run:t=>{let e=t.state.field(mht,!1);return!(!e||!e.active.some((t=>0!=t.state)))&&(t.dispatch({effects:fht.of(null)}),!0)}},{key:"ArrowDown",run:wht(!0)},{key:"ArrowUp",run:wht(!1)},{key:"PageDown",run:wht(!0,"page")},{key:"PageUp",run:wht(!1,"page")},{key:"Enter",run:t=>{let e=t.state.field(mht,!1);return!(t.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<75)&&(Uot(t,e.open.options[e.open.selected]),!0)}}],xht=rnt(z4.computeN([Jot],(t=>t.facet(Jot).defaultKeymap?[Sht]:[])));class kht{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),Mht.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Mht.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new Dht(this),n=new Dht(t);for(let t=e,r=e;;){if(s.next(t),n.next(t),t=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(r+=s.value.length,s.done||r>=i)return!0}}iter(t=1){return new Dht(this,t)}iterRange(t,e=this.length){return new Rht(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new Eht(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new Aht(t):Mht.from(Aht.split(t,[])):kht.empty}}class Aht extends kht{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((e?i:o)>=t)return new Bht(s,o,i,r);s=o+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new Aht(Tht(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&s){let t=i.pop(),e=Cht(n.text,t.text.slice(),0,n.length);if(e.length<=32)i.push(new Aht(e,t.length+n.length));else{let t=e.length>>1;i.push(new Aht(e.slice(0,t)),new Aht(e.slice(t)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof Aht))return super.replace(t,e,i);let s=Cht(this.text,Cht(i.text,Tht(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new Aht(s,n):Mht.from(Aht.split(s,[]),n)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<=e&&r<this.text.length;r++){let o=this.text[r],h=n+o.length;n>t&&r&&(s+=i),t<h&&e>n&&(s+=o.slice(Math.max(0,t-n),e-n)),n=h+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,32==i.length&&(e.push(new Aht(i,s)),i=[],s=-1);return s>-1&&e.push(new Aht(i,s)),e}}class Mht extends kht{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,h=i+r.lines-1;if((e?h:o)>=t)return r.lineInner(t,e,i,s);s=o+1,i=h+1}}decompose(t,e,i,s){for(let n=0,r=0;r<=e&&n<this.children.length;n++){let o=this.children[n],h=r+o.length;if(t<=h&&e>=r){let n=s&((r<=t?1:0)|(h>=e?2:0));r>=t&&h<=e&&!n?i.push(o):o.decompose(t-r,e-r,i,n)}r=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(t>=n&&e<=o){let h=r.replace(t-n,e-n,i),l=this.lines-r.lines+h.lines;if(h.lines<l>>4&&h.lines>l>>6){let n=this.children.slice();return n[s]=h,new Mht(n,this.length-(e-t)+i.length)}return super.replace(n,o,h)}n=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=e;n++){let o=this.children[n],h=r+o.length;r>t&&n&&(s+=i),t<h&&e>r&&(s+=o.sliceString(t-r,e-r,i)),r=h+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Mht))return 0;let i=0,[s,n,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==r||n==o)return i;let h=this.children[s],l=t.children[n];if(h!=l)return i+h.scanIdentical(l,e);i+=h.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new Aht(i,e)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],h=0,l=-1,a=[];function c(t){let e;if(t.lines>n&&t instanceof Mht)for(let e of t.children)c(e);else t.lines>r&&(h>r||!h)?(d(),o.push(t)):t instanceof Aht&&h&&(e=a[a.length-1])instanceof Aht&&t.lines+e.lines<=32?(h+=t.lines,l+=t.length+1,a[a.length-1]=new Aht(e.text.concat(t.text),e.length+1+t.length)):(h+t.lines>s&&d(),h+=t.lines,l+=t.length+1,a.push(t))}function d(){0!=h&&(o.push(1==a.length?a[0]:Mht.from(a,l)),l=-1,h=a.length=0)}for(let e of t)c(e);return d(),1==o.length?o[0]:new Mht(o,e)}}function Cht(t,e,i=0,s=1e9){for(let n=0,r=0,o=!0;r<t.length&&n<=s;r++){let h=t[r],l=n+h.length;l>=i&&(l>s&&(h=h.slice(0,s-n)),n<i&&(h=h.slice(i-n)),o?(e[e.length-1]+=h,o=!1):e.push(h)),n=l+1}return e}function Tht(t,e,i){return Cht(t,[""],e,i)}kht.empty=new Aht([""],0);class Dht{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof Aht?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof Aht?s.text.length:s.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(s instanceof Aht){let n=s.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,n.length>Math.max(0,t))return this.value=0==t?n:e>0?n.slice(t):n.slice(0,n.length-t),this;t-=n.length}else{let n=s.children[r+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof Aht?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class Rht{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Dht(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class Eht{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(kht.prototype[Symbol.iterator]=function(){return this.iter()},Dht.prototype[Symbol.iterator]=Rht.prototype[Symbol.iterator]=Eht.prototype[Symbol.iterator]=function(){return this});class Bht{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}let Pht="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let t=1;t<Pht.length;t++)Pht[t]+=Pht[t-1];function Lht(t){for(let e=1;e<Pht.length;e+=2)if(Pht[e]>t)return Pht[e-1]<=t;return!1}function Vht(t){return t>=127462&&t<=127487}function Wht(t,e,i=!0,s=!0){return(i?Nht:Hht)(t,e,s)}function Nht(t,e,i){if(e==t.length)return e;e&&Qht(t.charCodeAt(e))&&Iht(t.charCodeAt(e-1))&&e--;let s=zht(t,e);for(e+=Fht(s);e<t.length;){let n=zht(t,e);if(8205==s||8205==n||i&&Lht(n))e+=Fht(n),s=n;else{if(!Vht(n))break;{let i=0,s=e-2;for(;s>=0&&Vht(zht(t,s));)i++,s-=2;if(i%2==0)break;e+=2}}}return e}function Hht(t,e,i){for(;e>0;){let s=Nht(t,e-2,i);if(s<e)return s;e--}return 0}function Qht(t){return t>=56320&&t<57344}function Iht(t){return t>=55296&&t<56320}function zht(t,e){let i=t.charCodeAt(e);if(!Iht(i)||e+1==t.length)return i;let s=t.charCodeAt(e+1);return Qht(s)?s-56320+(i-55296<<10)+65536:i}function Fht(t){return t<65536?1:2}const $ht=/\r\n?|\n/;var qht=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(qht||(qht={}));class _ht{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?(t(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(t,e=!1){Uht(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new _ht(t)}composeDesc(t){return this.empty?t:t.empty?this:Yht(this,t)}mapDesc(t,e=!1){return t.empty?this:Zht(this,t,e)}mapPos(t,e=-1,i=qht.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],h=this.sections[r++],l=s+o;if(h<0){if(l>t)return n+(t-s);n+=o}else{if(i!=qht.Simple&&l>=t&&(i==qht.TrackDel&&s<t&&l>t||i==qht.TrackBefore&&s<t||i==qht.TrackAfter&&l>t))return null;if(l>t||l==t&&e<0&&!o)return t==s||e<0?n:n+h;n+=h}s=l}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&n>=t)return!(s<t&&n>e)||"cover";s=n}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new _ht(t)}}class Ght extends _ht{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Uht(this,((e,i,s,n,r)=>t=t.replace(s,s+(i-e),r)),!1),t}mapDesc(t,e=!1){return Zht(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let r=e[s],o=e[s+1];if(o>=0){e[s]=o,e[s+1]=r;let h=s>>1;for(;i.length<h;)i.push(kht.empty);i.push(r?t.slice(n,n+r):kht.empty)}n+=r}return new Ght(e,i)}compose(t){return this.empty?t:t.empty?this:Yht(this,t,!0)}map(t,e=!1){return t.empty?this:Zht(this,t,e,!0)}iterChanges(t,e=!1){Uht(this,t,e)}get desc(){return new _ht(this.sections)}filter(t){let e=[],i=[],s=[],n=new Kht(this);t:for(let r=0,o=0;;){let h=r==t.length?1e9:t[r++];for(;o<h||o==h&&0==n.len;){if(n.done)break t;let t=Math.min(n.len,h-o);Xht(s,t,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;Xht(e,t,r),r>0&&jht(i,e,n.text),n.forward(t),o+=t}let l=t[r++];for(;o<l;){if(n.done)break t;let t=Math.min(n.len,l-o);Xht(e,t,-1),Xht(s,t,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(t),o+=t}}return{changes:new Ght(e,i),filtered:new _ht(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],r=0,o=null;function h(t=!1){if(!t&&!s.length)return;r<e&&Xht(s,e-r,-1);let i=new Ght(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function t(l){if(Array.isArray(l))for(let e of l)t(e);else if(l instanceof Ght){if(l.length!=e)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${e})`);h(),o=o?o.compose(l.map(o)):l}else{let{from:t,to:o=t,insert:a}=l;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=a?"string"==typeof a?kht.of(a.split(i||$ht)):a:kht.empty,d=c.length;if(t==o&&0==d)return;t<r&&h(),t>r&&Xht(s,t-r,-1),Xht(s,o-t,d),jht(n,s,c),r=o}}(t),h(!o),o}static empty(t){return new Ght(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if("number"==typeof n)e.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)e.push(n[0],0);else{for(;i.length<s;)i.push(kht.empty);i[s]=kht.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new Ght(e,i)}}function Xht(t,e,i,s=!1){if(0==e&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:0==e&&0==t[n]?t[n+1]+=i:s?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function jht(t,e,i){if(0==i.length)return;let s=e.length-2>>1;if(s<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<s;)t.push(kht.empty);t.push(i)}}function Uht(t,e,i){let s=t.inserted;for(let n=0,r=0,o=0;o<t.sections.length;){let h=t.sections[o++],l=t.sections[o++];if(l<0)n+=h,r+=h;else{let a=n,c=r,d=kht.empty;for(;a+=h,c+=l,l&&s&&(d=d.append(s[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)h=t.sections[o++],l=t.sections[o++];e(n,a,r,c,d),n=a,r=c}}}function Zht(t,e,i,s=!1){let n=[],r=s?[]:null,o=new Kht(t),h=new Kht(e);for(let t=0,e=0;;)if(-1==o.ins)t+=o.len,o.next();else if(-1==h.ins&&e<t){let i=Math.min(h.len,t-e);h.forward(i),Xht(n,i,-1),e+=i}else if(h.ins>=0&&(o.done||e<t||e==t&&(h.len<o.len||h.len==o.len&&!i))){for(Xht(n,h.ins,-1);t>e&&!o.done&&t+o.len<e+h.len;)t+=o.len,o.next();e+=h.len,h.next()}else{if(!(o.ins>=0)){if(o.done&&h.done)return r?new Ght(n,r):new _ht(n);throw new Error("Mismatched change set lengths")}{let i=0,s=t+o.len;for(;;)if(h.ins>=0&&e>t&&e+h.len<s)i+=h.ins,e+=h.len,h.next();else{if(!(-1==h.ins&&e<s))break;{let t=Math.min(h.len,s-e);i+=t,h.forward(t),e+=t}}Xht(n,i,o.ins),r&&jht(r,n,o.text),t=s,o.next()}}}function Yht(t,e,i=!1){let s=[],n=i?[]:null,r=new Kht(t),o=new Kht(e);for(let t=!1;;){if(r.done&&o.done)return n?new Ght(s,n):new _ht(s);if(0==r.ins)Xht(s,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=s.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;Xht(s,e,i,t),n&&i&&jht(n,s,o.text)}else-1==o.ins?(Xht(s,r.off?0:r.len,e,t),n&&jht(n,s,r.textBit(e))):(Xht(s,r.off?0:r.len,o.off?0:o.ins,t),n&&!o.off&&jht(n,s,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||s.length>i),r.forward2(e),o.forward(e)}}else Xht(s,0,o.ins,t),n&&jht(n,s,o.text),o.next()}}class Kht{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?kht.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?kht.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Jht{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new Jht(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return tlt.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return tlt.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return tlt.range(t.anchor,t.head)}}class tlt{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:tlt.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new tlt([this.main])}addRange(t,e=!0){return tlt.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,tlt.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new tlt(t.ranges.map((t=>Jht.fromJSON(t))),t.main)}static single(t,e=t){return new tlt([tlt.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return elt(t.slice(),e);i=n.to}return new tlt(t,e)}static cursor(t,e=0,i,s){return new Jht(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(t,e,i){let s=(null!=i?i:33554431)<<5;return e<t?new Jht(e,t,24|s):new Jht(t,e,s|(e>t?4:0))}}function elt(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let s=t[i],n=t[i-1];if(s.empty?s.from<=n.to:s.from<n.to){let r=n.from,o=Math.max(s.to,n.to);i<=e&&e--,t.splice(--i,2,s.anchor>s.head?tlt.range(o,r):tlt.range(r,o))}}return new tlt(t,e)}function ilt(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let slt=0;class nlt{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.extensions=n,this.id=slt++,this.default=t([])}static define(t={}){return new nlt(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:rlt),!!t.static,t.enables)}of(t){return new olt([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new olt(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new olt(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function rlt(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class olt{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=slt++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,r=t[n]>>1,o=2==this.type,h=!1,l=!1,a=[];for(let i of this.dependencies)"doc"==i?h=!0:"selection"==i?l=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&a.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(h&&e.docChanged||l&&(e.docChanged||e.selection)||llt(t,a)){let e=i(t);if(o?!hlt(e,t.values[r],s):!s(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure:(t,e)=>{let h=i(t),l=e.config.address[n];if(null!=l){let i=vlt(e,l);if(this.dependencies.every((i=>i instanceof nlt?e.facet(i)===t.facet(i):!(i instanceof dlt)||e.field(i,!1)==t.field(i,!1)))||(o?hlt(h,i,s):s(h,i)))return t.values[r]=i,0}return t.values[r]=h,1}}}}function hlt(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function llt(t,e){let i=!1;for(let s of e)1&wlt(t,s)&&(i=!0);return i}function alt(t,e,i){let s=i.map((e=>t[e.id])),n=i.map((t=>t.type)),r=s.filter((t=>!(1&t))),o=t[e.id]>>1;function h(t){let i=[];for(let e=0;e<s.length;e++){let r=vlt(t,s[e]);if(2==n[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of s)wlt(t,e);return t.values[o]=h(t),1},update(t,i){if(!llt(t,r))return 0;let s=h(t);return e.compare(s,t.values[o])?0:(t.values[o]=s,1)},reconfigure(t,n){let r=llt(t,s),l=n.config.facets[e.id],a=n.facet(e);if(l&&!r&&rlt(i,l))return t.values[o]=a,0;let c=h(t);return e.compare(c,a)?(t.values[o]=a,0):(t.values[o]=c,1)}}}const clt=nlt.define({static:!0});class dlt{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new dlt(slt++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(clt).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],n=this.updateF(s,i);return this.compareF(s,n)?0:(t.values[e]=n,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,clt.of({field:this,create:t})]}get extension(){return this}}const ult=2;class flt{constructor(t,e){this.inner=t,this.prec=e}}class plt{of(t){return new glt(this,t)}reconfigure(t){return plt.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class glt{constructor(t,e){this.compartment=t,this.inner=e}}class mlt{constructor(t,e,i,s,n,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),r=new Map;for(let i of function(t,e,i){let s=[[],[],[],[],[]],n=new Map;function r(t,o){let h=n.get(t);if(null!=h){if(h<=o)return;let e=s[h].indexOf(t);e>-1&&s[h].splice(e,1),t instanceof glt&&i.delete(t.compartment)}if(n.set(t,o),Array.isArray(t))for(let e of t)r(e,o);else if(t instanceof glt){if(i.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(t.compartment)||t.inner;i.set(t.compartment,s),r(s,o)}else if(t instanceof flt)r(t.inner,t.prec);else if(t instanceof dlt)s[o].push(t),t.provides&&r(t.provides,o);else if(t instanceof olt)s[o].push(t),t.facet.extensions&&r(t.facet.extensions,o);else{let e=t.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(e,o)}}return r(t,ult),s.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof dlt?s.push(i):(n[i.facet.id]||(n[i.facet.id]=[])).push(i);let o=Object.create(null),h=[],l=[];for(let t of s)o[t.id]=l.length<<1,l.push((e=>t.slot(e)));let a=null==i?void 0:i.config.facets;for(let t in n){let e=n[t],s=e[0].facet,r=a&&a[t]||[];if(e.every((t=>0==t.type)))if(o[s.id]=h.length<<1|1,rlt(r,e))h.push(i.facet(s));else{let t=s.combine(e.map((t=>t.value)));h.push(i&&s.compare(t,i.facet(s))?i.facet(s):t)}else{for(let t of e)0==t.type?(o[t.id]=h.length<<1|1,h.push(t.value)):(o[t.id]=l.length<<1,l.push((e=>t.dynamicSlot(e))));o[s.id]=l.length<<1,l.push((t=>alt(t,s,e)))}}let c=l.map((t=>t(o)));return new mlt(t,r,c,o,h,n)}}function wlt(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function vlt(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const ylt=nlt.define(),blt=nlt.define({combine:t=>t.some((t=>t)),static:!0}),Olt=nlt.define({combine:t=>t.length?t[0]:void 0,static:!0}),Slt=nlt.define(),xlt=nlt.define(),klt=nlt.define(),Alt=nlt.define({combine:t=>!!t.length&&t[0]});class Mlt{constructor(t,e){this.type=t,this.value=e}static define(){return new Clt}}class Clt{of(t){return new Mlt(this,t)}}class Tlt{constructor(t){this.map=t}of(t){return new Dlt(this,t)}}class Dlt{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new Dlt(this.type,e)}is(t){return this.type==t}static define(t={}){return new Tlt(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}Dlt.reconfigure=Dlt.define(),Dlt.appendConfig=Dlt.define();class Rlt{constructor(t,e,i,s,n,r){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&ilt(i,e.newLength),n.some((t=>t.type==Rlt.time))||(this.annotations=n.concat(Rlt.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(Rlt.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function Elt(t,e){let i=[];for(let s=0,n=0;;){let r,o;if(s<t.length&&(n==e.length||e[n]>=t[s]))r=t[s++],o=t[s++];else{if(!(n<e.length))return i;r=e[n++],o=e[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function Blt(t,e,i){var s;let n,r,o;return i?(n=e.changes,r=Ght.empty(e.changes.length),o=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):null===(s=t.selection)||void 0===s?void 0:s.map(n),effects:Dlt.mapEffects(t.effects,n).concat(Dlt.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Plt(t,e,i){let s=e.selection,n=Wlt(e.annotations);return e.userEvent&&(n=n.concat(Rlt.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ght?e.changes:Ght.of(e.changes||[],i,t.facet(Olt)),selection:s&&(s instanceof tlt?s:tlt.single(s.anchor,s.head)),effects:Wlt(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function Llt(t,e,i){let s=Plt(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=Blt(s,Plt(t,e[n],r?s.changes.newLength:t.doc.length),r)}let n=new Rlt(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(klt),s=t;for(let n=i.length-1;n>=0;n--){let r=i[n](t);r&&Object.keys(r).length&&(s=Blt(t,Plt(e,r,t.changes.newLength),!0))}return s==t?t:new Rlt(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let s of e.facet(Slt)){let e=s(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:Elt(i,e))}if(!0!==i){let s,n;if(!1===i)n=t.changes.invertedDesc,s=Ght.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,n=e.filtered.invertedDesc}t=new Rlt(e,s,t.selection&&t.selection.map(n),Dlt.mapEffects(t.effects,n),t.annotations,t.scrollIntoView)}let s=e.facet(xlt);for(let i=s.length-1;i>=0;i--){let n=s[i](t);t=n instanceof Rlt?n:Array.isArray(n)&&1==n.length&&n[0]instanceof Rlt?n[0]:Llt(e,Wlt(n),!1)}return t}(n):n)}Rlt.time=Mlt.define(),Rlt.userEvent=Mlt.define(),Rlt.addToHistory=Mlt.define(),Rlt.remote=Mlt.define();const Vlt=[];function Wlt(t){return null==t?Vlt:Array.isArray(t)?t:[t]}var Nlt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Nlt||(Nlt={}));const Hlt=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Qlt;try{Qlt=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function Ilt(t){return e=>{if(!/\S/.test(e))return Nlt.Space;if(function(t){if(Qlt)return Qlt.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Hlt.test(i)))return!0}return!1}(e))return Nlt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return Nlt.Word;return Nlt.Other}}class zlt{constructor(t,e,i,s,n,r){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)wlt(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return wlt(this,i),vlt(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return Llt(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:n}=i;for(let e of t.effects)e.is(plt.reconfigure)?(i&&(n=new Map,i.compartments.forEach(((t,e)=>n.set(e,t))),i=null),n.set(e.value.compartment,e.value.extension)):e.is(Dlt.reconfigure)?(i=null,s=e.value):e.is(Dlt.appendConfig)&&(i=null,s=Wlt(s).concat(e.value));if(i)e=t.startState.values.slice();else{i=mlt.resolve(s,n,this),e=new zlt(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values}new zlt(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:tlt.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],r=Wlt(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),h=this.changes(o.changes),l=h.map(s);for(let t=0;t<i;t++)n[t]=n[t].map(l);let a=s.mapDesc(h,!0);n.push(o.range.map(a)),s=s.compose(l),r=Dlt.mapEffects(r,l).concat(Dlt.mapEffects(Wlt(o.effects),a))}return{changes:s,selection:tlt.create(n,e.mainIndex),effects:r}}changes(t=[]){return t instanceof Ght?t:Ght.of(t,this.doc.length,this.facet(zlt.lineSeparator))}toText(t){return kht.of(t.split(this.facet(zlt.lineSeparator)||$ht))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(wlt(this,e),vlt(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof dlt&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let e in i){let n=i[e],r=t[e];s.push(n.init((t=>n.spec.fromJSON(r,t))))}return zlt.create({doc:t.doc,selection:tlt.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=mlt.resolve(t.extensions||[],new Map),i=t.doc instanceof kht?t.doc:kht.of((t.doc||"").split(e.staticFacet(zlt.lineSeparator)||$ht)),s=t.selection?t.selection instanceof tlt?t.selection:tlt.single(t.selection.anchor,t.selection.head):tlt.single(0);return ilt(s,i.length),e.staticFacet(blt)||(s=s.asSingle()),new zlt(e,i,s,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet(zlt.tabSize)}get lineBreak(){return this.facet(zlt.lineSeparator)||"\n"}get readOnly(){return this.facet(Alt)}phrase(t){for(let e of this.facet(zlt.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(ylt))for(let r of n(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&s.push(r[t]);return s}charCategorizer(t){return Ilt(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),r=t-i,o=t-i;for(;r>0;){let t=Wht(e,r,!1);if(n(e.slice(t,r))!=Nlt.Word)break;r=t}for(;o<s;){let t=Wht(e,o);if(n(e.slice(o,t))!=Nlt.Word)break;o=t}return r==o?null:tlt.range(r+i,o+i)}}zlt.allowMultipleSelections=blt,zlt.tabSize=nlt.define({combine:t=>t.length?t[0]:4}),zlt.lineSeparator=Olt,zlt.readOnly=Alt,zlt.phrases=nlt.define({compare(t,e){let i=Object.keys(t),s=Object.keys(e);return i.length==s.length&&i.every((i=>t[i]==e[i]))}}),zlt.languageData=ylt,zlt.changeFilter=Slt,zlt.transactionFilter=xlt,zlt.transactionExtender=klt,plt.reconfigure=Dlt.define();class Flt{eq(t){return this==t}range(t,e=t){return new $lt(t,e,this)}}Flt.prototype.startSide=Flt.prototype.endSide=0,Flt.prototype.point=!1,Flt.prototype.mapMode=qht.TrackDel;class $lt{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function qlt(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class _lt{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,h=n[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==r)return h>=0?r:o;h>=0?o=s:r=s+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+t,this.to[n]+t,this.value[n]))return!1}map(t,e){let i=[],s=[],n=[],r=-1,o=-1;for(let h=0;h<this.value.length;h++){let l,a,c=this.value[h],d=this.from[h]+t,u=this.to[h]+t;if(d==u){let t=e.mapPos(d,c.startSide,c.mapMode);if(null==t)continue;if(l=a=t,c.startSide!=c.endSide&&(a=e.mapPos(d,c.endSide),a<l))continue}else if(l=e.mapPos(d,c.startSide),a=e.mapPos(u,c.endSide),l>a||l==a&&c.startSide>0&&c.endSide<=0)continue;(a-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,a-l)),i.push(c),s.push(l-r),n.push(a-r))}return{mapped:i.length?new _lt(s,n,i,o):null,pos:r}}}class Glt{constructor(t,e,i=Glt.empty,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(qlt)),this.isEmpty)return e.length?Glt.of(e):this;let o=new Ult(this,null,-1).goto(0),h=0,l=[],a=new Xlt;for(;o.value||h<e.length;)if(h<e.length&&(o.from-e[h].from||o.startSide-e[h].value.startSide)>=0){let t=e[h++];a.addInner(t.from,t.to,t.value)||l.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(o.chunkIndex)<e[h].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&a.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(a.addInner(o.from,o.to,o.value)||l.push(new $lt(o.from,o.to,o.value))),o.next());return a.finishInner(this.nextLayer.isEmpty&&!l.length?Glt.empty:this.nextLayer.update({add:l,filter:r,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n],h=t.touchesRange(r,r+o.length);if(!1===h)s=Math.max(s,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===h){let{mapped:n,pos:h}=o.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(h))}}let n=this.nextLayer.map(t);return 0==e.length?n:new Glt(i,e,n,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(e>=n&&t<=n+r.length&&!1===r.between(n,t-n,e-n,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return Zlt.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Zlt.from(t).goto(e)}static compare(t,e,i,s,n=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),h=jlt(r,o,i),l=new Klt(r,h,n),a=new Klt(o,h,n);i.iterGaps(((t,e,i)=>Jlt(l,t,a,e,i,s))),i.empty&&0==i.length&&Jlt(l,0,a,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=1e9);let n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(n.length!=r.length)return!1;if(!n.length)return!0;let o=jlt(n,r),h=new Klt(n,o,0).goto(i),l=new Klt(r,o,0).goto(i);for(;;){if(h.to!=l.to||!tat(h.active,l.active)||h.point&&(!l.point||!h.point.eq(l.point)))return!1;if(h.to>s)return!0;h.next(),l.next()}}static spans(t,e,i,s,n=-1){let r=new Klt(t,null,n).goto(e),o=e,h=r.openStart;for(;;){let t=Math.min(r.to,i);if(r.point?(s.point(o,t,r.point,r.activeForPoint(r.to),h,r.pointRank),h=r.openEnd(t)+(r.to>t?1:0)):t>o&&(s.span(o,t,r.active,h),h=r.openEnd(t)),r.to>i)break;o=r.to,r.next()}return h}static of(t,e=!1){let i=new Xlt;for(let s of t instanceof $lt?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(qlt(e,s)>0)return t.slice().sort(qlt);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}}Glt.empty=new Glt([],[],null,-1),Glt.empty.nextLayer=Glt.empty;class Xlt{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new _lt(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Xlt)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Glt.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=new Glt(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function jlt(t,e,i){let s=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&s.set(e.chunk[t],e.chunkPos[t]);let n=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=s.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||n.add(t.chunk[e])}return n}class Ult{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Zlt{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let r=t[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new Ult(r,e,i,n));return 1==s.length?s[0]:new Zlt(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)Ylt(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)Ylt(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Ylt(this.heap,0)}}}function Ylt(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let n=t[s];if(s+1<t.length&&n.compare(t[s+1])>=0&&(n=t[s+1],s++),i.compare(n)<0)break;t[s]=i,t[e]=n,e=s}}class Klt{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Zlt.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){eat(this.active,t),eat(this.activeTo,t),eat(this.activeRank,t),this.minActive=sat(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;iat(this.active,e,i),iat(this.activeTo,e,s),iat(this.activeRank,e,n),t&&iat(t,e,this.cursor.from),this.minActive=sat(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>t){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&eat(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let n=this.cursor.value;if(n.point){if(!(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.from<t&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let e=0;for(;e<i.length&&i[e]<t;)e++;this.openStart=e+s}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Jlt(t,e,i,s,n,r){t.goto(e),i.goto(s);let o=s+n,h=s,l=s-e;for(;;){let e=t.to+l-i.to||t.endSide-i.endSide,s=e<0?t.to+l:i.to,n=Math.min(s,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&tat(t.activeForPoint(t.to+l),i.activeForPoint(i.to))||r.comparePoint(h,n,t.point,i.point):n>h&&!tat(t.active,i.active)&&r.compareRange(h,n,t.active,i.active),s>o)break;h=s,e<=0&&t.next(),e>=0&&i.next()}}function tat(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function eat(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function iat(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function sat(t,e){let i=-1,s=1e9;for(let n=0;n<e.length;n++)(e[n]-s||t[n].endSide-t[i].endSide)<0&&(i=n,s=e[n]);return i}function nat(t,e,i=t.length){let s=0;for(let n=0;n<i;)9==t.charCodeAt(n)?(s+=e-s%e,n++):(s++,n=Wht(t,n));return s}const rat=1024;let oat=0;class hat{constructor(t,e){this.from=t,this.to=e}}class lat{constructor(t={}){this.id=oat++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=cat.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}lat.closedBy=new lat({deserialize:t=>t.split(" ")}),lat.openedBy=new lat({deserialize:t=>t.split(" ")}),lat.group=new lat({deserialize:t=>t.split(" ")}),lat.contextHash=new lat({perNode:!0}),lat.lookAhead=new lat({perNode:!0}),lat.mounted=new lat({perNode:!0});const aat=Object.create(null);class cat{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):aat,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new cat(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(lat.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(lat.group),s=-1;s<(i?i.length:0);s++){let n=e[s<0?t.name:i[s]];if(n)return n}}}}cat.none=new cat("",Object.create(null),0,8);const dat=new WeakMap,uat=new WeakMap;var fat;!function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"}(fat||(fat={}));class pat{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[t,e]of n)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(lat.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Aat(this.topNode,t)}cursorAt(t,e=0,i=0){let s=dat.get(this)||this.topNode,n=new Aat(s);return n.moveTo(t,e),dat.set(this,n._tree),n}get topNode(){return new bat(this,0,0,null)}resolve(t,e=0){let i=yat(dat.get(this)||this.topNode,t,e,!1);return dat.set(this,i),i}resolveInner(t,e=0){let i=yat(uat.get(this)||this.topNode,t,e,!0);return uat.set(this,i),i}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t;for(let r=this.cursor((t.mode||0)|fat.IncludeAnonymous);;){let t=!1;if(r.from<=n&&r.to>=s&&(r.type.isAnonymous||!1!==e(r))){if(r.firstChild())continue;t=!0}for(;t&&i&&!r.type.isAnonymous&&i(r),!r.nextSibling();){if(!r.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Dat(cat.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new pat(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new pat(cat.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,maxBufferLength:n=rat,reused:r=[],minRepeatType:o=s.types.length}=t,h=Array.isArray(i)?new gat(i,i.length):i,l=s.types,a=0,c=0;function d(t,e,i,w,v){let{id:y,start:b,end:O,size:S}=h,x=c;for(;S<0;){if(h.next(),-1==S){let e=r[y];return i.push(e),void w.push(b-t)}if(-3==S)return void(a=y);if(-4==S)return void(c=y);throw new RangeError(`Unrecognized record size: ${S}`)}let k,A,M=l[y],C=b-t;if(O-b<=n&&(A=g(h.pos-e,v))){let e=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=e.length;for(;h.pos>i;)n=m(A.start,e,n);k=new mat(e,O-A.start,s),C=A.start-t}else{let t=h.pos-S;h.next();let e=[],i=[],s=y>=o?y:-1,r=0,l=O;for(;h.pos>t;)s>=0&&h.id==s&&h.size>=0?(h.end<=l-n&&(f(e,i,b,r,h.end,l,s,x),r=e.length,l=h.end),h.next()):d(b,t,e,i,s);if(s>=0&&r>0&&r<e.length&&f(e,i,b,r,b,l,s,x),e.reverse(),i.reverse(),s>-1&&r>0){let t=u(M);k=Dat(M,e,i,0,e.length,0,O-b,t,t)}else k=p(M,e,i,O-b,x-O)}i.push(k),w.push(C)}function u(t){return(e,i,s)=>{let n,r,o=0,h=e.length-1;if(h>=0&&(n=e[h])instanceof pat){if(!h&&n.type==t&&n.length==s)return n;(r=n.prop(lat.lookAhead))&&(o=i[h]+n.length+r)}return p(t,e,i,s,o)}}function f(t,e,i,n,r,o,h,l){let a=[],c=[];for(;t.length>n;)a.push(t.pop()),c.push(e.pop()+i-r);t.push(p(s.types[h],a,c,o-r,l-o)),e.push(r-i)}function p(t,e,i,s,n=0,r){if(a){let t=[lat.contextHash,a];r=r?[t].concat(r):[t]}if(n>25){let t=[lat.lookAhead,n];r=r?[t].concat(r):[t]}return new pat(t,e,i,s,r)}function g(t,e){let i=h.fork(),s=0,r=0,l=0,a=i.end-n,c={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){let t=i.size;if(i.id==e&&t>=0){c.size=s,c.start=r,c.skip=l,l+=4,s+=4,i.next();continue}let h=i.pos-t;if(t<0||h<n||i.start<a)break;let d=i.id>=o?4:0,u=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break t;d+=4}else i.id>=o&&(d+=4);i.next()}r=u,s+=t,l+=d}return(e<0||s==t)&&(c.size=s,c.start=r,c.skip=l),c.size>4?c:void 0}function m(t,e,i){let{id:s,start:n,end:r,size:l}=h;if(h.next(),l>=0&&s<o){let o=i;if(l>4){let s=h.pos-(l-4);for(;h.pos>s;)i=m(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=n-t,e[--i]=s}else-3==l?a=s:-4==l&&(c=s);return i}let w=[],v=[];for(;h.pos>0;)d(t.start||0,t.bufferStart||0,w,v,-1);let y=null!==(e=t.length)&&void 0!==e?e:w.length?v[0]+w[0].length:0;return new pat(l[t.topID],w.reverse(),v.reverse(),y)}(t)}}pat.empty=new pat(cat.none,[],[],0);class gat{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new gat(this.buffer,this.index)}}class mat{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return cat.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(t+=4))return n;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return n+"("+r.join(",")+")"}findChild(t,e,i,s,n){let{buffer:r}=this,o=-1;for(let h=t;h!=e&&!(wat(n,s,r[h+1],r[h+2])&&(o=h,i>0));h=r[h+3]);return o}slice(t,e,i,s){let n=this.buffer,r=new Uint16Array(e-t);for(let s=t,o=0;s<e;)r[o++]=n[s++],r[o++]=n[s++]-i,r[o++]=n[s++]-i,r[o++]=n[s++]-t;return new mat(r,s-i,this.set)}}function wat(t,e,i,s){switch(t){case-2:return i<e;case-1:return s>=e&&i<e;case 0:return i<e&&s>e;case 1:return i<=e&&s>e;case 2:return s>e;case 4:return!0}}function vat(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function yat(t,e,i,s){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!s&&t instanceof bat&&t.index<0?null:t.parent;if(!e)return t;t=e}let r=s?0:fat.IgnoreOverlays;if(s)for(let s=t,o=s.parent;o;s=o,o=s.parent)s instanceof bat&&s.index<0&&(null===(n=o.enter(e,i,r))||void 0===n?void 0:n.from)!=s.from&&(t=o);for(;;){let s=t.enter(e,i,r);if(!s)return t;t=s}}class bat{constructor(t,e,i,s){this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let r=this;;){for(let{children:o,positions:h}=r._tree,l=e>0?o.length:-1;t!=l;t+=e){let l=o[t],a=h[t]+r.from;if(wat(s,i,a,a+l.length))if(l instanceof mat){if(n&fat.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,e,i-a,s);if(o>-1)return new kat(new xat(r,l,t,a),null,o)}else if(n&fat.IncludeAnonymous||!l.type.isAnonymous||Mat(l)){let o;if(!(n&fat.IgnoreMounts)&&l.props&&(o=l.prop(lat.mounted))&&!o.overlay)return new bat(o.tree,a,t,r);let h=new bat(l,a,t,r);return n&fat.IncludeAnonymous||!h.type.isAnonymous?h:h.nextChild(e<0?l.children.length-1:0,e,i,s)}}if(n&fat.IncludeAnonymous||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent._tree.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let s;if(!(i&fat.IgnoreOverlays)&&(s=this._tree.prop(lat.mounted))&&s.overlay){let i=t-this.from;for(let{from:t,to:n}of s.overlay)if((e>0?t<=i:t<i)&&(e<0?n>=i:n>i))return new bat(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new Aat(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return yat(this,t,e,!1)}resolveInner(t,e=0){return yat(this,t,e,!0)}enterUnfinishedNodesBefore(t){return vat(this,t)}getChild(t,e=null,i=null){let s=Oat(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Oat(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return Sat(this,t)}}function Oat(t,e,i,s){let n=t.cursor(),r=[];if(!n.firstChild())return r;if(null!=i)for(;!n.type.is(i);)if(!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}function Sat(t,e,i=e.length-1){for(let s=t.parent;i>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}class xat{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class kat{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new kat(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&fat.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new kat(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new kat(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new kat(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new Aat(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];t.push(i.slice(s,n,r,o)),e.push(0)}return new pat(this.type,t,e,this.to-this.from)}resolve(t,e=0){return yat(this,t,e,!1)}resolveInner(t,e=0){return yat(this,t,e,!0)}enterUnfinishedNodesBefore(t){return vat(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=Oat(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Oat(this,t,e,i)}get node(){return this}matchContext(t){return Sat(this,t)}}class Aat{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof bat)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof bat?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?!(i&fat.ExcludeBuffers)&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&fat.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&fat.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let s=e+t,n=t<0?-1:i._tree.children.length;s!=n;s+=t){let t=i._tree.children[s];if(this.mode&fat.IncludeAnonymous||t instanceof mat||!t.type.isAnonymous||Mat(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=t;r;r=r._parent)if(r.index==s){if(s==this.index)return r;e=r,i=n+1;break t}s=this.stack[--n]}for(let t=i;t<this.stack.length;t++)e=new kat(this.buffer,e,this.stack[t]);return this.bufferNode=new kat(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||!1!==t(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;s&&e&&e(this),s=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return Sat(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return Sat(this.node,t,s);let r=i[e.buffer[this.stack[n]]];if(!r.isAnonymous){if(t[s]&&t[s]!=r.name)return!1;s--}}return!0}}function Mat(t){return t.children.some((t=>t instanceof mat||!t.type.isAnonymous||Mat(t)))}const Cat=new WeakMap;function Tat(t,e){if(!t.isAnonymous||e instanceof mat||e.type!=t)return 1;let i=Cat.get(e);if(null==i){i=1;for(let s of e.children){if(s.type!=t||!(s instanceof pat)){i=1;break}i+=Tat(t,s)}Cat.set(e,i)}return i}function Dat(t,e,i,s,n,r,o,h,l){let a=0;for(let i=s;i<n;i++)a+=Tat(t,e[i]);let c=Math.ceil(1.5*a/8),d=[],u=[];return function e(i,s,n,o,h){for(let a=n;a<o;){let n=a,f=s[a],p=Tat(t,i[a]);for(a++;a<o;a++){let e=Tat(t,i[a]);if(p+e>=c)break;p+=e}if(a==n+1){if(p>c){let t=i[n];e(t.children,t.positions,0,t.children.length,s[n]+h);continue}d.push(i[n])}else{let e=s[a-1]+i[a-1].length-f;d.push(Dat(t,i,s,n,a,f,e,null,l))}u.push(f+h-r)}}(e,i,s,n,0),(h||l)(d,u,o)}class Rat{constructor(t,e,i,s,n=!1,r=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(t,e=[],i=!1){let s=[new Rat(0,t.length,t,0,!1,i)];for(let i of e)i.to>t.length&&s.push(i);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,r=t.length?t[0]:null;for(let o=0,h=0,l=0;;o++){let a=o<e.length?e[o]:null,c=a?a.fromA:1e9;if(c-h>=i)for(;r&&r.from<c;){let e=r;if(h>=e.from||c<=e.to||l){let t=Math.max(e.from,h)-l,i=Math.min(e.to,c)-l;e=t>=i?null:new Rat(t,i,e.tree,e.offset+l,o>0,!!a)}if(e&&s.push(e),r.to>c)break;r=n<t.length?t[n++]:null}if(!a)break;h=a.toA,l=a.toA-a.toB}return s}}class Eat{startParse(t,e,i){return"string"==typeof t&&(t=new Bat(t)),i=i?i.length?i.map((t=>new hat(t.from,t.to))):[new hat(0,0)]:[new hat(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let t=s.advance();if(t)return t}}}class Bat{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new lat({perNode:!0});var Pat;const Lat=new lat;class Vat{constructor(t,e,i=[]){this.data=t,zlt.prototype.hasOwnProperty("tree")||Object.defineProperty(zlt.prototype,"tree",{get(){return Nat(this)}}),this.parser=e,this.extension=[Gat.of(this),zlt.languageData.of(((t,e,i)=>t.facet(Wat(t,e,i))))].concat(i)}isActiveAt(t,e,i=-1){return Wat(t,e,i)==this.data}findRegions(t){let e=t.facet(Gat);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(t,e)=>{if(t.prop(Lat)==this.data)return void i.push({from:e,to:e+t.length});let n=t.prop(lat.mounted);if(n){if(n.tree.prop(Lat)==this.data){if(n.overlay)for(let t of n.overlay)i.push({from:t.from+e,to:t.to+e});else i.push({from:e,to:e+t.length});return}if(n.overlay){let t=i.length;if(s(n.tree,n.overlay[0].from+e),i.length>t)return}}for(let i=0;i<t.children.length;i++){let n=t.children[i];n instanceof pat&&s(n,t.positions[i]+e)}};return s(Nat(t),0),i}get allowsNesting(){return!0}}function Wat(t,e,i){let s=t.facet(Gat);if(!s)return null;let n=s.data;if(s.allowsNesting)for(let s=Nat(t).topNode;s;s=s.enter(e,i,fat.ExcludeBuffers))n=s.type.prop(Lat)||n;return n}Vat.setState=Dlt.define();function Nat(t){let e=t.field(Vat.state,!1);return e?e.tree:pat.empty}class Hat{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Qat=null;class Iat{constructor(t,e,i=[],s,n,r,o,h){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=r,this.skipped=o,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new Hat(this.state.doc),this.fragments)}work(t,e){return null!=e&&e>=this.state.doc.length&&(e=void 0),this.tree!=pat.empty&&this.isDone(null!=e?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof t){let e=Date.now()+t;t=()=>Date.now()>e}for(this.parse||(this.parse=this.startParse()),null!=e&&(null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(Rat.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=e?e:this.state.doc.length)))return!0;this.parse=this.startParse()}if(t())return!1}}))}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext((()=>{for(;!(e=this.parse.advance()););})),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Rat.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Qat;Qat=this;try{return t()}finally{Qat=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=zat(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:r,skipped:o}=this;if(this.takeTree(),!t.empty){let e=[];if(t.iterChangedRanges(((t,i,s,n)=>e.push({fromA:t,toA:i,fromB:s,toB:n}))),i=Rat.applyChanges(i,e),s=pat.empty,n=0,r={from:t.mapPos(r.from,-1),to:t.mapPos(r.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),s=t.mapPos(e.to,-1);i<s&&o.push({from:i,to:s})}}}return new Iat(this.parser,e,i,s,n,r,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:i,to:s}=this.skipped[e];i<t.to&&s>t.from&&(this.fragments=zat(this.fragments,i,s),this.skipped.splice(e--,1))}return!(this.skipped.length>=e)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends Eat{createParse(e,i,s){let n=s[0].from,r=s[s.length-1].to;return{parsedPos:n,advance(){let e=Qat;if(e){for(let t of s)e.tempSkipped.push(t);t&&(e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t)}return this.parsedPos=r,new pat(cat.none,[],[],r-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return Qat}}function zat(t,e,i){return Rat.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class Fat{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new Fat(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=new Iat(t.facet(Gat).parser,t,[],pat.empty,0,{from:0,to:e},[],null);return i.work(20,e)||i.takeTree(),new Fat(i)}}Vat.state=dlt.define({create:Fat.init,update(t,e){for(let t of e.effects)if(t.is(Vat.setState))return t.value;return e.startState.facet(Gat)!=e.state.facet(Gat)?Fat.init(e.state):t.apply(e)}});let $at=t=>{let e=setTimeout((()=>t()),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&($at=t=>{let e=-1,i=setTimeout((()=>{e=requestIdleCallback(t,{timeout:400})}),100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const qat="undefined"!=typeof navigator&&(null===(Pat=navigator.scheduling)||void 0===Pat?void 0:Pat.isInputPending)?()=>navigator.scheduling.isInputPending():null,_at=V9.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(Vat.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(Vat.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=$at(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(Vat.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,t&&!qat?Math.max(25,t.timeRemaining()-5):1e9),o=n.context.treeLen<s&&i.doc.length>s+1e3,h=n.context.work((()=>qat&&qat()||Date.now()>r),s+(o?0:1e5));this.chunkBudget-=Date.now()-e,(h||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:Vat.setState.of(new Fat(n.context))})),this.chunkBudget>0&&(!h||o)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then((()=>this.scheduleWork())).catch((t=>E9(this.view.state,t))).then((()=>this.workScheduled--)),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Gat=nlt.define({combine:t=>t.length?t[0]:null,enables:[Vat.state,_at]});const Xat=nlt.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function jat(t){let e=t.facet(Xat);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function Uat(t,e){let i="",s=t.tabSize;if(9==t.facet(Xat).charCodeAt(0))for(;e>=s;)i+="\t",e-=s;for(let t=0;t<e;t++)i+=" ";return i}class Zat{constructor(t,e){let i;function s(t){let e=jt.newName();return(i||(i=Object.create(null)))["."+e]=t,e}const n=e.scope;this.scope=n instanceof Vat?t=>t.prop(Lat)==n.data:n?t=>t==n:void 0,this.style=not(t.map((t=>({tag:t.tag,class:t.class||s(Object.assign({},t,{tag:null}))}))),{all:"string"==typeof e.all?e.all:e.all?s(e.all):void 0}).style,this.module=i?new jt(i):null,this.themeType=e.themeType}static define(t,e){return new Zat(t,e||{})}}bot.meta,bot.link,bot.heading,bot.emphasis,bot.strong,bot.strikethrough,bot.keyword,bot.atom,bot.bool,bot.url,bot.contentSeparator,bot.labelName,bot.literal,bot.inserted,bot.string,bot.deleted,bot.regexp,bot.escape,bot.string,bot.variableName,bot.variableName,bot.typeName,bot.namespace,bot.className,bot.variableName,bot.macroName,bot.propertyName,bot.comment,bot.invalid;const Yat=Object.create(null),Kat=[cat.none],Jat=[],tct=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])tct[t]=ict(Yat,e);function ect(t,e){Jat.indexOf(t)>-1||(Jat.push(t),console.warn(e))}function ict(t,e){let i=null;for(let s of e.split(".")){let e=t[s]||bot[s];e?"function"==typeof e?i?i=e(i):ect(s,`Modifier ${s} used at start of tag`):i?ect(s,`Tag ${s} used as modifier`):i=e:ect(s,`Unknown highlighting tag ${s}`)}if(!i)return 0;let s=e.replace(/ /g,"_"),n=cat.define({id:Kat.length,name:s,props:[eot({[s]:i})]});return Kat.push(n),n.id}const sct=Mlt.define(),nct=nlt.define();class rct{constructor(t,e,i,s,n){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=s,this.selectionsAfter=n}setSelAfter(t){return new rct(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:null===(t=this.changes)||void 0===t?void 0:t.toJSON(),mapped:null===(e=this.mapped)||void 0===e?void 0:e.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((t=>t.toJSON()))}}static fromJSON(t){return new rct(t.changes&&Ght.fromJSON(t.changes),[],t.mapped&&_ht.fromJSON(t.mapped),t.startSelection&&tlt.fromJSON(t.startSelection),t.selectionsAfter.map(tlt.fromJSON))}static fromTransaction(t,e){let i=lct;for(let e of t.startState.facet(nct)){let s=e(t);s.length&&(i=i.concat(s))}return!i.length&&t.changes.empty?null:new rct(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,lct)}static selection(t){return new rct(void 0,lct,void 0,void 0,t)}}function oct(t,e,i,s){let n=e+1>i+20?e-i-1:0,r=t.slice(n,e);return r.push(s),r}function hct(t,e){return t.length?e.length?t.concat(e):t:e}const lct=[];function act(t,e){if(t.length){let i=t[t.length-1],s=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return s.length&&s[s.length-1].eq(e)?t:(s.push(e),oct(t,t.length-1,1e9,i.setSelAfter(s)))}return[rct.selection([e])]}function cct(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function dct(t,e){if(!t.length)return t;let i=t.length,s=lct;for(;i;){let n=uct(t[i-1],e,s);if(n.changes&&!n.changes.empty||n.effects.length){let e=t.slice(0,i);return e[i-1]=n,e}e=n.mapped,i--,s=n.selectionsAfter}return s.length?[rct.selection(s)]:lct}function uct(t,e,i){let s=hct(t.selectionsAfter.length?t.selectionsAfter.map((t=>t.map(e))):lct,i);if(!t.changes)return rct.selection(s);let n=t.changes.map(e),r=e.mapDesc(t.changes,!0),o=t.mapped?t.mapped.composeDesc(r):r;return new rct(n,Dlt.mapEffects(t.effects,e),o,t.startSelection.map(r),s)}const fct=/^(input\.type|delete)($|\.)/;class pct{constructor(t,e,i=0,s){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new pct(this.done,this.undone):this}addChanges(t,e,i,s,n){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&t.changes&&(!i||fct.test(i))&&(!o.selectionsAfter.length&&e-this.prevTime<s&&function(t,e){let i=[],s=!1;return t.iterChangedRanges(((t,e)=>i.push(t,e))),e.iterChangedRanges(((t,e,n,r)=>{for(let t=0;t<i.length;){let e=i[t++],o=i[t++];r>=e&&n<=o&&(s=!0)}})),s}(o.changes,t.changes)||"input.type.compose"==i)?oct(r,r.length-1,n,new rct(t.changes.compose(o.changes),hct(t.effects,o.effects),o.mapped,o.startSelection,lct)):oct(r,r.length,n,t),new pct(r,lct,e,i)}addSelection(t,e,i,s){let n=this.done.length?this.done[this.done.length-1].selectionsAfter:lct;return n.length>0&&e-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(r=n[n.length-1],o=t,r.ranges.length==o.ranges.length&&0===r.ranges.filter(((t,e)=>t.empty!=o.ranges[e].empty)).length)?this:new pct(act(this.done,t),this.undone,e,i);var r,o}addMapping(t){return new pct(dct(this.done,t),dct(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let s=0==t?this.done:this.undone;if(0==s.length)return null;let n=s[s.length-1];if(i&&n.selectionsAfter.length)return e.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:sct.of({side:t,rest:cct(s)}),userEvent:0==t?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let i=1==s.length?lct:s.slice(0,s.length-1);return n.mapped&&(i=dct(i,n.mapped)),e.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:sct.of({side:t,rest:i}),filter:!1,userEvent:0==t?"undo":"redo",scrollIntoView:!0})}return null}}pct.empty=new pct(lct,lct);function gct(t,e){let i=-1;return t.changeByRange((s=>{let n=[];for(let r=s.from;r<=s.to;){let o=t.doc.lineAt(r);o.number>i&&(s.empty||s.to>o.from)&&(e(o,n,s),i=o.number),r=o.to+1}let r=t.changes(n);return{changes:n,range:tlt.range(r.mapPos(s.anchor,1),r.mapPos(s.head,1))}}))}const mct=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(gct(t,((e,i)=>{i.push({from:e.from,insert:t.facet(Xat)})})),{userEvent:"input.indent"})),!0),wct=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(gct(t,((e,i)=>{let s=/^\s*/.exec(e.text)[0];if(!s)return;let n=nat(s,t.tabSize),r=0,o=Uat(t,Math.max(0,n-jat(t)));for(;r<s.length&&r<o.length&&s.charCodeAt(r)==o.charCodeAt(r);)r++;i.push({from:e.from+r,to:e.from+s.length,insert:o.slice(r)})})),{userEvent:"delete.dedent"})),!0),vct={key:"Tab",run:mct,shift:wct};function yct(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function bct(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Oct(t,e){if(!e.anchorNode)return!1;try{return bct(t,e.anchorNode)}catch(t){return!1}}function Sct(t){return 3==t.nodeType?Lct(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function xct(t,e,i,s){return!!i&&(Act(t,e,i,s,-1)||Act(t,e,i,s,1))}function kct(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Act(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:Mct(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=kct(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?Mct(t):0}}}function Mct(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Cct={left:0,right:0,top:0,bottom:0};function Tct(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Dct(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Rct{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Ect,Bct=null;function Pct(t){if(t.setActive)return t.setActive();if(Bct)return t.focus(Bct);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Bct?{get preventScroll(){return Bct={preventScroll:!0},!0}}:void 0),!Bct){Bct=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function Lct(t,e,i=e){let s=Ect||(Ect=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function Vct(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function Wct(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Nct{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Nct(t.parentNode,kct(t),e)}static after(t,e){return new Nct(t.parentNode,kct(t)+1,e)}}const Hct=[];class Qct{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=Qct.get(e);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=Ict(e);else i.insertBefore(n.dom,e);s=n.dom}for(e=s?s.nextSibling:i.firstChild,e&&t&&t.node==i&&(t.written=!0);e;)e=Ict(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==Mct(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Qct.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let h=0,l=i,a=i;h<this.children.length;h++){let i=this.children[h],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=h,n=l),l>e&&i.dom.parentNode==this.dom){r=h,o=a;break}a=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Hct){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new zct(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Ict(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Qct.prototype.breakAfter=0;class zct{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Fct(t,e,i,s,n,r,o,h,l){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==s&&c&&!o&&!u&&r.length<2&&c.merge(i,n,r.length?d:null,0==i,h,l))){if(s<a.length){let t=a[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!u&&d&&t.merge(0,n,d,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,h,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,h,0),e++));e<s&&r.length;)if(a[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:h;else{if(!a[e].become(r[0]))break;e++,r.shift(),h=r.length?0:l}!r.length&&e&&s<a.length&&!a[e-1].breakAfter&&a[s].merge(0,0,a[e-1],!1,h,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function $ct(t,e,i,s,n,r){let o=t.childCursor(),{i:h,off:l}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of s)d+=t.length;t.length+=d,Fct(t,a,c,h,l,s,0,n,r)}let qct="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},_ct="undefined"!=typeof document?document:{documentElement:{style:{}}};const Gct=/Edge\/(\d+)/.exec(qct.userAgent),Xct=/MSIE \d/.test(qct.userAgent),jct=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qct.userAgent),Uct=!!(Xct||jct||Gct),Zct=!Uct&&/gecko\/(\d+)/i.test(qct.userAgent),Yct=!Uct&&/Chrome\/(\d+)/.exec(qct.userAgent),Kct="webkitFontSmoothing"in _ct.documentElement.style,Jct=!Uct&&/Apple Computer/.test(qct.vendor),tdt=Jct&&(/Mobile\/\w+/.test(qct.userAgent)||qct.maxTouchPoints>2);var edt={mac:tdt||/Mac/.test(qct.platform),windows:/Win/.test(qct.platform),linux:/Linux|X11/.test(qct.platform),ie:Uct,ie_version:Xct?_ct.documentMode||6:jct?+jct[1]:Gct?+Gct[1]:0,gecko:Zct,gecko_version:Zct?+(/Firefox\/(\d+)/.exec(qct.userAgent)||[0,0])[1]:0,chrome:!!Yct,chrome_version:Yct?+Yct[1]:0,ios:tdt,android:/Android\b/.test(qct.userAgent),webkit:Kct,safari:Jct,webkit_version:Kct?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=_ct.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class idt extends Qct{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof idt&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new idt(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Nct(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return ndt(this.dom,t,e)}}class sdt extends Qct{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Wct(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return(!i||!(!(i instanceof sdt&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0))&&($ct(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new sdt(this.mark,e,r)}domAtPos(t){return cdt(this.dom,this.children,t)}coordsAt(t,e){return udt(this,t,e)}}function ndt(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?edt.chrome||edt.gecko||(e?(n--,o=1):(r++,o=-1)):i<0?n--:r++;let h=Lct(t,n,r).getClientRects();if(!h.length)return Cct;let l=h[(o?o<0:i>=0)?0:h.length-1];return edt.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(h,(t=>t.width))||l),o?Tct(l,o<0):l||null}class rdt extends Qct{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||rdt)(t,e,i)}split(t){let e=rdt.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof rdt&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof rdt&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return E.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):E.empty}domAtPos(t){return 0==t?Nct.before(this.dom):Nct.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return Cct;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?s:Tct(s,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class odt extends rdt{domAtPos(t){let{topView:e,text:i}=this.widget;return e?hdt(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Nct(i,Math.min(t,i.nodeValue.length)))):new Nct(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?ldt(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?hdt(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>ndt(s,t,e))):ndt(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function hdt(t,e,i,s,n,r){if(i instanceof sdt){for(let o of i.children){let i=bct(o.dom,s),h=i?s.nodeValue.length:o.length;if(t<h||t==h&&o.getSide()<=0)return i?hdt(t,e,o,s,n,r):n(o,t,e);t-=h}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function ldt(t,e,i,s){if(i instanceof sdt)for(let n of i.children){let i=0,r=bct(n.dom,s);if(bct(n.dom,t))return i+(r?ldt(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class adt extends Qct{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof adt&&t.side==this.side}split(){return new adt(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Nct.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof idt){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof sdt&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return E.empty}}function cdt(t,e,i){let s=0;for(let n=0;s<e.length;s++){let r=e[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=e[s-1].dom;if(i.parentNode==t)return Nct.after(i)}return new Nct(t,0)}function ddt(t,e,i){let s,{children:n}=t;i>0&&e instanceof sdt&&n.length&&(s=n[n.length-1])instanceof sdt&&s.mark.eq(e.mark)?ddt(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function udt(t,e,i){for(let s=0,n=0;n<t.children.length;n++){let r,o=t.children[n],h=s+o.length;if((i<=0||h==t.length||o.getSide()>0?h>=e:h>e)&&(e<h||n+1==t.children.length||(r=t.children[n+1]).length||r.getSide()>0)){let t=0;if(h==s){if(o.getSide()<=0)continue;t=i=-o.getSide()}let n=o.coordsAt(Math.max(0,e-s),i);return t&&n?Tct(n,i<0):n}s=h}let s=t.dom.lastChild;if(!s)return t.dom.getBoundingClientRect();let n=Sct(s);return n[n.length-1]||null}function fdt(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function pdt(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function gdt(t,e,i){if(e)for(let s in e)i&&s in i||t.removeAttribute(s);if(i)for(let s in i)e&&e[s]==i[s]||t.setAttribute(s,i[s])}idt.prototype.children=rdt.prototype.children=adt.prototype.children=Hct;class mdt{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var wdt=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(wdt||(wdt={}));class vdt extends Yt{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new ydt(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Odt(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=Sdt(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Odt(t,e,i,s,t.widget||null,!0)}static line(t){return new bdt(t)}static set(t,e=!1){return ee.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}vdt.none=ee.empty;class ydt extends vdt{constructor(t){let{start:e,end:i}=Sdt(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof ydt&&this.tagName==t.tagName&&this.class==t.class&&pdt(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}ydt.prototype.point=!1;class bdt extends vdt{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof bdt&&pdt(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}bdt.prototype.mapMode=z.TrackBefore,bdt.prototype.point=!0;class Odt extends vdt{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?z.TrackBefore:z.TrackAfter:z.TrackDel}get type(){return this.startSide<this.endSide?wdt.WidgetRange:this.startSide<=0?wdt.WidgetBefore:wdt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Odt&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Sdt(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function xdt(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}Odt.prototype.point=!0;class kdt extends Qct{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof kdt))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),$ct(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new kdt;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){pdt(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){ddt(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=fdt(e,this.attrs||{})),i&&(this.attrs=fdt({class:i},this.attrs||{}))}domAtPos(t){return cdt(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Wct(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(gdt(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Qct.get(i)instanceof sdt;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=Qct.get(i))||void 0===e?void 0:e.isEditable)||edt.ios&&this.children.some((t=>t instanceof idt))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof idt))return null;let i=Sct(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return udt(this,t,e)}become(t){return!1}get type(){return wdt.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof kdt)return n;if(r>e)break}s=r+n.breakAfter}return null}}class Adt extends Qct{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Adt&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Nct.before(this.dom):Nct.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Adt(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Hct}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):E.empty}domBoundsAround(){return null}become(t){return t instanceof Adt&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Mdt{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Adt&&t.type==wdt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new kdt),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Cdt(new adt(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Cdt(new idt(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n){let r=e-t;if(i instanceof Odt)if(i.block){let{type:t}=i;t!=wdt.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Adt(i.widget||new Tdt("div"),r,t))}else{let o=rdt.create(i.widget||new Tdt("span"),r,i.startSide),h=this.atCursorPos&&!o.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||h||(this.pendingBuffer=0),this.flushBuffer(s),h&&(a.append(Cdt(new adt(1),s),n),n=s.length+Math.max(0,n-s.length)),a.append(Cdt(o,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}filterPoint(t,e,i,s){if(s<this.disallowBlockEffectsBelow&&i instanceof Odt){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,s,n){let r=new Mdt(t,e,i,n);return r.openEnd=ee.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Cdt(t,e){for(let i of e)t=new sdt(i,[t],t.length);return t}class Tdt extends mdt{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Ddt=[],Rdt=et.define(),Edt=et.define(),Bdt=et.define(),Pdt=et.define(),Ldt=et.define(),Vdt=et.define(),Wdt=Et.define({map:(t,e)=>t.map(e)}),Ndt=Et.define({map:(t,e)=>t.map(e)});class Hdt{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new Hdt(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Qdt=Et.define({map:(t,e)=>t.map(e)});function Idt(t,e,i){let s=t.facet(Pdt);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const zdt=et.define({combine:t=>!t.length||t[0]});class Fdt{constructor(t,e){this.field=t,this.get=e}}class $dt{from(t){return new Fdt(this,t)}static define(){return new $dt}}$dt.decorations=$dt.define(),$dt.atomicRanges=$dt.define(),$dt.scrollMargins=$dt.define();let qdt=0;const _dt=et.define();class Gdt{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=_dt.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:n}=e||{},r=[];if(s)for(let t of Array.isArray(s)?s:[s])r.push(t);return i&&r.push(Xdt.from((t=>({plugin:t,handlers:i})))),n&&r.push($dt.decorations.from(n)),new Gdt(qdt++,t,r)}static fromClass(t,e){return Gdt.define((e=>new t(e)),e)}}const Xdt=$dt.define();class jdt{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Idt(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Idt(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Idt(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Udt=et.define(),Zdt=et.define(),Ydt=et.define(),Kdt=et.define();class Jdt{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Jdt(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let h=s==t.length?null:t[s],l=r-o,a=h?h.fromB:1e9;for(;n<e.length&&e[n]<a;){let t=e[n],s=e[n+1],r=Math.max(o,t),h=Math.min(a,s);if(r<=h&&new Jdt(r+l,h+l,r,h).addToSet(i),s>a)break;n+=2}if(!h)return i;new Jdt(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),r=h.toA,o=h.toB}}}class tut{constructor(t,e,i=Ddt){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=$.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Jdt(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var eut=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(eut||(eut={}));const iut=eut.LTR,sut=eut.RTL;function nut(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const rut=nut("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),out=nut("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),hut=Object.create(null),lut=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);hut[e]=i,hut[i]=-e}const aut=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class cut{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?sut:iut}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const dut=[];function uut(t,e){let i=t.length,s=e==iut?1:2,n=e==iut?2:1;if(!t||1==s&&!aut.test(t))return fut(i);for(let e=0,n=s,o=s;e<i;e++){let i=(r=t.charCodeAt(e))<=247?rut[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?out[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=n:8==i&&4==o&&(i=16),dut[e]=4==i?2:i,7&i&&(o=i),n=i}var r;for(let t=0,e=s,n=s;t<i;t++){let s=dut[t];if(128==s)t<i-1&&e==dut[t+1]&&24&e?s=dut[t]=e:dut[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==dut[s];)s++;let r=t&&8==e||s<i&&8==dut[s]?1==n?1:8:256;for(let e=t;e<s;e++)dut[e]=r;t=s-1}else 8==s&&1==n&&(dut[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,h=0,l=0,a=0;h<i;h++)if(r=hut[e=t.charCodeAt(h)])if(r<0){for(let t=l-3;t>=0;t-=3)if(lut[t+1]==-r){let e=lut[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(dut[h]=dut[lut[t]]=i),l=t;break}}else{if(189==lut.length)break;lut[l++]=h,lut[l++]=e,lut[l++]=a}else if(2==(o=dut[h])||1==o){let t=o==s;a=t?0:1;for(let e=l-3;e>=0;e-=3){let i=lut[e+2];if(2&i)break;if(t)lut[e+2]|=2;else{if(4&i)break;lut[e+2]|=4}}}for(let t=0;t<i;t++)if(256==dut[t]){let e=t+1;for(;e<i&&256==dut[e];)e++;let n=1==(t?dut[t-1]:s),r=n==(1==(e<i?dut[e]:s))?n?1:2:s;for(let i=t;i<e;i++)dut[i]=r;t=e-1}let o=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=dut[t++];for(;t<i&&s==(1!=dut[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=dut[--i];for(;i>e&&s==(2!=dut[i-1]);)i--;o.push(new cut(i,t,s?2:1))}else o.push(new cut(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==dut[t++];for(;t<i&&s==(2==dut[t]);)t++;o.push(new cut(e,t,s?1:2))}return o}function fut(t){return[new cut(0,t,0)]}let put="";function gut(t,e,i,s,n){var r;let o=s.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),h=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),h=e.length-1)}h<0&&(h=cut.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[h];o==l.side(n,i)&&(l=e[h+=n?1:-1],o=l.side(!n,i));let a=n==(l.dir==i),c=O(t.text,o,a);if(put=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Y.cursor(c+t.from,a?-1:1,l.level);let d=h==(n?e.length-1:0)?null:e[h+(n?1:-1)];return d||l.level==i?d&&d.level<l.level?Y.cursor(d.side(!n,i)+t.from,n?1:-1,d.level):Y.cursor(c+t.from,n?-1:1,l.level):Y.cursor(n?t.to:t.from,n?-1:1,i)}class mut{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet($t.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=Qct.get(s),r=Qct.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:wut(s))||wut(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Qct.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function wut(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class vut{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class yut extends Qct{constructor(t){super(),this.view=t,this.compositionDeco=vdt.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new kdt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Jdt(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=vdt.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Out(t);if(!i)return vdt.none;let{from:s,to:n,node:r,text:o}=i,h=e.mapPos(s,1),l=Math.max(h,e.mapPos(n,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new mut([],a).readRange(r.firstChild,null).text;if(l-h<c.length)if(a.doc.sliceString(h,Math.min(a.doc.length,h+c.length),"￿")==c)l=h+c.length;else{if(a.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return vdt.none;h=l-c.length}else if(a.doc.sliceString(h,l,"￿")!=c)return vdt.none;let d=Qct.get(r);d instanceof odt?d=d.widget.topView:d&&(d.parent=null);return vdt.set(vdt.replace({widget:new Sut(r,o,d)}).range(h,l))}(this.view,t.changes)),(edt.ie||edt.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new kut;return ee.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Jdt.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=edt.chrome||edt.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Adt&&t.widget instanceof but&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:h}=s,{content:l,breakAtStart:a,openStart:c,openEnd:d}=Mdt.build(this.view.state.doc,o,h,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);Fct(this,p,g,u,f,l,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||edt.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(edt.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new Nct(t,0),i=!0}var o;let h=this.view.observer.selectionRange;!i&&h.focusNode&&xct(n.node,n.offset,h.anchorNode,h.anchorOffset)&&xct(r.node,r.offset,h.focusNode,h.focusOffset)||(this.view.observer.ignore((()=>{edt.android&&edt.chrome&&this.dom.contains(h.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=yct(this.root);if(s.empty){if(edt.gecko){let t=(e=n.node,i=n.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=xut(n.node,n.offset,1==t?1:-1);e&&(n=new Nct(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=h.cursorBidiLevel&&(h.cursorBidiLevel=s.bidiLevel)}else if(t.extend)t.collapse(n.node,n.offset),t.extend(r.node,r.offset);else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new Nct(h.anchorNode,h.anchorOffset),this.impreciseHead=r.precise?null:new Nct(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=yct(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=kdt.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let n=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(zdt)?this.root.activeElement==this.dom:Oct(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Qct.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof kdt)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=wdt.WidgetBefore&&n.type!=wdt.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==wdt.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,h=0;h<this.children.length;h++){let l=this.children[h],a=o+l.length;if(a>i)break;if(o>=e){let e=l.dom.getBoundingClientRect();if(t.push(e.height),n){let t=l.dom.lastChild,i=t?Sct(t):[];if(i.length){let t=i[i.length-1],n=this.view.textDirection==eut.LTR?t.right-e.left:e.right-t.left;n>r&&(r=n,this.minWidth=s,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+l.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof kdt){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=Sct(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new zct(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(vdt.replace({widget:new but(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return vdt.set(t)}updateDeco(){let t=this.view.pluginField($dt.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Ydt),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,h=0;for(let t of this.view.pluginField($dt.scrollMargins))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(h=Math.max(h,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+h};!function(t,e,i,s,n,r,o,h){let l=t.ownerDocument,a=l.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==l.body;if(d)t=Dct(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==n)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;f=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==h?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==eut.LTR)}}class but extends mdt{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Out(t){let e=t.observer.selectionRange,i=e.focusNode&&xut(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof kdt){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Qct.get(e);)e=e.previousSibling;let n=e?Qct.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof kdt)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class Sut extends mdt{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return odt}}function xut(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Mct(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class kut{constructor(){this.changes=[]}compareRange(t,e){xdt(t,e,this.changes)}comparePoint(t,e){xdt(t,e,this.changes)}}function Aut(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Mut(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Cut(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Tut(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Dut(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Rut(t,e,i){let s,n,r,o,h,l,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Sct(d);for(let u=0;u<t.length;u++){let f=t[u];n&&Cut(n,f)&&(f=Tut(Dut(f,n.bottom),n.top));let p=Aut(e,f),g=Mut(i,f);if(0==p&&0==g)return 3==d.nodeType?Eut(d,e,i):Rut(d,e,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(h=d,a=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):a&&Cut(a,f)?a=Dut(a,f.bottom):c&&Cut(c,f)&&(c=Tut(c,f.top))}}if(a&&a.bottom>=i?(s=h,n=a):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?Eut(s,d,i):r||"true"!=s.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}:Rut(s,d,i)}function Eut(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let h=0;h<s;h++){let s=Lct(t,h,h+1).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,s=i;if(edt.chrome||edt.gecko){Lct(t,h).getBoundingClientRect().left==a.right&&(s=!i)}if(c<=0)return{node:t,offset:h+(s?1:0)};n=h+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function But(t,{x:e,y:i},s,n=-1){var r;let o,h=t.contentDOM.getBoundingClientRect(),l=h.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-l;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=wdt.Text;)for(;c=n>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:s?null:Put(t,h,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:Put(t,h,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(h.left+1,Math.min(h.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),edt.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Lct(t,s-1,s).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let s=kdt.find(t.docView,d);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Rut(s.dom,e,i))}return t.docView.posFromDOM(g,m)}function Put(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+R(o,r,t.state.tabSize)}function Lut(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n);for(let o=e,h=null;;){let e=gut(n,r,t.textDirection,o,i),l=put;if(!e){if(n.number==(i?t.state.doc.lines:1))return o;l="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Y.cursor(i?n.from:n.to)}if(h){if(!h(l))return o}else{if(!s)return e;h=s(l)}o=e}}function Vut(t,e,i){let s=t.pluginField($dt.atomicRanges);for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.from>i.from?Y.cursor(s,1):Y.cursor(n,-1),t=!0)}));if(!t)return i}}class Wut{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in zut){let i=zut[e];t.contentDOM.addEventListener(e,(s=>{Iut(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),edt.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Xdt);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Iut(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Idt(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){Idt(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(edt.android&&edt.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!edt.ios||!(i=Nut.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Vct(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(edt.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!edt.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Nut=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Hut=[16,17,18,20,91,92,224,225];class Qut{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($t.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Rdt);return i.length?i[0](e):edt.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Edt);return i.length?i[0](e):edt.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=yct(t.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=tft(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Iut(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=Qct.get(s))&&i.ignoreEvent(e))return!1;return!0}const zut=Object.create(null),Fut=edt.ie&&edt.ie_version<15||edt.ios&&edt.webkit_version<604;function $ut(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=ift&&s.selection.ranges.every((t=>t.empty))&&ift==r.toString()){let t=-1;i=s.changeByRange((i=>{let h=s.doc.lineAt(i.from);if(h.from==t)return{range:i};t=h.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:h.from,insert:l},range:Y.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Y.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}zut.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():Hut.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};let qut=0;function _ut(t,e,i,s){if(1==s)return Y.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Y.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,h=r;i<0?o=O(n.text,r,!1):h=O(n.text,r);let l=s(n.text.slice(o,h));for(;o>0;){let t=O(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;h<n.length;){let t=O(n.text,h);if(s(n.text.slice(h,t))!=l)break;h=t}return Y.range(o+n.from,h+n.from)}(t.state,e,i);{let i=kdt.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Y.range(n,r)}}zut.touchstart=(t,e)=>{qut=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},zut.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},zut.mousedown=(t,e)=>{if(t.observer.flush(),qut>Date.now()-2e3&&1==tft(e))return;let i=null;for(let s of t.state.facet(Bdt))if(i=s(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Uut(t,e),s=tft(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),n=n.map(t.changes),o=null)},get(e,h,l){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Uut(t,e),o=e),!a||!i)return n;let c=_ut(t,a.pos,a.bias,s);if(i.pos!=a.pos&&!h){let e=_ut(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Y.range(n,r):Y.range(r,n)}return h?n.replaceRange(n.main.extend(c.from,c.to)):l?n.addRange(c):Y.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>Pct(t.contentDOM))),t.inputState.startMouseSelection(new Qut(t,e,i,s))}};let Gut=(t,e)=>t>=e.top&&t<=e.bottom,Xut=(t,e,i)=>Gut(e,i)&&t>=i.left&&t<=i.right;function jut(t,e,i,s){let n=kdt.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Xut(i,s,o))return-1;let h=n.coordsAt(r,1);return h&&Xut(i,s,h)?1:o&&Gut(s,o)?-1:1}function Uut(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:jut(t,i,e.clientX,e.clientY)}}const Zut=edt.ie&&edt.ie_version<=11;let Yut=null,Kut=0,Jut=0;function tft(t){if(!Zut)return t.detail;let e=Yut,i=Jut;return Yut=t,Jut=Date.now(),Kut=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Kut+1)%3:1}function eft(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,h={from:n,insert:i},l=t.state.changes(o?[o,h]:h);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}zut.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},zut.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&eft(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else eft(t,e,e.dataTransfer.getData("Text"),!0)},zut.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Fut?null:e.clipboardData;i?($ut(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),$ut(t,i.value)}),50)}(t)};let ift=null;function sft(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}zut.copy=zut.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;ift=n?i:null;let r=Fut?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},zut.focus=zut.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},zut.compositionstart=zut.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),sft(t,!0)))},zut.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&sft(t,!1)}),50)},zut.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},zut.beforeinput=(t,e)=>{var i;let s;if(edt.chrome&&edt.android&&(s=Nut.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const nft=["pre-wrap","normal","pre-line","break-spaces"];class rft{constructor(){this.doc=E.empty,this.lineWrapping=!1,this.direction=eut.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return nft.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n,r){let o=nft.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=n,h){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return h}}class oft{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class hft{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new hft(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new hft(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var lft=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(lft||(lft={}));class aft{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return aft.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:h,fromB:l,toB:a}=s[r],c=n.lineAt(o,lft.ByPosNoHeight,e,0,0),d=c.to>=h?c:n.lineAt(h,lft.ByPosNoHeight,e,0,0);for(a+=d.to-h,h=d.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,lft.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let u=gft.build(i,t,l,a);n=n.replace(o,h,u)}return n.updateHeight(i,0)}static empty(){return new dft(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new fft(aft.of(t.slice(0,e)),r,aft.of(t.slice(i)))}}aft.prototype.size=1;class cft extends aft{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new hft(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class dft extends cft{constructor(t,e){super(t,e,wdt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof dft||s instanceof uft&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof uft?s=new dft(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):aft.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class uft extends aft{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),h=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:a}=e.line(n+h);return new hft(l,a,i+o*h,o,wdt.Text)}lineAt(t,e,i,s,n){if(e==lft.ByHeight)return this.blockAt(t,i,s,n);if(e==lft.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new hft(e,s-e,0,0,wdt.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:h,length:l,number:a}=i.lineAt(t);return new hft(h,l,s+o*(a-r),o,wdt.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:h}=this.lines(i,n);for(let l=Math.max(t,n),a=Math.min(n+this.length,e);l<=a;){let e=i.lineAt(l);l==t&&(s+=h*(e.number-o)),r(new hft(e.from,e.length,s,h,wdt.Text)),s+=h,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof uft?i[i.length-1]=new uft(t.length+s):i.push(null,new uft(s-1))}if(t>0){let e=i[0];e instanceof uft?i[0]=new uft(t+e.length):i.unshift(new uft(t-1),null)}return aft.of(i)}decomposeLeft(t,e){e.push(new uft(t-1),null)}decomposeRight(t,e){e.push(null,new uft(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,h=t.heightChanged;for(s.from>e&&i.push(new uft(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=.001&&(o=-2);let h=new dft(e,n);h.outdated=!1,i.push(h),r+=e+1}r<=n&&i.push(null,new uft(n-r).updateHeight(t,r));let l=aft.of(i);return t.heightChanged=h||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class fft extends aft{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,h=e==lft.ByHeight?t<r:t<o,l=h?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(h?l.to<o:l.from>o))return l;let a=e==lft.ByPosNoHeight?lft.ByPosNoHeight:lft.ByPos;return h?l.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,h=n+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,n,r),e>=h&&this.right.forEachLine(t,e,i,o,h,r);else{let l=this.lineAt(h,lft.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,h,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&pft(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),pft(n,t)}return aft.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?aft.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,h=null;return s&&s.from<=e+n.length&&s.more?h=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?h=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),h?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function pft(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof uft&&(s=t[e+1])instanceof uft&&t.splice(e-1,3,new uft(i.length+1+s.length))}class gft{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof dft?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new dft(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new cft(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new dft(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new uft(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof dft)return t;let e=new dft(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=wdt.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=wdt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof dft||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new dft(0,-1));let i=t;for(let t of this.nodes)t instanceof dft&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new gft(i,t);return ee.spans(e,i,s,n,0),n.finish(i)}}class mft{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&xdt(t,e,this.changes,5)}}function wft(t,e){let i=t.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),h=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=h;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();s=Math.max(s,e.left),n=Math.min(n,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}function vft(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class yft{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return vdt.replace({widget:new bft(this.size,t)}).range(this.from,this.to)}}class bft extends mdt{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Oft{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new rft,this.scaler=Tft,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=aft.empty().applyChanges(t.facet(Ydt),E.empty,this.heightOracle.setDoc(t.doc),[new Jdt(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=vdt.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new Sft(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Tft:new Dft(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Rft(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(Ydt),n=t.changedRanges,r=Jdt.extendWithRanges(n,function(t,e,i){let s=new mft;return ee.compare(t,e,i,s,0),s.changes}(t.startState.facet(Ydt),s,t?t.changes:$.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let l=!t.changes.empty||2&t.flags||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace,r="rtl"==i.direction?eut.RTL:eut.LTR,o=this.heightOracle.mustRefreshForStyle(n,r),h=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,l=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,l|=8),h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,s=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==s||(l|=8,this.paddingTop=t,this.paddingBottom=s)}let c=(this.printing?vft:wft)(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,l|=8),h){let e=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(e)&&(o=!0),o||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:h}=t.docView.measureTextSize();o=s.refresh(n,r,i,h,p/h,e),o&&(t.docView.minWidth=0,l|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,o,new oft(this.viewport.from,e)),s.heightChanged&&(l|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,h=new Sft(s.lineAt(r-1e3*i,lft.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),lft.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<h.from||t>h.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,lft.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<h.from?o.top:o.bottom-r,h=new Sft(s.lineAt(i-500,lft.ByHeight,n,0,0).from,s.lineAt(i+r+500,lft.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new Sft(this.heightMap.lineAt(i,lft.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,lft.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,lft.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,lft.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new yft(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=eut.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=xft(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=kft(r,(this.visibleTop-i.top-t)/i.height),n=kft(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;s=kft(r,(this.pixelViewport.left-e)/t),n=kft(r,(this.pixelViewport.right+e)/t)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&Mft(o,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&Mft(o,h.to-10,h.to+10);for(let{from:s,to:n}of o)n-s>1e3&&e.push(Cft(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-s)<1e3&&Math.abs(t.to-n)<1e3))||new yft(s,n,this.gapSize(i,s,n,r)))}return e}gapSize(t,e,i,s){let n=Aft(s,i)-Aft(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){yft.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=vdt.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Ydt);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ee.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Rft(this.heightMap.lineAt(t,lft.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Rft(this.heightMap.lineAt(this.scaler.fromDOM(t),lft.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Rft(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Sft{constructor(t,e){this.from=t,this.to=e}}function xft(t,e,i){let s=[],n=t,r=0;return ee.spans(i.facet(Ydt),t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function kft({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function Aft(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}function Mft(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];if(n.from<i&&n.to>e){let r=[];n.from<e&&r.push({from:n.from,to:e}),n.to>i&&r.push({from:i,to:n.to}),t.splice(s,1,...r),s+=r.length-1}}}function Cft(t,e){for(let i of t)if(e(i))return i}const Tft={toDOM:t=>t,fromDOM:t=>t,scale:1};class Dft{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,lft.ByPos,t,0,0).top,o=e.lineAt(n,lft.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function Rft(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new hft(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>Rft(t,e))):t.type)}const Eft=et.define({combine:t=>t.join(" ")}),Bft=et.define({combine:t=>t.indexOf(!0)>-1}),Pft=jt.newName(),Lft=jt.newName(),Vft=jt.newName(),Wft={"&light":"."+Lft,"&dark":"."+Vft};function Nft(t,e,i){return new jt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const Hft=Nft("."+Pft,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Wft),Qft={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Ift=edt.ie&&edt.ie_version<=11;class zft{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Rct,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(edt.ie&&edt.ie_version<=11||edt.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Ift&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(zdt)?e.root.activeElement!=this.dom:!Oct(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((edt.ie&&edt.ie_version<=11||edt.android&&edt.chrome)&&!e.state.selection.main.empty&&i.focusNode&&xct(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=yct(t),i=edt.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,h=t.docView.domAtPos(t.state.selection.main.anchor);xct(h.node,h.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Qft),Ift&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Ift&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Vct(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&Oct(this.dom,this.selectionRange);if(e<0&&!n)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,s),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Fft(e,t.previousSibling||t.target.previousSibling,-1),s=Fft(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Fft(t,e,i){for(;e;){let s=Qct.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function $ft(t,e,i,s){let n,r,o=t.state.selection.main;if(e>-1){let s=t.docView.domBoundsAround(e,i,0);if(!s||t.state.readOnly)return;let{from:h,to:l}=s,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new vut(i,s)),n==i&&r==s||e.push(new vut(n,r)));return e}(t),c=new mut(a,t.state);c.readRange(s.startDOM,s.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||edt.android&&c.text.length<l-h)&&(d=o.to,u="end");let f=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;o>0&&h>0&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,h))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,h=r+(h-o),o=r}else if(h<r){r-=i<=r&&i>=h?r-i:0,o=r+(o-h),h=r}return{from:r,toA:o,toB:h}}(t.state.doc.sliceString(h,l,"￿"),c.text,d-h,u);f&&(edt.chrome&&13==t.inputState.lastKeyCode&&f.toB==f.from+2&&"￿￿"==c.text.slice(f.from,f.toB)&&f.toB--,n={from:h+f.from,to:h+f.toA,insert:E.of(c.text.slice(f.from,f.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Y.single(i+e,s+e):null}(a,h)}else if(t.hasFocus||!t.state.facet(zdt)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=t.docView,n=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!bct(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),h=s&&s.node==e.anchorNode&&s.offset==e.anchorOffset||!bct(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);n==o.head&&h==o.anchor||(r=Y.single(h,n))}if(n||r)if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4&&(n={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,o.to))}),n){let e=t.state;if(edt.ios&&t.inputState.flushIOSKey(t))return;if(edt.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&Vct(t.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&Vct(t.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&Vct(t.contentDOM,"Delete",46)))return;let i,s=n.insert.toString();if(t.state.facet(Vdt).some((e=>e(t,n.from,n.to,s))))return;if(t.inputState.composing>=0&&t.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&t.inputState.composing<0){let s=o.from<n.from?e.sliceDoc(o.from,n.from):"",r=o.to>n.to?e.sliceDoc(n.to,o.to):"";i=e.replaceSelection(t.state.toText(s+n.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let s=e.changes(n),h=r&&!e.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=t.state.sliceDoc(n.from,n.to),l=Out(t)||t.state.doc.lineAt(o.head),a=o.to-n.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:h||i.map(s)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=e.changes({from:u,to:d,insert:n.insert}),p=i.to-o.to;return{changes:f,range:h?Y.range(Math.max(0,h.anchor+p),Math.max(0,h.head+p)):i.map(f)}}))}else i={changes:s,selection:h&&e.selection.replaceRange(h)}}let h="input.type";t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:h})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class qft{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Oft(t.state||$t.create()),this.plugins=this.state.facet(_dt).map((t=>new jdt(t)));for(let t of this.plugins)t.update(this);this.observer=new zft(this,((t,e,i)=>{$ft(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Wut(this),this.docView=new yut(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof Bt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=this.state;for(let e of t){if(e.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=e.state}if(this.destroyed)return void(this.viewState.state=s);if(s.facet($t.phrases)!=this.state.facet($t.phrases))return this.setState(s);e=new tut(this,s,t);let n=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(n&&(n=n.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;n=new Hdt(t.empty?t:Y.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(Wdt)?n=new Hdt(t.value):t.is(Ndt)?n=new Hdt(t.value,"center"):t.is(Qdt)&&(n=t.value)}this.viewState.update(e,n),this.bidiCache=jft.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Kdt)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Eft)!=e.state.facet(Eft)&&(this.viewState.mustMeasureContent=!0),(i||n||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(Ldt))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Oft(t),this.plugins=t.facet(_dt).map((t=>new jdt(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new yut(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(_dt),i=t.state.facet(_dt);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new jdt(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let n=[];4&s||([this.measureRequests,n]=[n,this.measureRequests]);let r=n.map((t=>{try{return t.read(this)}catch(t){return Idt(this.state,t),Xft}})),o=new tut(this,this.state),h=!1,l=!1;o.flags|=s,e?e.flags|=s:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),h=this.docView.update(o));for(let t=0;t<n.length;t++)if(r[t]!=Xft)try{let e=n[t];e.write&&e.write(r[t],this)}catch(t){Idt(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),h&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(Ldt))t(e)}get themeClasses(){return Pft+" "+(this.state.facet(Bft)?Vft:Lft)+" "+this.state.facet(Eft)}updateAttrs(){let t=Uft(this,Udt,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(zdt)?"true":"false",class:"cm-content",style:`${edt.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Uft(this,Zdt,e),this.observer.ignore((()=>{gdt(this.contentDOM,this.contentAttrs,e),gdt(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(qft.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Kdt),jt.mount(this.root,this.styleModules.concat(Hft).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Gft(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Gft(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Gft(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Vut(this,t,Lut(this,t,e,i))}moveByGroup(t,e){return Vut(this,t,Lut(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==Qt.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.posAtCoords({x:i==(t.textDirection==eut.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=s)return Y.cursor(s,i?-1:1)}let o=kdt.find(t.docView,e.head),h=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Y.cursor(h,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return Vut(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Y.cursor(n,e.assoc);let o,h=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(n),c=t.documentTop;if(a)null==h&&(h=a.left-l.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(n-c);null==h&&(h=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let d=l.left+h,u=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(u+i)*r,a=But(t,{x:d,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?a<n:a>n))return Y.cursor(a,e.assoc,void 0,h)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:Wdt.of(Y.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),But(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return Tct(i,n[cut.find(n,t-s.from,-1,e)].dir==eut.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>_ft)return fut(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=uut(t.text,this.textDirection);return this.bidiCache.push(new jft(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||edt.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Pct(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Qdt.of(new Hdt("number"==typeof t?Y.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Gdt.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=jt.newName(),s=[Eft.of(i),Kdt.of(Nft(`.${i}`,t))];return e&&e.dark&&s.push(Bft.of(!0)),s}static baseTheme(t){return pt.lowest(Kdt.of(Nft("."+Pft,t,Wft)))}}qft.scrollTo=Wdt,qft.centerOn=Ndt,qft.styleModule=Kdt,qft.inputHandler=Vdt,qft.exceptionSink=Pdt,qft.updateListener=Ldt,qft.editable=zdt,qft.mouseSelectionStyle=Bdt,qft.dragMovesSelection=Edt,qft.clickAddsSelectionRange=Rdt,qft.decorations=Ydt,qft.darkTheme=Bft,qft.contentAttributes=Zdt,qft.editorAttributes=Udt,qft.lineWrapping=qft.contentAttributes.of({class:"cm-lineWrapping"}),qft.announce=Et.define();const _ft=4096;function Gft(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Xft={};class jft{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:eut.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new jft(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Uft(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&fdt(r,i)}return i}const Zft=!edt.ios;const Yft={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Zft&&(Yft[".cm-line"].caretColor="transparent !important");const Kft=!0,Jft="#24292e",tpt="#d1d5da",ept="#3392FF44",ipt="#c8e1ff",spt="#24292e",npt="#1b1f23",rpt="#2b3036",opt="#17E5E650",hpt="#f97583",lpt="#d1d5da",apt="#79b8ff",cpt="#9ecbff",dpt="#79b8ff",upt="#79b8ff",fpt="#b392f0",ppt="#79b8ff",gpt="#6a737d",mpt="#79b8ff",wpt="#f97583",vpt="#9ecbff",ypt=[qft.theme({"&":{color:tpt,backgroundColor:Jft},".cm-content":{caretColor:ipt},"&.cm-focused .cm-cursor":{borderLeftColor:ipt},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, & ::selection":{backgroundColor:ept},".cm-panels":{backgroundColor:spt,color:tpt},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:spt,outline:`1px solid ${npt}`},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:ept},".cm-activeLine":{backgroundColor:rpt},".cm-activeLineGutter":{backgroundColor:Jft},".cm-selectionMatch":{backgroundColor:ept},".cm-matchingBracket, .cm-nonmatchingBracket":{backgroundColor:opt,outline:"none"},".cm-gutters":{backgroundColor:Jft,color:tpt,border:"none"},".cm-lineNumbers, .cm-gutterElement":{color:"inherit"},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:tpt},".cm-tooltip":{border:`1px solid ${npt}`,backgroundColor:spt,color:tpt},".cm-tooltip.cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{background:ept,color:tpt}}},{dark:Kft}),tK.define([{tag:SK.keyword,color:hpt},{tag:[SK.name,SK.deleted,SK.character,SK.macroName],color:lpt},{tag:[SK.propertyName],color:apt},{tag:[SK.processingInstruction,SK.string,SK.inserted,SK.special(SK.string)],color:cpt},{tag:[SK.function(SK.variableName),SK.labelName],color:apt},{tag:[SK.color,SK.constant(SK.name),SK.standard(SK.name)],color:dpt},{tag:[SK.definition(SK.name),SK.separator],color:lpt},{tag:[SK.className],color:fpt},{tag:[SK.number,SK.changed,SK.annotation,SK.modifier,SK.self,SK.namespace],color:ppt},{tag:[SK.typeName],color:upt,fontStyle:upt},{tag:[SK.operator,SK.operatorKeyword],color:hpt},{tag:[SK.url,SK.escape,SK.regexp,SK.link],color:vpt},{tag:[SK.meta,SK.comment],color:gpt},{tag:SK.strong,fontWeight:"bold"},{tag:SK.emphasis,fontStyle:"italic"},{tag:SK.link,textDecoration:"underline"},{tag:SK.heading,fontWeight:"bold",color:mpt},{tag:[SK.atom,SK.bool,SK.special(SK.variableName)],color:lpt},{tag:SK.invalid,color:wpt},{tag:SK.strikethrough,textDecoration:"line-through"}])],bpt=t=>{const e=document.getElementById(t);if(null==e)throw new Error(`Can't find element with id ${t}`);return e},Opt={turn:0,robot:null,stage:null,program:t=>{},running:!1,canvas:null,context:null};let Spt=20;const xpt=t=>{var e;const i=(0,m.getBounds)(t),s=(i.right-i.left+1)*Spt;return(((null===(e=Opt.canvas)||void 0===e?void 0:e.width)||0)-s)/2},kpt=bpt("turn"),Apt=bpt("position"),Mpt=bpt("oil"),Cpt=(t,e,i)=>{e.clearRect(0,0,t.width,t.height),((t,e)=>{const i=xpt(e);for(let s=0;s<e.length;s++)for(let n=0;n<e[0].length;n++){const r=n*Spt+i,o=s*Spt,h=255-255*(0,m.getCell)(e,{x:n,y:s});t.fillStyle=`rgb(${h}, ${h}, ${h})`,t.fillRect(r,o,Spt,Spt),t.beginPath(),t.rect(r,o,Spt,Spt),t.strokeStyle="black",t.stroke()}})(e,i.stage),((t,e)=>{t.beginPath();const i=e.position.x*Spt+Spt/2+xpt(e.stage),s=e.position.y*Spt+Spt/2,n=Spt/2*.8;t.arc(i,s,n,0,2*Math.PI),t.fillStyle="#ff3b69",t.fill(),t.strokeStyle="#690c22",t.stroke()})(e,i),(t=>{kpt.textContent=Opt.turn.toString(),Apt.textContent=w.toString(t.position),Mpt.textContent=t.oil.toString()})(i)},Tpt=()=>{const{robot:t,program:e,canvas:i,context:s}=Opt;if(null==t||null==e||null==i||null==s)throw new Error("Invalid state");t.acted=!1,Cpt(i,s,t),Opt.running&&(Opt.turn++,e((0,l.makeRunner)(t)))},Dpt=t=>Math.floor(Math.random()*t),Rpt=t=>{const e=(0,m.getBounds)(t);return{x:Dpt(e.right-e.left),y:Dpt(e.bottom-e.top)}},Ept=t=>{Opt.stage=t,Opt.turn=0,Opt.robot={position:Rpt(t),oil:0,stage:t,acted:!1},(t=>{var e,i;const s=(null===(e=Opt.canvas)||void 0===e?void 0:e.width)||1,n=(null===(i=Opt.canvas)||void 0===i?void 0:i.height)||1,r=(0,m.getBounds)(t),o=s/(r.right-r.left+1),h=n/(r.bottom-r.top+1);Spt=Math.min(o,h)})(t)};n.start=t=>{const e=bpt(t),i=e.getContext("2d");if(null==i)throw new Error("Element isn't a canvas");let s;Opt.canvas=e,Opt.context=i,Ept(m.easy);const n=()=>{try{Tpt()}catch(t){console.error(t),clearInterval(s)}},r=t=>{s=setInterval(n,1e3/t)};r(1),((t,e,i)=>{const s=()=>{e.textContent=`${t.value}x`,i(Number(t.value))};t.addEventListener("change",s),s()})(bpt("speed"),bpt("speed-display"),(t=>{clearInterval(s),r(t)}))};const Bpt={easy:m.easy,medium:m.medium,hard:m.hard},Ppt=bpt("stage");Ppt.addEventListener("change",(()=>{const t=Ppt.value,e=Bpt[t];if(null==e)throw new Error(`Invalid stage: ${t}`);Ept(e)}));const Lpt=(Vpt=t=>{localStorage.setItem("program",t)},Wpt=1e3,Npt=0,function(...t){var e=Date.now();e-Npt>=Wpt&&(Vpt(...t),Npt=e)});var Vpt,Wpt,Npt;let Hpt=new Zn({state:$t.create({extensions:[k2,function(t={}){let e=t.jsx?t.typescript?fst:ust:t.typescript?dst:cst;return new Fw(e,cst.data.of({autocomplete:(i=["LineComment","BlockComment","String"],s=qit(ast),t=>{for(let e=Bw(t.state).resolveInner(t.pos,-1);e;e=e.parent)if(i.indexOf(e.name)>-1)return null;return s(t)})}));var i,s}(),ypt,function(t={}){return[mht,Jot.of(t),yht,xht,bht]}({override:[t=>{let e=t.matchBefore(/\w*/);return!e||e.from==e.to&&!t.explicit?null:{from:e.from,options:[{label:"robot.moveUp()",type:"function",info:"Moves up 1 square. Uses action."},{label:"robot.moveRight()",type:"function",info:"Moves right 1 square. Uses action."},{label:"robot.moveDown()",type:"function",info:"Moves down 1 square. Uses action."},{label:"robot.moveLeft()",type:"function",info:"Moves left 1 square. Uses action."},{label:"robot.drill()",type:"function",info:"Drills under the current position to get oil. Uses action."},{label:"robot.useSensor()",type:"function",info:"Returns a measurement of how much oil there is in the surroundings. Doesn't use action."},{label:"robot.getPosition()",type:"function",info:"Rgeturns the robot's position. Doesn't use action."}]}}]}),z4.of([vct]),Zn.updateListener.of((t=>{t.docChanged&&Lpt(t.state.doc.toString())}))],doc:localStorage.getItem("program")||"const program = (robot) => {\n  /* WRITE YOUR PROGRAM HERE */\n}"}),parent:document.getElementById("program")});const Qpt=bpt("start"),Ipt=bpt("stop");Ipt.disabled=!0,Qpt.addEventListener("click",(()=>{Opt.running||(Qpt.disabled=!0,Ipt.disabled=!1,Opt.program=Function(Hpt.state.doc.toString()+"; return program;")(),Opt.running=!0,Tpt())})),Ipt.addEventListener("click",(()=>{Opt.running&&(Ipt.disabled=!0,Qpt.disabled=!1,Ept(Opt.stage),Opt.running=!1,Tpt())}));const zpt=bpt("modal");bpt("help-button").addEventListener("click",(()=>{zpt.classList.remove("disabled")})),bpt("modal-close").addEventListener("click",(()=>{zpt.classList.add("disabled")})),(0,n.start)("canvas");
//# sourceMappingURL=index.61490ffe.js.map
